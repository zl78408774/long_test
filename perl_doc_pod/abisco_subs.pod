=head1 NAME

Abisco_Connection


=head1 DESCRIPTION

Document number: 1/190 55-CAH 161 1290/1 Uen
MODULE      : Abisco_Connection.pm
DESCRIPTION : ABISCO interface layer. Takes care of socket
handling and parsing in/out.

The package takes some options off @ARGV (see
'new'). It sets and uses the following corresponding
globals in the main package:

 $main::Opt_Host    - Default CH socket host
 $main::Opt_Port    - Default CH socket port
 $main::Opt_Server  - Add server name to ABISCO command
                      if none set explicitly
 $main::Opt_Debug   - Print trace info if set
 $main::Opt_Alone   - Run without ABISCO
 $main::Opt_Timeout - Default read timeout

@main::Replacements is a list of pairs that go into
an s/// operation.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME                    REVIEW    COMMENT
PA1 980806    QRAJRHD                           Development started
PA2 981127    QRAJRHD                           Ready for test
PA3 981214    QRAJRHD                           Ready for Octopus (R8)
PA4 981216    QRAJRHD                           Allow spaces in arrays, improved overrides
A   990308    QRAJRHD                           Improved parsing, new args to 'new'
P1B 990510    QRAJRHD                           Alternative response tag: ERR
P1C 990526    QRAJRHD                           Perfected pretty-printing
P1D 990817    QRAJRHD                           More parsable tags, started on Trig
P1E 990819    QRAJRHD                           Trigs working, many minor changes
P1F 990831    QRAJRHD                           Re-export everything in Msg
P1G 990913    QRAJRHD                           First_Abisco_Connection removed
P1H 990921    QRAJRHD                           Timeouts working, Cleanup added
P1I 991108    QRAJRHD                           Re-export Traffic
P1J 991114    QRAJRHD                           -Ignore
P1K 991114    QRAJRHD                            New parsable tag 'INTM'
P1L 991122    QRAJRHD                            Keyboard interrupt handler
P1M 991126    QRAJRHD                            '_' accepted in tags (for 'ABIS_UL')
P1N 000110    QRAJRHD                            Looping Get, more croaking
P1S 000330    QRAJRHD                            Tool would not go back from Manual to Auto sometimes
P1T 000501    QRAJRHD                            Improved error reporting slightly
P1U 000517    QRAJRHD                            Improved error message in Do
P1V 000519    QRAJRHD                            Prompt when 'Get'-ing from manual tools
P1X 000817    QRAJRHD                            Assert_Keys made case insensitive
P1Y 000920    QRAJRHD                            Input buffer lost at timeout
P1Z 001002    QRAJRHD                            Manual mode for specific tool instances
P2A 001020    QRAJRHD                            CH can't handle NL in strings
P2B 001101    QRAJRHD                            New interruptable hi-res 'Sleep'
P2C 001205    QRAJRHD                            Raw data mapped on 'Message' instead of 'Buf'
P2D 001213    ERAABAY                            Timeout => 0 means poll
P2E 001218    QRAJRHD                            Barf on arg overflow in Assert
P2F 001221    QRAJRHD                            Fix printouts in alone mode
P2G 010106    ERAABAY                            Croak on no connection
P2H 010223    QRAJRHD                            Manual tool intercept corrected in 'Get'
P2J 010810    QRAJRHD                            Get_Me, Do takes message pointer (like Put)
P2K 010815    QRAFRYS                            Assert should check Message key first
P2L 011009    QRAJRHD                            Get_Me must not set $_
P2M 011102    QRAFRYS                            Changed $Line substitution in Put routine
P2N 090325    XYNSTAN                            Added subs PendingMsg and GetSocket
B   20111008  ETORWIL                 XLEIMAR    Converted script to use strict, warnings and diagnostics
                                                 Moved code into template
                                                 Updated to pass thru perl::Critic with policy
                                                 Fixed subroutine new and subsequently called functions
                                                 Replaced @Complex::EXPORT_OK and $Msg::EXPORT_OK
                                                 with the actual function names.
                                                 Removed typo at import of comlex
C   20111024  XTOBSEM                 ETORWIL    Added GetActiveTG Exported @List

D   20111024  XTOBSEM                 ETORWIL    Fixed Bug in GetActiveTG

E   20111104  XTOBSEM                 XPRRANA    Fixed minor bug and changed the printout in GetActiveTG (HO97582).
F   20120223  XTEHKIN                 XSOFFRO    Fixed regular expression bug, TR HP52167.
G   20120323  XNAVNAS                 EDAMELI    Added option to enable/disable printout in GetActiveTG (HP64494).
H   20120412  XANSBEM                 XNAVNAS    Added more outputs from GetActiveTG (HP72473).
J   20121107  XSOFFRO                 EERICSV    Added output TRXTypeList and Cabinet in GetActiveTG (TR HQ45737).
                                                  General cleanup
K   20131206  Syntronic AB/     Syntronic AB/    HR96005: Skipped Unpack() for unknown message Abis(-)
              Adibah            Catherine
L   20140113  XPATHIL                 EDAMELI    Added StoreTG, ResetTG, GetTSConfig and GetSoftTGConfig (TR HP41622).
                                                  Applied PerlCritic

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Hash::Util> 

L<Complex> 

L<Msg> 

L<IO::Handle> 

L<IO::Socket> 

L<Getopt::Long> 

L<charnames> Lib with eg \N{SPACE} eq space char

L<English> Lib with readable names

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 new

 $self->new();

HEAD        : new
DESCRIPTION : Constructor, set up socket for use.
              Host/Port defaults can also be set on the command line

              $TG = new Abisco_Connection(Defaults => {Server => Traffic});

IN  : %1 - Hash of arguments, recognized tags (all optional):
            Host     => IP name/number of CH machine, default local_host
            Port     => Port number that C serves, default is 4051
            Defaults => Standard call-hash to be added as defaults
                        if the name is missing in a Do/Put,
OUT : Class reference


=head2 Assert

 $self->Assert();

HEAD        : Assert
DESCRIPTION : This class method is just a front end to Msg::Assert, see
              this sub-routine. In addition, the checking is supressed and the
              Required value is assigned to the Actual value if:
              - '-Ignore' is set
              - The required list contains a server/tool that is set to manual.

IN  : $1 - Values to check (scalar or ref to hash or array)
      $2 - Required Values (ditto). If $2 is absent $1 must be true.
      $3 - Force the check regardless of -Alone, -Ignore etc (internal use)
OUT : None (dies on mismatches)


=head2 Assert_Exactly

 $self->Assert_Exactly();

HEAD        : Assert_Exactly
DESCRIPTION : The same as 'Assert' except that no superfluos parameters
              are allowed. A third argument can be used to specify optionals (items
              that may be left out).

IN  : $1 - Values to check (scalar or ref to hash or array)
      $2 - Required contents of $1 (ditto)
      $2 - Optional contents (ditto, may be left out)
      $4 - Force (internal use, see 'Assert')
OUT : None (dies on mismatches)


=head2 Assert_Keys

 $self->Assert_Keys();

HEAD        : Assert_Keys
DESCRIPTION : Verify that all required keys are present, and that no
              unlisted keys are present. Does not handle sub-hashes.

IN  : $1 - Pointer to standard call-hash
      $2 - Pointer to list of required keys
      $3 - Pointer to list of optional keys
OUT : None (dies on error)


=head2 Assert_True

 $self->Assert_True();

HEAD        : Assert_True
DESCRIPTION : Same as Assert, but return true/false insead of raising
              and exception. If the result is false then the reason is in
              $EVAL_ERROR

IN  : $1 - Values to check (scalar or ref to hash or array)
      $2 - Expected Values (ditto)
      $3 - Force the check regardless of -Alone, -Ignore etc (internal use)
OUT : True if the patterns matched


=head2 Await

 $self->Await();

HEAD        : Await
DESCRIPTION : Obsolete - use Get.
              Wait for message matching specified pattern.
              Die if message not received within specified time.
              If there are multiple messages every second the loop
              may never finish since the time is low-resolution.
              Try turning off measurement reports then.

IN  : $1  - Timeout in seconds
      \%2 - Reference to command hash to look for, format
            as in Do/Put but without elements to be dis-
            carded (see 'Assert').
OUT : %1  - Matching input (hash or hash reference)


=head2 Cleanup

 $self->Cleanup();

HEAD        : Cleanup
DESCRIPTION : Consume all pending input for one instance if called
              as an instance method, or all if called as a class-method.

IN  : None
OUT : None


=head2 Configure

 $self->Configure();

HEAD        : Configure
DESCRIPTION : Set configuration property. The property applies #
              globally, not just for the current instance.

IN  : $1 - Property, currently supports:
         - Server: Default server to use if none is given
               explicitly. $2 is name of server, eg OM2000RO.
      $2 - Value to set property to
OUT : Current value if $2 not set


=head2 Do

 $self->Do();

HEAD        : Do
DESCRIPTION : Send command, scan for PROMPT and return RESP. Use oldest
              connection if not called via an instance handle.

IN  : %1 - Message-hash to send. The following extra pseudo-arguments are
            handled:
            Server   - The name of the ABISCO server
            Message  - The name of the ABISCO command/response
            Timeout  - Max time to wait for a response
                       or \%1 - Reference to the above
OUT : %1 - The response hash (or a reference in scalar context) to the
            command, or undef if transmission was skipped (due to a Trig).


=head2 Drop

 $self->Drop();

HEAD        : Drop
DESCRIPTION : Release the connection. The garabage collector starts when
              the caller undef's his handle. If the socket goes to the CH you should
              send CHEXTRAS.Output State=Off to prevent data from coming in after the
              cleanup.

IN  : None
OUT : None


=head2 Get

 $self->Get();

HEAD        : Get
DESCRIPTION : Return one incoming message. Die if it isn't received
              within the 'Timeout', or if the 'Expect'ed pattern doesn't appear
              before the 'Until' pattern.

              %Resp=$BTS->Get;  # Get next message
              %Resp=$BTS->Get(Timeout => 5.5, Expect => {AIP => 0}, Until => PROMPT);
              %Resp=$BTS->Get(Expect => {Message => Accept, Status => [OK, Brill]});

IN  : %1 - Hash with the following optional keys:
            Timeout => Max time to wait in $seconds (and fractions), default is
                       10 minutes or as specified on the command line.
            Expect  => Return last message matching this \%pattern or $tag.
                       Defaults is the same as 'Until'.
            Until   => Finish when this \%pattern or $tag matches. Default is
                      any message.

OUT : %1  - Message matching 'Expect' or
      \%1 - reference to it in scalar context


=head2 GetActiveTG

 $self->GetActiveTG();

HEAD        : GetActiveTG
DESCRIPTION : Return data for the connected TG from Abisco

OUT :
        AbisMode     - Abis Mode
        NumberOfTRX  - The number of TRXs defined in TG
        TG           - The number of the Active TG
        PCMList      - Active PCM lines
        TRXC         - Lowest number of started TRXs
        TRXList      - Array of started TRXs


=head2 GetSocket

 $self->GetSocket();

HEAD        : GetSocket
DESCRIPTION : Return the Abisco IO::Socket::INET socket object

IN  : <Template example row, please remove if not applicable>
OUT : a reference to the socket object


=head2 GetSoftTGConfig

 $self->GetSoftTGConfig();

HEAD        : GetSoftTGConfig
DESCRIPTION : Return data for the connected TGs soft configs, (not always
              needed for doing NewTG). The following is stored:
                IS, CON, DP, TX, RX and FM configuration param.
              * Refer to a TG conf file saved directly from Abisco.

IN  :   TGId
        TRXList (if you only have one TRX, put within brackets: TRXList => [$TRXC])
OUT :
        A hash with all DP, IS, CON, TX, RX and FM configuration parameters.


=head2 GetTSConfig

 $self->GetTSConfig();

HEAD        : GetTSConfig
DESCRIPTION : Return TS Configs for specified TRX on connected TG

IN :
        TGId           - The number of the Active TG
        TRXC           - The TRXNo of the TG
        TRXList        - A list of TRXs (for future implementations)
        AbisMode     - Abis Mode
        TS             - If only one TS Config is wanted
OUT:    A response hash with structure 'TS' => { InstanceNo => {
                                                    %TSConfig
                                                    } }


=head2 Get_Me

 $self->Get_Me();

HEAD        : Get_Me
DESCRIPTION : Load default Abisco_Connection object pointer from
              argument list if applicable.

IN  : \%1 - Abisco_Connection instance, or nothing.
      @2 - Anything you like
OUT : \%1 - Abisco_Connection instance


=head2 Get_One

 $self->Get_One();

HEAD        : Get_One
DESCRIPTION : Receive and parse response back to hash.
              ABISCO tags are assumed to be on.

IN  : $1  - Timeout in seconds (default 10 min. - enough for complete start)
OUT : \%1 - Input message hash


=head2 Get_Tag_Block

 $self->Get_Tag_Block();

HEAD        : Get_Tag_Block
DESCRIPTION : Read one line with timeout. Select must be used to
              to get a timeout on Win-NT.

IN  : $1 - Timeout in seconds
OUT : $1 - Tag
     $2 - String upto end tag


=head2 Interrupt_FD

 $self->Interrupt_FD();

HEAD        : Interrupt_FD
DESCRIPTION : Add another file descriptor to select list. If any
              input appears on this file the user interrupt signal handler is
              invoked.

IN  : $1 - File descriptor or reference to one (must be for input)
OUT : None


=head2 Is_Log_Message

 $self->Is_Log_Message();

HEAD        : Is_Log_Message
DESCRIPTION : Tell whether this is a log message or not (without auto-
              vivification).

IN  : \%1 - Message hash
OUT : $1 - True if and only if this is a log message


=head2 Manual

 $self->Manual();

HEAD        : Manual
DESCRIPTION : Class method, set server/tool instance to manual mode,
              or return current Auto/Manual setting. If one InstanceNo is set to
              manual then queries without instance return true (one for all - like
              three musketeers). This means that Asserts without InstanceNo
              will be supressed even if only one instance is manual.  Can handle
              all sorts of weird patterns (to make life easier for 'Assert').
              Get must be fast, Set can be as slow as it likes.

IN  : \%1 - Hash with the following keys (extraneous keys ignored)
        Server     => Name of a tool (letter case as emitted by ABISCO
        InstanceNo => Tool instance number (optional)
      $2 - True means set tool mode to manual, false means auto. Return
        current setting if parameter omitted.
OUT : Current value if $2 not used


=head2 Merge

 $self->Merge();

HEAD        : Merge
DESCRIPTION : Take two message hashes and create a superset. Values in
              the first argument override the second.

IN  : \%1 - Message hash
      \%2 - Message hash
OUT : \%1 - Hashes merged


=head2 PendingMsg

 $self->PendingMsg();

HEAD        : PendingMsg
DESCRIPTION : Check if there is at least one pending message buffered.
              If this fuction returns 1 it means that a Get() call will return an
              Abisco message without blocking.

IN  : <Template example row, please remove if not applicable>
OUT : 0 - no complete message in buffered data ([END] tag not found)
      1 - there is a complete message in buffered data ([END] tag found)


=head2 Put

 $self->Put();

HEAD        : Put
DESCRIPTION : Make specified substitutions and send command.
              Pretty print in alone mode.

IN  : %1 - Command hash or reference to it
OUT : $1 - False if transmission was skipped


=head2 Put_Tag_Block

 $self->Put_Tag_Block();

HEAD        : Put_Tag_Block
DESCRIPTION : Send one line to socket

IN  : $1 - Socket
      $2 - Message line
OUT : None


=head2 ResetTG

 $self->ResetTG();

SUBROUTINE  : ResetTG
DESCRIPTION : Reset the TG if the TG has been modified


IN  :     Cells, TG, MCTR, TGId, TRXList, TF
          TS, DP, IS, CON, TX, RX and FM
OUT :     0 if TG has not been modified
          1 If TG is restored
          -1 Failed to Restore TG
Sample:   $BTS->ResetTG(%StoredTG);


=head2 Sleep

 $self->Sleep();

HEAD        : Sleep
DESCRIPTION : The standard perl sleep resolution is one second, and
              it only sleeps to the 'top of the second', at least on some
              platforms. You can import 'Time::HiRes' but that's a non-standard
              package. Normal sleeps cannot be interrupted - this subroutine
              solves both problems. No sleep if alone mode. Resolution/minimum time
              is around 10 ms on NT4.

IN  : $1 - Timeout value in seconds (and fractions, e.g. 0.5)
OUT : None


=head2 StoreTG

 $self->StoreTG();

SUBROUTINE  : StoreTG
DESCRIPTION : Store TG parameters. This subroutin shall be followed by ResetTG


IN  :     TGId, TRXC, TRXList and AbisMode
          optionally: StoreAll => 'FALSE' for no TS, DP, IS, CON, TX, RX and FM data.
OUT :     {Cells}, {TG}, {MCTR},
          {TSConfig}, {DPConfig}, {ISConfig}, {CONConfig}, {TXConfig}, {RXConfig} and {FMConfig}
Sample:
Put in beginning of Precondition:
  %StoredTG = $BTS->StoreTG();
Put in Clean Up:
  $BTS->ResetTG(%StoredTG);
Dont forget to declare %StoredTG in scope for all script TCs!


=head2 Trig

 $self->Trig();

HEAD        : Trig
DESCRIPTION : Register a trig condition. The message hash is compared
              to input or output hashes with assert. Can be called as an
              ordinary sub, a class method or an instance method.

IN  : \%1 - Message pattern (do not change or supply a copy)
      \&2 - Adress of a call-back routine with the following specification:
            IN   : $1 - Abisco_Connection (or derived) instance
                   \%2 - matching msg-hash (which may be modified)
            OUT  : 'Next' means do not mask other triggers, keep searching.
                   'Skip' means:
            - DL : Do not send
            - UL : Ditch message and read again
      $3 - Monitor downlink if set (to anything), default is uplink
OUT : $1 - Unique Id for this trig


=head2 Trig_Maybe

 $self->Trig_Maybe();

HEAD        : Trig_Maybe
DESCRIPTION : Execute matching callbacks if any.

IN  : \%1 - Actual message (may be modified by the call-back routine
      $2  - 'DL' means this message is downlink
            'UL' means uplink
OUT : 'Skip' (see 'Trig') or false (but defined) otherwise


=head2 UnTrig

 $self->UnTrig();

HEAD        : UnTrig
DESCRIPTION : Remove trigger, see previous routine.

IN  : $1 - Unique Id for this trig
OUT : None



=cut

=head1 NAME

Abisco_Statistics


=head1 DESCRIPTION

Defines block contents for Messages and Timeouts


=head1 REQUIRES

L<Abisco_Connection> 

L<diagnostics> 


=head1 IMPLEMENTS

L<Exporter> 


=head1 METHODS

=head2 EstablishmentCause

 $self->EstablishmentCause();

Subroutine: EstablishmentCause
Purpose:
Input:      %Param hash
Output:


=head2 GetChannelStatistics(%)

 $self->GetChannelStatistics(%)();

Subroutine: GetChannelStatistics
Input:      %Param hash consisting of:
            AbiscoCon => Abisco connection
Output:	  	Hash containing the statistics


=head2 GetTrafficStatistics(%)

 $self->GetTrafficStatistics(%)();

Subroutine: GetTrafficStatistics
Purpose:
Input:      %Param hash consisting of:
            AbiscoCon => Abisco connection
            TypeOfStatistics => The type of statistics to request. Optional
                                and defaults to All if not specified.
Output:	  	Hash containing the statistics with first level as the statistics
            type.


=head2 MeasurementResults

 $self->MeasurementResults();

Subroutine: MeasurementResults
Purpose:
Input:      %Param hash
Output:


=head2 MeasurementResultsMs

 $self->MeasurementResultsMs();

Subroutine: MeasurementResultsMs
Purpose:
Input:      %Param hash
Output:


=head2 MessagesAndTimeouts

 $self->MessagesAndTimeouts();

Subroutine: MessagesAndTimeouts
Purpose:
Input:      %Param hash
Output:


=head2 ResponseTimes

 $self->ResponseTimes();

Subroutine: ResponseTimes
Purpose:
Input:      %Param hash
Output:


=head2 ReturnCodes

 $self->ReturnCodes();

Subroutine: ReturnCodes
Purpose:
Input:      %Param hash
Output:


=head2 TimeMeasurements

 $self->TimeMeasurements();

Subroutine: TimeMeasurement
Purpose:
Input:      %Param hash
Output:


=head2 UnpackChannelStatistics

 $self->UnpackChannelStatistics();

=head2 UnpackTrafficStatistics

 $self->UnpackTrafficStatistics();

Subroutine: UnpackTrafficStatistics
Purpose:
Input:      %Param hash
Output:


=head2 initEstCause

 $self->initEstCause();

Subroutine: initEstCause
Purpose:
Input:      %Param hash
Output:


=head2 initMsgAndTimeouts

 $self->initMsgAndTimeouts();

Subroutine: initMsgAndTimeouts
Purpose:
Input:      %Param hash
Output:


=head2 initReturnCodes

 $self->initReturnCodes();

Subroutine: initReturnCodes
Purpose:
Input:      %Param hash
Output:


=head2 initTimeMeas

 $self->initTimeMeas();

Subroutine: initTimeMeas
Purpose:
Input:      %Param hash
Output:



=cut

=head1 NAME

AbiscoFunc1


=head1 DESCRIPTION

Document number: 8/190 55-CAH 161 1290/1 Uen
MODULE      : AbiscoFunc1.pm
DESCRIPTION : This module contains functions that in use should resemble those in Abisco.
              Function in this module may have dependencies on other modules.

              GetTGData should be run at the beginning of each test case. It populates hash %TG
              which is used throughout all test programs to obtain data by simply looking at the
              appropriate hash entry whithout calling functions each and every time, as was
              practiced previously.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
PA1 20051128  ERADIPE             First revision
P1A 20080319  ERABAHG             Merged from branch \dev_08a
P1B 20090428  ERATZIS             Removed Prompt
A   20110817  XLOHFOO   ETORWIL   Updated to new script template
                                   Quality control with PerlCritic
                                   Added document number.
                                   Added TG as Typeglob

Note that on 2011-06-20 the revision style was changed back to A, B and so on.


=head1 REQUIRES

L<English> 

L<Carp> 

L<AbiscoFunc2> 

L<PerlFunc> 

L<DVTFunc> 

L<User> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 GetTGData

 GetTGData();

SUBROUTINE  : GetTGData
DESCRIPTION : Fills %TG with TG and cell data used throughout this program.
              Data is read from the TG itself, from the DVT and from the OMT.

              Example: GetTGData();
                       GetTGData('DVT', 'OMT');

IN  : Any combination of 'DVT', 'OMT' and 'Site'.
OUT :



=cut

=head1 NAME

AbiscoFunc2


=head1 DESCRIPTION

Document number: 9/190 55-CAH 161 1290/1 Uen
MODULE      : AbiscoFunc2.pm
DESCRIPTION : This module contains functions that in use should resemble
              those in Abisco. Functions in this module shall have no
              dependencies on other modules except for Globals and PerlFunc.

              - GetSeveral is a variation of Get_And_Count. It returns lists
                containing signals, arrival times e.t.c. which can be
                searched. It returns also a status which is quite useful.

              - GetPARList makes PAR parameters visible to other modules
                without having to specify them in the other modules.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV   DATE       NAME      REVIEW    COMMENT
PA1   20051128   ERADIPE             First revision
P1A   20080319   ERABAHG             New revision
A     20111018   XTOBSEM   ETORWIL   Updated to new script template
                                      Quality control with PerlCritic
                                      Added document number.
                                      Changed order of timeout check in GetSeveral
B     20120229   XMAROHM   ETORWIL   Updated GetSeveral due to TR: HP54734

Note that on 2011-06-20 the revision style was changed back to A, B and so on.


=head1 REQUIRES

L<English> 

L<Carp> 

L<PerlFunc> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 GetPARList

 GetPARList();

SUBROUTINE  : GetPARList
DESCRIPTION :

IN  :
OUT :


=head2 GetSeveral

 GetSeveral();

SUBROUTINE  : GetSeveral
DESCRIPTION : Example calls:

           $SignalList = GetSeveral(BTSConn => $BTS1,
                                    Timeout => 30,
                                    Until   => {Message => 'PROMPT'});

           $SignalList = GetSeveral(BTSConn => $BTS1,
                                    Expect  => [{Message => 'Accept'},
                                                {Message => 'RFResourceIndication'}],
                                    Upto    => [1, 3],
                                    Timeout => 10);

           $SignalList = GetSeveral(BTSConn => $BTS1,
                                    Expect  => [{Message => 'Accept'},
                                                {Message => 'RFResourceIndication'}]);

           -  {BTSConn} is mandatory.
           -  {Expect} shall contain a list of hashes ready for Assert_True.
           -  {Upto} may exist if {Expect} exists in which case GetSeveral tries to catch all the
               expected signals, or may not exist in which case GetSeveral returns when the first
               signal in the expected list arrives.
           -  {Until} is a hash ready for Assert_True.
           -  {Expect} and {Until} can coexist.
           -  {Timeout} defaults to 10 minutes. Upon exiry of the timeout the function returns.

           Returned from GetSeveral is a reference to a hash with entries the
           signal names that were received. Five additional entries are supplied:

             {Status}   : 'TIMED OUT' || 'UNTIL SIGNAL RECEIVED' || 'EXPECTED SIGNALS RECEIVED' || 'ONE SIGNAL RECEIVED'
             {Signals}  : e.g. {Accept => 1, RFResourceIndication => 3, FaultReport => 2}
                          indicating the number of signals of each sort that were received.
             {Sequence} : [[RFResourceIndication, 1],
                           [FaultReport, 1],
                           [Accept, 1],
                           [FaultReport, 2],
                           [RFResourceIndication, 2],
                           [RFResourceIndication, 3]]
             {Answer}   : If {Expect} is supplied without {Upto}, then entry {Answer} shows the
                          signal that was caught. Entry {Status} indicates 'ONE SIGNAL RECEIVED'.
             {Response} : Is the message taged as RESP.
                          Relevant only when a RESP is received (e.g. when waiting for RESP).
                          If a RESP has not been received then this is set to 'undef'.

           The signals look like this:
             {Accept}{001}
             {FaultReport}{001}
             {RFResourceIndication}{001}
             {RFResourceIndication}{002}
             {FaultReport}{002}
             {RFResourceIndication}{003}

           The first entry is $ReceivedSignal (e.g. Accept, FaultReport, ACK).
           After that follows the sequence number formatted in three digits.
           Each entry above is a hash having two entries: {Sig} and {Time}. Entry Sig is the
           signal as received with a little modification done for Abis signals, PROMPT's etc.
           This is done for simplification, we would like for instance to be able to say:

               Expect => [{Message => 'ChannelActAck__ABIS_UL'},
                          {Message => 'PROMPT'}]

           Messages tagged as RESP, ERR, SPONT and REPORT will set $ReceivedSignal to $Resp->{Message}.

           Messages tagged as ABIS_DL and ABIS_UL will set $ReceivedSignal to the signal name extracted
           from $Resp->{Message} and concatenated with the tag, e.g. 'NegotiationRequest__ABIS_DL'.
           Under {Sig} there are only three keys: 'TimeStamp(ms)', 'Data (Hex)' and 'Data (Text)' which
           are extracted from $Resp->{Message}. All other keys are deleted and {Message} is set to
           $ReceivedSignal (to be able to do Assert).

           All other tags, e.g. ACK or ECHO, set $ReceivedSignal to $Resp->{Tag}. No relevant data
           is saved under {Sig}. $Resp->{Message} is set to the tag.


IN     : See example above.
OUT    :


=head2 GreaterOrEqual

 GreaterOrEqual();

SUBROUTINE  : GreaterOrEqual
DESCRIPTION :

IN  :
OUT :



=cut

=head1 NAME

AbiscoFunc3


=head1 DESCRIPTION

Document number: 10/190 55-CAH 161 1290/1 Uen
MODULE      : AbiscoFunc3.pm
DESCRIPTION : Contains only MGetSeveral, a multi-threaded version of
              GetSeveral.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV   DATE      NAME      REVIEW    COMMENT
PA1   20051128  ERADIPE             First revision
PA3   20080213  XRSJALI             From ver13 on GSMRBS disk
P1A   20080319  ERABAHG             Merged from \dev_08a. New rev
A     20110819  XLEIMAR   ETORWIL   Updated to new script template,
                                     Quality control with PerlCritic
                                     Added document number.
                                     Removed global $T0.
                                     Removed unecessary imports.
                                     Changed die to croak.
                                     Replaced // with m{} and
                                      s/// with s{}{} for all regexps.

Note that on 2011-06-20 the revision style was changed back to A, B and so on.


=head1 REQUIRES

L<English> 

L<Carp> 

L<PerlFunc> 

L<Abisco_Connection> 

L<Win32> 

L<Thread::Semaphore> 

L<Thread::Queue> 

L<threads> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 CheckDoubleSignals

 CheckDoubleSignals();

SUBROUTINE  : CheckDoubleSignals
DESCRIPTION : Two signals are considered duplicates if they are identical
              and they occur across threads within 50 ms. (In practice I
              haven't seen them to occur more than 20 ms in between.)
IN  :
OUT :


=head2 GreaterOrEqual

 GreaterOrEqual();

SUBROUTINE  : GreaterOrEqual
DESCRIPTION :
IN  :
OUT :


=head2 MGetSeveral

 MGetSeveral();

SUBROUTINE :MGetSeveral
DESCRIPTION:There is essentially only one reason to use this function:
           The ability to send a signal while waiting for another signal.
           As an example, wait until signal X is received and if, in between,
           signal Y is received, send signal Z. Sending signal Z requires
           the second BTS connection which for us is a new thread of execution.

           The process that called MGetSeveral is called the "main thread"
           as it executes the main loop in this module.
           The threads started by the main thread to handle each BTS connection
           are called just "threads". Each BTS connection supports its own input
           queue of signals. The thread handling the BTS connection will put
           these signals in its hash entry of received signals. Function
           MGetSeveral returns a reference to a hash that has at the top level
           entries for each BTS connection, called '0', '1', or more, plus entry 'B'.
           There are also some more entries to display statistics.

           The CH is only aware of a number of BTS connections, not any threads.
           Responses received from the CH that are tagged as RESP can be addressed
           to the correct BTS connection, while all other messages tagged as
           e.g. SPONT are broadcasted to all active BTS connections. This is because
           the CH cannot decide which BTS connection is the recipient of the signal,
           and results in duplicated signals in the input queues of the different
           BTS connections.

           When the exit criteria are met and the function is about to exit,
           a routine is called to check if signals are duplicated across the
           different BTS connections. The mechanism is fairly simple and it will
           put the duplicate signals under entry 'B' and also remove these signals
           from the BTS connections queue where they occur.


           EXAMPLES:
           $L = MGetSeveral(BTSConn => [$BTS, $BTS1],
                            Expect  => [[{Message => 'Accept'},
                                         {Message => 'RFResourceIndication'}],
                                        [{Message => 'ABORT_SP_CFM'}]],
                            CheckDouble => 'YES',
                            Upto    => [[1, 3], [1]],
                            Timeout => [30, 30],
                            Until   => [{Message => 'Reject'}, {Message => 'PROMPT'}]);

           $BTS->Put(restart TG);
           $L = MGetSeveral(BTSConn => [$BTS, $BTS1],
                            Send    => {When => {Conn => 0,
                                                 Message => 'FaultReport',
                             Routing => {TRXC => 1},
                          MOClass => 'RX',
                          IntFaultMapClass2A => {FaultMap => [2, 0, 0, 0, 0, 0]}},
                                        What => {Conn => 1,
                                                 List => [{Server => 'DVT', Message => 'Command', String => Str('TRX0:PPC')},
                                                          {Server => 'DVT', Message => 'Command', String => Str('cma read 10590')},
                                                          {Server => 'DVT', Message => 'Command', String => Str('cma read 10990')}]},
                            Timeout => [3 * 60, 3 * 60],
                            Until   => [{Message => 'PROMPT'}, {}]);

           Here we make a restart, and when a specific FaultReport is received, a certain sequence
           shall be executed. Every command stated in the sending sequence must result in a PROMPT
           in order for the subsequent command to be sent.


           NOTE:
           - Do not use a {Send} on a thread that is used for any other purpose. That BTS connection
             blocks at Do/Put and can not be used.

           - If Abis logging is enabled during MGetSeveral, the execution can be suffering if a lot
             signaling is ongoing.


           OUTPUT:
           Returned from MGetSeveral is a reference to a hash containing
           following keys (as example):

            {NrBTSConn}: Number of BTS connections (in the examples above it is 2)

            {Status}   : [status code for first BTS connection, status code for second BTS connection, ...]
                         The status code is one of:
                            'Unknown' || 'Timed out' || 'Until signal received' || 'All signals received'

            {Signals}  : {S1 => [a1, b1, ...],
                          ...
                          S2 => [a2, b2, ...]}

                         where Sn are signals, and an, bn etc are occurences on each thread.
                         Background thread is last.

            {Sequence} : [[S1, occurance, thread],
                          ...
                          [S2, occurance, thread]]

            {0}{RFResourceIndication}{001}{Sig}  : ref to first signal RFResourceIndication (first BTS conn).
                                                   The whole signal hash is found here.
            {0}{RFResourceIndication}{001}{Time} : time stamp for first signal RFResourceIndication (first BTS conn).
                                                   The time stamp is relative to the time when MGetSeveral was
                                                   entered and is given in milliseconds.
            etc

            In {0}{RFResourceIndication}{001}{Sig}, the first key  indicates the BTS connection,
            0 counting is used. There exists also thread "B" where all background signals are put.

IN     :
OUT     :


=head2 PrepareArguments

 PrepareArguments();

SUBROUTINE  :PrepareArguments
DESCRIPTION :

IN  :
OUT :


=head2 Receive

 Receive();

SUBROUTINE  : Receive
DESCRIPTION :
IN  :
OUT :


=head2 TempStoreSignal

 TempStoreSignal();

SUBROUTINE  : TempStoreSignal
DESCRIPTION :
IN  :
OUT :


=head2 UpdateStatistics

 UpdateStatistics();

SUBROUTINE  : UpdateStatistics
DESCRIPTION :
IN  :
OUT :



=cut

=head1 NAME

BTSCapabilities


=head1 DESCRIPTION

<Document number: XX/190 55-CAH 161 1607/1 Uen>
MODULE      : BTSCapabilities
DESCRIPTION : Provides routines for reading, evaluating and storing
              MO Capabilities on the BTS.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME                    REVIEW    COMMENT
PA1 20130517  XPATHIL                 XHENRMA   First preliminary version
                                                Supports subs SaveCapabilitiesInFile, GetCapabilities,
                                                GetAndSaveCapabilities and CheckCapabilityAttributes.
                                                Left MCTRRecord subs for future versions.
                                                Perlcritic was applied.


=head1 REQUIRES

L<Hash::Util> 

L<charnames> 

L<English> 

L<Carp> 

L<dbLog> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 AnalyzeAlarmInfo

 AnalyzeAlarmInfo();

SUBROUTINE  : AnalyzeAlarmInfo
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeFNOffsetARFCNInfo

 AnalyzeFNOffsetARFCNInfo();

SUBROUTINE  : AnalyzeFNOffsetARFCNInfo
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeICPAttr1

 AnalyzeICPAttr1();

SUBROUTINE  : AnalyzeICPAttr1
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeICPGroupCapacity

 AnalyzeICPGroupCapacity();

SUBROUTINE  : AnalyzeICPGroupCapacity
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeInfo

 AnalyzeInfo();

SUBROUTINE  : AnalyzeInfo
DESCRIPTION : Decode each input in Capabalities and save in @CapabilitiesSummary

IN  : Attribute Recorded
OUT : None, Output will be written in the file


=head2 AnalyzeOMLRSLFunctions

 AnalyzeOMLRSLFunctions();

SUBROUTINE  : AnalyzeOMLRSLFunctions
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeTCHCapabilitiesInfo

 AnalyzeTCHCapabilitiesInfo();

SUBROUTINE  : AnalyzeTCHCapabilitiesInfo
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeTFMCTRRDivInfo

 AnalyzeTFMCTRRDivInfo();

SUBROUTINE  : AnalyzeTFMCTRRDivInfo
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeTXChainDelay

 AnalyzeTXChainDelay();

SUBROUTINE  : AnalyzeTXChainDelay
DESCRIPTION : AnalyzeInfo help function


=head2 AnalyzeTxRxSupport

 AnalyzeTxRxSupport();

SUBROUTINE  : AnalyzeTxRxSupport
DESCRIPTION : AnalyzeInfo help function


=head2 CheckCapabilityAttributes

 CheckCapabilityAttributes();

SUBROUTINE  : CheckCapabilityAttributes
DESCRIPTION : Checks the capabilities of MO. Returns 0 or 1 if Function
              is supported.

IN  : Optionally one or more of the following
      keys:     TGId, TRXC (for TRXC Capabilities), MO, Map, Index (Bit No.),
                PrintLogSupported => 'On' or 'Off'
OUT : 1 or 0
2do : Check Index value


=head2 DecodeAttribute

 DecodeAttribute();

SUBROUTINE  : DecodeAttribute
DESCRIPTION : To decode an attributed record in Capabilities Result

IN  : Attribute Recorded
OUT : None, Output will be written in the file


=head2 DecodeMCTRRecord

 DecodeMCTRRecord();

Subroutine:   DecodeMCTRRecord
Purpose:
Input:  %RefMCTRCaps
Output:


=head2 FetchAttribute

 FetchAttribute();

SUBROUTINE  : FetchAttribute
DESCRIPTION : Pick up one Attribute (Id, Length and Info) from the %RespBuffer buffer

IN  : uses @MOClass (global) and %RespBuffer (global)
OUT : @Att (Attribute buffer) and @CapabilitiesSummary (Cap. summary)


=head2 GetAndSaveCapabilities

 GetAndSaveCapabilities();

SUBROUTINE  : GetAndSaveCapabilities
DESCRIPTION : Capabilities Request and Save Capability Attributes to file

IN  : Optionally one or more of the following
      keys:     TGId, TRXC, MO, Inst, (SaveToFile), (PrintToLogg)
          * use SaveToFile = 'FALSE' if no file with capabilities is wanted!
OUT : %Capabilities, %CFCapabilities (global) alternatively %TRXCCapabilities (global)


=head2 GetCapabilities

 GetCapabilities();

SUBROUTINE  : GetCapabilities
DESCRIPTION :

IN  : TGNr and TRXC, MO (default CF)
OUT : @CapabilitiesSummary


=head2 GetDateTimeForFileName

 GetDateTimeForFileName();

SUBROUTINE  : GetDateTimeForFileName
DESCRIPTION : Formats date and time

IN  : None
OUT : Formatted string with date and time YYYYMMDD_HHMMSS


=head2 GetMCTRRecords

 GetMCTRRecords();

FUNCTION : GetMCTRRecords
COMMENT  : Returns MCTRRecords from Capabilities in CF
IN         -
OUT      : @MCTRRecords


=head2 MakeBin

 MakeBin();

SUBROUTINE  : MakeBin
DESCRIPTION : To convert an 8 bit integer to a binary string

IN  : Integer
OUT : Binary as string


=head2 SaveCapabilitiesInFile

 SaveCapabilitiesInFile();

SUBROUTINE  : SaveCapabilitiesInFile
DESCRIPTION : Stores Capabilities in file

IN  : MO, Filename, Capabilities
OUT : None



=cut

=head1 NAME

BTSFunc


=head1 DESCRIPTION

Document number: 11/190 55-CAH 161 11290/1 Uen
MODULE      : BTSFunc.pm
DESCRIPTION : Contains routines to be performed on a BTS,
              e.g. restarts, loadings etc.

COPYRIGHT Â© : ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV   DATE       NAME     REVIEW  COMMENT
PA1   20051128   ERADIPE          First revision
PA2   20060426   ERADIPE          Conforms to README
P1A   20080319   ERABAHG          Merged with \dev_08a. New rev
P1B   20080401   XRSJALI          Implementing CR 5761.
P1C   20080416   ERABAHG          Merged to main
P1D   20080418   ERABAHG          OrderedResetCF => 'ON', chenged to 'OFF'
                                  in CompleteStart.
P1D_1A20080624   XRSJALI          Implementing CR 5755.
P1D_1B20080804   XMATTEK          TS Reconfig added.
P1E   20080904   ERABAHG          Merged to main
P1E_1A20081118   XRSJALI          Implementing CR 5963.
P1F   20081121   XRSJALI          Merged to main
P1G   20090603   ERATZIS          Added DeallocateICPifTDMmode,
                                  AllocateICPifTDMmode, GetAbisModeAndConfig,
                                  CheckChCombType, UpdateCellCombType.
P1H   20090604   ERATZIS          Added Global DEBUG
P1J   20090604   ERATZIS          Updated UpdateCellCombType,
                                  imported psdatafunc.
P1K   20090806   ERATZIS          Updated header, added ChRelBTS,
                                   MeasurementReports, ConnectToMSSIM,
                                   ChActBTS, ChActMSSIM, ChRelMSSIM,
                                   CheckIfMeasResultMessages,
                                   CheckIfMeasReportInMeasResult,
                                   CheckIfMeasResultOnABIS, CreateParamHash.
P1L   20091101   ERAHEIK          Add parameter to CreateParamHash
A     20110928   XSOFFRO  XGUSTPE Applied new script template, perlcritic
                                   Added document number.
                                   Added catch of eval error around lock_keys.
                                   Exchanged HandleLogg with print.
                                   Fixed logging so that Log is used instead of WriteLog
                                   In UpdateCellCombType initialized @tempArr
                                   to an empty array instead of undef.

Note that on 2011-06-20 the revision style was changed back to A, B and so on.


=head1 REQUIRES

L<English> 

L<mssim_def> 

L<mssim_sub> 

L<mssim> 

L<psdatafunc> 

L<PerlFunc> 

L<HelpFunc> 

L<AbiscoFunc2> 

L<User> 

L<Msg> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 AllocateICPifTDMmode

 AllocateICPifTDMmode();

SUBROUTINE  : AllocateICPifTDMmode
DESCRIPTION : If TDM mode and Dynamic config it allocates ICP

IN  : $AbisMode
      $Config
      $DLEncoding
      $ULEncoding
OUT : $ICP
      $CI


=head2 BTSCompleteStart

 BTSCompleteStart();

SUBROUTINE  : BTSCompleteStart
DESCRIPTION : Runs a complete startup of the BTS by calling function
              CompleteStart. Afterwards, a check is made to see if all
              devices were also brought up by sending Status Request to each
              and one of them. If devices were unsuccessfully started, they
              are restarted again, up to three times.

IN  : %Input
OUT : $OK       1, 0


=head2 ChActBTS

 ChActBTS();

SUBROUTINE  : ChActBTS
DESCRIPTION : To activate a channel in the BTS

IN  : %Param
OUT : None


=head2 ChActMSSIM

 ChActMSSIM();

SUBROUTINE  : ChActMSSIM
DESCRIPTION : To activate a channel in the MSSIM

IN  : %Param          see main program for description
OUT : CcId


=head2 ChRelBTS

 ChRelBTS();

SUBROUTINE  : ChRelBTS
DESCRIPTION : To release a channel in the BTS

IN  : $ChType
OUT : None


=head2 ChRelMSSIM

 ChRelMSSIM();

SUBROUTINE  : ChRelMSSIM
DESCRIPTION : To release a channel in the MSSIM

IN  : $Timeout
      $CcId
OUT : None


=head2 CheckChCombType

 CheckChCombType();

SUBROUTINE  : CheckChCombType
DESCRIPTION : Checks that the Cell config Comb Type equals $CombType.
              If needed it performs a call to UpdateCellCombType

IN  : $CombType
      $No_trx
      $Band
      $BcchNo
      $Bspwrb
      $Bspwrt
      $TrxcList
      @ARFCN_array
OUT : Will die if errors found


=head2 CheckIfMeasReportInMeasResult

 CheckIfMeasReportInMeasResult();

SUBROUTINE  : CheckIfMeasReportInMeasResult
DESCRIPTION : Checks that if Measurement Report is sent from MS to BTS

IN  : State             1, 0
OUT : None


=head2 CheckIfMeasResultMessages

 CheckIfMeasResultMessages();

SUBROUTINE  : CheckIfMeasResultMessages
DESCRIPTION : Checks if Measurement Result messages arrives on not

IN  : State             1, 0
OUT : None


=head2 CheckIfMeasResultOnABIS

 CheckIfMeasResultOnABIS();

SUBROUTINE  : CheckIfMeasResultOnABIS
DESCRIPTION : Checks that No Measurement Result is sent on ABIS

IN  : State           1, 0
OUT : None


=head2 CheckLinkStatus

 CheckLinkStatus();

SUBROUTINE  : CheckLinkStatus
DESCRIPTION : Initializes entry $TG{LinkStatusError}.
              Faulty devices will be saved under this entry.

IN  : None
OUT : None


=head2 Check_2308

 Check_2308();

SUBROUTINE  : Check_2308
DESCRIPTION : For a 2308 the receiver diversity is set to 'A'

IN  : %Input
OUT :


=head2 CompleteStart

 CompleteStart();

SUBROUTINE  : CompleteStart
DESCRIPTION : Runs a complete startup of the RBS

IN  : %AD     complete start specific data
OUT : $Ret    1, 0


=head2 ConfigureFAS

 ConfigureFAS();

SUBROUTINE  : ConfigureFAS
DESCRIPTION :

IN  : %AD       Key _TRXC is mandatory
OUT : $Resp     the signal list as returned by GetSeveral


=head2 ConnectToMSSIM

 ConnectToMSSIM();

SUBROUTINE  : ConnectToMSSIM
DESCRIPTION : Just a wrapper to mssimConfig in order to avoid MSSIM sub
              imports in main.

IN  : $MsId
      $TG
      $TRXC
OUT : $Cell


=head2 CreateParamHash

 CreateParamHash();

SUBROUTINE  : CreateParamHash
DESCRIPTION : Subroutine for Creating the necessary Parameter Hash.
              This is used as input by many subroutines. Extra parameters
              are added from invoke list.

IN  : Globals
OUT : %Param


=head2 DeallocateICPifTDMmode

 DeallocateICPifTDMmode();

SUBROUTINE  : DeallocateICPifTDMmode
DESCRIPTION : If TDM mode and Dynamic config it deallocates ICP

IN  : $AbisMode
      $Config
OUT : None


=head2 GetAbisModeAndConfig

 GetAbisModeAndConfig();

SUBROUTINE  : GetAbisModeAndConfig
DESCRIPTION : Gets the Abis Mode and Config type (Dynamic/Static)

IN  : None
OUT : $AbisMode
      $Config


=head2 LoadBTS_SW

 LoadBTS_SW();

SUBROUTINE  : LoadBTS_SW
DESCRIPTION : The output of this routine is the status flag:

              - 'Load OK'
              - 'Load failed'  due to LoadSoftwareReject
              - 'Load error'   due to time out error?

IN  : %AD
OUT : 'Load OK', 'Load failed', 'Load error'


=head2 LoadOneBTSFile

 LoadOneBTSFile();

SUBROUTINE  : LoadOneBTSFile
DESCRIPTION : File is one of:
                  ZFI, ZFJ, DXP, DXL, TRP, TRL, TRB, TRX e.t.c.

              Special cases: ZF*, DX*, TR*, EC*
                  ZF* means ZFJ if DXU is PPC, otherwise ZFI
                  DX* means DXP if DXU is PPC, otherwise DXL
                  TR* means TRP if DXU is PPC, otherwise TRL
                  EC* means ECA if DXU is PPC, otherwise ECL

              If $AD{SW} is specified then the RU file will be taken from
              this load module, otherwise $TG{SW} is the load module meant.

              If DXU is PPC and TR* is specified, TRP file will be loaded
              even if the case could be that all devices are cTRU's and the
              desired RU file would rather be the TRL. In such case you have
              to say explicitly {File => 'TRL'}.
              The full name of the file is obtained from PROGPROD.

              OBSERVE: If not calling from within repstab/rbschar/rbsstab,
                       specify $AD{Project} !

IN  : %AD     list with options.
OUT : One of:
      - 'List file error'  : corresponding load file module does not exist
                             in PROGPROD (could be a project specification
                             error)
      - 'File not in list' : the specific load file requested is not
                             included in the list of load files specified
                             in PROGPROD.
      - 'Load error'       : loading of the load file has commenced but a
                             PROMPT has not been received within the time
                             frame specified.
      - 'Load failed'      : load has been completed but the result is
                             negative.
      - 'Load OK'          : load has been successfully completed
      - 1                  : the function has successfully issued the
                             loading command and will not await the
                             reception of any answer.


=head2 LoadTG

 LoadTG();

SUBROUTINE  : LoadTG
DESCRIPTION : Load a TG from file

IN  : $TGFile       File name of saved TG
OUT : None


=head2 MeasurementReports

 MeasurementReports();

SUBROUTINE  : MeasurementReports
DESCRIPTION : Turns on Measurement Reporting

IN  : State         1, 0
OUT : None


=head2 ModifyTG

 ModifyTG();

SUBROUTINE  : ModifyTG
DESCRIPTION :

IN  : %NewData        Additional data
OUT : None


=head2 SendStatusRequest

 SendStatusRequest();

SUBROUTINE  : SendStatusRequest
DESCRIPTION : Sends the message and if message ABORT_LINK_ERROR was returned
              if pushes in key LinkStatusError the relevant MO.

IN  : $TRXC
      $MO
      $Inst
OUT : Updates $TG->{LinkStatusError}


=head2 SetCFSharing

 SetCFSharing();

SUBROUTINE  : SetCFSharing
DESCRIPTION : This function will only build and return a hash.
              The main program will send the actual signal.

IN  : _Sharing      'On', 'Off'
OUT : None


=head2 SetTF_FSOffset

 SetTF_FSOffset();

SUBROUTINE  : SetTF_FSOffset
DESCRIPTION :

IN  : %AD
OUT : None


=head2 TRXReportingControl

 TRXReportingControl();

SUBROUTINE  : TRXReportingControl
DESCRIPTION : This signal is used to add some more load when running
              rbs_char. Not be used prior to R10.
              (this ought to be tested here)
              PC : Paging Counters.
              CU : Code Utilization (for AMR).

IN  : $LoadType      loading type 'NORMAL' e.t.c.
OUT : None


=head2 TSReconfigure

 TSReconfigure();

SUBROUTINE  : TSReconfigure
DESCRIPTION :

IN  : $TG
      $TRXC
      $TS               Timeslot
      $Duration         Duration in minutes
OUT :


=head2 UpdateCell

 UpdateCell();

SUBROUTINE  : UpdateCell
DESCRIPTION :

IN  :
OUT :


=head2 UpdateCellCombType

 UpdateCellCombType();

SUBROUTINE  : UpdateCellCombType
DESCRIPTION : Updates TG0 cell0 BCCHcomb to $CombType.

IN  : $CombType
      $No_trx
      $Band
      $BcchNo
      $Bspwrb
      $Bspwrt
      $TrxcList
      @ARFCN_array
OUT : None



=cut

=head1 NAME

BTSUtilities


=head1 DESCRIPTION

<Document number: XX/190 55-CAH 161 1607/1 Uen>
MODULE      : BTSUtilities
DESCRIPTION : Provides basic BTS routines like CompleteStart,
              ChannelActivation etc.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
A   20120330  XLEIMAR   XTOBSEM   First release
B   20120524  XANSBEM   XSOFFRO   Added SI-List to CompleteStart


=head1 REQUIRES

L<Hash::Util> 

L<English> 

L<Carp> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 new

 $self->new();

SUBROUTINE  : new
DESCRIPTION : Constructor

IN  : $Class           BTSUtilities class
      $Arg{BTS}        Abisco connection

      Example:
        my $BTSutil = BTSUtilities->new(BTS => $BTS);

OUT : The object reference


=head2 ChannelAct

 $self->ChannelAct();

SUBROUTINE  : ChannelActBTS
DESCRIPTION : To activate a channel in the BTS

IN  : Hash (See %Config below for allowed inputs)
        ChAct    - Type of channel activation (Mandatory input):
                   'AsyncHandover'
                   'ImmediateAssign'
                   'NormalAssign'
                   'PacketChannel'
                   'SecChannelMulti'
                   'VGCSChannel'
        Optional - Reference to a hash containing the elements which are,
                   according to the IWD, optional for the channel
                   activation. See %Optional below for the allowed elemets.
                   Note! All of the elements are not allowed for some
                   kinds of channel activation. E.g. the element
                   'PGSLTimersStruct' is only allowed for
                   ChannelActPacketChannel (see IWD for details).

OUT : Hash
        Result - value 0 if routine was successfull
        Reason - Error message if routine failed


=head2 ChannelRelease

 $self->ChannelRelease();

SUBROUTINE  : ChannelRelease
DESCRIPTION : To release a channel in the BTS

IN  : Hash (See %Config below for allowed inputs)
OUT : Hash
        Result - value 0 if routine was successfull
        Reason - Error message if routine failed


=head2 ChannelReleaseAll

 $self->ChannelReleaseAll();

SUBROUTINE  : ChannelReleaseAll
DESCRIPTION : To release all channels in the BTS

IN  : Hash (See %Config below for allowed inputs)
OUT : Hash
        Result - value 0 if routine was successfull
        Reason - Error message if routine failed


=head2 CheckChCombType

 $self->CheckChCombType();

SUBROUTINE  : CheckChCombType
DESCRIPTION : Checks that the Cell config Comb Type equals $CombType.
              If needed it performs a call to UpdateCellCombType

IN  : $CombType
      $Band
      $BcchNo
      $Bspwrb
      $Bspwrt
      @ARFCN_array
OUT : Hash
        Result - value 0 if routine was successfull
        Reason - Error message if routine failed


=head2 CompleteStart

 $self->CompleteStart();

SUBROUTINE  : CompleteStart
DESCRIPTION : Runs a complete startup of the RBS

IN  : %Input  Complete start specific data, see hash Config below for
              the allowed inputs.
OUT : Hash
        Result - value 0 if routine was successfull
        Reason - Error message if routine failed


=head2 UpdateCell

 $self->UpdateCell();

SUBROUTINE  : UpdateCell
DESCRIPTION :

IN  : %Input  Update cell specific data, see hash Config below for
              the allowed inputs.
OUT : Hash
        Result - value 0 if routine was successfull
        Reason - Error message if routine failed


=head2 UpdateCellCombType

 $self->UpdateCellCombType();

SUBROUTINE  : UpdateCellCombType
DESCRIPTION : Updates TG0 cell0 BCCHcomb to $CombType.

IN  : $CombType
      $Band
      $BcchNo
      $Bspwrb
      $Bspwrt
      @ARFCN_array
OUT : Hash
        Result - value 0 if routine was successfull
        Reason - Error message if routine failed



=cut

=head1 NAME

Complex


=head1 DESCRIPTION

Document number: 2/190 55-CAH 161 1290/1 Uen
MODULE      : complex.pm
DESCRIPTION :

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 991108    QRAJRHD             Created with ARFCN routines from synch.abi
P1B 991128    QRAJRHD             Added Disable/Configure/Enable from fuf.pl
P1C 991202    QRASIMO             DisableConfigEnable updeted - OpInfo
                                  added. New routine BCCHChComb added.
P1D 991213    QRASIMO             Function changed to Message
P1E 991214    QRAJRHD             Use new Assert front-end in
                                  Abisco_Connection.
P1F 000125    QRAJRHD             Assert import failed, MOClass missing in
                                  assert.
P1G 000206    QRAJRHD             Get_TRX_Freq adapted from fuf/EEDKVO
P1H 000213    QRAJRHD             DisableConfigEnable had 2 disable +
                                  Save/RestoreConfig.
P1I 000216    QRAJRHD             Splitting Get_TRX_Freq and ARFCN_Freq
P1J 000218    QRAJRHD             Get_TRXC_Freq refactored again
P1K 000306    QRAJRHD             In Disable..., Calculate the right
                                  CombChoice from CMB.
P1L 000329    QRAJRHD             Get_TRXC_Freq always returned returned
                                  first TRXC.
P1M 000331    QRASIMO             New routine 'ResetStartConfigEnable' added
P1N 000516    QRAJRHD             S_Behaviour casing workaround remove
P1S 000606    QRAJRHD             Get_TG/TRXC_List
P1T 000816    QRAJRHD             CH can restore more than one choice at a
                                  time.
P1U 000822    QRATHRA             ARFCN_Freq updated. solving TR0669
P1V 000825    QRASIMO             Correction of resp msg for
                                  CMDHLIB2000.SystemInformation. Correction
                                  of @Comb in BCCHChComb.
                                  Removed CombChoice, set by CH.
P1X 000905    QRATHRA             Added procedure Get_TRX_ARFCNs.
                                  Get_TRX_ARFCN obsolete.
P1Y 000911    QRAJRHD             Subroutine comments converted to POD's
P1Z 001102    QRAJRHD             Get_And_Count + Get_Cyclic
P2A 001205    QRAJRHD             Get_And_Count Upto
P2B 010115    QRAJRHD             Get_Cyclic
P2C 010321    QRAJRHD             Con => CON in example
P2D 010417    QRAFRYS             Added subroutines for TB value calculation
P2E 010427    QRAJRHD             Comment improvement to Check_SI_TB
P2F 010516    QRAFRYS             Added subroutine IS_Connection_Group
P2G 010517    QRAFRYS             Get_Not does not work with -Alone option
P2H 010808    QRAJRHD             Get_Me, PCM_IS_CON et al.
P2I 010814    QRAFRYS             Allow Check_SI_TB to accept MI messages
P2J 010817    QRAFRYS             Introduced DisableConfigEnable etc for
                                  RBS200.
P2K 010821    QRAJRHD             PCM_IS_CON, wrong Tag for
                                  high CG 2-n, CON_CG.
P2L 010824    QRAFRYS             Added subroutine Get_TRX_ARFCNs200
P2M 010911    QRAFRYS             Added revision information to complex.html
P2N 010913    QRAFRYS             Modified Check_SI_TB to provide for no
                                  check of TB.
P2O 010918    QRAFRYS             Improved documentation of
                                  DisableConfigEnable200.
P2P 010919    QRAFRYS             Uncommented AccordanceIndication in
                                  Config_Sequence200.
P2Q 010927    QRAJRHD             PCM_IS_CON for 64kbit air timeslots
P2R 011019    QRAJRHD             Get_TRXC_List corrected (doc+default value)
P2S 011204    QRAFRYS             Improved documentation of CON_CG and
                                  IS_Connection_Group.
P2T 011210    QRAFRYS             Changed IS_Connection_Group to IS_CG and
                                  introduced alias.
P2U 011211    QRAJRHD             Doc. change only, PCM_IS_CON tested with
                                  64kbit (some).
P2V 011214    QRAJRHD             IS_CG: always return array reference
P2X 020225    QRAJRHD             IS/CON_Length added to PCM_IS_CON
P2Y 020226    EDANEKS             CH_Info added to Delete_Non_DL
P2Z 020228    QRAJRHD             'Get_TRXC_List_From_IS'
P3A 021011    ERABAHG             PCM_IS_CON_Aux updated for PCM C and D.
P3B 050225    QRAGOWE             PCM_IS_CON rewritten for new CMDHAND
                                  commands.
P3C 050330    QRAGOWE             Late change: PCM_IS_CON should evaluate CF
                                  link from IS List, not via parameters.
P3D 060322    QRAGOWE             CALC_IS_CON modified for Super Channel.
P3E 060601    QMIKHEL             <> changed to () due to Perl upgrade
                                  to 5.8 .
    060628    QRAGOWE             Correction, CALC_IS_CON
    061127    QRAGOWE             CALC_IS_CON, Change 060628 changed back
                                  again (Input for CF was wrong).
    070119    QROBNOR             CALC_IS_CON is exported
    091203    XYNKABA             PCM_IS_CON updated to handle split list
                                  for CON Connection List correctly.
A   070608    XYNHAKS             Approved for UFTE R23A. This is a document
                                  not a product.
B   20110620  ETORWIL   XLEIMAR   Converted script to use strict, warnings
                                   and diagnostics. Moved code into new template.
                                  Updated to pass thru perl::Critic with policy.
                                  Removed POD documentation (Not complete anyway).
                                  Imported UnTrig from Abisco_Connection
                                   since it is not existing in User.pm
                                  Removed use Abisco_Connection and replaced
                                   all of these subroutine calls with
                                   Abisco_Connection::subroutine.
C   20120223  XTEHKIN   XSOFFRO   Fixed regular expression bug, TR HP52167.
D   20120329  XSOFFRO   XNAVNAS   Added a shift to input array of Get_TG_List (TR HP64480).

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Msg> 

L<charnames> 

L<English> 

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ARFCN_Freq

 ARFCN_Freq();

SUBROUTINE  : ARFCN_Freq
DESCRIPTION : Convert absolute radio frequency number to frequency in MHz

              %Frequency = ARFCN_Freq(Band => GSM900P, ARFCN => 13);

IN  : $Band - one of: GSM900P,GSM1800,GSM900E,GSM900R or GSM1900
      $ARFCN
OUT : %Frequency has the following keys:
        Uplink   => Uplink TRXC frequency in MHz
        Downlink => Downlink frequency in MHz


=head2 ARFCN_List

 ARFCN_List();

SUBROUTINE  : ARFCN_List
DESCRIPTION : Return a list of all frequencies used in indicated TG(s). The
              frequencies are read from the current ABISCO configuration.
              Dies on undefined TGs.

              @ARFCN_List = $BTS->ARFCN_List(0..1);

IN  :
OUT :


=head2 ARFCN_Octets

 ARFCN_Octets();

SUBROUTINE  : ARFCN_Octets
DESCRIPTION : Convert ARFNC list into a CA_ARFCN octet array of length 16,
              where each bit corresponds to a frequency. Used in the traffic
              'DataReqAssignmentCmd'.

             ($Hi_CA_ARFCN, @Low_CA_ARFCN) = ARFCN_Octets(1,99,124);

IN  :
OUT :


=head2 BCCHChComb

 BCCHChComb();

SUBROUTINE  : BCCHChComb
DESCRIPTION : This routine changes the channel combination for BCCH. The
              valid combination parameters are ncomb (iv+vii) and comb (v).
              For ncomb the time slots will be defined as follows:
              TRXC0 BCCH on TS0, SDCCH on TS1 and TCH on TS2..7.
              For comb: TRXC0 BCCH/SDCCH on TS0, TCH on TS1..7.

              $BTS->BCCHChComb(Combination => 'comb');

IN  :
OUT : Returns the last TSConfigResult if succesful, dies otherwise.


=head2 CALC_IS_CON

 CALC_IS_CON();

SUBROUTINE  : CALC_IS_CON
DESCRIPTION : IS/CON list calculation for PCM_IS_CON, see this routine.
              Provides basic PCM arithmetics only.

IN: \@1 - Connection list, see PCM_IS_CON
OUT:\@1 - IS list, may be longer than ISConfig allows
    \@2 - CON list, may be longer than CONConfig allows
    \@3 - CFIND, CF sharing. 'Undef', 'Off' or 'On'.
    \@4 - CFTRX, CF shared TRX (if CFIND = 'On').
    \@5 - CFPCM, PCM system for CF (if CFIND = 'Off').
    \@6 - CFTS, PCM TS for CF (if CFIND = 'Off').


=head2 CON_CG

 CON_CG();

SUBROUTINE  : CON_CG
DESCRIPTION : Repack a CON connection group from logical quadruplets of CCP,
              CI, Tag, TEI, into BTS message format of 5 octet groups
              (connection groups).

              $CG = CON_CG($CCP, $CI, $Tag, $TEI);

              Example:
                $CG = CON_CG(256, 4, 1, 255, 260, 4, 0, 1);

                $BTS->Do(Message => CONConfigRequest,

                CONConnectionList => {CONConnectionList => $CG});

                This will connect CON inlet 256 with CON outlet 260.

IN  : $CCP - CON Connection Point, inlet or outlet
      $CI  - Contiguity Index (always 4 unless you have a negative test)
      $Tag - 0 for CON outlets, CG sequence number otherwise (1,2,3,...)
      $TEI - TEI of target TRXC, or 255 for CON inlet

OUT : $CG  - Reference to a list of five octet connection group on ABISCO
             message format.


=head2 Calc_TB

 Calc_TB();

SUBROUTINE  : Calc_TB
DESCRIPTION : Calculates the TB value for a given frame number

IN  : $1 - Frame number
OUT : $1 - TB value


=head2 Check_SI_TB

 Check_SI_TB();

SUBROUTINE  : Check_SI_TB
DESCRIPTION : Check order of SI and MI messages (from CRTC) and their TB
              (TC) values. Messages that are not in the list are ignored.
              The first matching message must be the first in the list, and
              that also applies to the nested list of alternating SIs
              described below. Use Get(Until => ) to synchronize to the
              start of the sequence, see example below. Die on bad message
              or TB.

              $BTS->Check_SI_TB($Cycles, \@Expected_SI, \@Expected_TB);

              For example, to verify the sequence: SI1, SI2, (SI5Ter or
              SI13), MI,... SI5Ter and SI13 must alternate:

                $BTS->Get(Until => {Message => SI13});  # Sync, next loop
                                                        # has SI5Ter.
                $BTS->Get(Until => {Message => MI});    # Sync, next is SI1
                $BTS->Check_SI_TB(5, [SI1, SI2, [SI5Ter, SI13], MI]);

              The following line is an example of how to verify the
              sequence: SI1, SI2, MI,... without check of the TB values:

                $BTS->Check_SI_TB(5, [SI1, SI2, MI], []);

IN  : $Cycles      - No of times to follow the list around.
      @Expected_SI - List of SI and MI messages in correct order. *One* item
                     may be an array of alternating SI and MI messages, see
                     examples above.
      @Expected_TB - List of expected TB values, one for each entry in
                     @Expected_SI. Default is 0,1,2,...
                     By entering the empty list [] the check of TB values is
                     disabled.

OUT :


=head2 CombChoice_Default

 CombChoice_Default();

SUBROUTINE  : CombChoice_Default
DESCRIPTION : Set default CombChoice that matches the channel
              combination that we are setting. Ought to be done by ABISCO,
              see TR8306.

IN  : \%1 - Message hash
OUT : \%1 - Updated message (the original is also updated in place)
      %1 - in list contex


=head2 Config_Sequence

 Config_Sequence();

SUBROUTINE  : Config_Sequence
DESCRIPTION : Generic routine for generating DisableConfigEnable type
              sequences. Accepts a list of keywords that indicate messages
              to be sent, see table below. Dies on unexpected responses.

IN  : %1     - ConfigRequest parameters (if any)
      \@last - List of config-related messages
OUT :   \%1 - ConfigResult message or the last response if no config message
      or %1 - in list contex


=head2 Config_Sequence200

 Config_Sequence200();

SUBROUTINE  : Config_Sequence200
DESCRIPTION : Generic routine for generating DisableConfigEnable200 type
              sequences. Accepts a list of keywords that indicate messages
              to be sent, see table below. Dies on unexpected responses.

IN  : %1     - ConfigRequest parameters (if any)
      \@last - List of config-related messages
OUT :   \%1 - ConfigResult message or the last response if no config message
      or %1 - in list contex


=head2 ConnectResetStart

 ConnectResetStart();

SUBROUTINE  : ConnectResetStart
DESCRIPTION : Connect, Reset, then Start. Similar to L(DisableConfigEnable),
              see this routine.

IN  :
OUT : Returns the start result message.


=head2 ConnectResetStartConfigEnable

 ConnectResetStartConfigEnable();

SUBROUTINE  : ConnectResetStartConfigEnable
DESCRIPTION : Connect, Reset, Start, Configure, then Enable. Similar to
              L(DisableConfigEnable), see this routine.

IN  :
OUT :


=head2 Delete_Non_DL

 Delete_Non_DL();

SUBROUTINE  : Delete_Non_DL
DESCRIPTION : Take away parameters that are used uplink but not down-link

IN  : \%1 - A downlink message (modified)
OUT : \%1 - Same as the input message but uplink parameters deleted
      or %1 - in list contex


=head2 Delete_S_False

 Delete_S_False();

SUBROUTINE  : Delete_S_False
DESCRIPTION : Take out all optional sub-structures and choices that
have S_xxx set to FALSE.

IN  : \%1 - Message hash
OUT : \%1 - Updated message (the original is also updated in place)
      %1 - in list contex


=head2 DisableConfigEnable

 DisableConfigEnable();

SUBROUTINE  : DisableConfigEnable
DESCRIPTION : Disable, configure, then enable. Keep the LEDs correct with
              OperationalInfo. Works on RBS2000 for any MO except FM and
              supports the same parameters as the ConfigRequest for that MO
              (omit the message name). Predefined (loop) parameters are used
              as defaults. Since ABISCO supplies defaults for other
              parameters you can set as few or as many parameters as you
              like.

              %Resp = $BTS->DisableConfigEnable(
                      MOClass              => 'TS',
                      InstanceNo           => 0,
                      AssociatedSOInstance => 0,
                      Combination          => {CMB => 'iv'},
                      ReceiverDiversity    => {ReceiverDiversity => 'A+B'}
              );

              $Resp = $BTS->DisableConfigEnable;

IN  : See example above.
OUT : Returns the ConfigResult if succesful, dies otherwise.


=head2 DisableConfigEnable200

 DisableConfigEnable200();

SUBROUTINE  : DisableConfigEnable200
DESCRIPTION : Disable, configure, then enable. Works on RBS200 for MO
              classes TX, RX and TS.

              %Resp = $BTS->DisableConfigEnable200(
                      Routing           => {TG => 0,
                                            TRXC => 0},
                      MOClass           => 'TS',
                      InstanceNo        => 0,
                      Combination       => {CMB => 'iv'},
                      ReceiverDiversity => {ReceiverDiversity => 'A+B'}
              );

IN  : See example above.
OUT : Returns RFTransmParamComplete, RFReceptionParamComplete or
      RadioTSParamsComplete if succesful, dies otherwise.


=head2 Extract

 Extract();

SUBROUTINE  : Extract
DESCRIPTION : Return hash consisting only of keys asked for. Only top
              level keys are handled.

IN  : \%1 - Hask
      @2 - Keys to include in the returned hash (if they existed)
OUT : %1 - A subset of the input hash
      \%1 - in scalar context


=head2 Get_And_Count

 Get_And_Count();

SUBROUTINE  : Get_And_Count
DESCRIPTION : For when a number of messages must be checked, but the order
              is unknown. The 'Expect' parameter is a list of message
              patterns, suitable for 'Assert'. The sub-routine returns when
              the 'Until' pattern arrives, or when the 'Timeout' expires, or
              when the message counters have reached at least the values in
              'Upto'. All parameters except 'Expect' are optional (default
              is to wait 10 minutes). No exception (error) is generated on
              timeout - check the counters instead.

              ($As, $Bs, $Cs, $Others) =
                $BTS->Get_And_Count(Timeout => 10,
                                    Expect  => [{Message => A},
                                                {Message => B},
                                                {Message => C}],
                                    Upto    => [1, 2, 0, 0],
                                    Until   => {Message => D}
                                   );

              Assert([$As, $Bs, $Cs, $Others], [1, 2, 0, '*']);

IN  : See example above.
OUT : Returns a list of counters, one for each message plus one extra for
      non-matching messages. Returns a list pointer in scalar context.


=head2 Get_Cell

 Get_Cell();

SUBROUTINE  : Get_Cell
DESCRIPTION : Get cell with indicated routing(defaults taken from the
              predefined globals). Returns a CH InfoCellResponse message
              hash (or pointer to it in scalar context).

              $Resp = Get_Cell;
              %Resp = Get_Cell(TG => 0, TRXC => 0);

IN  : % Containing TG and TRXC
OUT : $ or %


=head2 Get_Cyclic

 Get_Cyclic();

SUBROUTINE  : Get_Cyclic
DESCRIPTION : For when a number of messages must arrive in a particular
              order. Works like L(Get_And_Count), except that the expected
              messages must arrive in the specified order. An exception
              (error) is generated otherwise. If cycles is set the sequence
              is tracked that many loops, and the cycle may start at any
              point in the list. If 'Cycles' is not set then message 'A'
              must be first and the routine finishes when the last message
              comes in. No exception (error) is generated on timeout -
              check the counters instead.

              $BTS->Get_Cyclic(Timeout => 10,
                               Cycles  => 1,
                               Expect  => [{Message => A},
                                           {Message => B},
                                           {Message => C}]
                               );

IN  : See example above.
OUT : The subroutine returns message counts just like Get_And_Count.


=head2 Get_Not

 Get_Not();

SUBROUTINE  : Get_Not
DESCRIPTION : For when a message must not arrive. The routine raises an
              exception if the message does arrive, and returns quietly
              otherwise. Accepts exactly the same parameters as 'Get'
              (thus the inappropriate parameter name 'Expect').

              $BTS->Get_Not(Timeout => 10,
                            Expect  => {Message   => 'A',
                                        Parameter => 'B'});

IN  : See example above.
OUT :


=head2 Get_TG_List

 Get_TG_List();

SUBROUTINE  : Get_TG_List
DESCRIPTION : Get list of defined TGs (or array pointer in scalar context).

              @TG_List = $BTS->Get_TG_List;
              $TG_List = $BTS->Get_TG_List;

IN  : $BTS
OUT :


=head2 Get_TRXC_List

 Get_TRXC_List();

SUBROUTINE  : Get_TRXC_List
DESCRIPTION : Get list of all TRXCs in one TG (all cells). Return array
              pointer in scalar context. Uses the predefined global $TG if
              no argument is given.

              @TRXCs = $BTS->Get_TRXC_List($TG_Number);

IN  : $TG_Number
OUT : @Array_with_all_TRXCs_in_that_TG


=head2 Get_TRXC_List_From_IS

 Get_TRXC_List_From_IS();

SUBROUTINE  : Get_TRXC_List_From_IS
DESCRIPTION : Like 'Get_TRXC_List', except the result is obtained by
              examining an IS connection list.

              $IS = IS_CG(4, 512, 4, 5, 524, 4);
              @TRXCs = $BTS->Get_TRXC_List_From_IS($TG, $IS);

IN  : $TG
      $IS
OUT : @Array_with_all_TRXCs_in_that_IS


=head2 Get_TRX_ARFCN

 Get_TRX_ARFCN();

SUBROUTINE  : Get_TRX_ARFCN
DESCRIPTION : Get TX ARCFN number from indicated TRX. Parameters
              - see L(Get_Cell).

              NOTE: this routine does not work with synth hopping. Use
              L(Get_TRX_ARFCNs) instead (handles both cases).

              $ARFCN = Get_TRX_ARFCN(TG => 0, TRXC => 0);

IN  :
OUT :


=head2 Get_TRX_ARFCNs

 Get_TRX_ARFCNs();

SUBROUTINE  : Get_TRX_ARFCNs
DESCRIPTION : Get list of TX ARCFN numbers from indicated TRX (the list will
              have one element unless synth hopping is used).
              Parameters - see L(Get_Cell).

              @ARFCNs = Get_TRX_ARFCNs(TG => 0, TRXC => 0);

IN  :
OUT :


=head2 Get_TRX_ARFCNs200

 Get_TRX_ARFCNs200();

SUBROUTINE  : Get_TRX_ARFCNs200
DESCRIPTION : Get list of TX ARCFN numbers from indicated TRX (the list will
              have one element unless synth hopping is used).

              @ARFCNs = Get_TRX_ARFCNs200(TG => 0, TRXC => 0);

IN  :
OUT :


=head2 Get_TRX_Freq

 Get_TRX_Freq();

SUBROUTINE  : Get_TRX_Freq
DESCRIPTION : The same as L(Get_TRX_ARFCN), but return the TX/RX frequencies
              instead of the ARFCN.

              %Frequency = Get_TRX_ARFCN(TG => 0, TRXC => 0);

IN  :
OUT : Returns the same as L(ARFCN_Freq).


=head2 Greater_Or_Equal

 Greater_Or_Equal();

SUBROUTINE  : Greater_Or_Equal
DESCRIPTION : Check if all numbers in a list are greater than those in
              another list.

IN  : \@1 - Actual values
      \@2 - Desired values
OUT : $1 - True iff all values in actual list are greater than or equal to
      the corresponding values in the de


=head2 ICP_To_TEI

 ICP_To_TEI();

SUBROUTINE  : ICP_To_TEI
DESCRIPTION : Convert a TRX connected IS connection point to
              corresponding TEI number.

IN:  $1 - ICP number, must be above 511.
OUT: $1 - TEI


=head2 IS_CG

 IS_CG();

SUBROUTINE  : IS_CG
DESCRIPTION : Repack an IS Connection Group from logical triplets of ICP1,
              ICP2 and CI, into BTS message format of 5 octet groups
              (connection groups).

              $CG = IS_CG($ICP1, $ICP2, $CI);

              Example:
                $CG = IS_CG(4, 512, 12, 16, 524, 2);

                $BTS->Do( Message  => ISConfigRequest,
                          ISChoice => {ISConfigList
                                         => {ISConnectionList => $CG}}
                         );

                This will send: ISConnectionList => [0,4,2,0,12,0,16,2,12,2]

IN  : $ICP1 - IS Connection Point
      $ICP2 - IS Connection Point
      $CI   - Contiguity Index
OUT : $CG   - Reference to a list of five octet IS connection group


=head2 IS_Connection_Group

 IS_Connection_Group();

SUBROUTINE  : IS_Connection_Group
DESCRIPTION : Alias

IN  :
OUT :


=head2 Index

 Index();

SUBROUTINE  : Index
DESCRIPTION : Return array index of indicated element. Examples elsewhere in
              this module.

IN  : %1 - A hash with the following keys:
      $Of => An $element to search for (scalar or hash/array pointer)
      \@In => A list of values to search in
OUT : $1 - Index of the first argument (starting at 0), undef if not found


=head2 OM2000_Defaults

 OM2000_Defaults();

SUBROUTINE  : OM2000_Defaults
DESCRIPTION : Set OM2000 loop parameters unless they are already set
              (either long or shortname).

IN  : \%1 - OM2000 message hash (or empty hash if you only want the defaults)
OUT : \%1 - Updated message (the original is also updated in place)
      %1 - in list contex


=head2 Optional

 Optional();

SUBROUTINE  : Optional
DESCRIPTION : Insert (name => value) in (parameter) list if value is
              defined. Saves having to evaluate the value twice especially
              in case it was a sub-routine. Also looks better.

IN  : $1 - Name
      $2 - Value (may be a pointer)
OUT : $1 => $2) - if $2 was defined
      or () - otherwise


=head2 PCM_IS_CON

 PCM_IS_CON();

SUBROUTINE  : PCM_IS_CON
DESCRIPTION : First a little bit about the HW. IS and CON are defined in
              FS 58/HRB 105 01 Uen. Look at figure 2 of this document
              (Rev J). IS connects PCM links with TRXCs, optionally via the
              CON concentrator, which allows one PCM connection to be split
              onto many TRXCs. From figure 2 it might just about be possible
              to deduce the rest by looking at the example below. More
              information can be found in the O&M IWD.

              PCM_IS_CON is simple yet powerful routine for configuring
              LAPD, IS and CON. The TG(s) should be configured and connected
              beforehand. The routine can then change the LAPD/IS/CON
              configuration to anything you like.

              Afterwards ABISCO can be used as normal, for example to
              perform a complete start.

              DisconnectTG and reconnect to go back to the original
              configuration. If there are errors you can start/stop the
              TSSTC to get back on track (disconnect TG, press CH button
              5,4,4,5, then connect TG again).

              The routine first clears all allocated LAPD links. New LAPD
              physical links are derived from the input lists, and OML/RSL
              logical links are defined on top of them. Traffic channels
              (to remote transcoder) are omitted here since they do not use
              the LAPD protocol. The CONFIG-server is kept up to date. New
              IS and CON configurations are calculated and stored in ABISCO,
              ready to be sent with the next ISConfig or CONConfig message,
              e.g. as part of a complete start.

              If the IS/CON list is too long, the subroutine cuts it into
              parts. The list segmentation may be explicitly controlled with
              the IS_Length/CON_Length parameters.

              The ABISCO store is suppressed if there is more than one
              IS/CON list. ABISCO can only hold values for one ISConfig, but
              in this case the list must be sent to the BTS in several
              ISConfig messages. This subroutine can not assume that the BTS
              is in an appropriate state for this, and may not change the
              state either. Instead the caller can send the messages at a
              later time using the returned IS/CON lists as shown in
              example 2 below.

              Note:
              - PCM_IS_CON can be called several times, using IS/CON
                Configurations with different numbers of TRX:s.
              - AT LEAST the TRX:s in the IS/CON Configurations must be
                included in New TG.
              - ONLY the TRX:s in current IS/CON Configuration may be
                included in CompleteStart.
              - The original IS/CON configuration (created at NewTG) can be
                restored by :
                  o Delete TG
                  o New TG (or Load Cfg)
                  o Connect TG
                Alternatively, PCM_IS_CON can be called again with the
                original IS/CON configuration.

              Note: About the implementation of sub PCM_IS_CON, the Abisco
              commands MUST be executed in following order to work properly:

                DeallocateCFLink
                DeallocateTRXLinks

                ISConfigRequest (SendToServer=Off)

                AllocateCFLink
                AllocateTRXLinks

              Synopsis :
                (square brackets are verbatim here):

                ($IS, $CON) = PCM_IS_CON(
                    IS_Length  => [<Length>, ...],
                    CON_Length => [<Length>, ...],
                    Connect
                      => [[<CI>, <SubRate>, <ICP1>],  # CF Link (no ICP2)
                          # (CF Link may be defined on any line)
                          # No concentration:
                          [<CI>, <SubRate>, <ICP1> => <ICP2>],
                          # With concentration:
                          [<CI>, <SubRate>,
                           <ICP1> => CCPI => [CCPO,...] => [ICP2,...]],
                         ]
                );

                where:
                CI      - Contiguity index, i.e. the number of consecutive
                          ICPs to use.
                SubRate - 16, 32, or 64 (kbit/s)
                ICP1    - IS connection point, PCM side
                ICP2    - IS connection point, TRX/CON side
                CCPI    - CON connection point, inlet (concentrated)
                CCPO    - CON connection point, outlet (de-concentrated)
                Length  - See input parameter IS_Length

                The arrow ('=>') symbolises a connection from one point to
                another.

              Example 1 (Default is CF link shared with TRXC0):
                PCM_IS_CON(Connect
                           # CF: 4 ICP points, 64kbit/s, starting at ICP1 4
                             => [[4, 64, 4],
                           # Same PCM as CF, but through IS to TRXC0 SCH
                                 [4, 64, 4  => 512],
                           # 8x16kbit/s, ICP 8 to ICP 516 (TRX0 TCH)
                                 [8, 16, 8  => 516],
                           # Ditto, TRX1, ICP 16..23 to 528..535
                                 [8, 16, 16 => 528],
                           # 64 kbit signalling again, this time through
                           # CON. ICP 24 to CON inlet 268, split to CON
                           # outlets 272/276, back through IS to 536/548, ie
                           # PCM TS 6 shared between TRX2 and TRXC3.
                                 [4, 64, 24 => 268 => [272, 276]
                                  => [536, 548]],
                                ]
                          );

              Example 2, CF link shared with TRXC1:
                PCM_IS_CON(Connect
                             => [[4, 64, 4  => 512], # Signalling, TRXC0
                                 [8, 16, 8  => 516], # Traffic, TRXC0
                                 [4, 64, 16],        # CF (Shared, TRXC1)
                                 [4, 64, 16 => 524], # Signalling, TRXC1
                                 [8, 16, 20 => 528], # Traffic, TRXC1
                                ]
                          );

              Example 3, CF link not shared (PCM system A, TS 31):
                PCM_IS_CON(Connect
                             => [[4, 64, 4  => 512], # Signalling, TRXC0
                                 [8, 16, 8  => 516], # Traffic, TRXC0
                                 [4, 64, 16 => 524], # Signalling, TRXC1
                                 [8, 16, 20 => 528], # Traffic, TRXC1
                                 [4, 64, 124],       # CF (Not shared, TS 31)
                                ]
                          );

              Example 4, a segmented IS list:
                ($IS, $CON) = PCM_IS_CON(IS_List => [7*5, 10*5],
                                         Connect => ...);

                Establish and start CF here maybe. ConnectResetStart IS is
                also needed 1st.

                foreach $IS_Part (@$IS) {
                  $Resp = Do( Message              => ISConfigRequest,
                              MOClass              => 'IS',
                              InstanceNo           => 0,
                              AssociatedSOInstance => 255,
                              ListNo               => {ListNo => ++$I},
                              EndListNo            => {EndListNo
                                                         => scalar(@$IS)},
                              ISChoice             => {ISConfigList
                                                         => {ISCL
                                                               => $IS_Part}
                                                      }
                            );

                  Assert($Resp, {Message => ISConfigRequest});
                }

                A segmented CON would be similar to the above.

IN  : TG_no             TG to be configured (Default: predefined global $TG)
      CF_SharingInd *)  CF shared with TRX  (Default: 'On')
      CF_TRXNum     *)  CF TRX, shared      (Default: 0)
      CF_PCMNum     *)  CF PCM, not shared  (Default:'PCM_A')
      CF_PCMTs      *)  CM TS, not shared   (Default: 1)

      IS_Length         Array of lengths indicating how to cut IS
                        lists into parts. The length is specified in
                        octets to allow negative tests - multiply by
                        5 to cut at correct points. If there are to few
                        lengths the last value is used repeatedly. For
                        example, [10] means to make all pieces 10 octets
                        long (the last piece is smaller if the list was
                        not evenly divisible by 10). If the parameter is
                        left out the maximum size (240) is used.

      CON_Length        Similar to IS_Length. Max/Default size is 177 octets

      Connect           A list of one or more connections.

*) The CF link is in the first place controlled by the Connection List.
   However, if no CF definitions exists in the list, it's also possible
   to control the CF link with these parameters.

OUT : $IS  - A list of IS lists, e.g.: '[[0 8 2 4 1], [0 9 2 5 1]]'.
             Returns an empty list if there was no IS connections.
      $CON - A list of CON lists, similar to $IS.


=head2 ResetStartConfigEnable

 ResetStartConfigEnable();

SUBROUTINE  : ResetStartConfigEnable
DESCRIPTION : Reset, Start, Configure, then Enable. Similar to
              L(DisableConfigEnable), see this routine.

IN  :
OUT :


=head2 ResetStartConfigEnable200

 ResetStartConfigEnable200();

SUBROUTINE  : ResetStartConfigEnable200
DESCRIPTION : Reset, Start, Configure, then Enable. Similar to
              L(DisableConfigEnable200), see this routine.

IN  :
OUT :


=head2 RestoreConfig

 RestoreConfig();

SUBROUTINE  : RestoreConfig
DESCRIPTION : Restore MOs saved with L(SaveConfig). Default is to restore
              the last configuration saved.

              RestoreConfig;
              RestoreConfig($Old);

IN  :
OUT :


=head2 SaveConfig

 SaveConfig();

SUBROUTINE  : SaveConfig
DESCRIPTION : Get configuration of MO instances given in input list. The
              configurations are returned in one big hash structure that can
              be given as argument to L(RestoreConfig). Only MOs from one TG
              can be stored at a time.

              Save configuration of TS 1. Default TG/TRXC. Default save
              variable:
                SaveConfig(TS => 1);

              Explicit TG/TRXC, different MO types/instances, saved in a
              variable:
                $Old = SaveConfig(Routing => {TG   => 1,
                                              TRXC => 3},
                                  TS      => [1..2,4],
                                  CON     => 1,
                                  DP      => [0..1]);

              Add to or update '$Old' configuration:
                %$Old = SaveConfig(TX => 0);

IN  : Parameters is a hash with the following keys:
        Routing  => As in OM2000, predefined variables used by default.
                    TRXC must be correct for some objects, e.g. TX.
        <Object> => The name of an object instance to save, value is an
                    instance, or an array of instances. Only AOs
                    supported currently.

OUT : Returns a pointer to the saved configuration, which can be given to
      L(RestoreConfig), see this routine.


=head2 Set_Default

 Set_Default();

SUBROUTINE  : Set_Default
DESCRIPTION : Set a default from list if parameter is undefined

IN  : $1 - Parameter to set
      @2 - Defaut values, tried left to right until not undef
OUT : $1 - Updated if it was undef


=head2 Signalling_Channel

 Signalling_Channel();

SUBROUTINE  : Signalling_Channel
DESCRIPTION : Tell whether ICP is for signalling or traffic

IN:  $1 - ICP number, must be above 511.
OUT: $1 - True if ICP is for signalling


=head2 Split_List

 Split_List();

SUBROUTINE  : Split_List
DESCRIPTION : Cut a long array into into smaller arrays.

              Example:
                @Pieces = Split_List([A,B,C,D,E], [1,2]);
                Assert(\@Pieces, [[A], [B, C], [D, E]]);

IN  : \@1 - A long list which will be split into many smaller lists
      \@2 - Lengths of the smaller lists. If all pieces are not specified,
      the last value will be used repeatedly.
OUT : @1 - Pointers to the smaller arrays.



=cut

=head1 NAME

csdatafunc


=head1 DESCRIPTION

Document number: 12/190 55-CAH 161 1290/1 Uen
MODULE      : csdatafunc.pl
DESCRIPTION : Support functions for sending CS Data from TSS.
              The only routine needed from an external program is SendCSData

              The program works for all Data Rates and all Abis Modes.

              For more information, see document:
                User Guide Payload testing with Abisco
                2/198 17-FCD 201 33 Uen
                (The document comes with the Abisco installation)

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME    REVIEW    COMMENT
P1A 060601    ESTEMOH           Created after splitting csdata.pl
P2A 090115    ESTEMOH           Interface to Prisma MSSIM added
P2B 090206    ESTEMOH           Added cc(viii), cc(ix) and cc(x)
P2C 090212    ESTEMOH           Cleanup of comments
P2D 090420    ESTEMOH           Updated for GSM base version 1.10
P2E 090424    ESTEMOH           Added Encryption
P2F 090622    ESTEMOH           Changed module header
P2G 090917    ESTEMOH           Added all subroutines in @EXPORT_OK
P2H 100105    ESTEMOH           Added safety release of CS data channel in
                                 TSS. Requires Abisco R32A or later.
P2I 100611    ESTEMOH           Modified for Loopback
P2J 100706    ESTEMOH           Changed to take hash as parameter input
P2K 110408    ETORWIL           Removed new Abisco_Connection due to
                                 HN67845 and HN65860.
A   20111017  XJMJMJM ETORWIL   Updated to new script template
                                 Quality control with PerlCritic.
                                 Added document number.
                                 Fixed imports and exports. Removed "Str"
                                 and "Strip" from Abisco_Connection
                                 include. Exchanged all "eq 'nr'" with
                                 "== nr".
                                 Updated AlgId in Activate Channel
                                 Use of undefined variable

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Carp> 

L<mssim_def> 

L<mssim_sub> 

L<mssim> 

L<User> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ActivateCSData

 ActivateCSData();

SUBROUTINE  : ActivateCSData
DESCRIPTION : To activate sending of CS Data in TSS

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
      $Param{Rate}
      $Param{Verification} (On or Off,)
      $Param{DTX}
      $Param{ICP}
      $Param{SimType} (Simulation type)
OUT : 0=Ok, 1=Error


=head2 ActivateChannel

 ActivateChannel();

SUBROUTINE  : ActivateChannel
DESCRIPTION : To make Channel Activation Normal Assign for Data.

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
      $Param{DTX}
      $ChannelRate
      $AlgOrRate
      $Param{ChComb}
      $Param{ICP}
      $Param{Algid}
      $Param{AlgOrRate}
OUT : 0=Ok, 1=Error


=head2 AllocateICP

 AllocateICP();

SUBROUTINE  : AllocateICP
DESCRIPTION : To allocate ICP and CI number

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
OUT : ICP
      CI


=head2 ChActMSSIM

 ChActMSSIM();

SUBROUTINE  : ChActMSSIM
DESCRIPTION : To activate a CS Data channel in the MSSIM

IN  : $Param{Ref}       (MSSIM Channel reference)
      $Param{Cell}      (MSSIM Cell)
      $Param{TG}
      $Param{TRXC}
      $Param{TS}
      $Param{Rate}      (Data rate)
      $Param{ChComb}    (Channel Combination)
OUT : 0=OK, 1= Error
      CcId              (MSSIM channel id)


=head2 ChRelMSSIM

 ChRelMSSIM();

SUBROUTINE  : ChRelMSSIM
DESCRIPTION : To release a channel in the MSSIM

IN  : $Param{CcId}  (MSSIM channel id)
OUT : 0=OK, 1=Error


=head2 CreateStatistics

 CreateStatistics();

SUBROUTINE  : CreateStatistics
DESCRIPTION : Save CS Data statistics for TSS in an array
              $Param{Rate}
              $Param{Statistics} (On, Off,)
              @{$Param{Result}} Statistics

IN  :
OUT : @{$Param{Result}} Statistics updated


=head2 DeactivateCSData

 DeactivateCSData();

SUBROUTINE  : DeactivateCSData
DESCRIPTION : To activate sending of CS Data in TSS

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
      $Param{Rate}
      $Param{Statistics} (On, Off,)
      @{$Param{Result}} Statistics
OUT : 0=Ok, 1=Error
      Result array updated with statistics


=head2 DeallocateICP

 DeallocateICP();

SUBROUTINE  : DeallocateICP
DESCRIPTION : To allocate ICP and CI number

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
OUT : None


=head2 DefinePattern

 DefinePattern();

SUBROUTINE  : DefinePattern
DESCRIPTION : To define pattern file to MSSIM

IN  : $Param{PatternFile}
OUT : 0=OK


=head2 Encr

 Encr();

SUBROUTINE  : Encr
DESCRIPTION : To turn on encryption in MSSIM

IN  : $Param{CcId}
      $Param{Algorithm Id}
OUT : None


=head2 GetCellInfo

 GetCellInfo();

SUBROUTINE  : GetCellInfo
DESCRIPTION : To fetch Cell Information from the ABISCO configuration
              for the requested TG and Cell

IN  : $Param{TG}
      $Param{Cell}
OUT : First TRXC number used in the Cell
      Last TRXC number used in the Cell
      TRXC number used for BCCH in the Cell
      BCCH type (COMB or NCOMB) used in the Cell
      Cell Broadcast indicator used in the Cell


=head2 GetStatistics

 GetStatistics();

SUBROUTINE  : GetStatistics
DESCRIPTION : To get CS Data statistics for TSS

IN  : Resp hash including DeactivateCSDataResult
OUT : None, global hash CSDataStat is updated with counters


=head2 ReadAbiscoConfig

 ReadAbiscoConfig();

SUBROUTINE  : ReadAbiscoConfig
DESCRIPTION : To get AbisMode and TCH Configuration in the
              ABISCO TG configuration.

IN  : $Param{TG}
      $Param{TRXC}
OUT : AbisMode
      TCH_Type


=head2 ReleaseChannel

 ReleaseChannel();

SUBROUTINE  : ReleaseChannel
DESCRIPTION : To make RF Channel release for a specific TS.
              Channel type Bm released.

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
OUT : 0=Ok, 1=Error


=head2 SLEEP

 SLEEP();

SUBROUTINE  : SLEEP
DESCRIPTION : Special sleep routine.
              The normal sleep does not work with TK GUI.

IN  : Time in seconds
OUT : None


=head2 SendCSData

 SendCSData();

SUBROUTINE  : SendCSdata
DESCRIPTION : To send CS Data

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
      $Param{Rate}         ("T4.8kbits/s", "T9.6kbits/s", "T14.4kbits/s",
                            "NT12kbits/s" or "NT14.5kbits/s")
      $Param{Time}         (Time to run
      $Param{DTX}          (On or Off)
      $Param{ChComb}       (1, 8, 9 or 10)
      $Param{Tool}         ("MSSIM" or "")
      $Param{AlgId}        (EncryptionaAlgorithm Id)
      $Param{SimType}      (Simulation Type, 0=Frames, 1=Looback)
      $Param{PatternFile}  (Pattern File, for Loopback mode only)
OUT : Error 0=OK, 1=error
      Error Reason
      Result               (Array including statistics from TSS and MSSIM)


=head2 StartLoopMSSIM

 StartLoopMSSIM();

SUBROUTINE  : StartLoopMSSIM
DESCRIPTION : To start the loop function in MSSIM

IN  : $Param{CcId}        (MSSIM downlink channel id)
      $Param{LoopCcId}    (MSSIM uplink channel id)
OUT : 0=OK


=head2 StartPRBS

 StartPRBS();

SUBROUTINE  : StartPRBS
DESCRIPTION : To start the PRBS function in MSSIM

IN  : $Param{CcId}
      $Param{PatternFile}
OUT : 0=OK


=head2 StopLoopMSSIM

 StopLoopMSSIM();

SUBROUTINE  : StopLoopMSSIM
DESCRIPTION : To stop the loop function in MSSIM

IN  : $Param{CcId}        (MSSIM downlink channel id)
      $Param{Rate}        (Data rate)
      @{$Param{Result}    (Statitics arry)
OUT : Status              (0=Ok, 1=Error)
      @{$Param{Result}    (Updated Statitics array)


=head2 StopPRBS

 StopPRBS();

SUBROUTINE  : StopPRBS
DESCRIPTION : To stop the PRBS function in MSSIM and prepare statistics

IN  : $Param{CcId}        (MSSIM downlink channel id)
      $Param{Rate}        (Data rate)
      @{$Param{Result}    (Statitics arry)
OUT : 0=Ok
      @{$Param{Result}    (Updated Statitics arry)


=head2 UnpackCnt

 UnpackCnt();

SUBROUTINE  : UnpackCnt
DESCRIPTION : To unpack statistics in the Cnt parameter

IN  : $Param{Rate}        (Data rate)
      @{$Param{Cnt}}      Cnt field fro m MSSIM
OUT : Result Hash updated with Cnt parameters


=head2 numerically

 numerically();

SUBROUTINE  : numerically
DESCRIPTION : Numerical sorting

IN  : None
OUT : None



=cut

=head1 NAME

dbLog


=head1 DESCRIPTION

Document number: 13/190 55-CAH 161 1290/1 Uen
MODULE      : dbLog.pm
DESCRIPTION : This package contains the subfunctions and variables
              used for SQLite database logging

COPYRIGHT ? ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
A   20111018  XSOFFRO   ETORWIL   File created. Added document number.
                                   Made script save result to to
                                    H:/uftework/abisco/Abisco.log to comply
                                    with ATP scheduler.
                                   Added Assert function(as replacement to
                                    the Abisco_Connection Assert function
                                    which use die instead of HandleError).
                                   A HandleError in Cleanup no longer aborts the script
                                    immediately, but gives a warning using carp.
                                    A croak is invoked at the end of StoreResultToDb()
                                    if any Errors have occurred in Cleanup,
                                    so the script still fails.
                                   HandleLogg messages are now logged in abiscolog
                                    using the function Log from user.pm.
                                   Compatible with perl 5.14
PB1 20121017 XYNSTAN  XDANHEN   Added SiteInfo to UpdateLogSection so that every Pre-sub
                                will contain GetSiteInfoResponse
PB2 20121018 XYNSTAN  XDANHEN   Added timer functionality, timer starts on PAC = P and ends on PAC = C


=head1 REQUIRES

L<English> 

L<File::Copy> 

L<User> 

L<HelpFunc> 

L<lib> 

L<Cwd> 

L<Carp> 

L<Abisco_Connection> 

L<DBI> 

L<DBI> 

L<diagnostics> Produce verbose warning diagnostics


=head1 IMPLEMENTS

L<Exporter> 


=head1 METHODS

=head2 Assert

 $self->Assert();

SUBROUTINE  : Assert
DESCRIPTION : Assert with DB logging

IN  : See Assert in abisco_connection.pm for more info
OUT : 0


=head2 DbCheckTable

 $self->DbCheckTable();

SUBROUTINE  : CheckTable
DESCRIPTION : To check if table is in used database

IN  : ldbh      - Database connection handle
      tablename - Database tablename
OUT : 1 for true, 0 for false


=head2 DbReport

 $self->DbReport();

SUBROUTINE  : DbReport
DESCRIPTION : To send log text from the Result hash to file.

IN  : PGMTablename - Test program table name
      DBFilename   - Database file name
      Type         - Message type (INFO/ERROR/RESULT/... etc)
      Message      - Message Text

OUT : None


=head2 DefaultFilename

 $self->DefaultFilename();

SUBROUTINE  : DefaultFilename
DESCRIPTION : Creates a filename for the database and abisco log files using
              TC, SubTC, data, time etc

IN  : None
OUT : A filename (no file ending)


=head2 EmptyLogBuffer

 $self->EmptyLogBuffer();

SUBROUTINE  : EmptyLogBuffer
DESCRIPTION : Write all pending messages to the logg

IN  : None
OUT : None


=head2 GetDateTime

 $self->GetDateTime();

SUBROUTINE  : GetDateTime
DESCRIPTION : Formats date and time

IN  : None
OUT : Formatted string with date and time


=head2 GetResult

 $self->GetResult();

SUBROUTINE  : GetResult
DESCRIPTION : Return the test result for the section.
              If HandleError is used with the parameter AllowCroak set to
              'FALSE', a return command with the value from GetResult()
              should be placed in the action section.

IN  : Automated   - 'User', 'Semi', 'Fully'
      Reason      - Reason string overriding default message

OUT : If the section had errors:
       - ('Not_Applicable', 'Testcase failed due to error')
          If no errors were detected and Fully automated:
       - ('Pass', '')
          If no errors were detected and Semi/User automated:
       - ('Not_Applicable', Test execution passed.
          Check log to verify the result')


=head2 HandleError

 $self->HandleError();

SUBROUTINE  : HandleError
DESCRIPTION : Performs necessary shutdowns and kills the program when an
              error occurs. It also log the errors and sets the TC result.

IN  : ErrMsg      - Contains information of the error cause
      Output      - Indicate where the message should be printed
                    (FILE / CONSOLE / NONE / BOTH)
      AllowCroak  - Inidcate that an error message should be
                    followed by a croak
OUT : None


=head2 HandleLogg

 $self->HandleLogg();

SUBROUTINE  : HandleLogg
DESCRIPTION : Saves logg message string to urther saving in database by
              DbReport.

IN  : LoggMsg         (Contains information of test case scenario)
      Output          - Indicate where the message should be printed
                                (FILE / CONSOLE / NONE / BOTH)
      ImmediateWrite  - Inidcate if the message should be written to
                        the logimmediate or placed in a message
                        buffer.
OUT : None


=head2 SetLogContextAsAction

 $self->SetLogContextAsAction();

SUBROUTINE  : SetLogContextAsAction
DESCRIPTION : Perform logging actions associated with the entering of the
              action section of a test-case. If a fail has occured in the
              precondition section, that is noted in the log here.

IN  : None
OUT : None


=head2 SetLogContextAsCleanup

 $self->SetLogContextAsCleanup();

SUBROUTINE  : SetLogContextAsCleanup
DESCRIPTION : Perform logging actions associated with the entering of the
              clean-up section of a test-case. If a fail has occured in the
              action section, that is noted in the log here.

IN  : None
OUT : None


=head2 SetLogContextAsPrecondition

 $self->SetLogContextAsPrecondition();

SUBROUTINE  : SetLogContextAsPrecondition
DESCRIPTION : Perform logging actions associated with the entering of the
              precondition section of a test-case.

IN  : None
OUT : None


=head2 StoreResultToDb

 $self->StoreResultToDb();

SUBROUTINE  : StoreResultToDb
DESCRIPTION : Write a result message to the log
              Should be places last in the clean-up section of every
              test case.

IN  : None
OUT : None


=head2 UpdateLogSection

 $self->UpdateLogSection();

SUBROUTINE  : UpdateLogSection

DESCRIPTION : A call to ths function should be placed in the beginning of
              each precondition/action/cleanup. The function perform the
              logging associated with the current section.

IN  : CreateAbiscoLog - Inidcator if an abiscolog should be created.
      UseWriteLog     - Indicator if all log messages should be
                        placed in a text file using the WriteLog
                        command.
      UseSQLiteLog    - Indicator if all log messages should be
                        placed in a SQL database file
      SkipActionIfFailedPreCond
                      - Inidcator if Action section of the test case
                        should be skipped if the precondition fails.
      ImmediateWrite  - Indicate if all log messages (from
                        HandleLog) should be immediately written to
                        the database/text file or be stored in a
                        buffer until a HandleError(),
                        UpdateLogSection() or StoreResultToDb is
                        issued.
OUT : None


=head2 WriteFileToDB

 $self->WriteFileToDB();

SUBROUTINE  : WriteFileToDB
DESCRIPTION : Write a text file into the database log

IN  : Filename  - File name
      Type      - File type

OUT : None


=head2 WriteLogDB

 $self->WriteLogDB();

SUBROUTINE  : WriteLogDB
DESCRIPTION : Write a message to the log

IN  : ErrMsg      - Error message text (setting this will make the
                    log type = ERROR)
      LoggMsg     - Error message text (setting this will make the
                    log type = INFO)
      ResultMsg   - Error message text (setting this will make the
                    log type = RESULT)
      Output      - Indicate where the message should be printed
                    (FILE / CONSOLE / NONE / BOTH)
      AllowCroak  - Inidcate that an error message should be
                    followed by a croak
      File        - File name from where the message was logged
      Line        - Line from where the message was logged

OUT : None



=cut

=head1 NAME

DVT_Support


=head1 DESCRIPTION

Document number: 3/190 55-CAH 161 1290/1 Uen
MODULE      : DVT_Support.pm
DESCRIPTION : This package contains functions handling communication with
              the DVT tool. Depending on the RBS software version the MRU
              names are either of the old DXU/TRUx type or the new DX/TRXx
              type. The conversion between the different type of names and
              the adaptation of the name type to the actual RBS software
              version is handled by the module.

              In the description of the module functions below, the
              following terminology has been used.

              Command: A DVT command given in string format. E.g. the
                       command to get the RBS application software revision
                       is 'rev'.

              Path:    The MRU name appended with ':' given in string
                       format, e.g. the path to the DXU MRU is 'DXU:'.

              MRU:     The MRU name in its common format, e.g. DXU.

              Besides specifying the path to the MRU, it is also possible to
              specify the path to the subsystem, e.g. 'DXU:PLS'.


COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 011002    QRAFRYS             Created
P1B 011004    QRAFRYS             Updated DVT_Command
P1C 011122    QRAFRYS             Update of DVT_Command
P1D 011127    QRAFRYS             Changed $Resp to %Resp and intruduced
                                  wantarray.
P1E 011203    QRAFRYS             Added DVT_Log_Read
P1F 011206    QRAFRYS             Improved documentation
P1G 011211    QRAFRYS             Removed the Abisco string format
                                  requirement.
P1H 011214    QRAFRYS             Partially re-designed for Mixed
                                  Configuration.
P1I 020122    QRAFRYS             Added the possibility to return more than
                                  one response from DVT_Command.
P1J 040116    ERABAHG             Added E0 for ECU in %MRUHash
A   20110905  XLEIMAR   ETORWIL   Applied new template and updated
                                   according to Perlcritic.

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Carp> 

L<Msg> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 Abbreviate

 Abbreviate();

SUBROUTINE  : Abbreviate
DESCRIPTION : Converts MRU to internal representation

IN  : $1 - MRU name
OUT : $2 - Abbreviated MRU name


=head2 Alt_Path

 Alt_Path();

SUBROUTINE  : Alt_Path
DESCRIPTION : Given the MRU name the second alternative for path is
              calculated. If Type is undefined the alternated Path is
              returned.

IN  : $1 - MRU name
OUT : $2 - Second alternative for Path


=head2 Check

 Check();

SUBROUTINE  : Check
DESCRIPTION : Checks that the given $MRU is supported

IN  : $1 - MRU name
OUT : None


=head2 DVT_Command

 DVT_Command();

SUBROUTINE  : DVT_Command
DESCRIPTION : The DVT_Command function sends a path and/or a command to the
              DVT. The path is checked and possibly converted with regard to
              the version of the RBS software. The command is not checked.
              Both path and command are optional arguments and should be
              given in string format.

              By default the function returns the response of the last
              executed DVT command as a hash or as a reference to a hash.
              All responses of a DVT command are returned in an array if the
              tag "Response => 'All'" is appended to the command. The
              function dies if the specified path is not supported.
              Currently DXU:/DX: and TRUx:/TRXx: paths are supported.

              The first time the DVT_Support module is called for a specific
              MRU the old path type, i.e. 'DXU:' for the DXU, and 'rev' are
              sent in order to determine the RBS software version of the
              MRU. If this initialisation is successful the type of MRU
              name, i.e. old or new type, is remembered by the module as
              long as it is executing.

              %Resp = DVT_Command(Path => 'DX:', Command => 'rev');

              Examples:
                The following two lines are equivalent, regardless of the
                RBS software version.

                %Resp = DVT_Command(Path => 'DXU:', Command => 'rev');
                %Resp = DVT_Command(Path => 'DX:', Command => 'rev');

                Change the path to TRU1...

                %Resp = DVT_Command(Path => 'TRU1:');

                ...and get the revision

                %Resp = DVT_Command(Command => 'rev');

                All responses of a command are returned by entering the
                following command...

                @RespList = DVT_Command(Path     => 'DXU:',
                                        Command  => 'rev',
                                        Response => 'All');

                ...the last response can be extracted and controlled with
                Assert.

                %LastResp = %{$RespList[$#RespList]};
                Assert(\%LastResp, {Message => Accept});

IN  :
OUT :


=head2 DVT_Log_Read

 DVT_Log_Read();

SUBROUTINE  : DVT_Log_Read
DESCRIPTION : The DVT_Log_Read function reads the log stored in the
              specified MRUs using the DVT tool. The MRU names specified in
              the MRU list are checked and possibly converted, since the
              underlying DVT.LogRead command only accepts MRU names of the
              old DXU/TRUx type. Thus, the TP programmer is allowed to call
              the DVT_Log_Read function with MRU names of both old DXU/TRUx
              type and new DX/TRXx type, regardless of the actual RBS
              software version.

              The function returns the number of log items read. Currently
              DXU/DX and TRUx/TRXx MRU names are supported.

              The first time the DVT_Support module is called for a specific
              MRU the old path type, i.e. 'DXU:' for the DXU, and 'rev' are
              sent in order to determine the RBS software version of the
              MRU. If this initialisation is successful the type of MRU
              name, i.e. old or new type, is remembered by the module as
              long as it is executing.

              When executing test programs with Tex or Texas, the LOG
              feature in the program description will employ the
              DVT_Log_Read function internally. Thus, the corresponding MRU
              list is allowed to be of either old or new MRU name type.

              $MRUList = [DXU, TRU0];
              $Items_Of_Interest = DVT_Log_Read($MRUList);

              Examples:
                The following two lines are equivalent, regardless of the
                RBS software version.

                $Items_Of_Interest = DVT_Log_Read([DXU, TRU0]);
                $Items_Of_Interest = DVT_Log_Read([DX, TRX0]);

IN  :
OUT :


=head2 DVT_MRU_Type

 DVT_MRU_Type();

SUBROUTINE  : DVT_MRU_Type
DESCRIPTION : The DVT_MRU_Type function returns the MRU name type for the
              specified MRU. The name type can be either 'Old' or 'New'.

              $MRUType = DVT_MRU_Type('DXU');

              Examples:
                The following two lines are equivalent, regardless of the
                RBS software version.

                $MRUType = DVT_MRU_Type('DXU');
                $MRUType = DVT_MRU_Type('DX');

IN  :
OUT :


=head2 First_Path

 First_Path();

SUBROUTINE  : First_Path
DESCRIPTION : Given the MRU name the first alternaive for path is
              calculated. If Type is assumed to be the first
              alternative.

IN  : $1 - MRU name
OUT : $2 - First alternative for Path


=head2 Init

 Init();

SUBROUTINE  : Init
DESCRIPTION : Initialises Type variable

IN  : $1 - MRU name
      $2 - Command string
OUT : None


=head2 LongMRU_2_Path

 LongMRU_2_Path();

SUBROUTINE  : LongMRU_2_Path
DESCRIPTION : Convert from LongMRU to Path

IN  : $1 - MRU name
OUT : $2 - Path


=head2 Old_MRU

 Old_MRU();

SUBROUTINE  : Old_MRU
DESCRIPTION : Given the MRU name, the corresponding old MRU name is returned

IN  : $1 - MRU name
OUT : $2 - Returns the corresponding old MRU name


=head2 Path_2_LongMRU

 Path_2_LongMRU();

SUBROUTINE  : Path_2_LongMRU
DESCRIPTION : Convert from Path to LongMRU

IN  : $1 - Path name
OUT : $2 - MRU name


=head2 Send_Command

 Send_Command();

SUBROUTINE  : Send_Command
DESCRIPTION : Sends command to DVT

IN  : $1 - Command string
OUT : @2 - List with responses


=head2 Update_Type

 Update_Type();

SUBROUTINE  : Update_Type
DESCRIPTION : Checks if the MRU name is an old or new Type and sets the
              Type. If the MRU name is neither an old or new path type the
              Type is unchanged.

IN  : $1 - MRU name
OUT : None



=cut

=head1 NAME

DVTFunc


=head1 DESCRIPTION

Document number: 14/190 55-CAH 161 1290/1 Uen
MODULE      : dvtfunc.pm
DESCRIPTION : This module contains functions to facilitate some DVT handling
              like clearing logs, reading logs etc. Some DVT commands differ
              betweed the PPC and the AMD. In the test programs the devices
              are meant to have the generic format of the device according
              to:

                 Generic   PPC    AMD
                   DX      DX     DXU
                   TRU     TRX    TRU
                   ECU     EC     ECU

              For example, the generic form DX remains unchanged if $TG{DXU}
              is PPC, and is changed to DXU if $TG{DXU} is AMD. This
              behavior is applied depending on the value of entry
              $TG{CheckAMD}. A true value enables the behavior mentioned
              above while false (0) disables it.

              Some commands may write to files, the convention is that the
              file name is passed with entry {File} and that the path is
              fixed to the one specified in $TG{PathLocalDVTLogs}. This path
              should point to the c: drive (UFTE computer), this is the way
              adopted; the files can be copied to a working directory
              (possibly under h: or s:) at the end of the tests. This final
              copy can be done by CopyDVTLogFiles in HelpFunc. This routine
              needs:
               - $TG{PathDVTLogs}          copy to
               - $TG{PathLocalDVTLogs}     copy from
               - $TG{UFTE_PC_MappedDrive}  the UFTE PC must be mapped on the
                                           Abisco PC

              Entry {Receive} may be set to 'NO' if an answer from the
              functions is not wanted (i.e. it does only a Put, not followed
              by a Get).

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV    DATE       NAME      REVIEW    COMMENT
PA1    20051128   ERADIPE             First revision
P1A    20080319   ERABAHG             Changed log read to log read detailed.
                                      New rev.
P1B    20080609   XRSJALI             Solution for TR 5832. Merged to main
P1B_1A 20080609   XRSJALI             Solution for TR 5763.
P1C    20080904   ERABAHG             Merged to main
P1C_1A 20080910   XRSJALI             Solution for CR 5865.
P1D    20080915   ERAMODN             Merge to main, PA8
P1D_1A 20080926   XMATTEK             ClearAndDestWindow now considers using
                                      detailed log (needed for CR5767).
P1D_1B 20080929   XRSJALI             Implementing TR 5858.
P1E    20081009   ERAMODN             Merge to main, PA9
P1E_1A 20081008   XRSJALI             Implementing CR 5926.
P1E_2A 20081030   XRSJALI             Implementing TR 5931.
P1F    20081020   XRSJALI             Merge to main
P1F_1A 20090424   XYNSTAN             Implementing TR 5920
P1G    20090424   XYNSTAN             Merge to main
P1G_1A 20090611   XYNSTAN             Implementing TR 6149
P1H    20090611   XYNSTAN             Merge to main
A      20110830   XLEIMAR   ETORWIL   Updated to new script template,
                                       Quality control with PerlCritic.
                                       Moved "Str" and "Strip" include from
                                       Absico_Connection to Msg. Removed
                                       "Pack" include from msg (not used).
B      20120530   XLEAENG             HP14008: Merged with ACM libraries
C      20120703   XLEAENG             Removed trailing spaces and hard tabs
D      20120711   XNURMOH   EDAMELI   Script optimization
E      20121017   XWOOKUN   XNURMOH   Debug mode to connect DVT through 5001 for sub DVTEstablishSocket
F      20130415   XTEHKIN   XWOOKUN   Modified in HQ59724, send 'RPA 1' in case RPA value is more than 80.
                                       Changed some commands in DVTRestart() to run recursively when rejected.
                                       DVT Time out flag was added in Measure subroutine.
                                       Modified for HQ62916
                                       Modified for 0004187

G      20131011  Syntronic AB/ Syntronic AB/  Modified for HR38066
                 Adibah        Jonathan       Modified in HR52197
                                              Modified in 0004745
H      20131111  Syntronic AB/ Syntronic AB/  0004795: Fixed profiler command return problems
                 Adibah        Catherine
Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<HelpFunc> 

L<Time::HiRes> 

L<Event> 

L<IO::Handle> 

L<Hash::Util> 

L<feature> 

L<English> 

L<Carp> 

L<PerlFunc> 

L<MIME::Base64> 

L<Win32> 

L<Socket> 

L<AbiscoFunc2> 

L<Msg> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 CheckAMD

 CheckAMD();

SUBROUTINE  : CheckAMD
DESCRIPTION : Some DVT commands differ between PPC and AMD. In the main
              program the DVT commands have a generic format which is
              translated to the appropriate one whenever a DVT command is
              issued.

IN  : 1. {%TG}     -> Reference to TG hash.
      2. \$Command -> Reference to the command string to be processed
                      in generic format.
OUT : 1. \$Command -> Reference to the command string after it is
                      corrected to PPC or AMD format.


=head2 CheckDXUPlatform

 CheckDXUPlatform();

SUBROUTINE  : CheckDXUPlatform
DESCRIPTION : 1. Sets $TG{DXU}.
                   IN  : None
                   OUT : None

           or 2. Retrieves the DXU platform type. (ACM)
                   IN  : 1. $Conn    -> Abisco connection object.
                         2. {%TG}    -> Reference to TG hash.
                         3. $cb      -> Callback function implementation.
                   OUT : 1. $TG{DXU} -> DXU platform type,
                                        either AMD or PPC.


=head2 CheckImprovedSWLog

 CheckImprovedSWLog();

SUBROUTINE  : CheckImprovedSWLog
DESCRIPTION : Check if a target RU handles Improved SW Log. This routine
              expects the RU to be selected already (i.e you have sent "DX:"
              or similar through a DVTCommand).

IN  : 1. $Conn -> Abisco connection object.
      2. {%TG} -> TG hash.
      3. $cb   -> Callback function implementation.
OUT : 1. $iL   -> 1 if the RU handles Improved SW Log, undef otherwise.


=head2 ClearDVTLog

 ClearDVTLog();

SUBROUTINE  : ClearDVTLog
DESCRIPTION : Example
                 ClearDVTLog(BTSConn => $abisco, TG => \%TG,
                             cb => \&Callback);
                 ClearDVTLog(BTSConn => $abisco, TG => \%TG,
                             Devices => ['DX', @{$TG{TRXListMon}[2]}],
                             cb => \&Callback);

              When device is not specified, the device is unchanged and only
              'log clear' is issued.

IN  : A hash with the following hash-key(s):
      1. BTSConn            -> Abisco connection object.
      2. TG                 -> Reference to TG hash.
      3. Devices (Optional) -> Reference to a list of devices.
      4. cb                 -> Callback function implementation.
OUT : -


=head2 DVTClearAndDestWindow

 DVTClearAndDestWindow();

SUBROUTINE  : DVTClearAndDestWindow
DESCRIPTION : Example
                 @Devices = ('DX', 'TRU0', 'TRU1', 'ECU0');
                 DVTClearAndDestWndow($abisco, \%TG, \@Devices, sub {
                                        ...
                                      });

IN  : A hash with the following hash-key(s):
      1. $Conn      -> Abisco connection object.
      2. {%TG}      -> Reference to TG hash.
      3. [@Devices] -> Reference to a list of devices.
      4. $Mode      -> 'on' or 'off'. If undef, defaults to 'all'.
      5. $Mode2     -> 'read' or undef.
      6. cb         -> Callback function implementation.
OUT : -


=head2 DVTCloseSocket

 DVTCloseSocket();

TR6157: Bad crash handling.
Date: 2009-07-28
TR Fix: New DVTCloseSocket will check whether the sockets have been defined
       before closing them.
TR6467: DVT Mixed command inputs.
Date: 2010-04-05
TR Fix: Set DVT to 'remote off' before closing sockets.
SUBROUTINE  : DVTCloseSocket
DESCRIPTION :

IN  : 1. $AbiscoConn -> Abisco connection object.
      2. $cb         -> Callback function implementation.
OUT : -


=head2 DVTCommand

 DVTCommand();

SUBROUTINE  : DVTCommand
DESCRIPTION : The answer to a command may be sent in a Spontaneous message
              e.g. when requesting SW revision. Answers have been seen to
              differ between different versions of DVT and between PPC and
              AMD.
              This means that following code is not failproof.
              Please feel free to improve it!

              1. Usage 1
                 Example:
                   DVTCommand(Command => 'DX:', CheckAMD => 1);
                   DVTCommand(Command => 'ECU0:', Receive => 'NO');
                   DVTCommand(Command => 'rpa');
                   DVTCommand(Command => 'Hardware reset 0', Timeout => 80);

                   IN  :
                   OUT : Accept || Spontaneous || Reject

           or 2. Usage 2 (ACM)
                 Example:
                   DVTCommand(BTSConn => $abisco, TG => \%TG,
                              Command => 'DX:', CheckAMD => 1,
                              cb => \&Callback);
                   DVTCommand(BTSConn => $abisco, TG => \%TG,
                              Command => 'ECU0:', Receive => 'NO',
                              cb => \&Callback);
                   DVTCommand(BTSConn => $abisco, TG => \%TG,
                              Command => 'rpa', cb => \&Callback);
                   DVTCommand(BTSConn => $abisco, TG => \%TG,
                              Command => 'Hardware reset 0', Timeout => 80,
                              cb => \&Callback);

                   IN  : A hash with the following hash-key(s):
                         1. BTSConn -> Abisco connection object.
                         2. TG      -> Reference to TG hash.
                         3. Command -> Command string to send to DVT.
                         4. CheckAMD (optional)
                                    -> 1 if the command string needs to be
                                       corrected to PPC or AMD format. 0 or
                                       undef if otherwise.
                                       Default is $TG{CheckAMD}.
                         5. Receive (Optional)
                                    -> YES to wait for response after
                                       sending the command string,
                                       NO to not wait.
                                       Default is YES.
                         6. Timeout (Optional)
                                    -> Timeout, in seconds. Default is 30.
                         7. cb      -> Callback function implementation.
                   OUT : A hash with the following hash-key(s):
                         1. Message -> Values can be either Accept,
                                       Spontaneous, Reject or Timeout.


=head2 DVTEstablishSocket

 DVTEstablishSocket();

TR6157: Bad crash handling.
Date: 2009-07-28
TR Fix: New DVTEstablishSocket will call DVTCloseSocket to close any
       existing connections before establishing connection.
       Removed some redundant codes.
TR6467: DVT Mixed command inputs.
Date: 2010-04-05
TR Fix: Modified DVTEstablishSocket() to accommodate the changes in
       DVTCloseSocket() implementation has been changed to set DVT to
       'remote off' before closing sockets.
SUBROUTINE  : DVTEstablishSocket
DESCRIPTION :

IN  : 1. $AbiscoConn -> Abisco connection object.
      2. {%TG}       -> Reference to TG hash.
      3. $cb         -> Callback function implementation.
OUT : -


=head2 DVTInfoTool

 DVTInfoTool();

SUBROUTINE  : DVTInfoTool
DESCRIPTION : Send DVT.InfoTool to request DVT information

IN  : 1. $conn    -> Abisco connection object.
      2. $cb      -> Callback function implementation.
OUT : -


=head2 DVTReadFromSocket

 DVTReadFromSocket();

SUBROUTINE  : DVTReadFromSocket
DESCRIPTION :

IN  :
OUT :


=head2 DVTReadFromSocketCallback

 DVTReadFromSocketCallback();

SUBROUTINE  : DVTReadFromSocketCallback
DESCRIPTION : This function will be triggered by an IO read event on either
              $dvtSockets[1], $dvtSockets[2], or $dvtSockets[3]. It is not
              meant to be called directly.

IN  : 1. $event -> The event object associated with this function.
OUT : -


=head2 DVTRestart

 DVTRestart();

CR6468: DVT Strange use of command.
Date: 2010-04-02
TR Fix: Changed DVTRestart() from 'DVT.Reset' to 'dvt exit'+NewTool way.
       DVTRestart() no longer calls DVTEstablishSocket() because not all
       TPs require the TCP/IP way of communicating with DVT. Better to
       call DVTEstablishSocket() separately for TPs that need to talk to
       DVT via TCP/IP.
TR6642: DVT Bad DVT handling.
Date: 2010-05-26
TR Fix: Allow caller of DVTRestart() to have a choice whether to restart DVT
       ("exit" + "start"), "exit" only (without "start"), or don't "exit"
       ("start" only).
0004745 : 20130910 : Increase timeout to 180s
SUBROUTINE  : DVTRestart
DESCRIPTION : 1. Exiting and restarting the dvt app

                   IN  :
                   OUT :

           or 2. Restarts the DVT application. Then, clears the log areas of
                 the specified RUs. (ACM)

                  IN  :  1. $AbiscoConn -> Abisco connection object.
                         2. {%TG}       -> Reference to TG hash.
                         3. [@RU]       -> Reference to a list of RUs. The
                                           log areas of these RUs will be
                                           cleared.
                         4. $Mode       -> One of:
                              NORMAL    - Perform both "exit" and "start" of
                                          DVT. This is the default.
                              DONT_EXIT - No need to tell the DVT to "exit".
                                          Just start it right away. It
                                          should be assumed that the DVT has
                                          already been closed by other
                                          means.
                              EXIT_ONLY - Close the DVT without starting it
                                          again later.
                         5. $rCb        -> Reference to callback function
                                           implementation.
                   OUT : 1. $State      -> Value of this is always 'DONE'.


=head2 DVTSendToSocket

 DVTSendToSocket();

SUBROUTINE  : DVTSendToSocket
DESCRIPTION :

IN  :
OUT :


=head2 DVTSocketRequest

 DVTSocketRequest();

SUBROUTINE  : DVTSocketRequest
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. TG      -> Reference to TG hash.
      2. Command -> Command string to send to DVT.
      3. Receive -> YES to wait for response after sending
                    the command string, NO to not wait.
                    Default is YES.
      4. Timeout -> Timeout, in seconds. Default is 10.
      5. cb      -> Callback function implementation.
OUT : 1. $rA     -> One of:
           [@ans] - A list is returned if the socket request
                    completed successfully.
           1      - The 'Receive' parameter was set to 'NO'.
                    (See IN)
           {Message => 'Timeout'}
                  - Timeout occurred.


=head2 GetBTS_SWRev

 GetBTS_SWRev();

SUBROUTINE  : GetBTS_SWRev
DESCRIPTION : Gets the BTS SW revision for a device as obtained by DVT.
              The revisions for all devices and for all locations
              (RAM e.t.c.) are obtained and put in a file if requested.

              1. Usage 1
                 Example:
                   $SW = GetBTS_SWRev(Devices => ['DX']);
                     Just get the SW revision. Only one device must be
                     specified. {File} is by default 'SCALAR'. If more than
                     one device should be given then the SW revision of the
                     last one should be returned.

                   GetBTS_SWRev(Devices  => [@{$TG{TRXList}}],
                                Location => ['FLASH'],
                                File     => '');
                   GetBTS_SWRev(Devices  => ['DX'],
                                Location => ['FLASH', 'BACKUP'],
                                File     => 'SCREEN');

                   Location : RAM || FLASH || BACKUP     (RAM is default)
                   File     : SCALAR || SCREEN || file   (SCALAR is default)
                   Code     : 4 || 5 || 7 || 8           (4 is default)

                     Example: 4 -> P9AF
                              5 -> P9AFZ
                              7 -> DXPP9AF
                              8 -> DXPP9AFZ

                   $DX_SW = GetBTS_SWRev(Devices => ['DX'], Code => 8);

                 Files are saved under $TG{PathLocalDVTLogs} if this entry
                 is defined otherwise under c:. File names follow a
                 standard pattern:

                   GetBTS_SWRev(Devices => ['DX', 'TRU3'],
                                File    => '2');
                   -> 'sw_revision_0002.txt'

                   IN  :
                   OUT :

           or 2. Usage 2 (ACM)
                 Example:
                   $SW = GetBTS_SWRev(BTSConn => $abisco, TG => \%TG,
                                      Devices => ['DX'], cb => \&Callback);
                      Just get the SW revision. Only one device must be
                      specified. {File} is by default 'SCALAR'. If more
                      than one device should be given then the SW revision
                      of the last one should be returned.

                   GetBTS_SWRev(BTSConn => $abisco, TG => \%TG,
                                Devices => [@{$TG{TRXList}}],
                                Location => ['FLASH'], File => '',
                                cb => \&Callback);
                   GetBTS_SWRev(BTSConn => $abisco, TG => \%TG,
                                Devices => ['DX'],
                                Location => ['FLASH', 'BACKUP'],
                                File => 'SCREEN', cb => \&Callback);

                   Location : RAM || FLASH || BACKUP     (RAM is default)
                   File     : SCALAR || SCREEN || file   (SCALAR is default)
                   Code     : 4 || 5 || 7 || 8           (4 is default)

                              Example: 4 -> P9AF
                                       5 -> P9AFZ
                                       7 -> DXPP9AF
                                       8 -> DXPP9AFZ

                   $DX_SW = GetBTS_SWRev(BTSConn => $abisco, TG => \%TG,
                                         Devices => ['DX'], Code => 8,
                                         cb => \&Callback);

                 Files are saved under $TG{PathLocalDVTLogs} if this entry
                 is defined otherwise under c:. File names follow a
                 standard pattern:

                     GetBTS_SWRev(BTSConn => $abisco, TG => \%TG,
                                  Devices => ['DX', 'TRU3'], File => '2',
                                  cb => \&Callback);
                     -> 'sw_revision_0002.txt'

                   IN  : A hash with the following hash-key(s) (See
                         description for details):
                         1. BTSConn
                         2. TG
                         3. Devices
                         4. Location (Optional)
                         5. File (Optional)
                         6. Code (Optional)
                         7. cb
                   OUT : 1. $TG{SW} -> One of:
                              The software revision number
                              "DVT jammed" -> This indicates that a timeout
                                              occured when trying to obtain
                                              SW rev.
                              "Incorrect code when obtaining SW revision"


=head2 GetIdleLoad

 GetIdleLoad();

SUBROUTINE  : GetIdleLoad
DESCRIPTION : Returns an array, example:
                 [78.2, 51, 0]
                 [0, 1000, 1]

IN  : 1. $LogFilePath, Current minute DVT log file.
      2. $TRS
      3. $RU
OUT : 1. [@B]


=head2 GetRPALoad

 GetRPALoad();

SUBROUTINE  : GetRPALoad
DESCRIPTION : Element 2 is 0 or 1.
              0 means OK and 1 means NOK.

IN  : 1. $LogFilePath, current minute dvt log file.
      2. $Mon
      3. $RU
OUT : 1. [@B]


=head2 HandleDVTPrompt

 HandleDVTPrompt();

SUBROUTINE  : HandleDVTPrompt
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. Timeout -> Timeout, in seconds
      2. cb      -> Callback function implementation.
OUT : A hash with the following hash-key(s):
      1. Message -> Values can be either Ready or Timeout.


=head2 HandleDVTResponse

 HandleDVTResponse();

SUBROUTINE  : HandleDVTResponse
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. Timeout -> Timeout, in seconds
      2. cb      -> Callback function implementation.
OUT : A hash with the following hash-key(s):
      1. Message -> Values can be either Accept, Spontaneous,
                    Reject or Timeout.


=head2 LogRead

 LogRead();

SUBROUTINE  : LogRead
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $Conn -> Abisco connection object.
      2. {%TG} -> Reference to TG hash.
      3. $Rec  -> Ignored! Left for future development and debugging.
      4. $FI (Optional)
               -> If this is specified, the logs are written
                  to a file. The value here will also be used
                  in the logfile naming.
      5. $RU (Optional)
               -> RU value to be appended to the logfile name.
      6. cb    -> Callback function implementation.
OUT : -


=head2 Measure

 Measure();

CR6450: DVT The command "dvt remote off" via TTR.
Date: 2010-04-05
CR Fix: Changed Measure() implementation so that "dvt remote off" is set via
       TTR. Removed sending of "dvt remote on" because it is redundant.
TR6677: TC 409:022 terminated prematurely.
Date: 2010-06-14
TR Fix: Allow program to continue after timeout when sending
       "dvt remote off", but record the occurrence in Abisco log.
SUBROUTINE  : Measure
DESCRIPTION : Measure the specified RUs to obtain their process properties
              (CPU load and RAM pool allocation). This is achieved with the
              help of some DVT commands sent through TCP/IP sockets.

IN  : A hash with the following hash-key(s):
      1. AbiscoConn -> Abisco connection object.
      2. TG         -> Reference to TG hash.
      3. RUs        -> List of RUs to be measured.
      4. ProcProps  -> List of process properties to be measured.
                       Measurable process properties: IDLE and POOL.
      5. DVTLogPath -> Path for DVTLog txt
      6. cb         -> Reference to callback function implementation.
OUT : 1. $State     -> One of:
           DONE         - Action completed successfully.
           UNSUCCESSFUL - Action aborted due to socket errors.
      2. {%Results} -> Reference to a hash containing the measurements.
      3. {%DVTStat} -> Reference to a hash containing the stats when
                       reading data.
      4. $Flag      -> 0=OK, 1=NOK.
      5. $RespTime  -> Time taken to complete the entire Measure action
                       in seconds, truncated to one decimal point.
      6. $DVTTimeoutFlag -> On : when dvt command timeout , off : dvt command done.


=head2 ProfilerLogRead

 ProfilerLogRead();

SUBROUTINE  : ProfilerLogRead
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $Conn -> Abisco connection object.
      2. {%TG} -> Reference to TG hash.
      3. $Rec  -> Ignored! Left for future development and debugging.
      4. $FI (Optional)
               -> If this is specified, the logs are written
                  to a file. The value here will also be used
                  in the logfile naming.
      5. $RU (Optional)
               -> RU value to be appended to the logfile name.
      6. $Long (Optional) -> Read Long Profiler Log.
      7. cb    -> Callback function implementation.
OUT : -


=head2 ReadDVTLog

 ReadDVTLog();

SUBROUTINE  : ReadDVTLog
DESCRIPTION : Example
                ReadDVTLog(BTSConn => $abisco, TG => \%TG,
                           cb => \&Callback);
                ReadDVTLog(BTSConn => $abisco, TG => \%TG,
                           Devices => ['DX', 'ECU2', 'TRU0', 'TRU3'],
                           cb => \&Callback);
                ReadDVTLog(BTSConn => $abisco, TG => \%TG,
                           Devices => ['DX'], File => 'log_file',
                           cb => \&Callback);
                ReadDVTLog(BTSConn => $abisco, TG => \%TG, File => '58',
                           Receive => 'NO', cb => \&Callback);

              File names:
                  ReadDVTLog(BTSConn => $abisco, TG => \%TG,
                             Devices => ['DX', 'TRU3'], File => '2',
                             cb => \&Callback);
                  -> '0002_DX.txt' and '0002_TRU3.txt'

              OBSERVE: The file name shall not include extension.

IN  : A hash with the following hash-key(s):
      1. BTSConn -> Abisco connection object.
      2. TG      -> Reference to TG hash.
      3. Devices (Optional)
                 -> Reference to a list of devices.
      4. File (Optional)
                 -> If this is specified, the logs are written
                    to a file. The value here will also be used
                    in the logfile naming. See example above.
      5. Receive (Optional)
                 -> YES to wait for response after sending
                    the command to DVT, NO to not wait.
                    Default is YES.
      6. cb      -> Callback function implementation.
OUT : -


=head2 ReadDVTProfilerLog

 ReadDVTProfilerLog();

HN28362:  Introduce a new TC with corresponding scripts (profiling) to ACM tests
Date: 2010-12-14
CR Fix: Create new functions for Profiling
SUBROUTINE  : ReadDVTProfilerLog
DESCRIPTION : Example
                ReadDVTProfilerLog(BTSConn => $abisco, TG => \%TG,
                           cb => \&Callback);
                ReadDVTProfilerLog(BTSConn => $abisco, TG => \%TG,
                           Devices => ['DX', 'ECU2', 'TRU0', 'TRU3'],
                           cb => \&Callback);
                ReadDVTProfilerLog(BTSConn => $abisco, TG => \%TG,
                           Devices => ['DX'], File => 'log_file',
                           cb => \&Callback);
                ReadDVTProfilerLog(BTSConn => $abisco, TG => \%TG,
                           File => '58', Receive => 'NO', cb => \&Callback);
                ReadDVTProfilerLog(BTSConn => $abisco, TG => \%TG,
                           Devices => ['DX', 'ECU2', 'TRU0', 'TRU3'],
                           Long => 'YES', cb => \&Callback);

              File names:
                  ReadDVTProfilerLog(BTSConn => $abisco, TG => \%TG,
                             Devices => ['DX', 'TRX0'],
                             File =>"profilerlog", Long => 'YES',
                             cb => \&Callback);
                  -> 'profilerlog_DX.txt' and 'profilerlog_TRX0.txt'
                  Note! If Long->"YES" > 'profilerlog_long_DX.txt' and
                  'profilerlog_long_TRX0.txt'
              OBSERVE: The file name shall not include extension.

IN  : A hash with the following hash-key(s):
      1. BTSConn -> Abisco connection object.
      2. TG      -> Reference to TG hash.
      3. Devices (Optional)
                 -> Reference to a list of devices.
      4. File (Optional)
                 -> If this is specified, the logs are written
                    to a file. The value here will also be used
                    in the logfile naming. See example above.
      5. Receive (Optional)
                 -> YES to wait for response after sending
                    the command to DVT, NO to not wait.
                    Default is YES.
      6. Long (Optional) -> if defined, read Long Profiler Log too, else
                            read only normal profiler log.
      7. cb    -> Callback function implementation.
OUT : -


=head2 RecursiveClearDVTLogForeachDevice

 RecursiveClearDVTLogForeachDevice();

SUBROUTINE  : RecursiveClearDVTLogForeachDevice
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. BTSConn -> Abisco connection object.
      2. TG      -> Reference to TG hash.
      3. Devices -> Reference to a list of devices.
      4. cb      -> Callback function implementation.
OUT : -


=head2 RecursiveDVTClearAndDestWindowForeachDevice

 RecursiveDVTClearAndDestWindowForeachDevice();

SUBROUTINE  : RecursiveDVTClearAndDestWindowForeachDevice
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $Conn      -> Abisco connection object.
      2. {%TG}      -> Reference to TG hash.
      3. [@Devices] -> Reference to a list of devices.
      4. $Mode      -> 'on' or 'off'. If undef, defaults to 'all'.
      5. $Mode2     -> 'read' or undef.
      6. cb         -> Callback function implementation.
OUT : -


=head2 RecursiveDVTSocketRequests

 RecursiveDVTSocketRequests();

SUBROUTINE  : RecursiveDVTSocketRequests
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. TG      -> Reference to TG hash.
      2. Command -> Command string to send to DVT.
      3. Receive -> YES to wait for response after sending
                    the command string, NO to not wait.
                    Default is YES.
      4. Timeout -> Timeout, in seconds. Default is 10.
      5. Answer  -> Answer received from the last socket request.
      6. Count   -> Number of socket requests left to be executed.
      7. cb      -> Callback function implementation.
OUT : 1. $rA     -> Answer received from the last socket request. One of:
           [@ans] - A list is returned if the socket request
                    completed successfully.
           1      - The 'Receive' parameter was set to 'NO'.
                    (See IN)
           {Message => 'Timeout'}
                  - Timeout occurred.


=head2 RecursiveGetBTS_SWRevForeachDevice

 RecursiveGetBTS_SWRevForeachDevice();

SUBROUTINE  : RecursiveGetBTS_SWRevForeachDevice
DESCRIPTION :

IN  : A hash with the following hash-key(s) (See description of
      GetBTS_SWRev()):
      1. BTSConn
      2. TG
      3. Devices
      4. Location
      5. File
      6. Code
      7. Answer (Optional) -> Default is an empty string.
      8. cb
OUT : 1. $Answer -> One of:
           The software revision number
           "DVT jammed" -> This indicates that a timeout occured
                           when trying to obtain SW rev.
           "Incorrect code when obtaining SW revision"


=head2 RecursiveGetBTS_SWRevForeachLocation

 RecursiveGetBTS_SWRevForeachLocation();

SUBROUTINE  : RecursiveGetBTS_SWRevForeachLocation
DESCRIPTION :

IN  : A hash with the following hash-key(s) (See description of
      GetBTS_SWRev()):
      1. BTSConn
      2. TG
      3. Devices
      4. Location
      5. File
      6. Code
      7. RU -> A single device (from the list of devices passed by
               input param #3) whose locations are being checked.
      8. Answer
      9. cb
OUT : 1. $Answer -> One of:
           The software revision number
           "DVT jammed" - This indicates a that timeout occured
                          when trying to obtain SW rev.
           "Incorrect code when obtaining SW revision"


=head2 RecursiveMeasureForeachLog

 RecursiveMeasureForeachLog();

SUBROUTINE  : RecursiveMeasureForeachLog
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $AbiscoConn-> Abisco connection object.
      2. {%TG}      -> Reference to TG hash.
      3. $Mon       -> Monitor.
      4. [@Log]     -> Reference to a list of log types.
      5. {%Results} -> Reference to a hash containing the measurements.
      6. {%DVTStat} -> Reference to a hash containing the stats when
                       reading data.
      7. $Flag      -> 0=OK, 1=NOK.
      8. $DVTLogPath -> Path for DVTLog txt
      9. $cb        -> Callback function implementation.
OUT : If successful:
        1. {%Results} -> Reference to a hash containing the measurements.
        2. {%DVTStat} -> Reference to a hash containing the stats when
                         reading data.
        3. $Flag      -> 0=OK, 1=NOK.
      If timeout:
        1. {Message => 'Timeout'}


=head2 RecursiveMeasureForeachMonitor

 RecursiveMeasureForeachMonitor();

SUBROUTINE  : RecursiveMeasureForeachMonitor
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $AbiscoConn-> Abisco connection object.
      2. {%TG}      -> Reference to TG hash.
      3. [@Mon]     -> Reference to a list of monitors.
      4. [@Log]     -> Reference to a list of log types.
      5. {%Results} -> Reference to a hash containing the measurements.
      6. {%DVTStat} -> Reference to a hash containing the stats when
                       reading data.
      7. $Flag      -> 0=OK, 1=NOK.
      8. $DVTLogPath -> Path for DVTLog txt
      9. $cb        -> Callback function implementation.
OUT : If successful:
        1. {%Results} -> Reference to a hash containing the measurements.
        2. {%DVTStat} -> Reference to a hash containing the stats when
                         reading data.
        3. $Flag      -> 0=OK, 1=NOK.
      If timeout:
        1. {Message => 'Timeout'}


=head2 RecursiveRPAOneForeachMonitor

 RecursiveRPAOneForeachMonitor();

HQ59724 : 05122012 : Send 'RPA 1' to each monitor list
SUBROUTINE  : RecursiveRPAOneForeachMonitor
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. AbisConn   -> Abisco Connection.
      2. rTG        -> Reference to TG hash.
      3. RUs        -> Reference to each monitor list
      4. DVTLogPath -> Path for DVTLog txt
      5. cb         -> Callback function implementation.

OUT : None


=head2 RecursiveReadDVTLogForeachDevice

 RecursiveReadDVTLogForeachDevice();

SUBROUTINE  : RecursiveReadDVTLogForeachDevice
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. BTSConn -> Abisco connection object.
      2. TG      -> Reference to TG hash.
      3. Devices -> Reference to a list of devices.
      4. File (Optional)
                 -> If this is specified, the logs are written
                    to a file. The value here will also be used
                    in the logfile naming. See example above.
      5. Receive -> YES to wait for response after sending
                    the command to DVT, NO to not wait.
                    Default is YES.
      6. cb      -> Callback function implementation.
OUT : -


=head2 RecursiveReadProfilerLogForeachDevice

 RecursiveReadProfilerLogForeachDevice();

SUBROUTINE  : RecursiveReadProfilerLogForeachDevice
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. BTSConn -> Abisco connection object.
      2. TG      -> Reference to TG hash.
      3. Devices -> Reference to a list of devices.
      4. File (Optional)
                 -> If this is specified, the logs are written
                    to a file. The value here will also be used
                    in the logfile naming. See example above.
      5. Receive -> YES to wait for response after sending
                    the command to DVT, NO to not wait.
                    Default is YES.
      6. $Long (Optional) -> Read Long Profiler Log.
      7. cb    -> Callback function implementation.
OUT : -


=head2 SalvageTTRAndDVT

 SalvageTTRAndDVT();

SUBROUTINE  : SalvageTTRAndDVT
DESCRIPTION : Salvage the TTR and DVT connection in the event
              of a timeout from the DVT on the RBS. Will take about
              20 seconds to execute due to settling times.
              A log file is written in $TG{PathDVTLogs}.

IN  : File name of the log file.
OUT :



=cut

=head1 NAME

Globals


=head1 DESCRIPTION

Document number: 15/190 55-CAH 161 1290/1 Uen
MODULE      : Globals.pm
DESCRIPTION :

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV    DATE       NAME      REVIEW    COMMENT
PA1    20051128   ERADIPE             First revision
PA2    20051206   ERADIPE             Moved hash %LTC from LTSFunc to Globals
PA3    20061201   ERADIPE             Updated with Avanti
PA4    20070504   ERADIPE             Updated with Avanti 07B
PA5    20080125   XRSJALI             Updated with more LTS counters and
                                       Avanti 08A.
P1A    20080319   ERABAHG             Merged with \dev_08a. New rev
P1B    20080609   XRSJALI             Updating for Avanti 08B
                                       Updating ch.req./sec. for OVERLOAD.
                                       Merged to main.
P1B_1A 20080903   XMATTEK             Added BGActivities T and G (CR5762, 63)
P1C    20080903   ERABAHG             Merged to main
P1C_1A 20080929   XRSJALI             Implementing CR 5888.
P1C_1B 20080930   XRSJALI             Reordering CSR, SSR etc. columns.
P1C_1C 20081007   XMATTEK             Merged from CR5904
P1D    20081008   XSRJALI             Merged to main
P1D_1A 20081210   XRSJALI             Implementing CR 5953.
P1E    20090119   XRSJALI             Merged to main
P1E_1A 20090203   XYNSTAN             Implementing TR 5894
P1F    20090203   XYNSTAN             Merged to main
B      20110831   XLEIMAR   ETORWIL   Updated to new script template,
                                       applied PerlCritic.
                                       Framework maintenance. Declared
                                       variables in @EXPORT_OK.
                                       Declared variables in @EXPORT_OK.

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS


=cut

=head1 NAME

glt


=head1 DESCRIPTION

Document number: ??/190 55-CAH 161 1290/1 Uen
MODULE      : glt.pm
DESCRIPTION : Interface routines to the Aeroflex GSM Load Tester
							More information can be founf in:
								- Remote Control of Aeroflex GSM Load Tester, 5/198 17-FCD 201 33 (CDM)
								- GSM Load Tester TCP/IP Interface (Aeroflex)
								- GSM Load Tester Software Description (Aeroflex)	

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV 	DATE      NAME      REVIEW    COMMENT
P1A   120628  	ESTEMOH             Created
P1B   121127  	ESTEMOH             Removed logging to Abisco log file
P1C   130123  	ESTEMOH             Support for sync from different TGs


=head1 REQUIRES

L<XML::Simple> 

L<Sys::Hostname> 

L<Socket> 

L<IO::Handle> 

L<User> Used for Abisco logging

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 AcceptListener

 AcceptListener();

FUNCTION : AcceptListener
COMMENT  : Accept an incomming socket connection from the Listener (used to receive responses from the GSM Load Tester)

IN       : Request hash
OUT      : Request hash updated


=head2 ConnectTalker

 ConnectTalker();

FUNCTION : ConnectTalker
COMMENT  : Connect a socket to the Talker (used to send commands to the GSM Load Tester)

IN       : Request hash
OUT      : Request hash updated


=head2 ConvertArfcn

 ConvertArfcn();

FUNCTION : ConvertArfcn
COMMENT  : Convert ARFCN to Uplink and Downlink frequency

IN       : Arfcn and Band
OUT      : Uplink and Downlink frequency


=head2 CreateXMLAlign

 CreateXMLAlign();

FUNCTION : CreateXMLAlign
COMMENT  : To create XML code for the Align command

IN       : Request hash {BCCH}, {Band}, {BCCHPower}
OUT      : Request hash updated with XML (OutMsg)


=head2 CreateXMLBoot

 CreateXMLBoot();

FUNCTION : CreateXMLBoot
COMMENT  : To create XML code for the Boot command

IN       : Request hash
OUT      : Request hash updated with XML (OutMsg)


=head2 CreateXMLHeader

 CreateXMLHeader();

FUNCTION : CreateXMLHeader
COMMENT  : To create the XML header

IN       : Request hash {myIP}, {Target} and {ListenerPort}
OUT      : Request hash updated with XML (OutMsg)


=head2 CreateXMLPrepareOrArm

 CreateXMLPrepareOrArm();

FUNCTION : CreateXMLPrepareOrArm
COMMENT  : To create XML code for the Prepare or Arm command

IN       : Request hash {Message}, {SigGenNumber}, {Arfcn}, {Band}, {Level},
					 {AiqFile}, {Delay} and {Triggered}.
OUT      : Request hash updated with XML (OutMsg)


=head2 CreateXMLSetAlignment

 CreateXMLSetAlignment();

FUNCTION : CreateXMLSetAlignment
COMMENT  : To create XML code for the Set Alignment command

IN       : Request hash
OUT      : Request hash updated with XML (OutMsg)


=head2 CreateXMLStop

 CreateXMLStop();

FUNCTION : CreateXMLStop
COMMENT  : To create XML code for the Stop command

IN       : Request hash
OUT      : Request hash updated with XML (OutMsg)


=head2 CreateXMLTrailer

 CreateXMLTrailer();

FUNCTION : CreateXMLTrailer
COMMENT  : To create the XML trailer

IN       : Request hash
OUT      : Request hash updated with XML (OutMsg)


=head2 InitIP

 InitIP();

FUNCTION : InitIP
COMMENT  : To initialize TCP/IP parameters

IN       : Request hash {Function}
OUT      : Request hash updated with {myHostName}, {myIP}, {GLTServer}, {GLTClient},
					 {ListenerPort}, {TalkerPort}, {RBuffSize}, {SocketTimeout}


=head2 OpenListener

 OpenListener();

FUNCTION : OpenListener
COMMENT  : Open a socket for the Listener (used to receive responses from the GSM Load Tester)

IN       : Request hash
OUT      : Request hash updated


=head2 OpenTalker

 OpenTalker();

FUNCTION : OpenTalker
COMMENT  : Open a socket for the Talker (used to send commands to the GSM Load Tester)

IN       : Request hash
OUT      : Request hash updated


=head2 PrepareResponse

 PrepareResponse();

FUNCTION : PrepareResponse
COMMENT  : To decode the received XML message and prepare the response to the caller.

IN       : Request hash {InMsg}
OUT      : Response hash {Message}, {Instance},
					 {Text} (Information messages),
           {Code} and {Reason} (in case of error)


=head2 ReceiveFromSocket

 ReceiveFromSocket();

FUNCTION : ReceiveFromSocket
COMMENT  : Receive a message from the GSM Load Tester

IN       : Request hash
OUT      : Request hash updated


=head2 SaveAlign

 SaveAlign();

FUNCTION : SaveAlign
COMMENT  : To save Align parameters in a hash

IN       : Request hash including:
					   {Message}, {BCCH}, {Band}, {BCCHPower},
OUT      : Global Hash %Align updated


=head2 SavePrepareOrArm

 SavePrepareOrArm();

FUNCTION : SavePrepareorArm
COMMENT  : To save Prepare or Arm parameters in a hash

IN       : Request hash including:
					   {IP}, {Message}, {SigGenNumber}, {Arfcn}, {Band},
					   {Level},{AiqFile}, {Delay} and {Triggered}.
OUT      : Global Hash %Prepare or %Arm updated


=head2 SendToSocket

 SendToSocket();

FUNCTION : SendToSocket
COMMENT  : Send a message to the GSM Load Tester

IN       : Request hash
OUT      : None


=head2 gltGet

 gltGet();

SUBROUTINE  : gltGet
DESCRIPTION : Routine called by user to receive a message from the GSM Load Tester:
              - Open Listener socket (if not already open)
							- Accept incomming socket connection
							- Receive a message message
							- Decode the XML message and return the response to the caller

IN  : Request hash
OUT : Response hash


=head2 gltLogDL

 gltLogDL();

FUNCTION : gltLogDL
COMMENT  : To log downlink messages from the GSM Load Tester in the Abisco log

IN       : Request hash
OUT      : None


=head2 gltLogUL

 gltLogUL();

FUNCTION : gltLogUL
COMMENT  : To log uplink message from the GSM Load Tester in the Abisco log

IN       : Response hash
OUT      : None


=head2 gltPut

 gltPut();

SUBROUTINE  : gltPut
DESCRIPTION : Routine called by user to send a message to the GSM Load Tester:
							- Prepare XML message
              - Open and connect Talker socket
							- Send XML message
							- Write to Abisco log

IN  : Request hash
OUT : None


=head2 numerically

 numerically();

Subroutine: numerically
Purpose:    Sort numerical
Input:
Output:


=head2 saveXMLFile

 saveXMLFile();

FUNCTION : saveXMLFile
COMMENT  : Save XML message to file (for debug purpose only)
					 Message name followed by IP Address, example boot_VERA171.xml

IN       : Request hash
OUT      : None



=cut

=head1 NAME

HelpFunc


=head1 DESCRIPTION

Document number: 16/190 55-CAH 161 1290/1 Uen
MODULE      : HelpFunc.pm
DESCRIPTION : This module contains functions that define standardized paths
              the test programs may use (mostly by repstab, rbschar and
              rbsstab), automatizes searching for fault reports or scanning
              for LTS periodic reports in logs, e.t.c.

              No dependencies on modules except for Globals and PerlFunc.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV    DATE       NAME      REVIEW           COMMENT
PA1    20051128   ERADIPE                    First revision
PA2    20080125   XRSJALI                    Updated with new LTS Counters for CR5571
P1A    20080319   ERABAHG                    Merged with \dev_08a. New rev
P1A_1A 20080901   XRSJALI                    Solving TR 5851.
P1B    20080904   ERABAHG                    Merged to main
P1B_1A2 0080919   XRSJALI                    Implementing TR 5889.
P1B_1B2 0080929   XRSJALI                    Implementing CR 5888.
P1C    20081008   XRSJALI                    Merge to main
P1C_1A2 0081210   XRSJALI                    Implementing CR 5953.
P1D    20090119   XRSJALI                    Merge to main
P1D_1A 20090206   XRSJALI                    Reimplementing CR 5953.
P1E    20090216   XRSJALI                    Merge to main
P1F    20090507   ERATZIS                    Added OpenLogFile, CloseLogFile, WriteLog, WriteResultInLogFile
P1G    20090520   ERATZIS                    Added ConvertTrueFalse, GetCapabilitiesOfAllTRXC, updated header
P1H    20090603   ERATZIS                    Added AbisLogging
P1J    20091001   ERATZIS                    Added TrafficMode
P1K    20091103   ERATZIS                    Modified OpenLogFile to handle test cases without SUBTC
B      20110823   XLOHFOO  XGUSTPE           Updated to new script template
                                             Quality control with PerlCritic
                                             Added document number.
                                             Imported %LTC from Globals.pm.
                                             Removed "Strip" from Abisco_Connection include (not used)
                                             and moved "Str" to Msg include.
                                             Updated package global $LOGFILE handle and removed
                                             $FH filehandle with typeglob to $LOGFILE
                                             Fixed WriteLog to call Log in user.pm
C      20120530   XLEAENG                    HP14008: Merged with ACM libraries
D      20120703   XLEAENG                    Removed trailing spaces and hard tabs
E      20120717   XLEAENG  EDAMELI           Script optimization
                                             Implemented lock_keys()
F      20120914   XLOHFOO  XWOOKUN           Implemented lock_keys() for ScanFaultReports,
                                             ScanFaultReportsAllFiles and ScanForRejectMessages
G      20120920   Syntronic AB/  XLOHFOO     Solve bug, add additional judgement for IF
                  Catherine                  in subroutine TraverseFile
H      20121010   XLOHFOO        XTEHKIN     Modified ReadIniFile subroutine for HQ42652
J      20121022   XWOOKUN        XNURMOH     Modified in HQ42662, added VamosCallSucc and VamosCalls to ScanPeriodicReports
K      20121220   XTEHKIN        Syntronic AB/ Modified in HP76832
                                 Catherine     ScanPeriodicReports gets SGCPS from rhLoadConfig
                                               Moved ReadIniFile to TP_Support.pm
                                               Modified for HQ62916
L      20130703   Syntronic AB/  XLOHFOO       Modified in HQ98836.
                  Adibah
M      20130725   Syntronic AB/  XWOOKUN       Modified in HR45662
                  Adibah
N      20131011   Syntronic AB/  XWOOKUN       Modified in 0004749
                  Adibah
S      20131111   Syntronic AB/  Syntronic AB/ HR50519: Return if DVT path not defined yet
                  Adibah         Catherine     0004800: Parsing MO_Address in TraverseFile()
                                               HR79044 : Update PRR
T      20140214   Syntronic AB/  Syntronic AB/ HR98115: Subtract success call/sms from ChReq
                  Adibah         Catherine
U      20140320   Syntronic AB/  Syntronic AB/ HS34697: Prevent undefined warnings if there is no Routing.TRXC
                  Adibah         Catherine
V      20140430   Syntronic AB/  Syntronic AB/ Modified in HS46676.
                  Adibah         Catherine

Note that on 2011-06-20 the revision style was changed back to A, B and so on.


=head1 REQUIRES

L<PerlFunc> 

L<User> 

L<AbiscoFunc2> 

L<Msg> 

L<Config::IniFiles> 

L<Abisco_Connection> 

L<Globals> 

L<Hash::Util> 

L<feature> 

L<English> 

L<Carp> 

L<Time::HiRes> 

L<Event> 

L<Win32> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 AbisLogging

 AbisLogging();

SUBROUTINE  : AbisLogging
DESCRIPTION : To turn on/off Abis Logging

IN  : $State: OFF/ON
OUT : None


=head2 AbiscoRequest

 AbiscoRequest();

SUBROUTINE  : AbiscoRequest
DESCRIPTION : Send command to Abisco, and register a watcher in the
              event loop to wait for response, while main process
              continues to run uninterrupted. Once the watcher has
              received the response, inform the main process to run the
              callback function that was passed in as a parameter.

IN  : 1. $abisco  -> Abisco connection object.
      2. %command -> Message-hash to send. It should have the
                     following hash-keys:
                     Response
                     - The name of the ABISCO response expected
                       OR a list of message names (waits for
                       one of them).
                     Timeout (Optional)
                     - Max time to wait for a response.
                       If this is specified and a timeout
                       occurs, then the callback is called with
                       the Message key set to 'Timeout'.
                       If Timeout is not specified then a
                       default timeout of 50 seconds is used
                       and if the timeout occurs the test case
                       is terminated.
                     cb
                     - Callback for when the response is
                       received (or a timeout occurs).
OUT : {%response} -> The received response message hash.


=head2 CloseLogFile

 CloseLogFile();

SUBROUTINE  : CloseLogfile
DESCRIPTION : To close the log file

IN  : None
OUT : None


=head2 ConvertLoadLevel

 ConvertLoadLevel();

HP63288: ACM shall handle different values for LoadDelay depending on load level
DATE: 2012-05-09
CR Fix: Convert Load Level
SUBROUTINE  : ConvertLoadLevel
DESCRIPTION : Convert the Load Level.

IN  : $CLoad - Unconverted Load Level
OUT : $CLoad - Converted Load Level


=head2 ConvertToFrequency

 ConvertToFrequency();

SUBROUTINE  : ConvertToFrequency
DESCRIPTION : Convert a list of ARFCNs to a frequency list

IN  : @1 - ARFCNs list
OUT : @2 - Frequency list


=head2 ConvertTrueFalse

 ConvertTrueFalse();

SUBROUTINE  : ConvertTrueFalse
DESCRIPTION : To convert string 'True' or 'False' to '1' or '0' respectively

IN  : Text string ('True' or 'False')
OUT : 1 or 0


=head2 CopyDVTLogFiles

 CopyDVTLogFiles();

SUBROUTINE  : CopyDVTLogFiles
DESCRIPTION :

IN  :
OUT :


=head2 CreateProjectPath

 CreateProjectPath();

SUBROUTINE  : CreateProjectPath
DESCRIPTION : Creates the entries $TG{PathAbiscoLogs} and $TG{PathDVTLogs}
              where the relevant files are saved.

              The input to this function is two start paths:
                  1. a known location e.g.
                     s:\upload\eradipe\characteristics where both the
                     abisco logs and DVT logs will placed.
                  2. a second known location on the UFTE computer that will
                     serve as an intermediate location when saving DVT logs.

              The intermediate location for saving DVT logs is put in
              $TG{PathLocalDVTLogs}. When a test case is terminated, the
              logs will have to be copied from the UFTE computer to the path
              specified by $TG{PathDVTLogs} which may or may not be on the
              Abisco computer.

              A path called 'PathTrash' is also created where intermediate
              files can be saved.

              The UFTE computer is mapped on the Abisco computer and the
              drive unit letter is saved in $TG{UFTE_PC_MappedDrive} in
              order to copy later.

IN  : $Path    -> Usually set to $PATH_PROJECT_ROOT
      $PathDVT -> The DVT logs are saved locally on the UFTE PC in this path
OUT :


=head2 DeleteAbiscoConfig

 DeleteAbiscoConfig();

SUBROUTINE  : DeleteAbiscoConfig
DESCRIPTION : To Disconnect and Delete a TG from Abisco

IN  : None
OUT : None


=head2 GenerateFrequencyList

 GenerateFrequencyList();

SUBROUTINE  : GenerateFrequencyList
DESCRIPTION : Generates a valid frequency list based on the frequency band,
              hopping and the employed ARFCNs

IN  : $1 - Frequency band
      $2 - Hopping
      @3 - Used ARFCNs
OUT : $4 - Frequency list


=head2 GetCurrentTime

 GetCurrentTime();

SUBROUTINE  : GetCurrentTime
DESCRIPTION :

IN  :
OUT :


=head2 GetLoadApplication

 GetLoadApplication();

SUBROUTINE  : GetLoadApplication
DESCRIPTION : This routine sets $TG{App} or $TG{NewApp} with respect to
              Load Module, IWD and Project. These are used when loading
              software.

              Used only by repstab.

IN  : $Application -> 'App' || 'NewApp'
OUT :


=head2 GetProjectName

 GetProjectName();

SUBROUTINE  : GetProjectName
DESCRIPTION : Examples:

              GetProjectName();
                displays default text on the screen
                sets $TG{Project}

              GetProjectName(Entry => 'SecondProject');
                displays default text on the screen
                sets $TG{SecondProject}

              GetProjectName(Entry => 'LoadFileProject',
                             Text  => 'Input a project for file loading');
                displays Text
                sets $TG{LoadFileProject}

              NOTE: Newlines in Text are set by the routine.

IN  :
OUT :


=head2 LoadAbiscoConfig

 LoadAbiscoConfig();

SUBROUTINE  : LoadAbiscoConfig
DESCRIPTION : To load an Abisco Configuration file
              A file named staticload.abiscoconfig must be saved in
              h:\uftework\abisco

IN  : 1. The abisco configuration file (full path).
OUT : None


=head2 LogString

 LogString();

SUBROUTINE  : LogString
DESCRIPTION : Put string in ABISCO log file. Newlines are re-
              moved and converted since they mean end of comment
              in ABISCO (an improvement would be to make one log
              call per line). 'Do' is used instead of 'Put' to
              get rid of the new CH prompt. A period is added last
              in case it ends with ',', the CH otherwise waits
              for more without issuing a new prompt (the dot felt
              cheaper than substitution, this routine is called a lot).

IN  : $1 - String to log
  or \%1 - Message hash
OUT : None


=head2 Member_Of_Array

 Member_Of_Array();

SUBROUTINE  : Member_Of_Array
DESCRIPTION : Check if $1 is member of @2

IN  :  $1 - Value
       @2 - Array
OUT :  $3 - Returns 1 if $1 is member of @2, 0 otherwise


=head2 OpenLogFile

 OpenLogFile();

SUBROUTINE  : OpenLogfile
DESCRIPTION : To create and open a log file. The log file is stamped with
              testcase, subtestcase and date

IN  : None
OUT : None


=head2 PadString

 PadString();

SUBROUTINE  : PadString
DESCRIPTION : Pad string with blanks upto indicated length.
              Longer strings are left intact.

IN  : $1 - Length of string to pad to
      $2 - String to pad
OUT : Padded string


=head2 ParseRejectMsg

 ParseRejectMsg();

HM 72582: TC 409:023 Error popup message for reject messages
Date    : 2010-09-14
Fix     : New subroutine to correct some parser algorithm mistakes in CR6559.
HO10755 : ACM crasch when reading SQL-lite
Date    : 2011-06-03
Fix     : Editting the algorithm; send two single quoted instead of one single quote
SUBROUTINE  : ParseRejectMsg
DESCRIPTION : Parses a reject message string into a hash.
              For example, this multi-line reject message string,

                {2010-09-06 09:32:14} 0360
                <CHEXTRAS.CHReject
                      CH_Info.IsCmdOrRsp=IsResponse,
                      ReasonForRejection="Timeout when waiting for response from I/O",
                      FurtherInformation="UnixClient timed out when waiting for prompt from Unix connection",
                      OriginalCommand="uch_r1ad 289 33 PROGPROD.ListLoadfileNames  AbisVersion=G11A TGBand=GSM900P TGBandType=900 SoftwareVersion='p1az' Project='avanti_g11b' Model=RBS2000 TGId=0 Model=RBS2000 AbisVersion=G11A TGBand=GSM900P TGBandType=900 "

              will turn into this hash:

                %parsedMsg = (
                    'CHReject'           => 'CHEXTRAS',
                    'OriginalCommand'    => 'uch_r1ad 289 33 PROGPROD.ListLoadfileNames  AbisVersion=G11A TGBand=GSM900P TGBandType=900 SoftwareVersion=\'p1az\' Project=\'avanti_g11b\' Model=RBS2000 TGId=0 Model=RBS2000 AbisVersion=G11A TGBand=GSM900P TGBandType=900 ',
                    'FurtherInformation' => 'UnixClient timed out when waiting for prompt from Unix connection',
                    'ReasonForRejection' => 'Timeout when waiting for response from I/O'
                );

IN  : 1. $rejectMsgStr -> A string containing a reject message.
OUT : 1. \%parsedMsg   -> Reference to a hash containing the parsed
                          reject message.


=head2 PrepareFaultMap

 PrepareFaultMap();

SUBROUTINE  : PrepareFaultMap
DESCRIPTION :

IN  :
OUT :


=head2 PrintFaultMap

 PrintFaultMap();

SUBROUTINE  : PrintFaultMap
DESCRIPTION :

IN  :
OUT :


=head2 ReadLoadDelaySetting

 ReadLoadDelaySetting();

HP63288: ACM shall handle different values for LoadDelay depending on load level
DATE: 2012-05-09
CR Fix: Read LoadDelay from INI files
SUBROUTINE  : ReadLoadDelaySetting
DESCRIPTION : Read LoadDelay parameter from INI files.

IN  : $CurrentLoadFile - The path of the INI files
OUT : $LoadDelay - the value of the LoadDelay


=head2 SaveRejectIntoArray

 SaveRejectIntoArray();

SUBROUTINE  : SaveRejectIntoArray
DESCRIPTION :

IN  :
OUT :


=head2 ScanFaultReports

 ScanFaultReports();

SUBROUTINE   : ScanFaultReports
DESCRIPTION  : Reads an Abisco log file to search for faults.
               The file name is supplied with its extension.

IN  : $Path
      $File
      $ReturnType -> 'return number' || 'return array'
OUT : $RT   -> the number of faults encountered in the Abisco log file
               || a reference to an array describing the faults


=head2 ScanFaultReportsAllFiles

 ScanFaultReportsAllFiles();

SUBROUTINE   : ScanFaultReportsAllFiles
DESCRIPTION  : Goes thru all files (which ought to be Abisco logs) in a
               given directory and searches for fault reports. Whatever
               faults are found will be written in file Abisco.txt.

               Example:
                 ScanFaultReportsAllFiles($Path, "*.log|*.txt");
IN  :
OUT :


=head2 ScanForRejectMessages

 ScanForRejectMessages();

CR6559: Add column(s) in Excel sheet with required level
Date: 2010-09-06
CR Fix: It is now possible to return an array of hashes containing the parsed
       reject messages instead of the reject count.
HM 72582: TC 409:023 Error popup message for reject messages
Date    : 2010-09-14
Fix     : Corrected some parser algorithm mistakes in CR6559.
SUBROUTINE  : ScanForRejectMessages
DESCRIPTION : Reads an Abisco log file to search for Reject messages.
              The file name is supplied with its extension.

IN  : 1. $SrcDir      -> Path to the directory where the Abisco log
                         file can be found.
      2. $SrcFile     -> Name of the Abisco log file to search for
                         Reject messages. File extension must be
                         included.
      3. $DestPath    -> The designated path of the file in which the
                         Reject log entries will be written to.
      4. $retType     -> If "return array" was specified here, a
         (Optional)      reference to an array of hashes containing
                         the parsed reject messages will be returned
                         instead of the reject count.
OUT : 1. $RejectCount -> Number of Reject messages found in the source
                         file.
             or
         \@parsedRejectMessages ->
                         Reference to an array of hashes containing
                         the parsed reject messages.


=head2 ScanPeriodicReports

 ScanPeriodicReports();

HO92107 : 20120209 : Pack LTS.Report data for each cell
HR45662 : 20130731 : Include fail rates; Call Fail Rate (CFR),
                    Vamos Call Fail Rate (VamosCFR) and SMS Fail Rate (SFR) in the report
SUBROUTINE  : ScanPeriodicReports
DESCRIPTION : Searches a file for periodic reports.

              The file given could correpsond to one minute execution
              time, this is the way implemented in
              characteristics/stability, but the duration could be anything
              actually. The file shall contain data obtained during the SAME
              LOAD TYPE (supplied to the function).
              What this function does is to return a hash with keys the
              success ratios: CSR, SSR, RCR and PRR. NPR and NT will also
              follow. Explanation:

               CSR: Call success ratio (all call types put together)
               SSR: SMS success ratio
               RCR: RUT channel requests ratio (a RUT is of course needed)
               PRR: Pagings success ratio
               CPS: Calls per second
               SPS: SMS per second
               RPS: CHRQST per second
               PPS: Pagings per second
               IAS: Immidiate Assignment Sent
               IAR: Immidiate Assignment Reject
               HOV: Handover
               NPR: number or periodic reports found
               NT : the time in seconds these reports total to

               CFR:      Call Fail Rate
               VamosCFR: Vamos Call Fail Rate
               SFR:      SMS Fail Rate

              With ratio we mean: with respect to what is expected for the
              load type in question (see Globals).

              Observe that by reading a file like the way it is done here it
              may be so that the text "LTS.PeriodicReport" is found but the
              actual calls etc are in another file, that is the file does
              not include the complete information. The function does not
              try to "paste" two "runs", what is lost is lost and hopefully
              considered marginal in the long run.
              Entry {OneFailedReading} is true if the above has occured.

              When running characteristics the period could be set to
              something in the order of 13 or 17 sec (nice prime numbers).

IN  :
OUT :


=head2 ScanSystemLoad

 ScanSystemLoad();

HO74565: ACM Updates according to System CR4961 & CR 5416
DATE: 2011-10-27
CR Fix: Search System load in abisco log file
HP91346 :Traffic and monitoring can not be done on other TRXs and REs than 0 (G13A & G12A_3)
Date: 2012-5-30
CR Fix: Pass all selected TRX for scan system load
SUBROUTINE  : ScanSystemLoad
DESCRIPTION : Reads an Abisco log file to search for system load.
              The file name is supplied with its extension.

IN  : $Path
      $File
OUT : $retLoad   -> the RU and CPU load encountered in the Abisco log file


=head2 StartABISLog

 StartABISLog();

SUBROUTINE  : StartABISLog
DESCRIPTION : The five values in set lot protocol command are:
              RBLT : the PCM link
              TS   : is e.g. 1 if we are checking TRXC3 with
                     4:1 concentration
              SB   : the Start Bit, should be set to 0 if not
                     running multiplexing
              SAPI : set to 0 for Cell, 62 if for OML
              TEI  : the TRX number

IN  :
OUT :


=head2 StartAbiscoLog

 StartAbiscoLog();

SUBROUTINE  : StartAbiscoLog
DESCRIPTION : Clears and starts the Abisco log file.
              The file name shall include the extension.

              Example:
                StartAbiscoLog($TG{PathAbiscoLogs}, 'abisco.txt');

IN  : 1. $Path -> A path where the abisco log file is to be saved
      2. $F    -> File identifier
OUT :


=head2 StopABISLog

 StopABISLog();

SUBROUTINE  : StopABISLog
DESCRIPTION : Analogous to StartAbisLog.

IN  : See above
OUT :


=head2 TrafficMode

 TrafficMode();

SUBROUTINE  : TrafficMode
DESCRIPTION : To turn on/off Traffic Mode

IN  : $State: OFF/ON
OUT : None


=head2 TraverseFile

 TraverseFile();

0004749 : 20131011 : Workaround to grab data from MO_Address in abisco log
SUBROUTINE  : TraverseFile
DESCRIPTION : Traverses a file (given to this function by its filehandle)
              in search of all error codes execept for those error codes
              defined in hash $TG{KnownFaults}.

              For all other cases, the fault is registered, printed in
              $ReportFile (which is either a file handle or STDOUT) and the
              number of faults encountered, or an array containing a short
              fault description, is returned; this is depended upon the
              value of $ReturnType. The faults are also printed together
              with the fault type, the fault interpretation.

              A bitmap is used to mark the devices that are faulty. When
              this subroutine ends, entry {FaultyTRXCs} is obtained.

              Every fault found is also tested against $TG{TrapFaults} and
              if a trap fault was detected, $TG{TrapFound} is set to refer
              to an array containing a short description of the trap that
              was triggered. If a trap was not found then $TG{TrapFound}
              remains undef. The main program will probably abort the test
              when a trap is detected.

              $FaultFound - indicates if a fault was found inside one
                            BG.FaultReport.
              $CNT        - counts all faults in all BG.FaultReports in the
                            whole file.

IN  : 1. $LogFile    -> Filehandle indicating the file to search errors in
      2. $ReportFile -> Filehandle indicating an output file or the screen
      3. $ReturnType -> 'return number' || 'return array'
OUT : 1. depends on $ReturnType


=head2 WriteLog

 WriteLog();

SUBROUTINE  : WriteLog
DESCRIPTION : To write a message to the logfile and/or console window

IN  : Text string to log
      Type (File, Console or Both);
OUT : None


=head2 WriteTCResultInLogFile

 WriteTCResultInLogFile();

SUBROUTINE  : WriteTCResultInLogFile
DESCRIPTION : To write the TC result in Log File

IN  : None
OUT : None



=cut

=head1 NAME

InstrFunc


=head1 DESCRIPTION

Document number: 17/190 55-CAH 161 1290/1 Uen
MODULE      : InstrFunc.pm
DESCRIPTION : Contains routines for SG, SPEC and CRTC.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV    DATE      NAME      REVIEW    COMMENT
PA1    20051128  ERADIPE             First revision
PA2    20080213                      ver13 on GSMRBS disk
P1A    20080319  ERABAHG             Merged with \dev_08a. New rev
P1B    20080609  XRSJALI             Implementation of CR 5758.
                                     Updating for CR 5758. Merged to main
P1B_1A 20080625  XRSJALI             Updating for CR 5768
P1C    20080904  ERABAHG             Merged to main
PC2    20110310  QRADGUT             Fix TR HN80884
D      20110822  XJMJMJM   XLEIMAR   Updated to new script template
                                      Quality control with PerlCritic.
                                      Added document number.
                                      Removed "Strip" for Abisco_Connection
                                       include (not used) and moved "Str" to
                                       Msg include.
E      20120530  XLEAENG             HP14008: Merged with ACM libraries
PF1    20120703  XLEAENG             Removed trailing spaces and hard tabs
PF2    20120712  XNURMOH   EDAMELI   Script optimization
PF3    20120802  XLOHFOO   XNURMOH   Replace array with Hash input for RUTAttach,
                                     RUTFreeRunningAirData, RUTConfig, RUTStart,
                                     RUTStop.
F      20130311  XLEAENG   XWOOKUN   Modified in HQ31594
Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<feature> 

L<tstm> 

L<Hash::Util> 

L<English> 

L<Carp> 

L<HelpFunc> 

L<PerlFunc> 

L<Globals> 

L<Msg> 

L<Complex> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 CRTCCfgConfigureCH

 CRTCCfgConfigureCH();

SUBROUTINE  : CRTCCfgConfigureCH
DESCRIPTION : This function is called when having called either
              CRTCCfgConfigureCH1 or CRTCCfgConfigureCH2. A reference
              to a TG hash is needed since this function needs some
              default values that are read from the TG hash. PLMN is an
              example of such a value.

              Default values that are set irrespective of the hash is
              the channel combination for CH1 or CH2 and the time slot.

              Example:
                CRTCCfgConfigureCH1();
                CRTCCfgConfigureCH2(TSRX => 4, TSTX => 4);

IN  : None
OUT : None


=head2 CRTCCfgConfigureCH1

 CRTCCfgConfigureCH1();

SUBROUTINE  : CRTCCfgConfigureCH1
DESCRIPTION :

IN  : None
OUT : None


=head2 CRTCCfgConfigureCH2

 CRTCCfgConfigureCH2();

SUBROUTINE  : CRTCCfgConfigureCH2
DESCRIPTION :

IN  : None
OUT : None


=head2 CRTCCommand

 CRTCCommand();

SUBROUTINE  : CRTCCommand
DESCRIPTION :

IN  : None
OUT : None


=head2 CRTCConfigurationStart

 CRTCConfigurationStart();

SUBROUTINE  : CRTCConfigurationStart
DESCRIPTION :

IN  : None
OUT : None


=head2 CRTCCreateLogFile

 CRTCCreateLogFile();

SUBROUTINE  : CRTCCreateLogFile
DESCRIPTION :

IN  :
OUT :


=head2 CRTCDefineSite

 CRTCDefineSite();

SUBROUTINE  : CRTCDefineSite
DESCRIPTION :

IN  : 1. %Indata (Optional) -> Override default data
OUT :


=head2 CRTCInitRootAirlog

 CRTCInitRootAirlog();

SUBROUTINE  : CRTCInitRootAirlog
DESCRIPTION :

IN  :
OUT :


=head2 CRTCLoopStart

 CRTCLoopStart();

SUBROUTINE  : CRTCLoopStart
DESCRIPTION :

IN  : None
OUT : None


=head2 CRTCReadyForInit

 CRTCReadyForInit();

SUBROUTINE  : CRTCReadyForInit
DESCRIPTION : Exit analog, ready for cfg files.

IN  : None
OUT : None


=head2 CRTCReadyForTP

 CRTCReadyForTP();

SUBROUTINE  : CRTCReadyForTP
DESCRIPTION : Up to airlog running, ready for TP running.

IN  : None
OUT : None


=head2 CRTCValidateSI5_6

 CRTCValidateSI5_6();

SUBROUTINE  : CRTCValidateSI5_6
DESCRIPTION : Validate that SI5 and SI6 are scheduled.
              Exception raised if not.

IN  : %1 - Message hash with overriding parameters (optional)
OUT : None


=head2 DIAmuXCommand

 DIAmuXCommand();

SUBROUTINE  : DIAmuXCommand
DESCRIPTION :

IN  : None
OUT : None


=head2 DIAmuXConTrafResource

 DIAmuXConTrafResource();

SUBROUTINE  : DIAmuXConTrafResource
DESCRIPTION :

IN  : None
OUT : None


=head2 DIAmuXDiscTrafResource

 DIAmuXDiscTrafResource();

SUBROUTINE  : DIAmuXDiscTrafResource
DESCRIPTION :

IN  : None
OUT : None


=head2 DIAmuXTRAChangeBoard

 DIAmuXTRAChangeBoard();

SUBROUTINE  : DIAmuXTRAChangeBoard
DESCRIPTION :

IN  : None
OUT : None


=head2 DVTAttach

 DVTAttach();

SUBROUTINE  : DVTAttach
DESCRIPTION : Attach the DVT by calling TTR.NewTool

IN  :
OUT :


=head2 DeltaSetAmplitude

 DeltaSetAmplitude();

SUBROUTINE  : DeltaSetAmplitude
DESCRIPTION :

IN  : DeltaAttenuation, DeltaAttenuationTime (optionally InstanceNo)
OUT :


=head2 RUTAttach

 RUTAttach();

SUBROUTINE  : RUTAttach
DESCRIPTION : Attach a RUT by calling TTR.NewTool

IN  : None
OUT : None


=head2 RUTConfig

 RUTConfig();

CR6543: New ini files needed when running against RUS/RRUS.
Date: 2010-05-14
CR Fix: Modified RUTConfig() to be able to configure RUT bursting on
       multiple timeslots, not just TS0.
HO92102: Add support to run SG Calls in ACM
Date   : 2012-1-3
CR Fix : Pass in SG calls burst file paths to RUTConfig()
SUBROUTINE  : RUTConfig
DESCRIPTION : Basic configuration of RUT

IN  : 1. Abisco Connection
      2. Burst filename
      3. TS list
      4. SGCall burst file path
      5. Call back function
OUT : None


=head2 RUTFreeRunningAirData

 RUTFreeRunningAirData();

CR6543: New ini files needed when running against RUS/RRUS.
Date: 2010-05-13
CR Fix: Modified RUTFreeRunningAirData() to be able to send the
       Abisco message "FreeRunningAirData" to multiple timeslots,
       not just TS0.
HP79712: TA value for signal generators used for SG shall be configured automatically
Date   : 2012-05-25
CR Fix : Pass in timing advance value
SUBROUTINE  : RUTFreeRunningAirData
DESCRIPTION : Use this item to configure the bursting of data in a
              certain timeslot.
              This item is not correlated to any measurement but rather
              should be used for non-RUT measurement applications.
              The actual bursting is started using the XExecute
              'StartFreeRunningAirData' item.

IN  : 1. Abisco Connection
      2. Burst file name
      3. TS list
      4. SG call burst file paths
      5. Timing Advance (in ms)
      6. Call back function
OUT : None


=head2 RUTModulatorConfig

 RUTModulatorConfig();

SUBROUTINE  : RUTModulatorConfig
DESCRIPTION : Use this item to supply RUT2 with information on
              how the external modulation interface on
              the modulator should be accessed.

      1. $BTS                   -> Abisco connection object.
      2. $model                 ->
      3. $delay                 ->
      4. $datavalidity          ->
      5. $sync                  ->
      6. $bitorder              ->
      7. $retryCount            ->
      8. $cb                    ->
OUT : None


=head2 RUTRejectStatus

 RUTRejectStatus();

CR6492: RUT and SG fault/error/reject routine.
Date: 2010-01-25
CR Fix: 'RUTRejectStatus' function sends 'GetRBSMasterTGSyncStatus', 'GetRUTAPPStatus', 'GetRUTAPPStatus2' and 'InfoTool' commands.
SUBROUTINE  : RUTRejectStatus
DESCRIPTION : Routine to get the RUT status when a RUT command is rejected

IN  : None
OUT : None


=head2 RUTReset

 RUTReset();

SUBROUTINE  : RUTReset
DESCRIPTION : Reset, close and restart the RUT application.

IN  : None
OUT : None


=head2 RUTSelectTRU

 RUTSelectTRU();

SUBROUTINE  : RUTSelectTRU
DESCRIPTION : Use this item to assign the measurements to a TRU number.

IN  : A hash with the following hash-key(s):
      1. $BTS                   -> Abisco connection object.
      2. $trxnum                -> TRU number (0..253)
      3. $retryCount            -> number of retry
      4. $cb                    -> Callback function
OUT : None


=head2 RUTStart

 RUTStart();

CR6543: New ini files needed when running against RUS/RRUS.
Date: 2010-05-13
CR Fix: Modified RUTStart() to be able to start free running air data on
       multiple timeslots, not just TS0.
HO92102: Add support to run SG Calls in ACM
Date   : 2012-1-3
CR Fix : Pass in SG calls burst file paths to RUTStart(), start all TS if present
SUBROUTINE  : RUTStart
DESCRIPTION : Start RUT bursting in specified timeslots.

IN  : 1. Abisco connection
      2. TS list
      3. SG Calls burst file path
      4. Call back function
OUT : None


=head2 RUTStop

 RUTStop();

CR6543: New ini files needed when running against RUS/RRUS.
Date: 2010-05-13
CR Fix: Modified RUTStop() to be able to stop free running air data on
       multiple timeslots, not just TS0.
HO92102: Add support to run SG Calls in ACM
Date   : 2012-1-3
CR Fix : Pass in SG calls burst file paths to RUTStop(), stop all TS if present
SUBROUTINE  : RUTStop
DESCRIPTION : Stop RUT bursting in specified timeslots.

IN  : 1. Abisco connection
      2. TS list
      3. SG Calls burst file path
      4. Call back function
OUT : None


=head2 RUTWaitForSync

 RUTWaitForSync();

SUBROUTINE  : RUTWaitForSync
DESCRIPTION : Wait for sync from RBS Master. To be executed after
              configuring the RUT.

IN  : None
OUT : None


=head2 SGAttach

 SGAttach();

SUBROUTINE  : SGAttach
DESCRIPTION : Attach a Signal Generator by calling TTR.NewTool

IN  : A hash with the following hash-key(s):
      1. $BTS                   -> Abisco connection object.
      2. $instance            -> SG Instance
      3. $retryCount            -> number of retry
      4. $cb                    -> Callback function
OUT : None


=head2 SGRejectStatus

 SGRejectStatus();

CR6492: RUT and SG fault/error/reject routine.
Date: 2010-01-25
CR Fix: 'SGRejectStatus' function sends 'Status' and 'InfoTool' commands.
SUBROUTINE  : SGRejectStatus
DESCRIPTION : Routine to get the SG status when a SG command is rejected

IN  : SG Instance No.
OUT : None


=head2 SGSetAmplitude

 SGSetAmplitude();

SUBROUTINE  : SGSetAmplitude
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $BTS                   -> Abisco connection object.
      2. $amplitude             -> Amplitude level in dBm
      3. $tmpinstance            -> SG Instance
      4. $retryCount            -> number of retry
      5. $cb                    -> Callback function
OUT : None


=head2 SGSetChannel

 SGSetChannel();

SUBROUTINE  : SGSetChannel
DESCRIPTION : Sets SG to a GSM channel on a given GSM band.

IN  : A hash with the following hash-key(s):
      1. $BTS                 -> Abisco connection object.
      2. $Channel             -> The channel number
      3. $Band                -> The GSM Band
      4. $Instance (Optional) -> SG Instance
      5. $retryCount          -> number of retry
      6. $cb                  -> Callback function
OUT : None


=head2 SGSetGSMDataPattern

 SGSetGSMDataPattern();

HN60002: Test scripts should set signal generator to use I/Q data
Date: 2011-3-29
TR Fix: Create SGSetGSMDataPattern function to send GSMDataPattern
SUBROUTINE  : SGSetGSMDataPattern
DESCRIPTION : Routine to Set the Data Pattern to the SG

IN  : A hash with the following hash-key(s):
      1. $BTS                   -> Abisco connection object.
      2. $instance            -> SG Instance
      3. $retryCount            -> number of retry
      4. $cb                    -> Callback function
OUT : None


=head2 SGSetOutput

 SGSetOutput();

SUBROUTINE  : SGSetOutput
DESCRIPTION : Set signal generator output on or off.

IN  : A hash with the following hash-key(s):
      1. $BTS                   -> Abisco connection object.
      2. $output               -> 'ON' or 'OFF'
      3. $instance            -> SG Instance
      4. $retryCount            -> number of retry
      5. $cb                    -> Callback function
OUT : None


=head2 SPECGetNoiseLevel

 SPECGetNoiseLevel();

SUBROUTINE  : SPECGetNoiseLevel
DESCRIPTION : Returns the noise level. This level is obtained by looking
              at a small window outside the far right side of the band
              (Uplink) and taking a measurement at the center of that
              window. The noise level is obtained in Video Average mode.

              Example:
                $NoiseLevel = SPECGetNoiseLevel('GSM800');

IN  : 1. $Band -> the frequency band
OUT : 1. the noise level (floor)


=head2 SPECGetSignalLevel

 SPECGetSignalLevel();

SUBROUTINE  : SPECGetSignalLevel
DESCRIPTION : Example:
              $A = SPECGetSignalLevel('CHNR', 4, 'GSM900P');
              $B = SPECGetSignalLevel('Frequency', 831.8);

IN  : 1. $Mode  -> CHNR || Frequency
      2. $Input -> a channel number or a frequency depending on 1.
      3. $Band  -> the frequency band. Is undefined if 'Frequency'.
OUT : 1. the signal level


=head2 SPECSetWindow

 SPECSetWindow();

SUBROUTINE  : SPECSetWindow
DESCRIPTION : This routine sets the window of the SPEC. If mode is set to
              'CHNR' then $Input is a list of ARFCN's (which has to be in
              an increasing order). This list can contain several channels
              but only the first and the last define the window.
              If mode is set to 'Frequency' then two frequncies are supplied
              and which define exactly the window.

              Example:
                SPECSetWindow('CHNR', [5, 11, 15, 19], 'GSM900P');
                  sets window between CHNR 3 and 21, the lowest in the array
                  minus 2 and the highest in the array plus 2. The array
                  is checked at the lowest and highest index since usually
                  this array is a TRX array (consists of several channels).

                SPECSetWindow('CHNR', $TG{TRXListCell}{0}, $TG{FreqBand});

                SPECSetWindow('Frequency', [956.1, 956.8]);
                  when using 'Frequency' only two frequencies shall be
                  supplied.

IN  :
OUT :


=head2 TSTM_ActivateRACH

 TSTM_ActivateRACH();

HQ31594: 20121130 : adding TSTM function to ACM
SUBROUTINE  : TSTM_ActivateRACH
DESCRIPTION : To cofigure and start sending of Channel Request from MSSIM

IN          : A hash containing:
              1. IP Adress
              2. Cell in MSSIM configuration
              3. Number of Channel Request per second per CCCH
              4. Number of EGPRS Channel Request per second per CCCH
OUT         : None


=head2 TSTM_DeactivateRACH

 TSTM_DeactivateRACH();

HQ31594: 20121130 : adding TSTM function to ACM
SUBROUTINE  : TSTM_DeactivateRACH
DESCRIPTION : To cofigure and start sending of Channel Request from MSSIM

IN          : A hash containing:
              1. IP Adress
              2. Cell in MSSIM configuration
OUT         : None



=cut

=head1 NAME

IS_ICP_ConvList


=head1 DESCRIPTION

Document number: 18/190 55-CAH 161 1290/1 Uen
MODULE      : IS_ICP_ConvList.pm
DESCRIPTION :

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
PA1 20051128  ERADIPE             First revision
P1A 20080319  ERABAHG             New rev
B   20110907  XJMJMJM   XLEIMAR   Updated to new script template
                                   Quality control with PerlCritic.
                                   Added document number.
                                   Fixed include from "Globals".

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<English> 

L<Carp> 

L<Globals> 

L<User> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ISStaticList

 ISStaticList();

SUBROUTINE  : ISStaticList
DESCRIPTION : Example calls:

              ISStaticList($IS, {TRU => 5, TS => 7}, 'ICP1');

                 -> Returns ICP1 for TRU5 TS7 on given IS list.

              ISStaticList($IS, {TRU => 5}, 'ICP2');

                 -> Returns ICP2 for TRU5 SCH on given IS list.
                    NOTE: you could not run TRU_ICP2() since you would
                          have to know if it is a 16 or 64 kbps TRU.
                          TRU_ICP2 just makes a conversion according to
                          the tables, and since no IS list is provided
                          in that function there is no way to obtain
                          the 16/64 since it depends on the information
                          stored in the IS list.

              ISStaticList($IS, {TRU => 5}, 'KBPS');

                 -> Returns 16 or 64 (kbps) for TRU5 on given IS list.

              ISStaticList($IS, {TRU => 5, TS => 7}, 'PCM');

                 -> Returns a hash (refer to function PCM_ICP1).
                    Contains keys {PCM}, {TS}, {SUBTS}, {ICP}.

              ISStaticList($IS, {ICP1 => 1184}, 'ICP2');

                 -> Returns the ICP2 that is connected to the given ICP1
                    according to the IS list.

              ISStaticList($IS, {ICP2 => 916}, 'PCM');

                 -> Returns a hash (see previous example requesting PCM).

IN  : See example above.
OUT :


=head2 PCM_ICP1

 PCM_ICP1();

SUBROUTINE  : PCM_ICP1
DESCRIPTION : Example calls:

              PCM_ICP1(PCM => 1, TS => 24, SUBTS => 0);
                 ->   {PCM => 1, TS => 24, SUBTS => 0, ICP => 224)

              PCM_ICP1(ICP => 1217);
                 ->   {PCM => 2, TS => 18, SUBTS => 1, ICP => 1217)

IN  : See example above.
OUT :


=head2 TRU_ICP2

 TRU_ICP2();

SUBROUTINE  : TRU_ICP2
DESCRIPTION : Example calls:

              TRU_ICP2(KBPS => 16, TRU => 4, CHTYPE => SCH, SUBTS => 1);
                 ->   {CHTYPE => SCH,
                       KBPS   => 16,
                       TRU    => 4,
                       ICP    => 561}

              TRU_ICP2(KBPS => 64, TRU => 6);
                 ->   {CHTYPE => SCH,
                       KBPS   => 64,
                       TRU    => 6,
                       ICP    => 928}

              TRU_ICP2(KBPS => 64, TRU => 7, TS => 3);
                 ->   {CHTYPE => ATSR,
                       KBPS   => 64,
                       TRU    => 7,
                       TS     => 3,
                       ICP    => 980}

              TRU_ICP2(ICP => 652);
                 ->   {CHTYPE => SCH,
                       KBPS   => 16,
                       TRU    => 7,
                       SUBTS  => 0,
                       ICP    => 652}

              TRU_ICP2(ICP => 1097);
                 ->   {CHTYPE => ATSR,
                       KBPS => 64,
                       TRU => 10,
                       TS => 5,
                       SUBTS => 1,
                       ICP => 1097}

IN  : See example above.
OUT :



=cut

=head1 NAME

LocalDB


=head1 DESCRIPTION

Document number: 19/190 55-CAH 161 1290/1
MODULE      : LocalDB.pm
DESCRIPTION : This package contains the sub functions and variables
              used for SQLite local database function

COPYRIGHT Â© : ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV  DATE      NAME         REVIEW      COMMENT
A    20100920  XDT/XNGUTHU  ESTEMOH     Initial version.
B    20110907  XSOFFRO      XLEIMAR     PerlCritic applied. 
                                         New script template used. 
                                         New document number added.


=head1 REQUIRES

L<constant> Ensure DB_VERSION is the same with version in DB

L<File::Basename> 

L<DBI> 

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 new

 $self->new();

SUBROUTINE  : new
DESCRIPTION : Create new local database object (Constructor subroutine)

IN  : None
OUT : Object instance


=head2 ClearSystemUnderTestIdArray

 $self->ClearSystemUnderTestIdArray();

SUBROUTINE  : ClearSystemUnderTestIdArray
DESCRIPTION : Clear system under test id array

IN  : None
OUT : None


=head2 ClearTestResourceIdArray

 $self->ClearTestResourceIdArray();

SUBROUTINE  : ClearTestResourceIdArray
DESCRIPTION : Clear test resource id array

IN  : None
OUT : None


=head2 CommandResultShow

 $self->CommandResultShow();

SUBROUTINE  : CommandResultShow
DESCRIPTION : Print out run response result but now does not use

IN  : Array of subtc_result_id
OUT : Pass/Fail


=head2 GetDate

 $self->GetDate();

SUBROUTINE  : GetDate
DESCRIPTION : Return the current date in string format

IN  : None
OUT : Current date in string


=head2 GetIdAutoIncrement

 $self->GetIdAutoIncrement();

SUBROUTINE  : GetIdAutoIncrement
DESCRIPTION : Increase ID value in a database table

IN  : table_name, field name
OUT : 1 if table emty or new id after increment


=head2 GetTestResourceTypeList

 $self->GetTestResourceTypeList();

SUBROUTINE  : GetTestResourceTypeList
DESCRIPTION : Get TestResourceTypeList from Program description

IN  : None
OUT : Test resource type list


=head2 GetTime

 $self->GetTime();

SUBROUTINE  : GetTime
DESCRIPTION : Return the current time in string format

IN  : None
OUT : Current time in string


=head2 InsertRowToTable

 $self->InsertRowToTable();

SUBROUTINE  : InsertRowToTable
DESCRIPTION : Insert new record into local database table

IN  : tablename: tablename, array of field name and value
OUT : None


=head2 IsValueTextExist

 $self->IsValueTextExist();

SUBROUTINE  : IsValueTextExist
DESCRIPTION : Check a specific record exists or not

IN  : table_name, array of fields in the table
OUT : (1, $id) or (0,undef)


=head2 LocalDBDisConnect

 $self->LocalDBDisConnect();

SUBROUTINE  : LocalDBDisConnect
DESCRIPTION : Disconnect local database

IN  : None
OUT : None


=head2 LogFileUpdate

 $self->LogFileUpdate();

SUBROUTINE  : LogFileUpdate
DESCRIPTION : Insert new record into 'log_file' table

IN  : logfile
OUT : log_file_id


=head2 LogOutputUpdate

 $self->LogOutputUpdate();

SUBROUTINE  : LogOutputUpdate
DESCRIPTION : Insert new record into 'log_output' table

IN  : log_file_id,
      log_output_type
      log_output_format

OUT : log_output_id


=head2 MakeAndConditionString

 $self->MakeAndConditionString();

SUBROUTINE  : MakeAndConditionString
DESCRIPTION : Combine two strings with 'AND'

IN  : Hash table of strings
OUT : Combined string


=head2 MakeQuestionMarkString

 $self->MakeQuestionMarkString();

SUBROUTINE  : MakeQuestionMarkString
DESCRIPTION : Make a "?,?,?,?,?" string

IN  : Number

OUT : A string
      ex: ?,?,?   (if input number =3)


=head2 PACInfoUpdate

 $self->PACInfoUpdate();

SUBROUTINE  : PACInfoUpdate
DESCRIPTION : Update value of pac, feature_number, module_number, tc, subtc, suba in
              'pac_result' table when running a subtc

IN  : pac, feature_number, module_number, tc, subtc, suba
OUT : None


=head2 PACResultUpdate

 $self->PACResultUpdate();

SUBROUTINE  : PACResultUpdate
DESCRIPTION : Insert new record into 'pac_result' table

IN  : Hash table of {subtc_result_id, result, msg_type, stdout_msg,
      line, log_output_type, achieved_results, expected_results, log_output_id}
OUT : None


=head2 ReadDataFromFile

 $self->ReadDataFromFile();

SUBROUTINE  : ReadDataFromFile
DESCRIPTION : Read content from file

IN  : File name
OUT : Blob data


=head2 SubTCHasSystemUnderTestUpdate

 $self->SubTCHasSystemUnderTestUpdate();

SUBROUTINE  : SubTCHasSystemUnderTestUpdate
DESCRIPTION : Insert new records into 'subtc_has_system_under_test' table

IN  : None
OUT : None


=head2 SubTCHasTestResourceUpdate

 $self->SubTCHasTestResourceUpdate();

SUBROUTINE  : SubTCHasTestResourceUpdate
DESCRIPTION : Insert new records into 'subtc_has_test_resource' table

IN  : None
OUT : None


=head2 SubTCResultShow

 $self->SubTCResultShow();

SUBROUTINE  : SubTCResultShow
DESCRIPTION : Print out Sub Tc result

IN  : Array of subtc_result_id
OUT : None


=head2 SubTCResultUpdate

 $self->SubTCResultUpdate();

SUBROUTINE  : SubTCResultUpdate
DESCRIPTION : Insert new record into 'subtc_result' table if the record does not exist

IN  : Setting parameters in 'tp.conf'
OUT : level, start_date, start_time


=head2 SubTCResultUpdateLevel

 $self->SubTCResultUpdateLevel();

SUBROUTINE  : SubTCResultUpdateLevel
DESCRIPTION : Update value of level in 'subtc_result' table

IN  : level
OUT : None


=head2 SubTCResultUpdateResult

 $self->SubTCResultUpdateResult();

SUBROUTINE  : SubTCResultUpdateResult
DESCRIPTION : Update result in 'subtc_result' table

IN  : result, status
OUT : subtc_result_id


=head2 SubTCResultUpdateStartTime

 $self->SubTCResultUpdateStartTime();

SUBROUTINE  : SubTCResultUpdateStartTime
DESCRIPTION : Update start time in 'subtc_result' table

IN  : None
OUT : None


=head2 SubTCResultUpdateStopTime

 $self->SubTCResultUpdateStopTime();

SUBROUTINE  : SubTCResultUpdateStopTime
DESCRIPTION : Update stop time in 'subtc_result' table

IN  : None
OUT : None


=head2 SystemUnderTestUpdate

 $self->SystemUnderTestUpdate();

SUBROUTINE  : SystemUnderTestUpdate
DESCRIPTION : Insert new record into 'system_under_test' table if the record does not exist

IN  : type, serial, revision, manufacturing_date, position, logical_id
OUT : None


=head2 TestCaseUpdate

 $self->TestCaseUpdate();

SUBROUTINE  : TestCaseUpdate
DESCRIPTION : Insert new record into 'test_case' table if the record dose not exist

IN  : Setting parameters in 'tp.conf'
OUT : None


=head2 TestProgramUpdate

 $self->TestProgramUpdate();

SUBROUTINE  : TestProgramUpdate
DESCRIPTION : Insert new record into 'test_program' table if the record does not exist

IN  : Setting parameters in 'tp.conf'
OUT : None


=head2 TestResourceUpdate

 $self->TestResourceUpdate();

SUBROUTINE  : TestResourceUpdate
DESCRIPTION : Insert new record into 'test_resource' table if the record does not exist

IN  : test_resource_type, hardware_id, hardware_revision, software_revision
OUT : None



=cut

=head1 NAME

LogABIStss


=head1 DESCRIPTION

Document number: 40/190 55-CAH 161 1290/1 Uen
MODULE      : LogABIStss.pm
DESCRIPTION : TSS monitoring subroutines, such as Tshark logging.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME    REVIEW  COMMENT
 A  20111024  XLEIMAR         Created based on wireshark.pm
 B  20111107  XLEIMAR XSOFFRO Changed TSSOpenWLog to extract more
                               information from the header.
 C  20120330  XLEIMAR EERICSV Updated TSSStartWLog to support newly added
                               elements in the TLM.Start_Tlinks command.
                               Updated DESTROY to remove the log file from
                               the tssXX directory if it was successfully
                               copied to the current directory.
                               Commented out some parts of the code because
                               of Abisco TR HP55198.
 D  20120425  XLEIMAR XAMMELY Restored the code which was commented out
                               because of Abisco TR HP55198.
                              Commented out input elements Output and
                               Format from TSSStartWLog as they are not yet
                               supported in an Abisco release
 E  20120507  XLEIMAR XAMMELY Altered parameter RBLT for LAPD logging
 F  20120530  XLEIMAR XAMMELY Changed RBLT to PCMline and instead retrieve
                               the RBLT (PCMnumber) with InfoTG
 G  20120612  ELEMARE EDAMELI Uncommented commented elements
 H  20120921  XNAVNAS ELEMARE Added extra safety to TSSWaitWLog
 J  20121217  ENASNAV XANSBEM Updated Format-input for TSSStartWLog according
                               to CP HQ59774
 K  20121221  ENASNAV EPRRANA Updated Format-input for TSSStartWLog
PL1 20130704  XHENRMA         Added neccesary package includes to parse new EL2TP-traffic
                              Added new parameters to TSSStartWLog when doing IP-logging
                              Modified the constructor to detect TSS rev Y13+ and will in that case,
                                change the way TSSOpenWLog, TSSCloseWLog and TSSReadWLog behaves.
                                Note that the returnvalues from TSSReadWLog are altered.


=head1 REQUIRES

L<NetPacket::IP> 

L<NetPacket::Ethernet> 

L<Net::TcpDumpLog> 

L<File::Compare> 

L<File::Copy> 

L<Scalar::Util> 

L<Hash::Util> 

L<English> 

L<Carp> 

L<Abisco_Connection> 

L<mssim> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 new

 $self->new();

SUBROUTINE  : new
DESCRIPTION : Constructor

IN  : $Class                LogABIStss class
      $Arg{AbisMode}        Either TDM, SC, IP-SIU or IP

      Example:
        my $ABISlog = LogABIStss->new(AbisMode => $TG{AbisMode});

OUT : The object reference


=head2 DESTROY

 $self->DESTROY();

SUBROUTINE  : DESTROY
DESCRIPTION : Destructor - is automatically called when the object is
              destroyed. This is to make sure that the logging stops
              when the script fails.

IN  : $Self         LogABIStss object reference
OUT :


=head2 TSSCloseWLog

 $self->TSSCloseWLog();

SUBROUTINE  : TSSCloseWLog
DESCRIPTION : To close the opened binary Wireshark log

IN  : $Self                 LogABIStss object reference
OUT : $Resp{Result}         Result Code (0=OK)
      $Resp{Reason}         Result Text


=head2 TSSOpenWLog

 $self->TSSOpenWLog();

SUBROUTINE  : TSSOpenWLog
DESCRIPTION : To open the binary Wireshark log (which was created in the
              last call to TSSStartWLog) and read the Basic Header, Counters
              and Channel Desciptors.

IN  : $Self                   LogABIStss object reference
OUT : $Resp{Result}           Result Code (0=OK)
      $Resp{Reason}           Result Text
      $Resp{NoOfChannels}     Number of Channels
      $Resp{NoOfPackets}      Number of Packets (total for all channels)

      For all parameters below, see see LSU Ethereal User's manual edition
      1.50 or later, chapter "Channel descriptors"

      $Resp{$Channel}{Domain}
      $Resp{$Channel}{Protocol}
      $Resp{$Channel}{PpuNbr}
      $Resp{$Channel}{SccRate}
      $Resp{$Channel}{UplinkChNbr}
      $Resp{$Channel}{DownlinkChNbr}
      $Resp{$Channel}{InterfaceCode}
      $Resp{$Channel}{ProcObjType}
      $Resp{$Channel}{Spare}
      $Resp{$Channel}{FilterMap}
      $Resp{$Channel}{UplinkPcmNbr}
      $Resp{$Channel}{DownLinkPcmNbr}
      $Resp{$Channel}{UplinkTsMask}
      $Resp{$Channel}{DownLinkTsMask})
      $Resp{$Channel}{UserLabelRxUl}
      $Resp{$Channel}{UserLabelTxDl}
      $Resp{$Channel}{ProcObjDescr}
      $Resp{$Channel}{ProtParamLength}
      $Resp{$Channel}{ProtParam}


=head2 TSSReadWLog

 $self->TSSReadWLog();

SUBROUTINE  : TSSReadWLog
DESCRIPTION : To read a ABIS record including Common Trace header and SDR
              header from the opened Wireshark log.

IN  : $Self                 LogABIStss object reference
OUT : $Resp{Message}        Messaged unpacked
      $Resp{MsgType}        Message Type, see LSU Ethereal User's manual edition 1.50 or later
      $Resp{Direction}      0 = Uplink, 1= Downlink
      $Resp{MsgLength}      Message Type, see LSU Ethereal User's manual edition 1.50 or later
      $Resp{Result}
      $Resp{Reason}

      For all parameters below, see see LSU Ethereal User's manual edition 1.50 or later,
      chapter "Additional header for GSM SDR radio Messages"

      $Resp{TimestampSec},
      $Resp{TimestampMic},
      $Resp{NoOfSavedOct},
      $Resp{MsgLength},
      $Resp{ChannelId},
      $Resp{MsgType},
      $Resp{ErrorCode},
      $Resp{Spare10},
      $Resp{LostMsg},
      $Resp{MsgDiscr},

      When using TSSReadWLog to log IP on ABIS, on TSS rev Y13+, the return values are the following:
      $Resp{Message}        Messaged unpacked
      $Resp{Direction}      0 = Uplink, 1= Downlink
      $Resp{MsgLength}
      $Resp{Result}
      $Resp{Reason}
      $Resp{TimestampSec}
      $Resp{TimestampMic}
      $Resp{NoOfSavedOct}


=head2 TSSStartWLog

 $self->TSSStartWLog();

SUBROUTINE  : TSSStartWLog
DESCRIPTION : Initiates ABIS logging on the TSS


IN  : $Self                    LogABIStss object reference
      $Input{BTS}              Mandatory, Abisco Connection
      $Input{Filename}         Mandatory, desired file name of Wireshark log
      $Input{Duration}         Optional, duration in seconds
      $Input{GroupId}          Optional, identifies the file
      $Input{Overwrite}        Optional, =1 overwrite if file already exists
      $Input{Direction}        Optional, =3 both UL and DL, =2 only DL,
                                         =1 only UL

      $Input{RSLFrames}        Optional, =1 capture RSL frames. Must be
                               combined with a LAPD channel input
                               (ex. LAPDCh0) on TDM or a APGW channel input
                               (ex. APGWCh0) on SC.
                               RSL - Radio Signalling Link.
      $Input{OMLFrames}        Optional, =1 capture OML frames. Applied in
                               the same way as the RSLFrames element.
                               OML - Operation and Maintenance Link.
      Low-level filetering LAPD:
                               If 'RSLFrames' or 'OMLFrames' is present, all
                               three elements below are set to 1 by default.
                               At least one of them must be set when logging
                               LAPD Frames (RSL and OML frames).
        $Input{IFrames}        Optional, =1 capture this type of LAPD frames
        $Input{UIFrames}       Optional, =1 capture this type of LAPD frames
        $Input{ControlFrames}  Optional, =1 capture this type of LAPD frames

      $Input{PTFGFrames}       Optional, =1 capture PTFG frames (TRAU and
                               CSDATA). Must be combined a APGW channel
                               input (ex. APGWCh0) on SC.
      $Input{PGSLFrames}       Optional, =1 capture PGSL frames (packet
                               data). Applied in the same way as the
                               PTFGFrames element, i.e. only applicable
                               with SC.

      NB! See hash %Config below for the allowed inputs. Note that one or
          more of the specified channels must be set in the function call.

      Example - logging packet data on TDM:
        my %RespTSS = $ABISlog->TSSStartWLog(BTS      => $BTS,
                                             Duration => $Duration,
                                             Filename => $WLogFile,
                                             GSLCh0   => {TG   => $TG,
                                                          TRXC => $TRXC,
                                                          TS   => $TS},
                                             );

      Example - logging packet data on SC:
        my %RespTSS = $ABISlog->TSSStartWLog(BTS        => $BTS,
                                             Duration   => $Duration,
                                             Filename   => $WLogFile,
                                             PGSLFrames => 1,
                                             APGWCh0    => {TG   => $TG,
                                                            TRXC => $TRXC},
                                             );

OUT : $Resp{Result}        Result Code (0=OK)
      $Resp{Reason}        Result Text


=head2 TSSWaitWLog

 $self->TSSWaitWLog();

SUBROUTINE  : TSSWaitWLog
DESCRIPTION : To wait for TSS to complete logging

IN  : $Self              LogABIStss object reference
OUT : $Resp{Result}      Result Code (0=OK)
      $Resp{Reason}      Result Text


=head2 createMessageLogFromWLog

 $self->createMessageLogFromWLog();

SUBROUTINE  : createMessageLogFromWLog
DESCRIPTION : Create Message log From Wireshark Log

IN  : $Self                   LogABIStss object reference
      $Input{PGSLLogFile}     File name of new log to be created
OUT : $Config{PGSLLogFile}    File name of message File containing Hex dump
                              as string, one per Wireshark log line



=cut

=head1 NAME

LogFunction


=head1 DESCRIPTION

Document number: 20/190 55-CAH 161 1290/1
MODULE      : LogFunction.pm
DESCRIPTION : This package contains the sub functions and variables
              used for logging function

COPYRIGHT Â© : ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV  DATE       NAME         REVIEW    COMMENT
A    20100920   XDT/XNGUTHU  ESTEMOH   Initial version.
B    20110823   XSOFFRO      ETORWIL   Framework maintenance


=head1 REQUIRES

L<constant> 

L<constant> 

L<constant> 

L<constant> 

L<constant> 

L<constant> 

L<constant> 

L<constant> 

L<constant> 

L<constant> 

L<Cwd> 

L<Carp> 

L<English> 

L<LocalDB> 

L<Settings> 

L<HelpFunc> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 Assert

 Assert();

SUBROUTINE  : Assert
DESCRIPTION : Assert with DB logging

IN  : $1 - Values to check (scalar or ref to hash or array)
      $2 - Required Values (ditto). If $2 is absent $1 must be true.
      $3 - Force the check regardless of -Alone, -Ignore etc (internal use)

OUT : 0


=head2 BeginPACLogging

 BeginPACLogging();

SUBROUTINE  : BeginPACLogging
DESCRIPTION : Start PAC logging

IN  : $pac,$spec, $tc, $subtc, $suba
OUT : None


=head2 CloseStdoutLog

 CloseStdoutLog();

SUBROUTINE  : CloseStdoutLog
DESCRIPTION : Close stdout log file

IN  : None
OUT : None


=head2 DatabaseUpdateforLogging

 DatabaseUpdateforLogging();

SUBROUTINE  : DatabaseUpdateforLogging
DESCRIPTION : Start Local Database update for manual logging

IN  : $pac, $spec, $tc, $subtc, $suba
OUT : None


=head2 DatabaseUpdateforUpload

 DatabaseUpdateforUpload();

SUBROUTINE  : DatabaseUpdateforUpload
DESCRIPTION : Start Local Database update for manual upload

IN  : $pac, $spec, $tc, $subtc, $suba
OUT : None


=head2 EndPACLogging

 EndPACLogging();

SUBROUTINE  : EndPACLogging
DESCRIPTION : Perform some action when stop PAC logging

IN  : None
OUT : None


=head2 GetResult

 GetResult();

SUBROUTINE  : GetResult
DESCRIPTION : Return the test result for the section.
              If HandleError is used with the parameter AllowCroak set to
              'FALSE', a return command with the value from GetResult()
              should be placed in the action section.

IN  : Automated   - 'User', 'Semi', 'Fully'
      Reason      - Reason string overriding default message

OUT : If the section has errors:  ('Not_Applicable',
      'Testcase failed due to error')
      If no error detected and Fully automated ('Passed', '')
      If no error detected and Semi/User automated ('Not_Applicable',
      Test execution passed. Check log to verify the result')


=head2 GetSubTCStartInfo

 GetSubTCStartInfo();

SUBROUTINE  : GetSubTCStartInfo
DESCRIPTION : Get information when subTC starts

IN  : None
OUT : None


=head2 GetSubTCStopInfo

 GetSubTCStopInfo();

SUBROUTINE  : GetSubTCStopInfo
DESCRIPTION : Get information when subTC stops

IN  : $not_applicable from user.pm
OUT : None


=head2 GetSystemUnderTestInfo

 GetSystemUnderTestInfo();

SUBROUTINE  : GetSystemUnderTestInfo
DESCRIPTION : Get system_under_test information from real machine

IN  : None
OUT : A reference of hash info


=head2 GetTestResourceInfo

 GetTestResourceInfo();

SUBROUTINE  : GetTestResourceInfo
DESCRIPTION : Get test_resource information from real machine

IN  : None
OUT : A reference of hash info


=head2 Logging

 Logging();

SUBROUTINE  : Logging
DESCRIPTION : Write a STDOUT message into local database

IN  : MsgType, StdoutMsg, LogFile, LogType, AchRS, ExpRS, StdoutSilent
OUT : None


=head2 MoveFileToLogDir

 MoveFileToLogDir();

SUBROUTINE  : MoveFileToLogDir
DESCRIPTION : Save log files into LOG_DIR folder

IN  : File name
OUT : None


=head2 MoveToDirLogStdoutLog

 MoveToDirLogStdoutLog();

SUBROUTINE  : MoveToDirLogStdoutLog
DESCRIPTION : Move  stdout log file to log dir

IN  : None
OUT : None


=head2 OpenStdoutLog

 OpenStdoutLog();

SUBROUTINE  : OpenStdoutLog
DESCRIPTION : Open stdout log file

IN  : None
OUT : None


=head2 PackDectoAscii

 PackDectoAscii();

SUBROUTINE  : PackDectoAscii
DESCRIPTION : Pack from Decimal to Ascii format. Use in getting
              system_under_test information

IN  : Serial number, revision number, position number and logical number
      in Decimal format
OUT : Serial number, revision number, position number and logical number
      in Ascii format


=head2 PrintCommandResult

 PrintCommandResult();

SUBROUTINE  : PrintCommandResult
DESCRIPTION : Print out run response result but now does not use

IN  : Array of sub tc result id
OUT : Pass/Fail


=head2 PrintSubTCResult

 PrintSubTCResult();

SUBROUTINE  : PrintSubTCResult
DESCRIPTION : Print out sub tc result

IN  : Array of sub tc result id
OUT : None


=head2 UnExpectedError

 UnExpectedError();

SUBROUTINE  : UnExpectedError
DESCRIPTION : Write runtime error to Perl log file

IN  : Error information
OUT : None


=head2 WriteStdoutLog

 WriteStdoutLog();

SUBROUTINE  : WriteStdoutLog
DESCRIPTION : Write stdoutput to log file

IN  : String or array of string
OUT : None



=cut

=head1 NAME

lsuConfig


=head1 DESCRIPTION

Document number: 21/190 55-CAH 161 1290/1 Uen
MODULE      : LSUConfig.pm
DESCRIPTION : This package contains the subfunctions and variables
              used for LSU configuration

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE     NAME    REVIEW  COMMENT
A   20110201 XWIKMAR XDAVMEL File created. Added PCM 33-40.
                             Fix for ABIS signaling (PCM TS1) that can not
                             be read from virtual SCC.
B   20110202 XDAVMEL ETORWIL Switched offset DL and UL in %NormalSCCSet and
             ETORWIL         %MinimalSCCSet. Fix for problem with
                             ISConfigRequest in PCMTimeslot. Removed dbLog
                             dependency.
C   20111018 QRADGUT XTOBSEM Updated to new script template
                              Added document number.
                              Changed %Normal/MinimalSCCSet.TDM_5.IsVirtual
                               to 1. Switched offset DL and UL in
                               %NormalSCCSet and %MinimalSCCSet back after
                               decision that lowest PCM number should be
                               uplink.
                              Added lock_keys hash checking on input.
                              Changed 'our' declared variables to 'my'.
                              Added catch of eval error around lock_keys.
                              Corrected erronous printouts to file in
                               subroutine CreateWiresharkCfg.
                              Switched rate for E1 T1 bit rate
D   20111021  XLEIMAR ETORWIL Fixed bug in GetVirtualSCC that made it return
                               the wrong value.
                              Corrected warnings in GetVirtualSCC.
E   20111118  ETORWIL XPRRANA Updated SetupLSU to remove BTS key from input HASH
                               Key not used but fix needed for backward compatibility
                               HO13635


=head1 REQUIRES

L<Carp> 

L<Net::Telnet> 

L<Hash::Util> 

L<dbLog> 

L<English> 

L<Abisco_Connection> 

L<IS_ICP_ConvList> 

L<PerlFunc> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ConnectLSU

 ConnectLSU();

SUBROUTINE  : ConnectLSU
DESCRIPTION : Connect to the LSU using Telnet

IN  : Hash containing the following keys:
      LSU_IP          - IP or host name (ex. 'lsu01')
      TelnetUserName  - Username (default 'user')
      TelnetPassword  - Password (default 'user')
OUT : Telnet connection reference


=head2 CreateMSSIMWiresharkCfg

 CreateMSSIMWiresharkCfg();

SUBROUTINE  : CreateMSSIMWiresharkCfg
DESCRIPTION : Creates a MSSIM configuration file

IN  : Hash containing the following keys:
      Interface             - Specifies the Wireshark cfg file Interface
                              setting.
      AdditionalParameters  - Specifies the Wireshark cfg file Additional
                              Parameter setting.
      FileName              - Specifies the generated cfg file name.
                              ( default 'MSSIM_XX_XX.cfg' where XX_XX is the
                              test program number in the PAR hash ).

OUT : Error     - 0 = OK, 1 = Error
      Reason    - Error reason (only valid if Error = 1)
      FileName  - The name of the generated file


=head2 CreateSCC

 CreateSCC();

SUBROUTINE  : CreateSCC
DESCRIPTION : Create a SCC in the LSU. An existsing SCC with the incorrect
              rate will be deleted before creation of the new.

IN  : Hash containing the following keys:
      SSCNumber         - SCC number
      SSCRate           - SCC rate
      PPU               - PPU number
      TelnetConnection  - Telnet connection reference
      IsVirtual         - Indicate the SCC should be set as a virtual SCC

OUT : 0 - Creation failed
      1 - Successfully created SCC


=head2 CreateWiresharkCfg

 CreateWiresharkCfg();

SUBROUTINE  : CreateWiresharkCfg
DESCRIPTION : Create a Wireshark configuration file

IN  : Hash containing the following keys:
      Interface            - Specifies the Wireshark cfg file Interface
                             setting.
      AdditionalParameters - Specifies the Wireshark cfg file Additional
                             Parameter setting.
      FileName             - Specifies the generated cfg file name.
                             ( default 'MSSIM_XX_XX.cfg' where XX_XX is the
                             test program number in the PAR hash ).
      LSU_IP               - IP or host name (ex. 'lsu01')
      TcpPort              - LSU tcp/ip port nr (default 1861)
      UChannel             - Uplink channel number
      DChannel             - Downlink channel number
      InterfaceVersion     - Wireshark interface version (default 2)
      PortNr               - Port number (default '000')
      PPU                  - PPU number (default 0)
      Interface            - Interface number
      AdditionalParameters - Interface Additional parameters
      AddToExistingCfg     - Indicate if a new .cfg file should be created
                             (overwrite existing) or the settings should be
                             appended to an existing file.

OUT : Error     - 0 = OK, 1 = Error
      Reason    - Error reason (only valid if Error = 1)
      FileName  - The name of the generated file


=head2 GetLSUSettings

 GetLSUSettings();

SUBROUTINE  : GetLSUSettings
DESCRIPTION : Read the LSU setting from file

IN  : None
OUT : Hash containing the following keys:
      Error     - 0 = OK, 1 = Error
      Reason    - Error reason (only valid if Error = 1)
      Settings  - Reference to the LSU settings hash


=head2 GetPCMTimeslot

 GetPCMTimeslot();

SUBROUTINE  : GetPCMTimeslot
DESCRIPTION : Return the PCM timeslot associated with a specified UM timeslot

IN  : Hash containing the following keys:
      UMTimeslot - UM timeslot
      Rate       - The TCH rate
      TRX        - The TRX nr
OUT : Hash containing the following keys:
      PCMTimeslots - The PCM timeslot
      PCMSubCh     - The PCM sub channel


=head2 GetSCCBase

 GetSCCBase();

SUBROUTINE  : GetSCCBase
DESCRIPTION : Get the first SCC number associated with a PCM and Area number

IN  : Hash containing the following keys:
      PCM_UL - PCM number (uplink)
OUT : The base SCC number


=head2 GetSCType

 GetSCType();

SUBROUTINE  : GetSCType
DESCRIPTION : Get the PCM SC type

IN  : Rate
OUT : 'E1' or 'T1'


=head2 GetVirtualSCC

 GetVirtualSCC();

SUBROUTINE  : GetVirtualSCC
DESCRIPTION : Get the virtual SCC numbers connected to a SCC

IN  : Hash containing the following keys:
      SSCNumber         - SCC number
      SSCRate           - SCC rate (8, 16, 32, 64, 512, ... , 1984)
      PPU               - PPU number
      TelnetConnection  - Telnet connection reference

OUT : Hash containing the following keys:
      '8'  => { 'TS0' => SCCx
                'TS1' => SCCx
                ...
                'TS7' => SCCx },
      '16' => { 'TS0' => SCCx
                'TS1' => SCCx
                ...
                'TS4' => SCCx },
      '64' => { 'TS0' => SCCx }


=head2 PrintToFile

 PrintToFile();

SUBROUTINE  : PrintToFile
DESCRIPTION : Opens a file, prints the input line array, and closes the file

IN  : FileName            Filename as a string
      Lines               An array of strings to be printed
OUT : 0                   Ok


=head2 ReadSwitchMatrix

 ReadSwitchMatrix();

SUBROUTINE  : ReadSwitchMatrix
DESCRIPTION : Read the LSU switch matrix

IN  : Hash containing the following keys:
      SwitchMatrixLocation  - Path to switch matrix on LSU
      TelnetConnection      - Telnet connection reference
OUT : Referense to Array containing the switch matrix


=head2 SCCExists

 SCCExists();

SUBROUTINE  : SCCExists
DESCRIPTION : Check if a SCC number exist with a specified rate

IN  : Hash containing the following keys:
      SSCNumber         - SCC number
      SSCRate           - SCC rate
      PPU               - PPU number
      TelnetConnection  - Telnet connection reference
OUT : 1 - SCC exists with the specified rate
      0 - SCC do not exists or have an incorrect rate


=head2 SetLSUSettings

 SetLSUSettings();

SUBROUTINE  : SetLSUSettings
DESCRIPTION : Write the LSU settings to a file

IN  : Hash containing the settings that should be written to file
OUT : Hash containing the following keys:
      Error     - 0 = OK, 1 = Error
      Reason    - Error reason (only valid if Error = 1)
      FileName  - The name of the created settings file


=head2 SetSwitchMatrix

 SetSwitchMatrix();

SUBROUTINE  : SetSwitchMatrix
DESCRIPTION : Update the switch matrix

IN  : Hash containing the following keys:
      SSCNumber             - SCC number
      SSCRate               - SCC rate (8, 16, 32, 64, 512, ... , 1984)
      PCM                   - PCM line number
      Timeslots             - PCM timeslots
      PPU                   - PPU number
      TelnetConnection      - Telnet connection reference
      SwitchMatrixLocation  - Path to switch matrix on LSU

OUT : 1 - Switch matrix was updated
      0 - No update was needed


=head2 SetTG

 SetTG();

SUBROUTINE  : SetTG
DESCRIPTION : To set TCM configuration, updates, disconnects and reconnects

IN  : TCH_Configuration
OUT : None


=head2 SetupLSU

 SetupLSU();

SUBROUTINE  : SetupLSU
DESCRIPTION : Subroutine to configure the LSU switch matrix and create a
              corresponding Wireshark/TShark configuration file

IN  : Hash containing the following keys:
      ConfigTSType          - Indicate the type of timeslot used for
                              configuration, 'PCM' (over Abis) or 'UM'
                              (over Air).
      Timeslots             - Timeslots. The type of timeslot set here is
                              defined by ConfigTSType.
      PCMSubCh              - PCM sub channel. Only required if ConfigTSType
                              is set to 'PCM'.
      TRX                   - TRX number. Only required if ConfigTSType is
                              set to 'UM'.
      Area                  - SCC TDM area (0-6).
      TCHRate               - TCHRate ( 8 / 16 / 64 / 1536 / 1984 )
      AddToExistingCfg      - Indicate if a new .cfg file should be created
                              (overwrite existing) or the settings should be
                              appended to an existing file.
      PreDefinedInterface   - A pre-defined Wireshark interface in the hash
                              %WiresharkInterface. Valid values for Abis
                              monitoring are: 'TRAU_Frames_3GPP',
                              'Ericsson_PCU_16k,'Ericsson_PCU_64k',
                              'Ericsson_Abis'.
      Interface             - Specify the Wireshark cfg file Interface
                              setting. Not required if PreDefinedInterface
                              is set.
      AdditionalParameters  - Specify the Wireshark cfg file Additional
                              Parameter setting. Not required if
                              PreDefinedInterface is set.
      LSUConfigFile         - Specify the geenrated cfg file name.
      HalfRateChannel       - Only valid on 8 kbps (half-rate)
                              0 = Lm/0, 1 = Lm/1

OUT : Hash containing the following keys:
      Error         - 0 = OK, 1 = Error
      Reason        - Error reason (only valid if Error = 1)
      FileName      - The name of the generated file
      PCMTimeslots  - The PCM timeslot
      PCMSubCh      - The PCM sub channel



=cut

=head1 NAME

LTSFunc


=head1 DESCRIPTION

Document number: 22/190 55-CAH 161 1290/1 Uen
MODULE      : ltsfunc.pm
DESCRIPTION : Contains the helper functions used to simplify creation of the
              backend implementations of the LTS API methods, excluding
              those which are used during initialization.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV    DATE       NAME          REVIEW     COMMENT
PA1    20051128   ERADIPE                  First revision
P2A    20080319   XRSJALI                  Added handling of lost replies in ConfigureLTSLoad
P1A    20080319   ERABAHG                  Merged with \tr5705. New rev
P1B    20080401   XRSJALI                  Implementing CR 5761.
P1C    20080416   ERABAHG                  Merged to main
P1C_1A 20080617   XRSJALI                  Implementing CR 5768.
P1D    20080904   ERABAHG                  Merged to main
P1D_1A 20081020   XRSJALI                  Implementing TR 5935
P1E    20081030   XRSJALI                  Merged to main
P1E_1A 20081121   XRSJALI                  Implementing TR 5991
P1F    20081124   XRSJALI                  Merged to main
P1F_1A 20090311   XYNSTAN                  Implementing TR 6056
P1G    20090311   XYNSTAN                  Merged to main
B      20110907   XLOHFOO       XSOFFRO    Updated to new script template.
                                           Quality control with PerlCritic
                                           Added document number.
C      20120530   XLEAENG                  HP14008: Ported from ACM
                                           Updated to new script template.
D      20120703   XLEAENG                  Removed trailing spaces and hard tabs
E      20120710   XLOHFOO       EDAMELI    Update script by applying PerlCritic
F      20120808   Syntronic AB/ XLOHFOO    Added lock_keys for Code Optimisation 0003027
                  Catherine
G      20120810   XLOHFOO       XTEHKIN    Add hash key for ReadIniFile
H      20120829   XWOOKUN       XLOHFOO    Pass in timing advance from user config
J      20121025   XWOOKUN       XNURMOH    Added debug mode for ConfigureLTSLoad

K      20121022   Syntronic AB/ XTEHKIN    Implement HQ45055
                  Catherine
L      20121029   XTEHKIN       XNURMOH    HQ45962, Delete SACCHControlStruct ConfigureCellLoad parameter for CTRU
M      20130222   XWOOKUN       Syntronic AB/ Modified in HP76832
                                Catherine     Rewrite how ConfigureSiteR12 calculate traffics, by calling LoadConfigCalculations
                                              ConfigureLoad2 uses Storable::dclone for deep cloning multi-dimentional hash
                                              ConfigureLTSLoad no longer calculates SGCall, done in CalculateLoadConfig
                                              Rewrite GetNoofTCH to cater for BCCH TRX and configured TRX when calculate TCH 
                                              Modified in HQ47771
                                              Modified in 0003886
                                              Modified for HQ84948 HR14245
N     20130703    Syntronic AB/ XMAROHM       Modified in HR24750
                  Adibah
Note that on 2011-06-20 the revision style was changed back to A, B and so on.


=head1 REQUIRES

L<Exporter> 

L<Storable> 

L<Hash::Util> 

L<feature> 

L<English> 

L<Carp> 

L<Time::HiRes> 

L<HelpFunc> 

L<PerlFunc> 

L<diagnostics> Produce verbose warning diagnostics


=head1 IMPLEMENTS

L<Exporter> 


=head1 METHODS

=head2 ConfigureLTSLoad

 $self->ConfigureLTSLoad();

HO92107 : 20120307 : Replace ConfigureLoad with ConfigureCellLoad
SUBROUTINE  : ConfigureLTSLoad
DESCRIPTION : Configures the load and resets the counters.

IN  : 1. $BTS                -> Abisco connection object.
      2. $rIndata (Optional) -> Additional data. (in hash)
      3. $rTG                -> TG hash reference.
      4. $cb                 -> Callback function implementation.
OUT : -


=head2 ConfigureLoad

 $self->ConfigureLoad();

SUBROUTINE  : ConfigureLoad
DESCRIPTION : Configures the load by calling ConfigureLTSLoad.
              If key PredefinedLoading exists in %Indata, it can have
              values NORMAL, HIGH or OVER, which is a predefined loading
              behavior the LTS can be set to.
              If key PredefinedLoading does not exist, then a default
              set of values is used.

IN  : 1. $BTS      -> Abisco connection object.
      2. {%TG}     -> Reference to a TG hash.
      3. {%LTC}    -> Reference to a LTC hash.
      4. {%Indata} -> Reference to a hash containing additional data.
      5. $cb       -> Callback function implementation.
OUT : 1. %TG       -> Updated TG hash.


=head2 ConfigureLoad2

 $self->ConfigureLoad2();

SUBROUTINE  : ConfigureLoad2
DESCRIPTION : Continuation from ConfigureLoad

IN  : 1. $BTS      -> Abisco connection object.
      2. {%TG}     -> Reference to a TG hash.
      3. {%LTC}    -> Reference to a LTC hash.
      4. {%Indata} -> Reference to a hash containing additional data.
      5. $Loading  -> Load type.
      6. $cb       -> Callback function implementation.
OUT : -


=head2 ConfigureSiteR11

 $self->ConfigureSiteR11();

SUBROUTINE  : ConfigureSiteR11
DESCRIPTION :

IN  : 1. $BTS  -> Abisco connection object.
      2. {%TG} -> Reference to TG hash.
      3. $cb   -> Callback function implementation.
OUT : 1. %TG   -> Updated TG hash.


=head2 ConfigureSiteR12

 $self->ConfigureSiteR12();

HP98504 : 20120703 : Removed the reserved timeslot 7 for TS reconfiguration
HO92107 : 20120209 : New command LTS.ConfigureCell (replaced LTS.ConfigureSite)
SUBROUTINE  : ConfigureSiteR12
DESCRIPTION :

IN  : 1. $BTS  -> Abisco connection object.
      2. {%TG} -> Reference to TG hash.
      3. $cb   -> Callback function implementation.
OUT : 1. %TG   -> Updated TG hash.


=head2 ConfigureSiteStaticLoad

 $self->ConfigureSiteStaticLoad();

CR6572 : 20100622 : Configure Site for static load
SUBROUTINE  : ConfigureSiteStaticLoad
DESCRIPTION : Configure LTS site for static load cases

IN  : 1. $BTS -> Abisco connection object.
      2. $TG  -> Reference to TG
      3. $cb  -> Callback function implementation.
OUT : -


=head2 ConfigureTS

 $self->ConfigureTS();

SUBROUTINE  : ConfigureTS
DESCRIPTION : Element 0 in the array means that the time slot is
              reserved by the LTS for the load.

IN  : 1. $BTS      -> Abisco connection object.
      2. {%TG}     -> Reference to TG hash, supplied only to
                      extract UFTE revision information.
      3. {%Indata} -> Reference to a hash that alters the
                      content of the sent signal.
      4. $cb       -> Callback function implementation.
OUT : -


=head2 FMReportRequest

 $self->FMReportRequest();

SUBROUTINE  : FMReportRequest
DESCRIPTION : send 'FMReportRequest'

IN  : 1. $BTS  -> Abisco connection object.
      2. $TGNr -> TG number
      3. $TRXC -> TRXC number
      4. $cb   -> Callback function implementation.
OUT : -


=head2 GetLtsReport

 $self->GetLtsReport();

HO92107 : 20120209 : New functions to get LTS.GetReports without blocking
SUBROUTINE  : GetLtsReport
DESCRIPTION : Send LTS.GetReports for all the cells configured in a TG

IN  : A hash with the following hash-key(s):
       1. BTS -> Abisco connection object.
       2. TG  -> Reference to TG hash.
       3. CB  -> Callback function implementation.
      In addition, the hash should also contain other optional data.
OUT : 1. $result -> One of:
                     DONE         - Action completed successfully.
                     UNSUCCESSFUL - Action ended but it was unsuccessful.
                     TIMEOUT      - Action aborted due to timeout.


=head2 GetLtsReportStop

 $self->GetLtsReportStop();

SUBROUTINE  : GetLtsReportStop
DESCRIPTION : Stop LTS.GetReports by setting a global flag, so that
              GetLtsReport() will stop the timer when wake up from sleep event

IN  : A hash with the following hash-key(s):
       1. $Option = STOP
OUT : -


=head2 GetNoofTCH

 $self->GetNoofTCH();

HO92107 : 20120426 : To obtain the number of TCH for assigned TRX
SUBROUTINE  : GetNoofTCH
DESCRIPTION : Get the Total TCH for the Assigned TRX

IN  : 1. Reference TG hash
      2. Cell number
      3. Array with Assign TRX
OUT : 1. Number of TCH


=head2 LTSReportCalculations

 $self->LTSReportCalculations();

SUBROUTINE  : LTSReportCalculations
DESCRIPTION :

IN  : 1. Report     -> Reference to Report Data
      2. ReportType -> Type of Report
      3. $rTG        -> Reference to TG Hash
OUT : Hash containing result of calculation


=head2 RecursiveConfigureLoad

 $self->RecursiveConfigureLoad();

SUBROUTINE  : RecursiveConfigureLoad
DESCRIPTION : Function to configure load multiple times in
              recursive fashion.

IN  : 1. $BTS     -> Abisco connection object.
      2. {%H}     -> Reference to a message-hash that will be
                     sent to Abisco. It should at least have
                     the following hash-key(s):
                        Server  -> Name of the ABISCO server.
                        Message -> Name of the ABISCO command.
                        Timeout -> Max time to wait for response.
      3. $retries -> Number of retries.
      4. $cb      -> Callback function implementation.
OUT : -


=head2 ResetLTSCounters

 $self->ResetLTSCounters();

HO92107 : 20120209 : Send LTS.ResetCounters to all cells in TG, from TRXListCell
SUBROUTINE  : ResetLTSCounters
DESCRIPTION :

IN  : 1. $BTS -> Abisco connection object.
      2. $cb  -> Callback function implementation.
OUT : -



=cut

=head1 NAME

LTSSetup


=head1 DESCRIPTION

Document number: 23/190 55-CAH 161 1290/1 Uen
Module      : ltssetup.pm
Description : Specifically contains the helper functions used to simplify
              creation of the backend implementations of the LTS API methods
              which are used during initialization.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV    DATE       NAME          REVIEW    COMMENT
R5Z_1A 20080909   XMATTEK                 Module version of ltssetup.pl (CR5755, 5756)
A      20110823   XLEIMAR       XSOFFRO   Framework maintenance
                                          Added hash reference \ for hashes
                                          within hashes.
B      20120530   XLEAENG                 HP14008: Ported from ACM
                                          Updated to new script template.
C      20120703   XLEAENG                 Removed trailing spaces and hard tabs
D      20120710   XTEHKIN       EDAMELI   Script optimization
E      20120808   Syntronic AB/ XLOHFOO   Added lock_keys for Code Optimisation 0003027
                  Catherine
F      20120828   XLOHFOO       XWOOKUN   New vamos parameter was added for R45
G      20121029   XWOOKUN       XNURMOH   Modified in HQ42662, changed regex to match abisco version of ufte test build in RecursiveLoadConfig
H      20130222   XWOOKUN       Syntronic AB/ Modified in HQ47771
                                Catherine     Modified in HQ47774
                                              Modified for HQ84948 vamos advance
J      20130703   Syntronic AB/ XLOHFOO       Modified in HR23132
                  Adibah
K      20131111   Syntronic AB/ Syntronic AB/ Added lock_keys to Get_TG_List(), modified CheckTG, Prompt
                  Adibah        Catherine
Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Exporter> 

L<Hash::Util> 

L<feature> 

L<globals_acm> 

L<PerlFunc> 

L<HelpFunc> 

L<English> 

L<Term::ReadKey> 

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 IMPLEMENTS

L<Exporter> 


=head1 METHODS

=head2 ARFCNsListSet

 $self->ARFCNsListSet();

SUBROUTINE  : ARFCNsListSet
DESCRIPTION : Set the ARFCNs List with User Input for ARFCN Start and
              ARRCN End

IN  : 1. $Frequency Band
      2. ARFCN Start (User)
      3. ARFCN END (User)
OUT : 1. @Array  -> ARFCN list


=head2 Build_TRXC_And_TS_Hashes

 $self->Build_TRXC_And_TS_Hashes();

HP61054: The Automated Test Script (Init()) and manual LTSSetup will change the SDCCCH configuration incorrectly
DATE: 2012-05-28
TR Fix: Readout all the SDCCCH for all the TRXC, and store in TSHash, in order to be used in TS_Reconfig_ChComb to
          Configure the TS for SDCCCH, CCCH and tch correctly
FUNCTION : Build_TRXC_And_TS_Hashes
COMMENT  :

IN       : 1. $BTS      -> Abisco connection object.
           2. $TG       -> TG number.
           3. $TRXC     -> TRXC number.
           4. [@ARFCNs] -> Reference to a list of ARFCNs.
           5. $cb       -> Callback function implementation.
OUT      : 1. %TRXCHash (Global)
           2. %TSHash (Global)


=head2 CheckConfigLoad

 $self->CheckConfigLoad();

SUBROUTINE  : CheckConfigLoad
DESCRIPTION : Checks parameters in a saved Configure Load file for errors.

IN  : 1.  %ConfigLoadFiles (Global) -> Hash with loadfiles to check.
      2.  %LoadLevels (Global)
      3.  $FSLevel (Global)
      4.  $SacchControl (Global)
      5.  $Rsul (Global)
      6.  $Rsdl (Global)
      7.  $FacchCtrl (Global)
      8.  $RepeatDLFACCH (Global)
      9.  $SpeechGenMode (Global)
      10. $LoopDelay (Global)
      11. $NoOfActPDCH (Global)
      12. $SwDwLoad (Global)
      13. $ComplStart (Global)
      14. $FASConf (Global)
      15. $ActivateVGCS (Global)
OUT : 1.  $Errors


=head2 CheckConfigLoads

 $self->CheckConfigLoads();

SUBROUTINE  : CheckConfigLoads
DESCRIPTION : Checks parameters in saved Configure Load files
              for all load levels for errors.

IN  : 1. %ConfigLoadFiles (Global) -> Hash with loadfiles to check.
OUT : -
CR6570: Make a standalone version of ltssetup.
Date: 2010-04-14
CR Fix: check single load file if running in ltssetup mode


=head2 CheckFix_Param

 $self->CheckFix_Param();

SUBROUTINE  : CheckFix_Param
DESCRIPTION : Checks a specific TG/Cell parameter (Fix Parameter) for
              errors.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0).
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Param     -> Parameter to be checked.
      4. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 CheckPCM_Param

 $self->CheckPCM_Param();

SUBROUTINE  : CheckPCM_Param
DESCRIPTION : Checks PCM parameters in TG for errors.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0).
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Param     -> Parameter to be checked.
      4. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 CheckSaved_Param

 $self->CheckSaved_Param();

SUBROUTINE  : CheckSaved_Param
DESCRIPTION : Checks parameters in LTS Config Load file for error.

IN  : 1. $Text     -> Text string to Print (if error).
      2. $FSParam  -> Expected value.
      3. $IniParam -> Value from saved file.
OUT : 1. $Error    -> 0=OK, 1=ERROR.


=head2 CheckTFMode

 $self->CheckTFMode();

SUBROUTINE  : CheckTFMode
DESCRIPTION : Checks TF Mode parameter for errors.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0), second cell.
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Param     -> Parameter to be checked.
      4. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 CheckTG

 $self->CheckTG();

SUBROUTINE  : CheckTG
DESCRIPTION : Checks TG and Cell parameters according to Load Level.

IN  : 1. $BTS -> Abisco connection object.
      2. $cb  -> Callback function implementation.
OUT : -


=head2 Check_Array

 $self->Check_Array();

SUBROUTINE  : Check_Array
DESCRIPTION : Checks a specific TG/Cell parameter in an array for errors.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0).
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Param     -> Parameter to be checked.
      4. $Fix       -> Reference to fix hash.
      5. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 Check_BSPower

 $self->Check_BSPower();

SUBROUTINE  : Check_BSPower
DESCRIPTION : Checks BS Power BCCH on Neighbour cells for errors.

IN  : 1. $Type             -> Type for Printout (example TG0/Cell0).
      2. $Indicator        -> Indicator for Printout (ERROR or WARNING).
      3. $BSPowerFirstCell -> BS Power first cell.
      4. $Message          -> Reference to message hash.
OUT : 1. $Errors           -> 0=OK, 1=ERROR.


=head2 Check_Dedication

 $self->Check_Dedication();

SUBROUTINE  : Check_Dedication
DESCRIPTION : Checks Dedication Information for Antenna Hopping for
              errors.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0).
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Param     -> Parameter Name.
      4. $Fix       -> Parameter Value.
      5. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 Check_FLAB

 $self->Check_FLAB();

SUBROUTINE  : Check_FLAB
DESCRIPTION : Checks FLAB configuration according to load level for
              errors. Also checks that FLAB is not configured for cTRU.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0), second cell.
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 Check_HoppingARFCN

 $self->Check_HoppingARFCN();

SUBROUTINE  : Check_HoppingARFCN
DESCRIPTION : Checks nbr of ARFCNs for SYNTH hopp for errors.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0).
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Param     -> Hopping parameter.
      4. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 Check_IRC

 $self->Check_IRC();

SUBROUTINE  : Check_IRC
DESCRIPTION : Checks that IRC is not configured on a cTRU.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0), second cell.
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 Check_Neighbour

 $self->Check_Neighbour();

SUBROUTINE  : Check_Neighbour
DESCRIPTION : Checks Neighbour ARFCN for errors.

IN  : A hash with the following hash-key(s):
      1. $Type               -> Type for Printout (example TG0/Cell0),
                                second cell.
      2. $Indicator          -> Indicator for Printout (ERROR or WARNING).
      3. $Type1              -> Type for Printout (example TG0/Cell0), first
                                cell.
      4. $BCCHFirstCell      -> BCCH first cell.
      5. $NeighbourFirstCell -> Neighbour ARFCN first cell.
      6. $Message            -> Reference to message hash.
OUT : 1. $Errors             -> 0=OK, 1=ERROR.


=head2 Check_SDCCHConfig

 $self->Check_SDCCHConfig();

SUBROUTINE  : Check_SDCCHConfig
DESCRIPTION : Checks configuration of SDCCH, on BCCH or non_BCCH TRX
              for errors.

IN  : 1. $Type      -> Type for Printout (example TG0/Cell0).
      2. $Indicator -> Indicator for Printout (ERROR or WARNING).
      3. $Message   -> Reference to message hash.
OUT : 1. $Errors    -> 0=OK, 1=ERROR.


=head2 CloseLog

 $self->CloseLog();

SUBROUTINE  : CloseLog
DESCRIPTION : Close the LTSSetup log file.

IN  : -
OUT : -


=head2 ConfigureFAS

 $self->ConfigureFAS();

HP62048: FMConfigReq fails in Ltssetup on 1800
Date: 2012-05-25
Fix: delete Rus_Start_ARFCN and RUS_Stop_ARFCN in config
SUBROUTINE  : ConfigureFAS
DESCRIPTION :

IN  : 1. $BTS  -> Abisco connection object.
      2. {%TG} -> Reference to TG hash.
      3. $RId  -> Hwinfo-Logical ID
      4. $MCTR_SuppFreqBw -> MCTR Supported Frequency Bandwidth
      5. $cb   -> Callback function implementation.
OUT : -


=head2 ConnectTG

 $self->ConnectTG();

HQ47774 : 20130218 : added rTG to pass to sub ConnectTG
SUBROUTINE  : ConnectTG
DESCRIPTION :

IN  : 1. $BTS -> Abisco connection object.
      2. $rTG -> Reference to TG hash.
      3. $cb  -> Callback function implementation.
OUT : -


=head2 ConvertToFrequency

 $self->ConvertToFrequency();

SUBROUTINE  : ConvertToFrequency
DESCRIPTION : Converts a list of ARFCNs to a frequency list.

IN  : 1. @ARFCNsList    -> List of ARFCNs.
OUT : 1. %FrequencyList -> Hash containing frequency lists.


=head2 DisconnectTG

 $self->DisconnectTG();

SUBROUTINE  : DisconnectTG
DESCRIPTION :

IN  : 1. $BTS -> Abisco connection object.
      2. $cb  -> Callback function implementation.
OUT : -


=head2 ExcludeTRXs

 $self->ExcludeTRXs();

SUBROUTINE  : ExcludeTRXs
DESCRIPTION : Exclude TRXs of nTRU type from LTS setup.

IN  : 1. $TG                -> TG number from which the TRXs
                               are to be excluded.
      2. @TRXTypeList       -> List of TRX types.
OUT : 1. %TRXCHash (Global) -> TRXC hash.


=head2 FAS_Reconfig

 $self->FAS_Reconfig();

SUBROUTINE  : FAS_Reconfig
DESCRIPTION : Reconfiguration of FAS for RBS2000.

IN  : 1. $BTS      -> Abisco connection object.
      2. $FAS_TRXC -> TRXC for FAS.
      3. $cb       -> Callback function implementation.
OUT : -


=head2 FixConfig

 $self->FixConfig();

SUBROUTINE  : FixConfig
DESCRIPTION :

IN  : 1. $BTS -> Abisco connection object.
      2. $cb  -> Callback function implementation.
OUT : -
CR6570: Make a standalone version of ltssetup.
Date: 2010-04-14
CR Fix: set $SendToServer to On if running in ltssetup mode


=head2 GenerateFrequencyList

 $self->GenerateFrequencyList();

SUBROUTINE  : GenerateFrequencyList
DESCRIPTION : Generates a valid frequency list based on the frequency
              band, hopping and the employed ARFCNs.

IN  : 1. $FrequencyBand -> Frequency band.
      2. $Hopping       -> Hopping.
      3. @UsedARFCNs    -> List of used ARFCNs.
OUT : 1. $NoOfARFCN     -> Number of ARFCNs.
      2. %FrequencyList -> Hash containing the frequency lists.


=head2 GetAbiscoRevision

 $self->GetAbiscoRevision();

SUBROUTINE  : GetAbiscoRevision
DESCRIPTION : Retrieves the Abisco revision.

IN  : 1. $BTS -> Abisco connection object.
      2. $cb  -> Callback function implementation.
OUT : -


=head2 Get_Cell

 $self->Get_Cell();

SUBROUTINE  : Get_Cell
DESCRIPTION : Get cell with indicated routing (defaults taken from the
              predefined globals). Returns a CH InfoCellResponse
              message hash (or pointer to it in scalar context).
              Example
                Get_Cell($BTS, TG => $TG, TRXC => $TRXC, sub {
                           ...
                         });

IN  : 1. $BTS      -> Abisco connection object.
      2. TG        -> Routing parameters - TG
                       (Refer to example above)
      3. TRXC      -> Routing parameters - TRXC
      4. $cb       -> Callback function implementation.
OUT : 1. $InfoCell -> A pointer to a CH InfoCellResponse
                      message hash.
         or
         undef     -> There are no cells with the specified
                      routing TRXC number under the specified
                      routing TG number.


=head2 Get_FAS_Reconfig_Param

 $self->Get_FAS_Reconfig_Param();

SUBROUTINE  : Get_FAS_Reconfig_Param
DESCRIPTION : Get reconfiguration parameters for FAS.

IN  : 1. {%TG}     -> Reference to TG hash that was already
                      initialized (by running GetTGData()
                      in TP_Support).
OUT : 1. $FAS_TRXC -> TRXC for FAS.


=head2 Get_TG_List

 $self->Get_TG_List();

SUBROUTINE  : Get_TG_List
DESCRIPTION :

IN  : 1. $BTS    -> Abisco connection object.
      2. $cb     -> Callback function implementation.
OUT : 1. @TGList -> List of TGs.


=head2 Get_TRXC_List

 $self->Get_TRXC_List();

SUBROUTINE  : Get_TRXC_List
DESCRIPTION : Get list of all TRXCs in one TG (all cells). Uses the
              predefined global $TG if no argument is given.
              Example
                Get_TRXC_List($BTS, $TG_Number, sub {
                                @TRXCs = @_;
                              });
IN  : A hash with the following hash-key(s):
      1. $BTS       -> Abisco connection object.
      2. $TG_Number -> TG number from which the TRXC list
                       is to be obtained from.
      3. $cb        -> Callback function implementation.
OUT : 1. @TRXCs     -> List of TRXCs.


=head2 Get_TRX_ARFCNs

 $self->Get_TRX_ARFCNs();

SUBROUTINE  : Get_TRX_ARFCNs
DESCRIPTION : Get list of TX ARCFN numbers from indicated TRX (the
              list will have one element unless synth hopping is used).
              Example
                Get_TRX_ARFCNs($BTS, TG => 0, TRXC => 0, sub {
                                 @ARFCNs = @_;
                               });
IN  : A hash with the following hash-key(s):
      1. $BTS    -> Abisco connection object.
      2. $TG     -> TG (the routing parameters.)
      3. $TRXC   -> TRXC (the routing parameters.)
      4. $cb     -> Callback function implementation.
OUT : 1. @ARFCNs -> List of ARFCNs.


=head2 Get_TRX_ARFCNs200

 $self->Get_TRX_ARFCNs200();

SUBROUTINE  : Get_TRX_ARFCNs200
DESCRIPTION : Get list of TX ARCFN numbers from indicated TRX (the
              list will have one element unless synth hopping is used).
              Example
                Get_TRX_ARFCNs200($BTS, TG => 0, TRXC => 0, sub {
                                    @ARFCNs = @_;
                                  });
IN  : A hash with the following hash-key(s):
      1. $BTS    -> Abisco connection object.
      2. $TG     -> TG (the routing parameters.)
      3. $TRXC   -> TRXC (the routing parameters.)
      4. $cb     -> Callback function implementation.
OUT : 1. @ARFCNs -> List of ARFCNs.


=head2 Get_TS_Config

 $self->Get_TS_Config();

SUBROUTINE  : Get_TS_Config
DESCRIPTION : Sets up a hash of Channel combinations for all TS.

IN  : 1. $BTS -> Abisco connection object.
      2. $cb  -> Callback function implementation.
OUT : -


=head2 MemberOfArray

 $self->MemberOfArray();

SUBROUTINE  : MemberOfArray
DESCRIPTION : Checks if $Value is member of @Array.

IN  : 1. $Value -> Value.
      2. @Array -> Array.
OUT : 1. $1     -> Returns 1 if $Value is member of @Array,
                    0 otherwise.


=head2 OM2000_Defaults

 $self->OM2000_Defaults();

SUBROUTINE  : OM2000_Defaults
DESCRIPTION : Set OM2000 loop parameters unless they are already set
              (either long or shortname).

IN  : 1. \%Msg -> OM2000 message hash (or empty hash if you
                  only want the defaults).
OUT : 1. \%Msg -> Updated message (the original is also
                  updated in place).
         or
         %Msg  -> In list context.


=head2 OpenConfigLoad

 $self->OpenConfigLoad();

SUBROUTINE  : OpenConfigLoad
DESCRIPTION : Opens LTS Config Load file.

IN  : 1. $File -> File path.
OUT : 1. "OK" or "ERROR".
      2. @ConfigLoad (Global).


=head2 OpenLog

 $self->OpenLog();

SUBROUTINE  : OpenLog
DESCRIPTION : Initiate the LTSSetup log file.

IN  : 1. $Create -> One of:
                     0 - Append if the log file exists, else create a new one.
                     1 - Overwrite if the log file exists, else create a new one.
OUT : -


=head2 Prompt

 $self->Prompt();

SUBROUTINE  : Prompt
DESCRIPTION : Prompts for user response.

IN  : 1. $Message   -> Message.
      2. $Default   -> Default answer.
      3. [@Options] -> Reference to a list of options.
      4. $timeOut   -> Timeout in seconds after which the
                       prompt stops waiting for a user input
                       and sets $Answer=$Default.
OUT : 1. $Answer    -> Answer.


=head2 ReadAndLoadConfig

 $self->ReadAndLoadConfig();

SUBROUTINE  : ReadAndLoadConfig
DESCRIPTION : Reads the abisco config from the file specified and
              applies the configuration.

IN  : 1. $BTS                 -> Abisco connection object.
      2. $ABISCOConfiguration -> Path to Abisco configuration file.
      3. $cb                  -> Callback function implementation.
OUT : -


=head2 RecursiveCheckEachTG

 $self->RecursiveCheckEachTG();

SUBROUTINE  : RecursiveCheckEachTG
DESCRIPTION :

IN  : 1. $BTS    -> Abisco connection object.
      2. [@TG]   -> Reference to a list of TGs to be checked
                    and verified.
      3. $Errors -> Error count.
      4. $cb     -> Callback function implementation.
OUT : 1. $Errors -> Error count.


=head2 RecursiveCheckEachTGCell

 $self->RecursiveCheckEachTGCell();

SUBROUTINE  : RecursiveCheckEachTGCell
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $BTS                -> Abisco connection object.
      2. $TG        -> Current TG number.
      3. [@Cell]    -> Reference to a list of cells to be
                       checked and verified.
      4. $CellCount -> Number of cells that have been checked so far.
      5. $Errors    -> Error count.
      6. $BSPowerFirstCell   -> the first BS power cell
      7. $BCCHFirstCell      -> the first BCCH cell
      7. $NeighbourFirstCell -> Neighbour ARFCN first cell
      8. $Type1              -> Type for Printout (example TG0/Cell0), first
                                cell.
      9. $cb                 -> Callback function implementation.
OUT : 1. $Errors    -> Error count.


=head2 RecursiveConnectTG

 $self->RecursiveConnectTG();

SUBROUTINE  : RecursiveConnectTG
DESCRIPTION :

IN  : 1. $BTS  -> Abisco connection object.
      2. [@TG] -> Reference to a list of TGs to be connected.
      3. $cb   -> Callback function implementation.
OUT : -


=head2 RecursiveDisconnectTG

 $self->RecursiveDisconnectTG();

SUBROUTINE  : RecursiveDisconnectTG
DESCRIPTION :

IN  : 1. $BTS  -> Abisco connection object.
      2. [@TG] -> Reference to a list of TGs to be disconnected.
      3. $cb   -> Callback function implementation.
OUT : -


=head2 RecursiveFindEachTG

 $self->RecursiveFindEachTG();

SUBROUTINE  : RecursiveFindEachTG
DESCRIPTION :

IN  : 1. $BTS          -> Abisco connection object.
      2. [@TGHashKeys] -> Reference to a list of TG hash-keys.
      3. $cb           -> Callback function implementation.
OUT : -


=head2 RecursiveFindEachTRXC

 $self->RecursiveFindEachTRXC();

SUBROUTINE  : RecursiveFindEachTRXC
DESCRIPTION :

IN  : 1. $BTS            -> Abisco connection object.
      2. $TG             -> TG number.
      3. [@TRXCHashKeys] -> Reference to a list of TRXC hash-keys.
      4. $cb             -> Callback function implementation.
OUT : -


=head2 RecursiveLoadConfig

 $self->RecursiveLoadConfig();

SUBROUTINE  : RecursiveLoadConfig
DESCRIPTION : Applies the configuration commands line-by-line
              in recursive fashion.

IN  : 1. $BTS       -> Abisco connection object.
      2. [@Command] -> Reference to a list of commands read
                       line-by-line from the configuration file.
      3. rTG        -> Reference of TG Hash.
      4. $cb        -> Callback function implementation.
OUT : -


=head2 Recursive_Get_Cell

 $self->Recursive_Get_Cell();

SUBROUTINE  : Recursive_Get_Cell
DESCRIPTION :

IN  : 1. $BTS      -> Abisco connection object.
      2. $Msg      -> Reference to a message hash containing
                      defaults taken from the predefined globals.
      3. [@Cell]   -> Reference to a list of cells.
      4. $cb       -> Callback function implementation.
OUT : 1. $InfoCell -> Reference to a CH InfoCellResponse
                      message hash.
      2. $isMatch  -> Boolean indicating whether the specified
                      routing TRXC matches one of the TRXs
                      found in the specified TG and cell number.


=head2 Recursive_Get_TRXC_List

 $self->Recursive_Get_TRXC_List();

SUBROUTINE  : Recursive_Get_TRXC_List
DESCRIPTION : Get list of all TRXCs by recursively checking every cell
              in the specified TG.

IN  : 1. $BTS       -> Abisco connection object.
      2. $TG_Number -> TG number from which the TRXC list
                       is to be obtained from.
      3. [@Cells]   -> Reference to a list of cells.
      4. [@TRXCs]   -> Reference to a list of TRXCs.
      5. $cb        -> Callback function implementation.
OUT : 1. @TRXCs     -> List of TRXCs.


=head2 Recursive_TS_Reconfig_Each_TG

 $self->Recursive_TS_Reconfig_Each_TG();

SUBROUTINE  : Recursive_TS_Reconfig_Each_TG
DESCRIPTION :

IN  : 1. $BTS          -> Abisco connection object.
      2. [@TGHashKeys] -> Reference to a list of TG hash-keys.
      3. $SendToServer -> On or Off.
      4. $cb           -> Callback function implementation.
OUT : -


=head2 Recursive_TS_Reconfig_Each_TRXC

 $self->Recursive_TS_Reconfig_Each_TRXC();

SUBROUTINE  : Recursive_TS_Reconfig_Each_TRXC
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1.  $BTS            -> Abisco connection object.
      2.  $TG             -> TG number.
      3.  [@TRXCHashKeys] -> Reference to a list of TRXC hash-keys.
      4.  $SendToServer   -> On or Off.
      5.  [@TCH_Config]   -> Reference to a list of TCH configurations.
      6.  [@TRXType]      -> Reference to a list of TRX types.
      7.  $AbisIWDNum     -> Abisco IWD number.
      8.  $JitterSize     -> Jitter size.
      9.  $PackingAlg     -> Packing algorithm.
      10. $cb             -> Callback function implementation.
OUT : -


=head2 Recursive_TS_Reconfig_Each_TS

 $self->Recursive_TS_Reconfig_Each_TS();

SUBROUTINE  : Recursive_TS_Reconfig_Each_TS
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1.  $BTS          -> Abisco connection object.
      2.  $TG           -> TG number.
      3.  $TRXC         -> TRXC number.
      4.  [@TSHashKeys] -> Reference to a list of TS hash keys.
      5.  $SendToServer -> On or Off.
      6.  [@TCH_Config] -> Reference to a list of TCH configurations.
      7.  [@TRXType]    -> Reference to a list of TRX types.
      8.  $AbisIWDNum   -> Abisco IWD number.
      9.  $JitterSize   -> Jitter size.
      10. $PackingAlg   -> Packing algorithm.
      11. $IntTLSA      -> Transcoder alarm in active mode.
      12. $cb           -> Callback function implementation.
OUT : -


=head2 RemoveFromArray

 $self->RemoveFromArray();

SUBROUTINE  : RemoveFromArray
DESCRIPTION : Removes the element $Remove from array @Array.

IN  : 1. $Remove -> Element to remove.
OUT : 1. @Array  -> The resulting array.


=head2 ReturnNumeric

 $self->ReturnNumeric();

SUBROUTINE  : ReturnNumeric
DESCRIPTION : Filters out numeric digits from a string.

IN  : 1. $Line         -> A string.
OUT : 1. $Numeric      -> One of:
                           0 - No numeric characters found.
                           1 - Only numeric characters found.
      2. $NumericValue -> Space filtered out.


=head2 SendSysInfo

 $self->SendSysInfo();

SUBROUTINE  : SendSysInfo
DESCRIPTION :

IN  : 1. $BTS          -> Abisco connection object.
      2. $TG           -> TG number.
      3. $TRXC         -> TRXC number.
      4. $SendToServer -> On or Off.
      5. $cb           -> Callback function implementation.
OUT : -


=head2 SendSysInfo2

 $self->SendSysInfo2();

SUBROUTINE  : SendSysInfo2
DESCRIPTION : Continuation from SendSysInfo.

IN  : A hash with the following hash-key(s):
      1. $BTS          -> Abisco connection object.
      2. $TG           -> TG number.
      3. $TRXC         -> TRXC number.
      4. $SendToServer -> On or Off.
      5. $UNACK_Resp   -> The Abisco response message
                          'UNACKNOWLEDGED_MESSAGE_SENT'.
      6. $cb           -> Callback function implementation.
OUT : -


=head2 SendSysInfoForeachTGNumber

 $self->SendSysInfoForeachTGNumber();

SUBROUTINE  : SendSysInfoForeachTGNumber
DESCRIPTION :

IN  : 1. $BTS          -> Abisco connection object.
      2. [@TG]         -> Reference to a list of TGs.
      3. [@TRXC]       -> Reference to a list of TRXCs.
      4. $SendToServer -> On or Off.
      5. $cb           -> Callback function implementation.
OUT : -


=head2 SendSysInfoForeachTRXCNumber

 $self->SendSysInfoForeachTRXCNumber();

SUBROUTINE  : SendSysInfoForeachTRXCNumber
DESCRIPTION :

IN  : 1. $BTS          -> Abisco connection object.
      2. $TGNumber     -> TG number.
      3. [@TRXC]       -> Reference to a list of TRXCs.
      4. $SendToServer -> On or Off.
      5. $cb           -> Callback function implementation.
OUT : -


=head2 SetDefault

 $self->SetDefault();

SUBROUTINE  : SetDefault
DESCRIPTION : Set a default from list if parameter is undefined.

IN  : 1. $1 -> Parameter to set.
      2. @2 -> Default values, tried left to right until not undef.
OUT : 1. $1 -> Updated if it was undef.


=head2 Set_BG_Reporting

 $self->Set_BG_Reporting();

SUBROUTINE  : Set_BG_Reporting
DESCRIPTION : Deactivates BG reporting for RFRI, IAS and TRX.

IN  : 1. $BTS -> Abisco connection object.
      2. $cb  -> Callback function implementation.
OUT : -


=head2 TS_Reconfig

 $self->TS_Reconfig();

SUBROUTINE  : TS_Reconfig
DESCRIPTION : Sends TS Config Request and System Information.

IN  : Requires that sub Get_TS_Config has been called.
      1. $BTS          -> Abisco connection object.
      2. $SendToServer -> On or Off.
      3. $cb           -> Callback function implementation.
OUT : -


=head2 TS_Reconfig_ChComb

 $self->TS_Reconfig_ChComb();

SUBROUTINE  : TS_Reconfig_ChComb
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1.  $BTS          -> Abisco connection object.
      2.  $TG           -> TG number.
      3.  $TRXC         -> TRXC number.
      4.  $TS           -> TS number.
      5.  $SendToServer -> On or Off.
      6.  [@TCH_Config] -> Reference to a list of TCH configurations.
      7.  [@TRXType]    -> Reference to a list of TRX types.
      8.  $AbisIWDNum   -> Abisco IWD number.
      9.  $JitterSize   -> Jitter size.
      10. $PackingAlg   -> Packing algorithm.
      11. $IntTLSA      -> Transcoder alarm in active mode.
      12. $ChComb       -> CH combination.
      13. $cb           -> Callback function implementation.
OUT : -


=head2 TS_Reconfig_EnableRequest

 $self->TS_Reconfig_EnableRequest();

SUBROUTINE  : TS_Reconfig_EnableRequest
DESCRIPTION :

IN  : A hash with the following hash-key(s):
      1. $BTS          -> Abisco connection object.
      2. $TG           -> TG number.
      3. $TRXC         -> TRXC number.
      4. $TS           -> TS number.
      5. $SendToServer -> On or Off.
      6. $cb           -> Callback function implementation.
OUT : -


=head2 numerically

 $self->numerically();

SUBROUTINE  : numerically
DESCRIPTION : Used for numerical sort.

IN  : -
OUT : -



=cut

=head1 NAME

Msg


=head1 DESCRIPTION

Document number: 4/190 55-CAH 161 1290/1 Uen
MODULE      : Msg.pm
DESCRIPTION : Operations on message-hashes which are a native Perl
              representation of a complete ABISCO message. This package
              knows about the ABISCO syntax and can convert into and out of
              it. The mapping is more or less one-to-one: ABISCO parameter
              names become hash keys (N.B. case sensitive), and values
              become hash values. The special keys 'Server' and 'Message'
              refer to the ABISCO server name and the name of the ABISCO
              command/response. Substructures (e.g. Routing) are mapped onto
              sub-hashes. ABISCO arrays become Perl arrays. Integers, enums
              and strings become scalars.  Abisco strings have to be
              explicitly stripped of quotes, see 'Strip'. See any test
              program for numerous examples.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV  DATE       NAME                    REVIEW    COMMENT
P1A  990728     QRAJRHD                           Created from stuff out of User and
                                                  Abisco_Connection.
P1B  990804     QRAJRHD                           Cleaned and shaved for code review
P1C  990805     QRAJRHD                           Updated with review comments
P1D  990815     QRAJRHD                           Pack ruined its input hash
P1E  990824     QRAJRHD                           Temp-fix: allow leading underscore in
                                                  enum.
P1F  991001     QRAJRHD                           List of expected's in Assert and value
                                                  wildcard '*', ...
P1G  991008     QRAJRHD                           Allow spaces around '='
P1H  991015     QRAJRHD                           Migrating from 'Function' to 'Message'
P2H  991021     QRAJRHD                           Preserve input hash in Pack
P2I  991104     QRAJRHD                           Modified messages from Assert
P2J  991214     QRAJRHD                           Assert failed when array element was a
                                                  choice list.
P2K  991214     QRAJRHD                           Assert not exported, use front-end in
                                                  Abisco_Connection.
P2L  000403     QRAJRHD                           Made Strip work on lists
P2M  000413     QRAJRHD                           Pack nested array parameters with
                                                  surrounding quotes.
P2O  000502     QRAJRHD                           No double quotes in strings (MMI
                                                  workaround).
P2P  000512     QRAJRHD                           Pack/unpack nested array parameters
                                                  properly.
P2Q  000605     QRAJRHD                           Strip hashes too
P2R  000616     QRAJRHD                           String-quote un-packable pointers in
                                                  messages.
P2S  000823     QRAJRHD                           Ignore undef in 'Strip' and let
                                                   'Pack_Args' take msg ptr.
P2T  000824     QRAJRHD                            Let 'Str' handle lists
P2U  000922     QRAJRHD                            H'1E parsed as string
P2V  001102     QRAJRHD                            Pack scalar pointer like scalar
                                                   (unsupported by Abisco).
P2X  001204     QRAJRHD                            Let 'Normalize' handle hashes as well
P2Y  010125     QRAJRHD                            Allow msg name "0"
P2Z  010206     ERAABAY                            No more support for 'Function', use
                                                   'Message'.
P2AA 110407     ETORWIL                            Changed Pack_Args to sort keys
                XDAVMEL                            Implemented use strict and use warnings
                                                   (quality improvement).
A    20110905   XLEIMAR                 ETORWIL    Updated according to new template
                                                   Perlcritic.
                                                   Bugfix in Unpack_Value.
B    20130703   Syntronic AB/           EDAMELI    Modified for Code Optimisation
                Adibah

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<letter> 

L<English> 

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 Assert

 Assert();

SUBROUTINE  : Assert
DESCRIPTION : Take two hashes and make sure all values in the second
              list (required) are equal to the corresponding values in the
              first list (actual). Items only in the actual list are ignored.

              A value of '*' matches anything and only the name (hash-key)
              is checked.

              In order to create a logical 'or' you may also submit a list
              of possible expected-patterns within square brackets. This
              notation may also be used anywhere in an 'expected' pattern to
              specify more than one acceptable value shown with  the 'Pn'
              parameter below.

              E.G.:
                %ChactRes = $BTS->Do(Fun => Chact_Normal,
                                     Pn  => 3);
                Assert(\%ChactRes, {Message => Ack,
                                    Pn      => [1,2,3],
                                    Status  => OK}
                      );

IN  : $1 - Values to check (scalar or ref to hash or array)
      $2 - Required Values (ditto). If $2 is absent $1 must be true.
OUT : None (dies on mismatches)


=head2 Choice

 Choice();

SUBROUTINE  : Choice
DESCRIPTION : Determine whether Assert was given a list of choices

IN  : $1 - Values to check (scalar or ref to hash or array)
      $2 - Expected Values (ditto)
OUT : True if it was a choice list


=head2 Is_Str

 Is_Str();

SUBROUTINE  : Is_Str
DESCRIPTION : Return true iff input is an ABISCO string.
              Not tested yet!

IN  : $1 - Scalar which might be an ABISCO string
OUT : $1 - True if and only if input was a string


=head2 Normalize

 Normalize();

SUBROUTINE  : Normalize
DESCRIPTION : Capitalize first character in all identifiers and words
              within an identifier. ABISCO strings are not affected. E.g:
              'TRAFFRN.mode_modify' becomes 'Traffrn.Mode_Modify'.

IN  :     $1 - String
      or \%1 - A hash (string values are left intact)
OUT :     $1 - Converted string,
      or  %1 - A normalized hash ...
      or \%1 - ... a reference to it in scalar context


=head2 Pack

 Pack();

SUBROUTINE  : Pack
DESCRIPTION : Convert call hash to ABISCO command string

IN  :  \%1 - Reference to hash representing Abisco call
        $2 - Pretty print if true
OUT : Hash converted to string


=head2 Pack_Args

 Pack_Args();

SUBROUTINE  : Pack_Args
DESCRIPTION : Convert hash of name/value pairs to Abisco argument
              string (auxiliary to Pack). Ignore pseudo-args (Server etc...)

IN  : $1 - String to prefix each name with (substructures)
      $2 - Hash representing Abisco call arguments
      $3 - Pretty print if set (to anything)
OUT : None


=head2 Pack_Value

 Pack_Value();

SUBROUTINE  : Pack_Value
DESCRIPTION : Convert the value side of a name=value pair to string,
              (auxiliary to Pack_Args).

IN  : \@1 - A value to convert, plain scalar or scalar/array pointer
OUT :  $1 - Input argument in string form


=head2 Str

 Str();

SUBROUTINE  : Str
DESCRIPTION : Convert from Perl to ABISCO string

IN  :    $1 - One Perl string
      or @1 - List of Perl strings
OUT :    $1 - Converted copy of the input (the original is not changed)
      or @1 - Converted list (the original is unchanged)


=head2 Strip

 Strip();

SUBROUTINE  : Strip
DESCRIPTION : Convert from ABISCO to perl string. Remove surrounding
              and doubled double quotes. Non-strings are returned without
              change. The string is assumed to have been parsed OK.

IN  :    $1 - ABISCO string
      or @1 - A list of ABISCO strings
      or %1 - A list of ABISCO strings
OUT : 1 - The input converted to perl string (the input is not changed)


=head2 Strip_All

 Strip_All();

SUBROUTINE  : Strip_All
DESCRIPTION : Convert all ABISCO strings to native format

IN  : \$1 - Call hash
OUT : \$1 with strings stripped


=head2 To_Hash

 To_Hash();

SUBROUTINE  : To_Hash
DESCRIPTION : Concatenate hashes, lists or scalars and return hash.
              Later hash entries will overwrite earlier ones.

IN  : Anything, any even no. of arguments
OUT : Resulting hash


=head2 Unpack

 Unpack();

SUBROUTINE  : Unpack
DESCRIPTION : Convert ABISCO command string to msg hash.  This is
              the exact reverse of Pack.

IN  : $1 - Abisco response string
OUT :     %1 - Message hash
      or \%1 - in scalar context


=head2 Unpack_Value

 Unpack_Value();

DESCRIPTION: Parse an argument value (auxiliary to Unpack).
IN:  $1 - String starting with a value (no spaces)
          The value is consumed in the callers string.
     $2 - Optional radix, 'H', 'O', 'B'. Default is decimal.
OUT: Perl scalar (int, enum or string) or array
     The value is taken off the input string



=cut

=head1 NAME

mssim


=head1 DESCRIPTION

Document number: 24/190 55-CAH 161 1290/1 Uen
MODULE      : mssim.pm
DESCRIPTION : Interface routines to the PRISMA mssim mobile simulator.
              See MSSIM User's Guide 3/198 17-FCD 201 33 Uen

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A   080526  ESTEMOH             Created
P1B   081117  ESTEMOH             Updated
P1C   081209  ESTEMOH             Added subroutine mssimLogOnOff.
                                   Corrections for "package".
P1D   090313  ESTEMOH             Fixed timeout bug in mssimGetSeveral
P1E   090520  ESTEMOH             Added mssimOpenWLog, mssimReadWLog and
                                   mssimCloseWLog.
P1F   090616  ESTEMOH             Added mssimStartWLog and mssimWaitWLog
P1G   090808  ESTEMOH             Changed Tethereal to Tshark
P1H   091013  ERATZIS             Moved mssimOpenWLog, mssimReadWLog,
                                   mssimCloseWLog, mssimStartWLog,
                                   mssimWaitWLog to module wireshark.pm
                                   (with new names!).
P1J   110408  XDAVMEL             Fixed bug in mssimAssert (for printing
                                   Error code and reason). Updated
                                   mssimLogPref (now you only need to send
                                   HashKey to modify).
A   20110923  XLEIMAR   ETORWIL   Approved for release in Abisco R37A
                                   HO29390: Fixed issues found in mssimPack (how to
                                   pack -1 in unsigned varibles and undefs).
                                   HO43422: PerlCritic
                                            Added use strict
                                            Added use warnings
                                            Added use diagnostics
                                   Removed lexical def of var @Spont in
                                    subroutine mssimGetSeveral.
                                   Added check for an undefined value in
                                    subroutine mssimGet.
B   20111018  ETORWIL   EANSKAT   Enabled diagnostics.
C   20120103  ETORWIL   XTOBSEM   Approved for release in Abisco R38A
                                   Updated mssimUnpack to avoid warnings
                                   Updated ReceiveTCP_IP and mssimGet to improve buffer handling.
D   20120706  XNAVNAS   XSOFFRO   Solved TR HQ17411 (change in mssimPack).

Note that on 2011-09-23 the revision style was changed to A, B and so on.


=head1 REQUIRES

L<Socket> 

L<IO::Handle> 

L<mssim_def> 

L<Hash::Util> 

L<User> Used for Abisco logging

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 InitRESP

 InitRESP();

SUBROUTINE  : InitRESP
DESCRIPTION : To initialize the %RESPHash

IN  : Primitive
      Result Code
OUT : %RESP hash


=head2 ReceiveTCP_IP

 ReceiveTCP_IP();

SUBROUTINE  : ReceiveTCP_IP
DESCRIPTION : To receive a message from MSSIM over TCP/IP.
              If timeout an Error code is returned.

IN  : Timeout value
OUT : 0=DataReceived 1=Timeout
      Received buffer


=head2 mssimAssert

 mssimAssert();

SUBROUTINE  : mssimAssert
DESCRIPTION : Check Error response from MSSIM

IN  : Addr to RESP Hash
      Addr to Message Hash
OUT : None, croaks if an error is found


=head2 mssimClearSpont

 mssimClearSpont();

SUBROUTINE  : mssimClearSpont
DESCRIPTION : Clear spont buffer

IN  : None
OUT : None


=head2 mssimConnect

 mssimConnect();

SUBROUTINE  : mssimConnect
DESCRIPTION : Set up TCP/IP connection to LSU/MSSIM.
              Retuns an error code if connect fails

IN  : %REQ{IP} (IP address)
      %REQ{Port}
OUT : %RESP{Result}
      %RESP{Reason}


=head2 mssimConvString

 mssimConvString();

SUBROUTINE  : mssimConvString
DESCRIPTION : To convert a string to numeric decimal and numeric hexadecimal

IN  : String
OUT : Numeric strig
      Hexadecimal string


=head2 mssimDisconnect

 mssimDisconnect();

SUBROUTINE  : mssimDisConnect
DESCRIPTION : Disconnect TCP/IP connection to LSU/MSSIM.

IN  : %REQ{IP}  (IP address)
      %REQ{Port}
OUT : %RESP{Result}
      %RESP{Reason}


=head2 mssimDo

 mssimDo();

SUBROUTINE  : mssimDo
DESCRIPTION : To send a message to MSSIM over TCP/IP.

IN  : %REQ       (Unpacked message to send)
OUT : %RESP      (Received unpacked message)


=head2 mssimGet

 mssimGet();

SUBROUTINE  : mssimGet
DESCRIPTION : To receive a message from MSSIM over TCP/IP.
              If timeout an Error code is returned.

IN  : %REQ{Timeout}      (Optional)
OUT : %RESP              (Response)


=head2 mssimGetErrTxt

 mssimGetErrTxt();

SUBROUTINE  : mssimGetErrTxt
DESCRIPTION : To get Error Text for a specific Error Code


IN  : Error Code (from any REJECT_IND or ERROR_IND)
      SAP Identifier
OUT : Error Text


=head2 mssimGetErrTxtLAPDm

 mssimGetErrTxtLAPDm();

SUBROUTINE  : mssimGetErrTxtLAPDm
DESCRIPTION : To get Error Text for a specific LAPDm Error Code

IN  : Error Code (from lapdm primitive)
OUT : Error Text


=head2 mssimGetLog

 mssimGetLog();

SUBROUTINE  : mssimGetLog
DESCRIPTION : To get Log Records

IN  : Record Number
OUT : Status (0=OK, 1=No record)
      Primitive Name
      Decoded Message
      Hexadecimal message
      Decimal message


=head2 mssimGetSeveral

 mssimGetSeveral();

SUBROUTINE  : mssimGetSeveral
DESCRIPTION : To receive several messages from MSSIM. Returns if timeout or
              when any of the messages defined in the "Until" parameter is
              received. Spontanious messages received are stored and can be
              received later by the mssimGetSpont routine.

IN  : %REQ{Timeout}     (Timeout value in seconds)
      %REQ{Until}       (Messages to wwait for)
OUT : $ReceivedSpont    (Number of spontanious messages stored)
      %RESP             (as received from mssimGet)


=head2 mssimGetSpont

 mssimGetSpont();

SUBROUTINE  : mssimGetSpont
DESCRIPTION : To receive previously stored spontanious messages

IN  : None
OUT : Number of remaining messages
      %RESP (as received from mssimGet)


=head2 mssimGetTemplateLength

 mssimGetTemplateLength();

SUBROUTINE  : mssimGetTemplateLength
DESCRIPTION : To return the length of a specific pack template parameter

IN  : Template
OUT : Length


=head2 mssimLog

 mssimLog();

SUBROUTINE  : mssimLog
DESCRIPTION : To log communication to/from mssim

IN  : Text string to log
OUT : None


=head2 mssimLogMsg

 mssimLogMsg();

SUBROUTINE  : mssimLogMsg
DESCRIPTION : To log an MSSIM message. It is logged in decoded format,
              in HEX format and in decimal format.

IN  : Decoded Log Buffer
      Undecoded Buffer
OUT : None


=head2 mssimLogOnOff

 mssimLogOnOff();

SUBROUTINE  : mssimLogOnOff
DESCRIPTION : To enable or disable logging

IN  : Status (On or Off)
OUT : None


=head2 mssimLogPref

 mssimLogPref();

SUBROUTINE  : mssimLogPref
DESCRIPTION : To set loggging preferences

IN  : Record Number
OUT : Status (0=OK, 1=No record)
      Primitive Name
      Decoded Message
      Hexadecimal message
      Decimal message


=head2 mssimPack

 mssimPack();

SUBROUTINE  : mssimPack
DESCRIPTION : To pack a message before sending to MSSIM.

IN  : $RESP{Server}
      $RESP{Message}
      $RESP{SAP}
      $RESP{Length}
      Other parameters depending on actual message
OUT : Buffer to transmit to MSSIM


=head2 mssimPrepareUnpack

 mssimPrepareUnpack();

SUBROUTINE  : mssimPrepareUnpack
DESCRIPTION : To setup the parameters for unpack of an array

IN  : Template
      Buffer to unpack (total buffer)
      Actual Start position
      Previous parameter
OUT : Template updated with length
      Buffet including only the parameter to unpack
      Length of variable length field


=head2 mssimPut

 mssimPut();

SUBROUTINE  : mssimPut
DESCRIPTION : To send a message to MSSIM over TCP/IP.

IN  : %REQ        (Unpacked message to send)
OUT : None


=head2 mssimUnpack

 mssimUnpack();

SUBROUTINE  : mssimUnpack
DESCRIPTION : To unpack a received message from MSSIM. The routine
              mssimUnpackHeader is called to unpack the header.
              If it is not possible to unpack the messages, the response
              as received from mssimUnpackHeader is returned.

IN  : Received Buffer from MSSIM
      Log 0=no logging, 1=logging
OUT : $RESP{Result}
      $RESP{Reason}
      $RESP{Server}
      $RESP{Message}
      $RESP{SAP}
      $RESP{Length}
      Other parameters depending on actual message


=head2 mssimUnpackHeader

 mssimUnpackHeader();

SUBROUTINE  : mssimUnpackHeader
DESCRIPTION : To unpack the header in a received message from MSSIM

IN  : Received Buffer from MSSIM
OUT : $Found (1=Found, 0=Not found)
      $SAP (Test)
      $Primitive (text)
      $Length



=cut

=head1 NAME

mssim_def


=head1 DESCRIPTION

Document number: 25/190 55-CAH 161 1290/1 Uen
MODULE      : mssim_def.pm
DESCRIPTION : Definitions for MSSIM. The first part of this file is fixed
              and defined in file mssim_def_base.pm. The second part including
              the %Primitives hash is automatically generated by the MSSIM
              pre-processor mssim_pp.pl. See MSSIM User's Guide 3/198 17-FCD 201 33 Uen.

              Included in mssim_def.pm package are:
              - $HeaderTemplate
              - $HeaderLength
              - %SAPDef           SAP definitions according to "GSM Base package"
              - %mssimC{gsmbSrv}  Codes for gsmbSRV according to "GSM Base package"
              - %mssimC{lapdm}    Codes for lapdm according to "GSM Base package"
              - %mssimC{gsmph}    Codes for gsmph according to "GSM Base package"
              - %mssimC{gsmapp}   Codes for gsmapp according to "GSM Base package"
              - %mssimEC{gsmbSrv} Error Codes for gsmbSRV according to "GSM Base package"
              - %mssimEC{lapdm}   Error Codes for lapdm according to "GSM Base package"
              - %mssimEC{gsmph}   Error Codes for gsmph according to "GSM Base package"
              - %mssimEC{gsmapp}  Error Codes for gsmapp according to "GSM Base package"
              - %mssimEC_LAPDm    Error Codes for lapdm (3GPP 44.006) according to "GSM Base package"
              - %mssimResult      Internal API Result Codes
              - %Primitives       Primitive definitions according to "GSM Base package"

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE     NAME     REVIEW    COMMENT
P1A   080526 ESTEMOH            Created
P1B   081117 ESTEMOH            Updated to match rev 0.06 of GSM base package
P1C   081204 ESTEMOH            Added CSText
P1D   081211 ESTEMOH            Changed TxFName and RxFName to a64
P1E   090204 ESTEMOH            Updated to match rev 0.07 of GSM base package
P1F   090324 ESTEMOH            Updated to match rev 1.01 of GSM base package
P1G   090417 ESTEMOH            Updated to match rev 1.10 of GSM base package
P1H   090519 ESTEMOH            Updated with codes for Log analyze
P1J   090615 ESTEMOH            Added error code ParamErr
P1K   090612 ESTEMOH            Changed codes for DAS and UAS
P1L   090623 ESTEMOH            Changed module header
P1M   090625 ESTEMOH            Updated to match rev 1.30 of GSM base package
P1N   090813 ESTEMOH            Updated to match rev 1.40 of GSM base package
P1O   090907 ESTEMOH            Updated to match rev 1.50 of GSM base package
P1P   090909 ESTEMOH            Changed textual definitions of Coding Schemes
P1Q   091014 ESTEMOH            Updated to match rev 1.60 of GSM base package
P1R   091019 ESTEMOH            Removed Wlog definitions
P1S   100908 ESTEMOH            Updated to match rev 2.01 of GSM base package
P1T   110222 ETOBVES            Changed gsmbSrvMS_SETATTR and gsmbSrvCELL_PARM_ACK
A   20110923 XTOBSEM ETORWIL    Approved for use in Abisco R37A
                                 Added gsmphMPH_CHN_SET_OPT_REQ and gsmphMPH_CHN_SET_OPT_CNF
                                 Updated to comply with CR HO43422, strict warnings and diagnostics
                                 Updated according to perlcritic.
B   20111018 ETORWIL EANSKAT    Enabled diagnostics. 

Note that on 2011-09-23 the revision style was changed to A, B and so on.


=head1 REQUIRES

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS


=cut

=head1 NAME

mssim_sub


=head1 DESCRIPTION

Document number: 26/190 55-CAH 161 1290/1 Uen
MODULE      : mssim_sub.pm
DESCRIPTION : High level interface routines to the PRISMA MSSIM mobile simulator.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 080827    ESTEMOH             Created
P1B 081017    ESTEMOH             Minor update
P1C 081117    ESTEMOH             Added subroutine mssimConnect
P1D 081204    ESTEMOH             Return cell in mssimConfig. Fix for HR speech.
P1E 081215    ESTEMOH             Corrections for "package"
P1F 081215    ESTEMOH             Clean Cell and Trx array
P1G 090227    ESTEMOH             Read InfoMSSIM from Abisco
P1H 090304    ESTEMOH             InfoMSSIM correction
P1J 090316    ERATZIS             mssimGetCHNParam addition; Bm_UNI and
                                   (Bm_BI + 'SecChannelMulti' Assign)
                                    have same ChnComb in MSSIM
P1K 090316    ESTEMOH             More mssimGetCHNParam additions in the Bm_BI/Bm_UNI case
P1L 090325    ESTEMOH             Updated for GSM base version 1.01
P1M 090428    ESTEMOH             Corrections for Frequency Hopping
P1N 090506    ESTEMOH             Changed Arfcn
P1O 090611    ESTEMOH             General refresh. Added mssimSetMSAttr and mssimReconfCCCH.
P1P 090622    ESTEMOH             Added Bm_BI for signalling in mssimGetCHNParam
P1Q 090623    ESTEMOH             Changed print statement in mssimConfig
P1R 090626    ESTEMOH             Changed RepSACCH to SacchOpt
P1S 090813    ESTEMOH             Logging of Type, SwVersion and CalibrationDate
P1T 090819    ESTEMOH             Wrong cell parameter, always zero
P1U 090903    ESTEMOH             Changed default value for Sens and Power
P1V 090928    ESTEMOH             Added Speech for Bm_Bi and Bm_Uni (mssimGetCHNParam)
P1Y 091005    ESTEMOH             Removed gsmphMPH_SET_ARFCN_REQ
P1Z 100112    ESTEMOH             Changed default timeout to 20 seconds
P2A 100420    ESTEMOH             Changed header comment for sub mssimGetCHNParam
P2B 100909    ESTEMOH             Updated to match rev 2.01 of GSM base package
P2C 100929    ESTEMOH             Added call to PrismaVersions
P2C 101006    ESTEMOH             mssimGetCHNParam modified for VAMOS
P2D 101119    XWIKMAR             mssimGetCHNParam modified to solve SDCCH issue
A   20110923  XGUSTPE   XOSKRON   Approved for delivery in Abisco R37A
                                   Updated according to CR HO43422, strict warning and diagnostics
                                   Updated mssimPrinSWVersions according to CR HO40646
                                   Added subroutine waitForCellSync HO63845
B   20111018  ETORWIL   EANSKAT   Enabled diagnostics.
C   20111027  XPRRANA   XNAVNAS   Added subroutine setFrequencyOffset HO44675
D   20111118  XLEIMAR   XNAVNAS   Changed mssimInit to print more readable error messages.
E   20111222  XDAVMEL   XTOBSEM   Release in R38A
                                   HP16117 Implemented catch of eval errors on every mssimAssert
                                    in order to print out more readable error messages.
                                   HP20627 Changed mssimGetARFCN and mssimGetCHNParam to
                                    use Cell number from infoTG
                                   HP24656 Fixed minor bug in mssimChangeMSAttr
F   20120530  EDAMELI   ETORWIL   Fixed bug in mssimGetARFCN and mssimGetCHNParam where CellNumber was hard coded
G   20121121  XANSBEM   XMAREDV   Added subroutine mssimCheckConnection and implemented mssimCheckConnection in
                                   mssimConfig. Ran Perl-Critic
H   20130430  XYNHAKS   XMAROHM   Update to cater for both IP address and host name.

Note that on 2011-09-23 the revision style was changed to A, B and so on.


=head1 REQUIRES

L<Net::Telnet> 

L<English> 

L<Hash::Util> 

L<PerlFunc> 

L<mssim_def> 

L<Carp> 

L<prismaversions> 

L<mssim> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 mssimChangeMSAttr

 mssimChangeMSAttr();

SUBROUTINE  : ChangeMSAttr
DESCRIPTION : To change the MS attributes

IN  : $REQ{MsId}        Mandatory
      $REQ{Cell}        Mandatory
      $REQ{BbAtt}       Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{Imsi}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{SacchOpt}    Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{Tmsi}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{Power}       Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{PowerSacch}  Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{TaAb}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{TaNb}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{TaSacch}     Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
OUT : None


=head2 mssimCheckConnection

 mssimCheckConnection();

SUBROUTINE  : mssimCheckConnection
DESCRIPTION : Control that Sensitivity, RFL and RMS values are within
               specified limits
IN  :
OUT :


=head2 mssimConfig

 mssimConfig();

SUBROUTINE  : mssimConfig
DESCRIPTION : To configure MSSIM.
              Read MSSIM Site info from Abisco, call mssimInit and mssimDefineCell
              Default values are used for parameters not defined in the %REQ hash

IN  : $MsId             Mandatory, MSSIM Mobile Id
      $TG               Mandatory, TG number in Abisco
      $TRXC             Mandatory, BCCH TRXC number in Abisco

      $REQ{Timeout}     Optional
      $REQ{Side}        Optional, see MSSIM gsmbSrvCONFIG command
      $REQ{MaxMs}       Optional, see MSSIM gsmbSrvCONFIG command
      $REQ{MaxPs}       Optional, see MSSIM gsmbSrvCONFIG command
      $REQ{MaxFile}     Optional, see MSSIM gsmbSrvCONFIG command
      $REQ{MaxFrm}      Optional, see MSSIM gsmbSrvCONFIG command
      $REQ{VamosII}     Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{BbAtt}       Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{Imsi}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{SacchOpt}    Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{Tmsi}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{Power}       Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{PowerSacch}  Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{TaAb}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{TaNb}        Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{TaSacch}     Optional, see MSSIM gsmbSrvMS_CREATE_CMD command
      $REQ{CcchConf}    Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{BsAgBlkRes}  Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{BsPaMfrms}   Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{CCauto}      Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltSI}       Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltPg}       Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltLapdm}    Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltUndec}    Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command

OUT : $Cell             MSSIM Cell number


=head2 mssimDefineCell

 mssimDefineCell();

SUBROUTINE  : mssimDefineCell
DESCRIPTION : To define a cell in the MSSIM with the following commands
              - gsmbSrvMS_CREATE_CMD
              - gsmphMPH_SET_ARFCN__REQ
              - gsmphMPH_CCCH_OPEN_REQ

IN  : %REQ hash including the following MANDATORY parameters:
      - Timeout   (Timeout in seconds to wait for response from MSSIM)
      - Cell      (Cell number)
      - MsId      (Array Mobile Identifier)
      - Trx       (Array with Trx numbers)
      - Arfcn     (Array with Arfcn numbers for each Trx)
      - See mssimConfig for other parameters
OUT : %RESP hash including:
      - Result    (0=OK, 1=Error)
      - Reson     (Reason for Error)


=head2 mssimGetARFCN

 mssimGetARFCN();

SUBROUTINE  : mssimGetARFCN
DESCRIPTION : To get the ARFCN number for a specific TRXC, only for non-hopping

IN  : TG
      TRXC
OUT : ARFCN (undef if hopping is used)


=head2 mssimGetCHNParam

 mssimGetCHNParam();

SUBROUTINE  : mssimGetCHNParam
DESCRIPTION : To get paramaters for the MSSIM Channel Activation requests
              gsmphMPH_CS_CHN_OPEN_REQ and gsmphMPH_PS_CHN_OPEN_REQ

IN  : %REQ hash including:
      - TG
      - TRXC
      - TS
      - PDCHMode (BTTI or RTTI)
      - ChActType (Channel Activation type, ActivationType in Abisco)
      - ChannelType   as defined for ChannelNo struct in Abisco ChannelActivation
      - TypeOfCh   as defined for ChannelMode struct in Abisco ChannelActivation
      - AlgOrRate   as defined for ChannelMode struct in Abisco ChannelActivation
      - AMRCodec
        0   = Not defined
        1   = 4.75 (GSM3) or 6.60 (GSM5)
        2   = 5.15 (GSM3) or 8.85 (GSM5)
        4   = 5.9  (GSM3) or 12.65 (GSM5)
        8   = 6.7  (GSM3)
        16  = 7.4  (GSM3)
        32  = 7.95 (GSM3)
        64  = 10.2 (GSM3)
        128 = 12.2 (GSM3)
OUT : %RESP hash including MSSIM Ch Act parameters:
      - Result    (0=OK, 1=Error)
      - Reson     (Reason for Error)
      - ChnComb   (Channel Combination for MSSIM)
      - ChnMain   (Main Channel for MSSIM)
      - Sub       (Subslot for MSSIM)
      - Tsc       (Training Sequence Code)
      - Narfcn    (Number hopping of ARFCN for MSSIM)
      - Fr        (ARFCN or MAIO/HSN for MSSIM)
      - Arfcn1    (ARFCN hopping list for MSSIM)


=head2 mssimGetDefaults

 mssimGetDefaults();

SUBROUTINE  : mssimGetDefaults
DESCRIPTION : To get a parameter value or a default value (internal use only)

IN  : %REQ hash
OUT : %REQ hash


=head2 mssimGetTrx

 mssimGetTrx();

SUBROUTINE  : mssimGetTrx
DESCRIPTION : To get Trx numbers from MSSIM Cell configuration

IN  : Cell number
OUT : @Trx


=head2 mssimInit

 mssimInit();

SUBROUTINE  : mssimInit
DESCRIPTION : To connect to MSSIM over TCP/IP and send the follwoing commands
              - gsmbSrvLOGIN_CMD
              - gsmbSrvCONFIG_CMD
              - gsmbSrvSTART_CMD

IN  : %REQ hash including the following MANDATORY parameters:
      - Timeout   (Timeout in seconds to wait for response from MSSIM)
      - IP        (IP address)
      - Port      (Port Number)
      - CliName   (Client Log Name)
      - CellList  (Array Cell numbers)
      - See mssimConfig for other parameters
OUT : %RESP hash including:
      - Result    (0=OK, 1=Error)
      - Reson     (Reason for Error)


=head2 mssimMakeAscii

 mssimMakeAscii();

SUBROUTINE  : mssimMakeAscii
DESCRIPTION : Convert an array with chacters to printable Ascii. Quit if null found

IN  : Character array
OUT : Printable ascii string


=head2 mssimPrintSWVersions

 mssimPrintSWVersions();

SUBROUTINE  : mssimPrintSWVersions
DESCRIPTION : To print SW versions of MSSIM modules

IN  : %REQ hash including the following MANDATORY parameters:
      - IP    (IP address)
OUT : None


=head2 mssimReconfCCCH

 mssimReconfCCCH();

SUBROUTINE  : mssimReconfCCCH
DESCRIPTION : To reconfigure CCCH

IN  : $REQ{Cell}        Mandatory
      $REQ{CcchConf}    Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{BsAgBlkRes}  Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{BsPaMfrms}   Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{CCauto}      Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltSI}       Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltPg}       Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltLapdm}    Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
      $REQ{FltUndec}    Optional, see MSSIM gsmphMPH_CCCH_OPEN_REQ command
OUT : None


=head2 setFrequencyOffset

 setFrequencyOffset();

SUBROUTINE  : setFrequencyOffset
DESCRIPTION :
IN  :
OUT :


=head2 waitForCellSync

 waitForCellSync();

SUBROUTINE  : waitForCellSync
DESCRIPTION : Return when cell is synchronized, or return error if timeout.
              The MSSIM messages and their corresponding parameters can be
              found in the MSSIM user's manual.

IN  : %Input containing
        Cell                  Cell number
OUT : %Output containing
        Error                 If cell syncronized = 0, otherwise = 1
        ErrorMsg              Contains the error message if Error = 1,
                              otherwise = ''



=cut

=head1 NAME

packetfunc


=head1 DESCRIPTION

Document number: 27/190 55-CAH 161 1290/1 Uen
MODULE      : packetfunc.pm
DESCRIPTION : Support functions for handling of packet data. Functions to
              control both TSS and MSSIM. For more information, see document:
              User Guide Payload testing with Abisco 2/198 17-FCD 201 33 Uen
              (The document comes with the Abisco installation)

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE     NAME    REVIEW  COMMENT
P1A 20081029 ESTEMOH         Created, functions moved from psdatafunc.pm
P1B 20081107 ESTEMOH         New parameter in MSSIM statistics
P1C 20081117 ESTEMOH         Changed Log on to MSSIM
P1D 20081204 ESTEMOH         Added SaveStatistics, SaveStatisticsToFile and
                              SaveFreeText.
P1E 20081215 ESTEMOH         Corrections for "package"
P1F 20090330 ESTEMOH         Updated for GSM base version 1.01
P1G 20090420 ESTEMOH         Changed Access Burst definition in
                              smphMPH_PS_DATA_REQ.
P1H 20090428 ERATZIS         Some additions to ChActMSSIM_P
                              (added $RxTrfcOn).
P1J 20090428 ERATZIS         Some minor corrections. Added $Timeout
                              to ChRelMSSIM_P.
P1K 20090501 ESTEMOH         Updated for Edge Evolution
P1L 20090526 ESTEMOH         Prepared for Edge Evolution. Requires UFTE R30A
                              or later.
P1M 20090618 ESTEMOH         Corrections for Edge Evolution.
P1N 20090817 ESTEMOH         Changed GetLoopParamMSSIM for three puncturing
                              schemes.
P1P 20090817 ERATZIS         Changed SaveStatistics, SaveFreeTest. Changed
                              to "append file" i.e. >> instead of >.
                              Added Close on files.
P1Q 20090819 ESTEMOH         Changed SaveStatisticsToFile
P2R 20091012 ESTEMOH         Changed CPS handling according to
                              Abisco CR 6135.
P2Q 20091013 ESTEMOH         Changed for multiple gsmappLOOP_PS_CFG_SET_CMD
P2R 20091109 ESTEMOH         Subroutine CreateMACHeader, correction for PAN
P2S 20091113 ESTEMOH         More corrections for PAN
P2T 20091120 ESTEMOH         Changes for 16QAM and PRBS
P2U 20091126 ESTEMOH         Changed calc of success rate for PRBS_LOOP
P2V 20091202 ESTEMOH         Changed $MaxFiles and $MaxFrm
P2W 20091207 ESTEMOH         Changed calc of success rate for PRBS
P2X 20100125 ESTEMOH         Changed CPS Startbit for DAS-11 and DAS-12
P2Y 20100301 ESTEMOH         Changed my to our for %PRBSHash, %UCMHash,
                              %CPSHash, %EncHash.
P2Z 20100812 ESTEMOH         Changed to call subroutine DifferentEncoding
                              every time.
 A  20110706 XGUSTPE XTOBSEM Updated to new script template
                              Added document number.
                              Added lock_keys hash checking on input.
                              Added 'our' declared variables to @EXPORT_OK.
                              Fixed imports and exports. Removed "Str" and
                              "Strip" from Abisco_Connection include.
                              Added catch of eval error around lock_keys.
                              Changed wrong printouts in SaveStatisticsToFile
                              Fixed filehandle bug in AppendToFile
                              Added import of Hash::Util and Carp
 B  20111107 XLEIMAR XSOFFRO Added the possibility of setting the element
                              NumberOfFrames in AvtivateGSL.
 C  20111220 XNAVNAS XTOBSEM Release in R38A
                              HP27474 Updated ActivateGSL to accept ULPANIndicator
                               input for StartGslLink

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<integer> 

L<English> 

L<Carp> 

L<mssim_def> 

L<mssim_sub> 

L<Hash::Util> 

L<mssim> 

L<User> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ActivateGSL

 ActivateGSL();

SUBROUTINE  : ActivateGSL
DESCRIPTION : Start Sending GSL or PGSL data from TSS

IN  : $Param{TG}
      $Param{TRXC}
      $Param{TS}
      $Param{DLEncoding}      Downlink encoding
      $Param{ICP}             Only applicabale in TDM mode
      $Param{CI}              Only applicabale in TDM mode
      $Param{PTA}             Only applicabale in SC mode
      $Param{PAL}             Only applicabale in SC mode
      $Param{ULMode}          Uplink mode BTTI/RTTI
      $Param{DLMode}          Downlink mode BTTI/RTTI
      $Param{SecTS}           Secondary timeslot, only applicable for RTTI
      $Param{Power}
      $Param{UCM}             Uplink Channel Mode
      $Param{ULEncoding}      Uplink Encoding
      $Param{ULPANIndicator}  Uplink PAN Indicator, default = 1
      $Param{SendPAN}         0=No, 1= Yes
      $Param{PAN}             PAN value, applicable only when $Param{SendPAN}=1
      $Param{TFI}             TFI value, applicable only when $Param{SendPAN}=1
      $Param{TimingOffset}    Timing Offset
      $Param{TLINK}           TLINK timer value
      $Param{TSUP}            TSUP supervision timer
      $Param{OpMode}          TSS Operational mode
      $Param{PRBSMode}        PRBS mode, only applicable when $OPMode include PRBS
      @{$Param{PacketData}}   Data including RLC/MAC header
      $Param{MACHdrStruct}{MACHdrData0}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData1}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData1}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData2}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData2}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData3}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData3}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData4}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData4}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData5}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData5}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData6}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData6}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData7}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData7}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData8}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData8}{Retransmission}   Optional TRUE or FALSE
      $Param{MACHdrStruct}{MACHdrData9}{CPS}              Optional CPS value
      $Param{MACHdrStruct}{MACHdrData9}{Retransmission}   Optional TRUE or FALSE
OUT : 0=Ok, 1=Error


=head2 ActivatePDCH

 ActivatePDCH();

SUBROUTINE  : ActivatePDCH
DESCRIPTION : Channel Activation, PDCH Channel

IN  : $TG
      $TRXC
      $TS
      $AbisMode
      $ICP
      $CI
      $PTA
      $PAL
OUT : 0=Ok, 1=Error


=head2 AppendToFile

 AppendToFile();

SUBROUTINE  : AppendToFile
DESCRIPTION : Opens a file, appends the input line array, and closes the file

IN  : FileName            Filename as a string
      Lines               An array of strings to be printed
OUT : 0                   Ok


=head2 CPSManipulation

 CPSManipulation();

SUBROUTINE  : CPSManipulation
DESCRIPTION : To store a CPS value in a RLC/MAC header
              or to fetch a CPS value from a RLC/MAC header

IN  : $Type (Fetch or Store)
      $CPSValue ( value to store, only used if Type=Store)
      $StartBit (in RLC/MAC header)
      $Length (Number of bits in RLC/MAC header)
      @Header (RLC/MAC Header)
OUT : $CPSValue (Fetched value, only if Type=Fetch)
      @Header (Updated RLC/MAC header, only if Type=Store)


=head2 ChActMSSIM_P

 ChActMSSIM_P();

SUBROUTINE  : ChActMSSIM_P
DESCRIPTION : To activate a packet channel in the MSSIM

IN  : $Ref       (MSSIM Channel reference)
      $Cell      (MSSIM Cell)
      $TG
      $TRXC
      $TS
      $SecTS     (Secondary timeslot, only applicable for RTTI)
      $Mode      (BTTI/RTTI)
      $UCM       (Uplink Channel Mode)
      $SendAB    (Send Access Burts, 0=No, 1=Yes)
      $TypeOfAB  (Type of Access Burst, 0=Single AB, 1=Four AB)
      $RxTrfcOn  (1 or 0)
OUT : Error      (0=OK, 1= Error)
      CcId       (MSSIM channel id)


=head2 ChRelMSSIM_P

 ChRelMSSIM_P();

SUBROUTINE  : ChRelMSSIM_P
DESCRIPTION : To release a channel in the MSSIM

IN  : $CcId      (MSSIM channel id)
      $Timeout
OUT : 0=OK


=head2 CheckCPS

 CheckCPS();

SUBROUTINE  : CheckCPS
DESCRIPTION : To check CPS parameter

IN  : $Encoding
      $CPS
OUT : 0 = OK, 1 = Error


=head2 CheckEncoding

 CheckEncoding();

SUBROUTINE  : CheckEncoding
DESCRIPTION : To check Encoding parameter

IN  : $Encoding
OUT : 0 = OK, 1 = Error


=head2 CloseCCCH

 CloseCCCH();

SUBROUTINE  : CloseCCCH
DESCRIPTION : To close the CCCH channel in MSSIM. To avoid receiving too many
              pagings during Load test

IN  : None
OUT : 0=OK


=head2 ConfigMSSIM_P

 ConfigMSSIM_P();

SUBROUTINE  : ConfigMSSIM_P
DESCRIPTION : To configure MSSIM

IN  : $MsId    (MSSIM Mobile Id)
      $TG      (BTS TG)
      $TRXC    (BTS TRXC)
OUT : $Cell    (MSSIM Cell number)


=head2 CreateMACHeader

 CreateMACHeader();

SUBROUTINE  : CreateMACHeader
DESCRIPTION : To create a number of MAC headers to be included in
              StartGSL Command.

IN  : %Param hash (See ActivateGSL)
OUT : %AbiscoREQ updated with MACHdrData1-MACHdrData9


=head2 DeactivateGSL

 DeactivateGSL();

SUBROUTINE  : DeactivateGSL
DESCRIPTION : Stop Sending GSL or P_GSL data from TSS

IN  : $TG
      $TRXC
      $TS
OUT : 0=Ok, 1=Error


=head2 DifferentEncoding

 DifferentEncoding();

SUBROUTINE  : DifferentEncoding
DESCRIPTION : To prepare MSSIM for different encoding in downlin/uplink

IN  : $Action         Action
      $DLEncoding     Downlink encoding
      $DL_CPS         Downlink CPS
      $ULEncoding     Uplink encoding
      $UL_CPS         Uplink CPS
OUT : 0=OK


=head2 GetCPSValue

 GetCPSValue();

SUBROUTINE  : GetCPSValue
DESCRIPTION : To get the numeric representation of CPS

IN  : Encoding
      CPS (text format)
OUT : CPS (numeric value)


=head2 GetLoopParamMSSIM

 GetLoopParamMSSIM();

SUBROUTINE  : GetLoopParamMSSIM
DESCRIPTION : To start the loop function in MSSIM

IN  : $Encoding
      $CPS
OUT : $CodSch       (Coding Schema)
      $Padding      (Padding, 0=No, 1=Yes)
      @PnctB        (Punturing array 0, 1 or 2)


=head2 GetStatisticsTSS

 GetStatisticsTSS();

SUBROUTINE  : GetStatisticsTSS
DESCRIPTION : Get GSL or P-GSL statistics from TSS

IN  : $TG,
      $TRXC
      $TS
      $ExpectedAB   (Expected number of Access bursts)
      %Result hash  (will be returned updated)

OUT : 0=Ok, 1=Error
      %Result hash including:
        SentDLFrames   Sent frames downlink from TSS
        ReceULFrames   Received frames uplink in TSS
        ReceUnexp      Received frames in TSS with unexpected contents
        ReceExp        Received frames in TSS with expected contents
        RecePAN        Received frames in TSS with PAN
        ExpPAN         Received frames in TSS with expected PAN contents
        ReceAB         Received number of Access Burts in TSS
        ReceABUnexp    Received number of Access Burts in TSS with
                       unexpected contents.
        ExpAB          Expected number of Access Burts in TSS
        RTT_Min        Roundtrip Delay minimum
        RTT_Avg        Roundtrip Delay average
        RTT_Max        Roundtrip Delay maximum
        BitErrCnt      PRBS Bit Error cound
        Status


=head2 PrepareData

 PrepareData();

SUBROUTINE  : PrepareData
DESCRIPTION : Prepare Packet data with RLC/MAC header

IN  : $Encoding
      $CPSValue
      $SendPAN (0 or 1)
OUT : 0=OK, 1=Error
      @PacketData (Data including RLC/MAC header)


=head2 ReleasePDCH

 ReleasePDCH();

SUBROUTINE  : ReleasePDCH
DESCRIPTION : RF Channel Release, PDCH Channel

IN  : $TG
      $TRXC
      $TS
OUT : 0=OK, 1=Error


=head2 SaveFreeText

 SaveFreeText();

SUBROUTINE  : SaveFreeText
DESCRIPTION : To save free text in summary file

IN  : Path Statistics file
      Path Summary file        (may be undef if not used)
      Free Text to write to SUMMARY File
OUT : 0=OK


=head2 SaveStatistics

 SaveStatistics();

SUBROUTINE  : SaveStatistics
DESCRIPTION : To save statistics to file

IN  : Path Statistics file
      Path Summary file       (may be undef if not used)
      Result Number           (may be undef if summary file is not used)
      Modulation              (may be undef)
      Downlink Encoding
      Downlink Mode           (BTTI or RTTI)
      Uplink Encoding
      Uplink Mode             (BTTI or RTTI)
      SendPAN                 (0=No, 1=Yes)
      SendAB                   (0=No, 1=Yes)
        BitsInAB                (0 = 8 bits, 1 = 11 bits)
        TS_AB                    (Training sequence for AB 0, 1 or 2)
        TypeOfAB                (0 = single AB, 1 = four ABs, 2 = repeated)
        TimeToRun
      Result hash with TSS and MSSIM statistics
OUT : Success rate


=head2 SaveStatisticsToFile

 SaveStatisticsToFile();

SUBROUTINE  : SaveStatisticsToFile
DESCRIPTION : To save statistics to file

IN  : Result Text
      Success Rate
      Path Statistics file
      Reference to hash Result (TSS and MSSIM statistics)
OUT : None


=head2 SendAccessBurstsMSSIM

 SendAccessBurstsMSSIM();

SUBROUTINE  : SendAccessBurstsMSSIM
DESCRIPTION :

IN  : $MsId         (MSSIM mobile Id)
      $CcId         (MSSIM channel id)
      $BitsInAB     (0 = 8 bits, 1 = 11 bits)
      $TS_AB        (Training sequence for AB 0, 1 or 2)
      $TypeOfAB     (0 = single AB, 1 = four ABs)
      $ULEncoding   (Ulink encoding)
      @AB           (Access burst contents, 8 bits one octet, 11 bits two octets)
OUT : 0=OK
      $Burst        (Type of burst)


=head2 StartLoopMSSIM

 StartLoopMSSIM();

SUBROUTINE  : StartLoopMSSIM
DESCRIPTION : To start the loop function in MSSIM
              If the same Encoding/CPS is used in both directions, the $CcId
              and $LoopCcId shall have the same value

IN  : $CcId        (MSSIM downlink channel id)
      $LoopCcId    (MSSIM uplink channel id)
      %Param       (Parameter hash)
OUT : 0=OK


=head2 StartPRBS_MSSIM

 StartPRBS_MSSIM();

SUBROUTINE  : StartPRBS_MSSIM
DESCRIPTION : To start the PRBS function in MSSIM

IN  : $CcId               CcId
      $DLEncoding         Downlink Encoding
      $ULEncoding         Uplink Encoding
      $PatternFile        Pattern File Name
      $PRBSMode           PRBS Mode
OUT : 0=OK


=head2 StopLoopMSSIM

 StopLoopMSSIM();

SUBROUTINE  : StopLoopMSSIM
DESCRIPTION : To stop the loop function in MSSIM

IN  : $CcId         (MSSIM downlink channel id)
      $LoopCcId     (MSSIM uplink channel id)
      %Result       (Will be returned updated)

OUT : 0=Ok
      %Result hash including statistics:
        NotTX                  See LSU V3, GSM Base Package, User's Manual
        RxDisc                 See LSU V3, GSM Base Package, User's Manual
        CntRxErrTot            See LSU V3, GSM Base Package, User's Manual
        CntRxErrHdrUsf         See LSU V3, GSM Base Package, User's Manual
        CntRxErrData           See LSU V3, GSM Base Package, User's Manual
        CntRxErrPan            See LSU V3, GSM Base Package, User's Manual
        Arrays with variable length including:
          CntCs                See LSU V3, GSM Base Package, User's Manual
          CntCsText            Coding Scheme text
          CntRxPkt             See LSU V3, GSM Base Package, User's Manual
          CntTxPkt             See LSU V3, GSM Base Package, User's Manual

        Optional, included only when CcId and LoopCcId are different:
          LoopCntRxErrTor      See LSU V3, GSM Base Package, User's Manual
          LoopCntRxErrHdrUsf   See LSU V3, GSM Base Package, User's Manual
          LoopCntRxErrData     See LSU V3, GSM Base Package, User's Manual
          LoopCntRxErrPan      See LSU V3, GSM Base Package, User's Manual
        Arrays with variable length including:
          LoopCntCs            See LSU V3, GSM Base Package, User's Manual
          LoopCntCsText        Coding Scheme text
          LoopCntRxPkt         See LSU V3, GSM Base Package, User's Manual
          LoopCntTxPkt         See LSU V3, GSM Base Package, User's Manual


=head2 StopPRBS_MSSIM

 StopPRBS_MSSIM();

SUBROUTINE  : StopPRBS_MSSIM
DESCRIPTION : To stop the PRBS function in MSSIM

IN  : $CcId       (MSSIM downlink channel id)
      %Result     (Will be returned updated)

OUT : 0=OK
      %Result hash, updated with
        NotTx             See LSU V3, GSM Base Package, User's Manual
        InvMs             See LSU V3, GSM Base Package, User's Manual
        TxFilled          See LSU V3, GSM Base Package, User's Manual
        TxNotFilled       See LSU V3, GSM Base Package, User's Manual
        RxHdrCorr         See LSU V3, GSM Base Package, User's Manual
        RxHdrChkErr       See LSU V3, GSM Base Package, User's Manual
        RxHdrIdErr        See LSU V3, GSM Base Package, User's Manual
        RxSeqSync         See LSU V3, GSM Base Package, User's Manual
        RxSeqLossCnt      See LSU V3, GSM Base Package, User's Manual
        RxLatMin          See LSU V3, GSM Base Package, User's Manual
        RxLatMax          See LSU V3, GSM Base Package, User's Manual
        RxLatAvg          See LSU V3, GSM Base Package, User's Manual
        RxLatVar          See LSU V3, GSM Base Package, User's Manual
        RxFrmErr          See LSU V3, GSM Base Package, User's Manual
        RxBitErr          See LSU V3, GSM Base Package, User's Manual
        RxSlips           See LSU V3, GSM Base Package, User's Manual
        Arrays with variable length including:
          CntCs           See LSU V3, GSM Base Package, User's Manual
          CntCsText       Coding Scheme text
          CntRxPkt        See LSU V3, GSM Base Package, User's Manual
          CntTxPkt        See LSU V3, GSM Base Package, User's Manual


=head2 UnpackCnt

 UnpackCnt();

SUBROUTINE  : UnpackCnt
DESCRIPTION : To unpack the Cnt field received from MSSIM

IN  : $Cnt            Cnt
      $Prefix         Parameter prefix
      %Result         (Will be returned updated)
OUT : %Result         (Updated)



=cut

=head1 NAME

PerlFunc


=head1 DESCRIPTION

Document number: 28/190 55-CAH 161 1290/1 Uen
MODULE      : PerlFunc.pm
DESCRIPTION : This module contains functions to facilitate handling with
              arrays, hashes, frequency consistencies, numeric conversions
              and unit conversions (primarily used by rbsstab.abi) and of
              course, the almighty, in-house PrettyPrint.

              A function that is placed under this module may not have any
              dependencies on any other "\pm" package except for Globals.
              (and this IS a demand!)

              Packing and unpacking Perl structures will have to be revised,
              since it is not done properly (although it works fine). See if
              PrettyPrint can be used instead of PackArrayOrHash or check to
              see if a third party function exists.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME           REVIEW    COMMENT
PA1 20051128  ERADIPE                  First revision
PA2 20051207  ERADIPE                  Added GetLocalTime
PA3 20060104  ERADIPE                  UnpackArrayOrHash returns undef and does
                                       not die if what to be unpacked is not a
                                       reference to array or hash.
PA4 20060127  ERADIPE                  MergeHashes not comletely "tight". Check
                                       the case where there are similar keys but
                                       in the first hash the key is a scalar and
                                       in the second hash it is a ref to a hash.
P1A 20080319  ERABAHG                  Merged with \dev_08a. New rev
B   20110831  XJMJMJM        XLEIMAR   Updated to new script template
                                       Quality control with PerlCritic.
                                       Added document number.
                                       Placed the previously internal subs of
                                       MergeHashes on the outside (GetLeaves and
                                       MakeIndex). Fixed includes from "Globals".
C   20111220  EDAMELI        XPRRANA   PrettyPrint_X: do not try to print
                                       undefined value
D   20120530  XLEAENG                  HP14008: Merged with ACM libraries
E   20120612  EDAMELI        XNAVNAS   PrettyPrint_X: do not try to print
                                       undefined value
                                       Removed trailing spaces and hard tabs
F   20130703  Syntronic AB/  EDAMELI   Script optimization
              Adibah                   Implemented lock_keys()

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Time::Local> 

L<feature> 

L<Time::HiRes> 

L<English> 

L<Carp> 

L<Scalar::Util> 

L<Globals> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ARFCN_to_Frequency

 ARFCN_to_Frequency();

SUBROUTINE  : ARFCN_to_Frequency
DESCRIPTION : Converts a channel number to a frequency.

              Example:
               $F_dl = ARFCN_to_Frequency(81, 'Downlink', 'GSM900P');

IN  : 1. $CHNR -> the channel number
      2. $Direction -> 'Downlink' || 'Uplink'
      3. $Band -> the frequency band
OUT : the frequency in MHz


=head2 Arfcn2TrxMap

 Arfcn2TrxMap();

HN31188  : Allow ACM to use BCCH on other TRX than 0 (zero)
Date     : 2012-5-12
TR Fix   : Map the AFRCN number to TRX number
FUNCTION : Arfcn2TrxMap
COMMENT  : Convert the Req

IN       : 1. @ARFCNList
           2. $ARFCNno = the target ARFCN number
           3. @TRXList

OUT      : $targetTRX


=head2 Ceil

 Ceil();

SUBROUTINE  : Ceil
DESCRIPTION : This function is incomplete.
              How roundings are implemented for negative numbers is not
              yet clear.

IN  :
OUT :


=head2 CheckKeyExistence

 CheckKeyExistence();

SUBROUTINE  : CheckKeyExistence
DESCRIPTION : Checks the existence of a hash entry. E.g.
              CheckKeyExistence(\%Car, ['Engine', 'Volume'])
              checks that $Car{Engine}{Volume} exists.

              Observe that by testing:
              if (exists($Car{Engine}{Volume})
              a correct behavior may not be obtained.

IN  : 1. $rH   -> reference to a hash
      2. $Keys -> reference to an array containing the keys
OUT : 1. -> 1/0


=head2 CopyArray

 CopyArray();

SUBROUTINE  : CopyArray
DESCRIPTION : Copies from one array, from a start index to an end index,
              to another array.

IN  : 1. $rA  -> reference to array to copy from
      2. $I   -> start copying from index $I in $rA
      3. $J   -> stop copying at index $J (included) in $rA
      4. $rrB -> reference to reference to array to copy to
OUT :


=head2 DHM_to_Minutes

 DHM_to_Minutes();

SUBROUTINE  : DHM_to_Minutes
DESCRIPTION : Takes a day, hour and minute and returns minutes.
              0 counting for days.

              Example:
              DHM_to_Minutes(1, 7, 41) gives 1901.
IN  :
OUT :


=head2 DelaySec

 DelaySec();

SUBROUTINE  : DelaySec
DESCRIPTION :

IN  :
OUT :


=head2 DeleteNonUnderscoredKeys

 DeleteNonUnderscoredKeys();

SUBROUTINE  : DeleteNonUnderscoredKeys
DESCRIPTION :

IN  :
OUT :


=head2 DeleteUnderscoredKeys

 DeleteUnderscoredKeys();

SUBROUTINE  : DeleteUnderscoredKeys
DESCRIPTION :

IN  :
OUT :


=head2 ExistsInArray

 ExistsInArray();

SUBROUTINE  : ExistsInArray
DESCRIPTION : Checks the existence of an element in an array.

IN  : 1. $E -> element to search for in the array
      2. $A -> reference to the array
OUT : 1. -> 0/1


=head2 Floor

 Floor();

SUBROUTINE  : Floor
DESCRIPTION : This function is incomplete.
              How roundings are implemented for negative numbers is not
              yet clear.

IN  :
OUT :


=head2 FormatNumber

 FormatNumber();

SUBROUTINE  : FormatNumber
DESCRIPTION : Example:

              '27'     ->  '0027'
              'dummy7' ->  'dummy0007'
              'abisco' ->  'abisco'

              Only the first occurance of a numeral is formatted.

IN  : 1. $X -> a string
OUT : 1. the string formatted


=head2 Frac

 Frac();

SUBROUTINE  : Frac
DESCRIPTION : This function is incomplete.
              How roundings are implemented for negative numbers is not
              yet clear.

IN  :
OUT :


=head2 GetARFCNHighLow

 GetARFCNHighLow();

SUBROUTINE  : GetARFCNHighLow
DESCRIPTION : Gets High and Low values of an ARFCN number

              Example:
               $rH = GetARFCNHighLow(625);

               gives: $rH->{High} = 2
               $rH->{Low}  = 113

IN  : 1. $Channel -> The channel number
OUT : 1. Reference to hash with keys High and Low


=head2 GetARFCNOffset

 GetARFCNOffset();

SUBROUTINE  : GetARFCNOffset
DESCRIPTION : Example
              GetARFCNOffset('GSM900P')      yields 0
              GetARFCNOffset('GSM900E')      yields 0
              GetARFCNOffset('GSM900E', 0)   yields 974

IN  : $Band
      $Region   If region is not supplied, then the last region
                is meant. Band 900E for example is regions 975
                thru 1023 (first) and 1 thru 124 (second).
OUT : The offset, i.e. the first channel minus one.


=head2 GetLeaves

 GetLeaves();

=head2 GetLocalTime

 GetLocalTime();

SUBROUTINE  : GetLocalTime
DESCRIPTION : Example:

              scalar    -> "Thu Feb 23 04:54:34 2006"
              date_time -> 20060223_045434
              dt_sep    -> [20060223, 045434]
              hash      -> {Year  => 2006,
                            Month => 1,   i.e. 0 counted
                            Day   => 23,  i.e. NOT 0 counted
                            Hour  => 4,
                            Minute => 54,
                            Second => 34,
                            DayText => THU,
                            MonthText => FEB}

IN  : $Type -> see example above
OUT :


=head2 GetSecondsSinceEpoch

 GetSecondsSinceEpoch();

CR6333: 405:005 File Loading Time.
Date: 2010-03-31
CR Fix: Created GetSecondsSinceEpoch() to parse the time value from a
       log entry retrieved from the RBS.
SUBROUTINE  : GetSecondsSinceEpoch
DESCRIPTION : Parses out the time from a line retrieved from the RBS
              log. Then, uses the parsed time to compute and return the
              number of seconds since the epoch. For example, the line
              below

              [10-01-30 01:45:35.276] P_LOADER  csm_loader.c:1678 ...

              returns 1264787135.276.

IN  : 1. $Line              -> Line of text to be parsed.
OUT : 1. $SecondsSinceEpoch -> Number of seconds since the epoch.


=head2 MakeIndex

 MakeIndex();

=head2 MaxValue

 MaxValue();

SUBROUTINE  : MaxValue
DESCRIPTION :

IN  : 1. rA -> ref to list where to search the maximum value
OUT :


=head2 MergeHashes

 MergeHashes();

GetLeaves($A, $rH1, $rH2);
return;
}


=head2 MinValue

 MinValue();

SUBROUTINE  : MinValue
DESCRIPTION :

IN  : 1. rA -> ref to list where to search for the minimum value
OUT :


=head2 Minutes_to_DHM

 Minutes_to_DHM();

SUBROUTINE  : Minutes_to_DHM
DESCRIPTION : Takes a number of minutes and returns:
              - week number
              - day number
              - hour
              - minute
              - a text in the form HH:MM
              - an abbreviation of the day, e.g. TUE

              Zero counting always applies.

              Example:
              Minutes_to_DHM(1901) gives
              [0, 1, 7, 41, '07:41', 'MON', 'MON 07:41']
IN  :
OUT :


=head2 MyPack_Array

 MyPack_Array();

SUBROUTINE  : MyPack_Array
DESCRIPTION : Used in MyPack_X

IN  :
OUT :


=head2 MyPack_Hash

 MyPack_Hash();

SUBROUTINE  : MyPack_Hash
DESCRIPTION : Used in MyPack_X

IN  :
OUT :


=head2 MyPack_X

 MyPack_X();

SUBROUTINE  : MyPack_X
DESCRIPTION : Used in PackArrayOrHash

IN  :
OUT :


=head2 PackArrayOrHash

 PackArrayOrHash();

SUBROUTINE  : PackArrayOrHash
DESCRIPTION : Packs a legal Perl array or hash into a string. The
              following is practiced.

              - Strings, whether they are key names or scalars, may
                not contain whitespace or a mixture between numbers,
                letters and characters, unless enclosed by " and ".
                If only letters, it's OK without ".

              - Numerical values, either integer or floats, are
                identified by using looks_like_number.
                Exponentiation is allowed, e.g. -5.2e-2 = -0.052

              As can be seen in the code when processing a scalar,
              check is done to see if the scalar is a numeric value.
              If it is numeric everything is fine.
              If it is not, it has to be string, and is enclosed by '.

              OBS! No check is done to see if the string already is
                   enclosed by ' or ". If it is by " it is OK. But if it is
                   by ' then we have a problem. To be solved later.

              When packing is finished all strings except for key names
              will be enclosed by '.

              NOTE:
              The code here is actually the same as in PrettyPrint.
              Maybe someone could look into merging this function into
              PrettyPrint.

IN  :
OUT :


=head2 PositionInArray

 PositionInArray();

SUBROUTINE  : PositionInArray
DESCRIPTION : Returns the position of an element in an array or undef.

IN  : 1. $E -> element to search the position for in the array
      2. $A -> reference to the array
OUT : 1. -> undef || position


=head2 PrettyPrint

 PrettyPrint();

SUBROUTINE  : PrettyPrint
DESCRIPTION : Makes a formatted printout of an array or a hash.
              Each key/value pair of a hash is displayed in one row.
              The elements of an array are displayed in one row.
              PrettyPrint(\%SomeHash); could e.g. give:

              {Message => Greetings,
              Sender => John,
              Receiver => Mom,
              Data => {Part1 => [0, 31 deg, 3, Hawaii, 16, 4, -99],
                       Part2 => {Subpart1 => [0, [5, -1]],
                                 Subpart2 => Not applicable}},
              Status => OK}

              Example:
               PrettyPrint(\@Array1);
               PrettyPrint(\%Hash14, {FileHandle => *FH,
                                      Print      => 'no head'}
                          );
               PrettyPrint(\%Hash15, {Caption => 'Hash 15 version A2'});

              A file handle to an already opened file can be given,
              redirecting the output to that file. Default is STDOUT.

IN  : 1. $X      -> reference to an array || hash
      2. $Option -> Optional 'No head'
OUT :


=head2 PrettyPrint_Array

 PrettyPrint_Array();

SUBROUTINE  : PrettyPrint_Array
DESCRIPTION : Used in PrettyPrint_X

IN  : $X - reference to an array.
OUT : None. Changes global variable @Rows.


=head2 PrettyPrint_Hash

 PrettyPrint_Hash();

SUBROUTINE  : PrettyPrint_Hash
DESCRIPTION : Used in PrettyPrint_X

IN  : $X - reference to a hash.
OUT : None. Changes global variable @Rows and @IND.


=head2 PrettyPrint_X

 PrettyPrint_X();

SUBROUTINE  : PrettyPrint_X
DESCRIPTION : Used in PrettyPrint

IN  : $X - reference to an array or hash.
OUT : None. Changes global variable @Rows.


=head2 Print

 Print();

=head2 PrintVec

 PrintVec();

SUBROUTINE  : PrintVec
DESCRIPTION : Print a vector as used when selecting filehandles.
              e.g.
              vec($Rout, 5, 1) = 1;
              PrintVec($Rout, "fileno 5 gives");
IN  :
OUT :


=head2 RandomizedArrayElements

 RandomizedArrayElements();

SUBROUTINE  : RandomizedArrayElements
DESCRIPTION : Example:
               input  -> [0, 1, 2, 3, 4, 5]
               output -> [4, 2, 5, 0, 1, 3]

               BTSCompleteStart(TRXList
                                  => RandomizedArrayElements($TG{TRXList}));

IN  : 1. rA -> reference to a list
OUT : 1. reference to a list


=head2 RemoveFromArray

 RemoveFromArray();

SUBROUTINE  : RemoveFromArray
DESCRIPTION : Removes an element from an array, if it exists.

IN  : 1. $E -> element to remove from array $A
      2. $A -> reference to array
OUT :


=head2 Round

 Round();

SUBROUTINE  : Round
DESCRIPTION : This function is incomplete.
              How roundings are implemented for negative numbers is not
              yet clear.

IN  :
OUT :


=head2 SD

 SD();

HO47384 : ACM shall supervise the traffic levels for the whole periods
Date    : 2011-10-25
CR Fix  : Edit the algorithm to allow all the results displayed in 2 decimal points
SUBROUTINE  : SD
DESCRIPTION :

IN  :
OUT :


=head2 Seconds_to_HMS

 Seconds_to_HMS();

SUBROUTINE  : Seconds_to_HMS
DESCRIPTION :

IN  : 1. $T -> time in seconds
OUT : 1. reference to hash with entries Hours, Minutes and Seconds.


=head2 Trunc

 Trunc();

SUBROUTINE  : Trunc
DESCRIPTION : This function is incomplete.
              How roundings are implemented for negative numbers is not
              yet clear.

IN  :
OUT :


=head2 UnpackArrayOrHash

 UnpackArrayOrHash();

SUBROUTINE  : UnpackArrayOrHash
DESCRIPTION : Unpacks what was packed (preferably) with PackArrayOrHash.
              Since packing packed so that the ouput would be a reference
              to an array or hash, we have to replace the initial [ or {
              with an ( and the final ] or } with an ).
              This is done in order to unpack by a simple eval (which
              does not want a reference to something).

              OBSERVE:
              No initial or final whitespaces in the string.

IN  : A string being a valid reference to an array or hash
OUT : A reference to an array or hash.


=head2 ValidARFCN

 ValidARFCN();

SUBROUTINE  : ValidARFCN
DESCRIPTION : Returns 1 if CHNR is a valid channel number in the band,
              otherwise 0.

              Example:
               $Valid = ValidARFCN(127, 'GSM900P');

               yields 0 since GSM900P goes from 1 to 124.
IN  :
OUT :



=cut

=head1 NAME

prismaversions


=head1 DESCRIPTION

Document number: 29/190 55-CAH 161 1290/1 Uen
MODULE      : prismaversions.pm
DESCRIPTION : Retrive SW versions for Prisma modules

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 100930    ESTEMOH             Created
A   20110923  ETORWIL   XLEIMAR   Approved for use in Abisco R37A
                                   Updated according to CR HO43422
                                   Used IO::Socket::INET for creation of socket
                                   Removed use of Socket and IO::Handle
B   20111018  ETORWIL   EANSKAT   Enabled diagnostics
C   20131216  ESTEMOH             Catch failed TCP/IP connection

Note that on 2011-09-23 the revision style was changed to A, B and so on.


=head1 REQUIRES

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 PrismaVersions

 PrismaVersions();

SUBROUTINE  : PrismaSwVersion
DESCRIPTION : Read SW versions of SW modules in MSSIM or LSU
              The available module names are:
              'lapd', 'abis-edge', 'abis-trau', 'vscsrv', 'monsrv',
              'www_ui', 'sdrCal', 'sdrGsm', 'gsmb', 'basic-env', 'lsuv3-base'

IN  : $REQ{IP}            IP address or DHCP name
      $REQ{Port}          Port number (normally 8200)
      $REQ{Timeout}       Timeout value in seconds
      @{$REQ{Modules}}    Array with module names
OUT : $RESP{Result}       0=Ok, 1= Fail
      @{$RESP{Versions}}  Array with module names and versions, example "lsuv3-base 7.11.20"



=cut

=head1 NAME

psdatafunc


=head1 DESCRIPTION

Document number: 30/190 55-CAH 161 1290/1 Uen
MODULE      : psdatafunc.pm
DESCRIPTION : Support functions for sending PS Data from TSS.

             Perl module Telnet.pm must be stored in the perl installation
              library c:\perl\lib\Net. The module can be found in the
              CPAN home page, www.cpan.org

              The Telnet connection to Lanforge is hardcoded to
              host='lanforge.rbs.rnd.ki.sw.ericsson.se', port=4001.

              The program works for all Coding Schemas and all Abis Modes.

              For more information, see document:
              User Guide Payload testing with Abisco
              2/198 17-FCD 201 33 Uen
             (The document comes with the Abisco installation)

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 070522    ESTEMOH             Created after splitting psdata.pl
P1B 071019    ESTEMOH             Updated for Abisco R24A
P1C 080303    ESTEMOH             Added Remote Control of Lanforge
P1D 080422    ESTEMOH             Added RTTI
P1E 080429    ESTEMOH             Added CPS 15 for MCS-0
P1F 080513    ESTEMOH             Changed length in LLC header MCS-2 - MCS-9
P1G 080513    ESTEMOH             Changed RLC/MAC header for MCS-0
P1H 080521    ESTEMOH             Set UCM NB-unkn for MCS-6 with padding
P1I 080521    ESTEMOH             Changed Validation parameters for MCS-6
                                   with padding.
P1I 080527    ESTEMOH             Added padding for MCS-6 with padding.
                                   Export of CPSManipulation.
P1J 080610    ESTEMOH             Modified for control of Racal
    080723    EDAVBOO             In ReadLanforgeInput() clear the hash
                                   before reading in the file otherwise
                                   new/changed files just get mixed in with
                                   earlier ones. In ProcessLanforge() sort
                                   the outer loop (Number) numerically
                                   otherwise line 10 comes between 1 and 2.
                                   Added sun numerically() for above sort.
                                   In SendPSData() corrected error in timing loop.
                                   was...                if ($TimeToRun > $LanforgeTime) {SLEEP ($TimeToRun > $LanforgeTime);}
                                   should be...       if ($TimeToRun > $LanforgeTime) {SLEEP ($TimeToRun - $LanforgeTime);}
P1K 081003    ESTEMOH             Modified for control of Prisma MSSIM.
                                   Added PAN and AB.
P2A 081104    ESTEMOH             A number of subroutines moved to
                                   packetfunc.pm.
P2B 081117    ESTEMOH             Changed Access Burst handling and Log on
                                   to MSSIM.
P2C 081204    ESTEMOH             Changed MSSIM statistics handling
P2D 081215    ESTEMOH             Corrections for "package"
P2E 090303    ESTEMOH             Added dynamic ICP handling
P2F 090428    ERATZIS             Exported AllocateICP and  DeallocateICP
P2G 090514    ESTEMOH             Prepared for Edge Evolution.
                                   Requires UFTE P30A.2 or later.
P2H 090526    ESTEMOH             Prepared for PRBS. Requires UFTE R30A or
                                   later.
P2J 090622    ESTEMOH             Corrections for Edge Evolution.
P2K 091012    ESTEMOH             Changed CPS handling according to
                                   Abisco CR 6135.
P2L 091013    ESTEMOH             StartLoopMSSIM changed to use
                                   parameter hash.
P2M 091120    ESTEMOH             Changed start order TSS/MSSIM in
                                   Sub SendPSData.
P2N 091130    ESTEMOH             Changed description of sub SendPSData
P2O 100105    ESTEMOH             Added safety release of CS data channel
                                   in TSS. Requires Abisco R32A or later.
P2Q 110408    ETORWIL             Removed new Abisco_Connection due to
                                   HN67845 and HN65860.
A   20110923  XJMJMJM   XSOFFRO   Updated to new script template.
                                    Quality control with PerlCritic.
                                    Fixed imports and exports. Removed "Str"
                                     and "Strip" from Abisco_Connection include
                                    Exported SendPSData().
                                    Removed extra import of Net::Telnet.
B   20120521  XPRRANA   XSOFFRO   Deleted unused keys from input hash to ActivateGSL
                                    in subroutine SendPSData

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<English> 

L<Carp> 

L<Net::Telnet> 

L<packetfunc> 

L<mssim_def> 

L<User> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 AllocateICP

 AllocateICP();

SUBROUTINE  : AllocateICP
DESCRIPTION : To allocate ICP and CI numbers

IN  : TG
      TRXC
      TS
      Downlink Encoding
      Uplink Encoding
OUT : ICP
      CI


=head2 CheckCHConfig

 CheckCHConfig();

SUBROUTINE  : CheckCHConfig
DESCRIPTION : To check GSL/PGSL mode in the Commandd Handler

IN  : None
OUT : 0=OK, 1=Error
      Error Text


=head2 CheckTCHConfig

 CheckTCHConfig();

SUBROUTINE  : CheckTCHConfig
DESCRIPTION : To check that TCH configuration (16 or 64 Kbit/S) is
              applicable for the select coding scheme.

IN  : AbisMode
      TCH Configuration
      Downlink Encoding
      Uplink Encoding
OUT : 0=OK, 1=Error
      Error Reason


=head2 DeallocateICP

 DeallocateICP();

SUBROUTINE  : DeallocateICP
DESCRIPTION : To allocate ICP and CI number

IN  : TG
      TRXC
      TS
OUT : None


=head2 ProcessLanforge

 ProcessLanforge();

SUBROUTINE  : ProcessLanforge
DESCRIPTION : To send Latency and Jitter to Lanforge

IN  : LanforgeEndpoint (global)
      LanforgeHash (global)
OUT : Time Spent


=head2 ReadAbiscoConfig

 ReadAbiscoConfig();

SUBROUTINE  : ReadAbiscoConfig
DESCRIPTION : To fetch AbisMode and TCH Configuration for a specific TRXC

IN  : None
OUT : $AbisMode (according to Abisco TG)
      $TCH Configuration (according to Abisco TG)


=head2 ReadLanforgeInput

 ReadLanforgeInput();

SUBROUTINE  : ReadLanforgeInput
DESCRIPTION : To read input file with Lanforge parameters

IN  : File Name, Lanforge input file
OUT : %LanforgeHash (global)


=head2 SLEEP

 SLEEP();

SUBROUTINE  : SLEEP
DESCRIPTION : Special sleep routine. The normal sleep does not work
              with TK GUI.

IN  : Time in seconds
OUT : None


=head2 SendAB

 SendAB();

SUBROUTINE  : SendAB
DESCRIPTION : To send Access Bursts

IN  : $TS_AB        0 =TS0,    1 = TS1, 2=TS2 (TS = Training Sequence code)
      $BitsInAB     0 =8 bits, 1 = 11 bits
      $TypeOfAB     0=Single,  1=Four,  2=Continous
      $UlEncoding   Uplink Encoding/CPS
      $TimeToRun    Time to run in seconds
OUT : None


=head2 SendPSData

 SendPSData();

SUBROUTINE  : SendPSData
DESCRIPTION :

IN  :    $Param{TG}
         $Param{TRXC}
         $Param{TS}
         $Param{ULMode}              Uplink mode (BTTI/RTTI)
         $Param{DLMode}              Uplink mode (BTTI/RTTI)
         $Param{SecTS}               Secondary TS (only for RTTI)
         $Param{PTA}                 Only applicabale in SC mode
         $Param{PAL}                 Only applicabale in SC mode
         $Param{Power}
         $Param{UCM}                 Uplink Channel Mode
         $Param{DLEncoding}          Downlink Encoding/CPS
         $Param{UlEncoding}          Uplink Encoding/CPS
         $Param{TimeToRun}           Time to run in seconds
         $Param{UseLanforge}         0=No, 1=Yes
         $Param{LanforgePath}        Path to Lanforge configuration file
         $Param{UseMSSIM}            0=No, 1=Yes
         $Param{SendAB}              0=No, 1=Yes  (Send Access burst yes/no)
         $Param{BitsInAB}            0 =8 bits, 1 = 11 bits
         $Param{TS_AB}               0=TS0, 1=TS1, 2=TS2
                                     (TS = Training Sequence code)
         $Param{TypeOfAB}            0=Single, 1=Four, 2=Continous
         $Param{SendPAN}             0=No, 1=Yes
         $Param{PAN}                 PAN value
         $Param{TFI}                 TFI value
         $Param{OpMode}              0=Loop, 1=PRBS_Loop,
                                     2=PRBS_Transmit, 3=PRBS_Receive
         $Param{PatternFile}         MSSIM pattern file, applicable
                                     only when using PRBS
         $Param{PRBSMode}
         $Param{MACHdrStruct}{MACHdrData0}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData1}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData1}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData2}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData2}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData3}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData3}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData4}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData4}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData5}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData5}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData6}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData6}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData7}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData7}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData8}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData8}{Retransmission}   Optional TRUE or FALSE
         $Param{MACHdrStruct}{MACHdrData9}{CPS}              Optional CPS value
         $Param{MACHdrStruct}{MACHdrData9}{Retransmission}   Optional TRUE or FALSE

OUT :    Error 0=OK, 1=error
         Error Reason (text string)
         Result hash (Statistics)

         The Result hash includes:

           TSS Statistics:
             $Result{SentDLFrames}   Sent frames downlink from TSS
             $Result{ReceULFrames}   Received frames uplink in TSS
             $Result{ReceUnexp}      Received frames in TSS with
                                     unexpected contents.
             $Result{ReceExp}        Received frames in TSS with
                                     expected contents.
             $Result{RecePAN}        Received frames in TSS with PAN
             $Result{ExpPAN}         Received frames in TSS with
                                     expected PAN contents.
             $Result{ReceAB}         Received number of Access Burts in TSS
             $Result{ReceABUnexp}    Received number of Access Burts in TSS
                                     with unexpected contents.
             $Result{ExpAB}          Expected number of Access Burts in TSS
             $Result{RTT_Min}        Roundtrip Delay minimum
             $Result{RTT_Avg}        Roundtrip Delay average
             $Result{RTT_Max}        Roundtrip Delay maximum
             $Result{BitErrCnt}      PRBS Bit Error cound
             $Result{Status}

           MSSIM PRBS Statistics:
             $Result{Filled}               See doc. LSUv3, GSM Base Package, User's Manual
             $Result{TxNotFilled}          See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxHdrCorr}            See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxHdrChkErr}          See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxHdrIdErr}           See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxSeqSync}            See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxSeqLossCnt}         See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxLatMin}             See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxLatMax}             See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxLatAvg}             See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxLatVar}             See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxFrmErr}             See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxBitErr}             See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxSlips}              See doc. LSUv3, GSM Base Package, User's Manual

           MSSIM Statistics main channel:
             $Result{NotTX}                See doc. LSUv3, GSM Base Package, User's Manual
             $Result{RxDisc}               See doc. LSUv3, GSM Base Package, User's Manual
             $Result{CntRxErrTot}          See doc. LSUv3, GSM Base Package, User's Manual
             $Result{CntRxErrHdrUsf}       See doc. LSUv3, GSM Base Package, User's Manual
             $Result{CntRxErrData}         See doc. LSUv3, GSM Base Package, User's Manual
             $Result{CntRxErrPan}          See doc. LSUv3, GSM Base Package, User's Manual
            Arrays for each coding scheme sent and received:
             @$Result{CntCs}}              See doc. LSUv3, GSM Base Package, User's Manual
             @$Result{CntCsText}}          Coding Scheme translated to text
             @$Result{CntRxPkt}}           See doc. LSUv3, GSM Base Package, User's Manual
             @$Result{CntTxPkt}}           See doc. LSUv3, GSM Base Package, User's Manual

           MSSIM Statistics secondary channel, used only when different mode (BTTI/RTTI) in UL and DL:
             $Result{LoopCntRxErrTot}      See doc. LSUv3, GSM Base Package, User's Manual
             $Result{LoopCntRxErrHdrUsf}   See doc. LSUv3, GSM Base Package, User's Manual
             $Result{LoopCntRxErrData}     See doc. LSUv3, GSM Base Package, User's Manual
             $Result{LoopCntRxErrPan}      See doc. LSUv3, GSM Base Package, User's Manual
            Arrays for each coding scheme sent and received:
             @$Result{LoopCntCs}}          See doc. LSUv3, GSM Base Package, User's Manual
             @$Result{LoopCntCsText}}      Coding Scheme translated to text
             @$Result{LoopCntRxPkt}}       See doc. LSUv3, GSM Base Package, User's Manual
             @$Result{LoopCntTxPkt}}       See doc. LSUv3, GSM Base Package, User's Manual


=head2 SplitEnc

 SplitEnc();

SUBROUTINE  : SplitEnc
DESCRIPTION : To split Encoding from CPS

IN  : Encoding:CPS
OUT : Encoding
      CPS


=head2 numerically

 numerically();

SUBROUTINE  : numerically
DESCRIPTION : Used for numerical sort

IN  : None
OUT : None



=cut

=head1 NAME

roundtripdelay


=head1 DESCRIPTION

Document number: 31/190 55-CAH 161 1290/1 Uen
MODULE      : roundtripdelay.pm
DESCRIPTION : Author: Stefan Mohlin
              Calculation of Round Trip Delay for speech, psdata and csdata based
              on Abis and Um LSU log files.
              The log files shall be created during a test session with Abisco in
              Loopback mode and MSSIM in PRBS mode. Due to LSUMSSIM-143, csdata is still
              not possible to verify.
              The subroutine to be called is "RoundTripDelay", all others at only for internal use.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
A   20101018  ESTEMOH   XSOFFRO   Created
B   20111206  XTOBSEM   XSOFFRO   HP21303 Fixed bug in ReadWiresharkAbis (HP21303)
                                   and made small changes to FindMatch to avoid warnings


=head1 REQUIRES

L<integer> 

L<PerlFunc> 

L<mssim_def> 

L<wireshark> 

L<mssim> 

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 BitAlignFrame

 BitAlignFrame();

SUBROUTINE  : BitAlignFrame
DESCRIPTION : To bit shift (left) a frame

IN  : $REQ{Frame} 	      Frame from wireshark log
      $REQ{StartPos} 			StartPosition
      $REQ{HeaderType}		Header type according to P-GSL IWD
      $REQ{Direction}			UL or DL

OUT : $RESP{Frame}		    Frame bit alignet
      $RESP{StartPos}			Updated Start position


=head2 CalcLength

 CalcLength();

SUBROUTINE  : CalcLength
DESCRIPTION : To calculate the length of a frame excluding the starting octets
              and two octets at the end.

IN  : Start position
      Expected length
      Data

OUT : Calculated length


=head2 CalcStartPosUmPsdata

 CalcStartPosUmPsdata();

SUBROUTINE  : CalcStartPosUmPsdata
DESCRIPTION : To calculate the Start position for psdata Um interface

IN  : %REQ
OUT : None, global hash %SearchHash updated


=head2 ConvertWiresharkTimeStamp

 ConvertWiresharkTimeStamp();

SUBROUTINE  : ConvertWiresharkTimeStamp
DESCRIPTION : Routine to make seconds and microseconds into a timestamp

IN  : Seconds and Microseconds from LSU log file
OUT : Complete timestamp


=head2 FindMatch

 FindMatch();

SUBROUTINE  : FindMatch
DESCRIPTION : To compare Master with Slave and find matching messages.
              To calculate Round Trip delay based on Timestamp.
              Master could be either @Uplink or @Downlink
              Slave could be either @Uplink or @Downlink

IN  : None (Globals @Uplink and @Downlink)
OUT : None (Globals @Matched, @Unmatched and @Skipped created)


=head2 HandleSC

 HandleSC();

SUBROUTINE  : HandleSC
DESCRIPTION : To make special preparations for Super Channel

IN  : Payload Type
      %RESP hash from lsuReadAbisWLog

OUT : %RESP hash updated


=head2 InvalidFileType

 InvalidFileType();

SUBROUTINE  : InvalidFileType
DESCRIPTION : Routine to check that the LSU file type (Interface) is the expected

IN  : InterfaceCode parameter from LSU log file
      REQ hash, see subroutine RoundTripDelay

OUT : 0 = Expected File Type
      1 = Not expected File Type


=head2 ProcessOutput

 ProcessOutput();

SUBROUTINE  : ProcessOutput
DESCRIPTION : To write the result into an output file

IN  : RESULT hash
OUT : None


=head2 ReadWiresharkAbis

 ReadWiresharkAbis();

SUBROUTINE  : ReadWiresharkAbis
DESCRIPTION : To read a Wireshark file for the Abis interface and filter out
              Uplink and downlink messages

IN  : REQ hash, see subroutine RoundTripDelay
OUT : None (Globals @Uplink and @Downlink created)


=head2 ReadWiresharkUm

 ReadWiresharkUm();

SUBROUTINE  : ReadWiresharkUm
DESCRIPTION : To read a Wireshark file for the Um interface and filter out
              Uplink and downlink messages

IN  : REQ hash, see subroutine RoundTripDelay
OUT : None (Globals @Uplink and @Downlink created)


=head2 RoundTripDelay

 RoundTripDelay();

SUBROUTINE  : RoundTripDelay
DESCRIPTION : To calculate Round Trip Delay based on an Abis or Um LSU log file.
              The result is written in and output file.

IN  : $REQ{InFile}            Input file
      $REQ{OutFile}           Output file
      $REQ{InterfaceCode}     "ABIS_TDM", "ABIS_SC" or Um"
      $REQ{PayloadType}       "speech8", "speech16", "csdata" or "psdata"
      $REQ{Encoding}          Mandatory only for psdata (both Abis and Um)

OUT : $RESULT{Result}         Result Code, 0=OK
      $RESULT{Reason}         Error text, applicable only if Result is not zero
      $RESULT{Domain}         Domain (from LSU file)
      $RESULT{Protocol}       Protocol (from LSU file)
      $RESULT{SccRate}        SccRate (from LSU file)
      $RESULT{InterfaceCode}  InterfaceCode (from LSU file)
      $RESULT{Match}          Number of matching frames
      $RESULT{UnMatch}        Number of unmatching frames
      $RESULT{Skipped}        Number of skipped frames
      $RESULT{MaxTime}        Maximum Round Trip Delay
      $RESULT{MinTime}        Minimum Round Trip Delay
      $RESULT{AvgTime}        Average Round Trip Delay



=cut

=head1 NAME

Sercom


=head1 DESCRIPTION

Document number: 32/190 55-CAH 161 1290/1 Uen
MODULE      : Sercom.pm
DESCRIPTION : This module contains functions for serial port communication.
              Only asynchronous mode is used. There is any handshaking or
              signal checking functions

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
PA1 20070906  ERAHEIK             First revision
P1A 0080319   ERABAHG             New rev
B   20110907  XLEIMAR   ETORWIL   Updated document header with doc number

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Exporter> 

L<Win32::SerialPort> 

L<Win32API::CommPort> 

L<threads::shared> 

L<threads> 

L<Win32::API> 


=head1 METHODS

=head2 PortInit

 PortInit();

---FUNCTION    : PortInit
DESCRIPTION :

SYNTAX      : PortInit();

---

=head2 ReadFromPort

 ReadFromPort();

---FUNCTION    : ReadFromPort
DESCRIPTION : Port is COM1 or COM2 ...

SYNTAX      : ReadFromPort($Port);

---

=head2 WriteToPort

 WriteToPort();

---FUNCTION    : WriteToPort
DESCRIPTION : Port is COM1 or COM2 ...

SYNTAX      : WriteToPort($SendString);

---


=cut

=head1 NAME

Settings


=head1 DESCRIPTION

Document number: 33/190 55-CAH 161 1290/1
MODULE      : Settings.pm
DESCRIPTION : This package contains the subfunctions
              used for reading information from configuration file

COPYRIGHT ? ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME         REVIEW    COMMENT
A   20100920  XDT/XNGUTHU  ESTEMOH   Initial version.
B   20110908  XSOFFRO      XLEIMAR   Pelrcritic applied.
                                      Added new document number.
                                      Fixed infinite loop
                                       when new() input is non-existant file.
                                      Replaced // with m{} and s///


=head1 REQUIRES

L<File::Copy> 

L<File::Basename> 

L<File::Spec> 

L<Cwd> 

L<Carp> 

L<diagnostics> 


=head1 METHODS

=head2 new

 $self->new();

SUBROUTINE  : new
DESCRIPTION : Create new local database object (Constructor subroutine)

IN  : Configuration file name
OUT : Object instance


=head2 CreateDefaultConfFile

 $self->CreateDefaultConfFile();

SUBROUTINE  : CreateDefaultConfFile
DESCRIPTION : Create a default configuration file if the file does not exist

IN  : Optional file name
OUT : 0 if success and 1 if fail


=head2 Get

 $self->Get();

SUBROUTINE  : Get
DESCRIPTION : Get value from setting file by key

IN  : key
OUT : value


=head2 Keys

 $self->Keys();

SUBROUTINE  : Keys
DESCRIPTION : Get array of key in setting

IN  : None
OUT : Ref of key array


=head2 Print

 $self->Print();

SUBROUTINE  : Print
DESCRIPTION : Print all key and value in setting file

IN  : None
OUT : string output


=head2 ReadConfFile

 $self->ReadConfFile();

SUBROUTINE  : ReadConfFile
DESCRIPTION : Read data of 'tp.conf' file

IN  : Configuration file name
OUT : Result 0/1


=head2 ReadConfFiles

 $self->ReadConfFiles();

SUBROUTINE  : ReadConfFiles
DESCRIPTION : Read 'tp.conf' file

IN  : None
OUT : -



=cut

=head1 NAME

SF2


=head1 DESCRIPTION

Document number: 34/190 55-CAH 161 1290/1 Uen
MODULE      : SF2.pm
DESCRIPTION : Contains only MGetSeveral, a multi-threaded version of
              GetSeveral.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
PA1 20051128  ERADIPE             First revision
P1A 20080319  ERABAHG             New rev
B   20110812  XSOFFRO   XLEIMAR   Copied entire body from abiscofunc3.pm
                                  (rev B) as the files were identical
                                  prior to  HO43422. Added document number.

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<English> 

L<Carp> 

L<PerlFunc> 

L<Abisco_Connection> 

L<Win32> 

L<Thread::Semaphore> 

L<Thread::Queue> 

L<threads> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 CheckDoubleSignals

 CheckDoubleSignals();

SUBROUTINE  : CheckDoubleSignals
DESCRIPTION : Two signals are considered duplicates if they are identical
              and they occur across threads within 50 ms. (In practice I
              haven't seen them to occur more than 20 ms in between.)
IN  :
OUT :


=head2 GreaterOrEqual

 GreaterOrEqual();

SUBROUTINE  : GreaterOrEqual
DESCRIPTION :
IN  :
OUT :


=head2 MGetSeveral

 MGetSeveral();

SUBROUTINE :MGetSeveral
DESCRIPTION:There is essentially only one reason to use this function:
           The ability to send a signal while waiting for another signal.
           As an example, wait until signal X is received and if, in between,
           signal Y is received, send signal Z. Sending signal Z requires
           the second BTS connection which for us is a new thread of execution.

           The process that called MGetSeveral is called the "main thread"
           as it executes the main loop in this module.
           The threads started by the main thread to handle each BTS connection
           are called just "threads". Each BTS connection supports its own input
           queue of signals. The thread handling the BTS connection will put
           these signals in its hash entry of received signals. Function
           MGetSeveral returns a reference to a hash that has at the top level
           entries for each BTS connection, called '0', '1', or more, plus entry 'B'.
           There are also some more entries to display statistics.

           The CH is only aware of a number of BTS connections, not any threads.
           Responses received from the CH that are tagged as RESP can be addressed
           to the correct BTS connection, while all other messages tagged as
           e.g. SPONT are broadcasted to all active BTS connections. This is because
           the CH cannot decide which BTS connection is the recipient of the signal,
           and results in duplicated signals in the input queues of the different
           BTS connections.

           When the exit criteria are met and the function is about to exit,
           a routine is called to check if signals are duplicated across the
           different BTS connections. The mechanism is fairly simple and it will
           put the duplicate signals under entry 'B' and also remove these signals
           from the BTS connections queue where they occur.


           EXAMPLES:
           $L = MGetSeveral(BTSConn => [$BTS, $BTS1],
                            Expect  => [[{Message => 'Accept'},
                                         {Message => 'RFResourceIndication'}],
                                        [{Message => 'ABORT_SP_CFM'}]],
                            CheckDouble => 'YES',
                            Upto    => [[1, 3], [1]],
                            Timeout => [30, 30],
                            Until   => [{Message => 'Reject'}, {Message => 'PROMPT'}]);

           $BTS->Put(restart TG);
           $L = MGetSeveral(BTSConn => [$BTS, $BTS1],
                            Send    => {When => {Conn => 0,
                                                 Message => 'FaultReport',
                             Routing => {TRXC => 1},
                          MOClass => 'RX',
                          IntFaultMapClass2A => {FaultMap => [2, 0, 0, 0, 0, 0]}},
                                        What => {Conn => 1,
                                                 List => [{Server => 'DVT', Message => 'Command', String => Str('TRX0:PPC')},
                                                          {Server => 'DVT', Message => 'Command', String => Str('cma read 10590')},
                                                          {Server => 'DVT', Message => 'Command', String => Str('cma read 10990')}]},
                            Timeout => [3 * 60, 3 * 60],
                            Until   => [{Message => 'PROMPT'}, {}]);

           Here we make a restart, and when a specific FaultReport is received, a certain sequence
           shall be executed. Every command stated in the sending sequence must result in a PROMPT
           in order for the subsequent command to be sent.


           NOTE:
           - Do not use a {Send} on a thread that is used for any other purpose. That BTS connection
             blocks at Do/Put and can not be used.

           - If Abis logging is enabled during MGetSeveral, the execution can be suffering if a lot
             signaling is ongoing.


           OUTPUT:
           Returned from MGetSeveral is a reference to a hash containing
           following keys (as example):

            {NrBTSConn}: Number of BTS connections (in the examples above it is 2)

            {Status}   : [status code for first BTS connection, status code for second BTS connection, ...]
                         The status code is one of:
                            'Unknown' || 'Timed out' || 'Until signal received' || 'All signals received'

            {Signals}  : {S1 => [a1, b1, ...],
                          ...
                          S2 => [a2, b2, ...]}

                         where Sn are signals, and an, bn etc are occurences on each thread.
                         Background thread is last.

            {Sequence} : [[S1, occurance, thread],
                          ...
                          [S2, occurance, thread]]

            {0}{RFResourceIndication}{001}{Sig}  : ref to first signal RFResourceIndication (first BTS conn).
                                                   The whole signal hash is found here.
            {0}{RFResourceIndication}{001}{Time} : time stamp for first signal RFResourceIndication (first BTS conn).
                                                   The time stamp is relative to the time when MGetSeveral was
                                                   entered and is given in milliseconds.
            etc

            In {0}{RFResourceIndication}{001}{Sig}, the first key  indicates the BTS connection,
            0 counting is used. There exists also thread "B" where all background signals are put.

IN     :
OUT     :


=head2 PrepareArguments

 PrepareArguments();

SUBROUTINE  :PrepareArguments
DESCRIPTION :

IN  :
OUT :


=head2 Receive

 Receive();

SUBROUTINE  : Receive
DESCRIPTION :
IN  :
OUT :


=head2 TempStoreSignal

 TempStoreSignal();

SUBROUTINE  : TempStoreSignal
DESCRIPTION :
IN  :
OUT :


=head2 UpdateStatistics

 UpdateStatistics();

SUBROUTINE  : UpdateStatistics
DESCRIPTION :
IN  :
OUT :



=cut

=head1 NAME

speechfunc


=head1 DESCRIPTION

Document number: 35/190 55-CAH 161 1290/1 Uen
MODULE      : speechfunc.pl
DESCRIPTION : Support functions for sending speech frames.
              The only routine needed to call from an external program
              is SendSpeech

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 090206    ESTEMOH             Created
P1B 090211    ESTEMOH             Cleanup of comments
P1C 090402    ESTEMOH             Close CCCH
P1C 090403    ESTEMOH             Turned on DTX and TFO in ActivateSpeech
P1D 090420    ESTEMOH             Updated for GSM base version 1.10
P1E 090424    ESTEMOH             Added Encryption
P1F 090601    ESTEMOH             Correction for Dynamic ICP. Increased to
                                  4 CodecMode patterns.
P1G 090622    ESTEMOH             Changed module header
P1H 090909    ESTEMOH             Made more subroutines available
                                  @EXPORT_OK = qw.
P1I 100105    ESTEMOH             Added safety release of Speech channel in
                                  TSS. Requires Abisco R32A or later.
P1J 100929    ESTEMOH             Added support for VAMOS
P1K 101006    ESTEMOH             Corrections for VAMOS
P1L 101110    ESTEMOH             Added MsId and Meas as parameters
P1M 110408    ETORWIL             Removed new Abisco_Connection due to
                                  HN67845 and HN65860.
A   20111018  XTOBSEM   ETORWIL   Updated to new script template
                                   Quality control with PerlCritic.
                                   Added document number.
                                   Fixed imports and exports. Removed "Str"
                                    and "Strip" from Abisco_Connection
                                    include.
                                   Fixed exists bug with OPT2 hash in ActivateChannel
                                   Removed undef from hash in SendSpeech

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Carp> 

L<mssim_sub> 

L<mssim> 

L<mssim_def> 

L<User> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ActivateChannel

 ActivateChannel();

SUBROUTINE  : ActivateChannel
DESCRIPTION : To make Channel Activation Normal Assign for speech.

IN  : Parameter Hash
OUT : 0=OK, 1=Error


=head2 ActivateSpeech

 ActivateSpeech();

SUBROUTINE  : ActivateSpeech
DESCRIPTION : To activate speech in TSS, either "Frames" or "LoopBack"

IN  : Parameter hash
OUT : 0=OK, 1=Error


=head2 AllocateICP

 AllocateICP();

SUBROUTINE  : AllocateICP
DESCRIPTION : To allocate ICP and CI number

IN  : Param Hash
OUT : ICP
      CI


=head2 ChActMSSIM

 ChActMSSIM();

SUBROUTINE  : ChActMSSIM
DESCRIPTION : To activate a channel in the MSSIM

IN  : Parameter Hash
OUT : CcId


=head2 ChRelMSSIM

 ChRelMSSIM();

SUBROUTINE  : ChRelMSSIM
DESCRIPTION : To release a channel in the MSSIM

IN  : Parameter Hash
OUT : None


=head2 CreateAcs

 CreateAcs();

SUBROUTINE  : CreateAcs
DESCRIPTION : Create the Acs parameter used in MSSIM commands

IN  : Param Hash
OUT : Param Hash updated with Acs


=head2 DeactivateSpeech

 DeactivateSpeech();

SUBROUTINE  : DeactivateSpeech
DESCRIPTION : To deactivate speech in TSS

IN  : Statistics (On, Off)
      Parameter Hash
OUT : 0=OK, 1= Error
      Result hash including statistics


=head2 DeallocateICP

 DeallocateICP();

SUBROUTINE  : DeallocateICP
DESCRIPTION : To allocate ICP and CI number

IN  : Param Hash
OUT : None


=head2 DefinePattern

 DefinePattern();

SUBROUTINE  : DefinePattern
DESCRIPTION : To define pattern file to MSSIM

IN  : Parameter Hash
OUT : 0=OK


=head2 Encr

 Encr();

SUBROUTINE  : Encr
DESCRIPTION : To activate encryption in MSSIM

IN  : Parameter Hash
OUT : None


=head2 GetStatistics

 GetStatistics();

SUBROUTINE  : GetStatistics
DESCRIPTION : To get TSS speech statistics returned in
              DeactivateSpeech command.

IN  : Response hash from Abisco
      Speech Rate
OUT : Result hash including statistics


=head2 ReadAbiscoConfig

 ReadAbiscoConfig();

SUBROUTINE  : ReadAbiscoConfig
DESCRIPTION : To get AbisMode and TCH Configuration for a specific TRXC

IN  : Param Hash
OUT : AbisMode
      TCH_Type


=head2 ReleaseChannel

 ReleaseChannel();

SUBROUTINE  : ReleaseChannel
DESCRIPTION : To make RF Channel Release in BTS

IN  : Parameter Hash
OUT : 0=OK, 1=Error


=head2 SLEEP

 SLEEP();

SUBROUTINE  : SLEEP
DESCRIPTION : Special sleep routine.
              The normal sleep does not work with TK GUI.

IN  : Time in seconds
OUT : None


=head2 SendSpeech

 SendSpeech();

SUBROUTINE  : SendSpeech
DESCRIPTION : To activate sending of speech, either from MSSIM or from TSS

IN  : Param hash including:
             $Param{TG}
             $Param{TRXC}
             $Param{TS}
             $Param{SubCh}          TCH sub channel (0/1)
             $Param{DTX}            DTX Downlink (On/Off)
        See IWD Browser:
             $Param{TypeOfCh}       According to Abisco Ch Activation
             $Param{AlgOrRate}      According to Abisco Ch Activation
             $Param{ChRate}         According to Abisco Ch Activation
             $Param{ChannelType}    According to Abisco Ch Activation
             $Param{MRVersion}      According to Abisco Ch Activation
             $Param{ICMI}           According to Abisco Ch Activation
             $Param{StartMode}      According to Abisco Ch Activation
             @{$Param{AMR}}         According to Abisco Ch Activation
             $Param{TFO}            According to Abisco Ch Activation
             $Param{SCS}            According to Abisco Ch Activation
             $Param{MACS}           According to Abisco Ch Activation
             $Param{SimTypeTSS}     TSS simulation type "Frames" or
                                    "LoopBack".
             $Param{StartCodec}     According to Abisco ActivateSpeech
                                    OPT1.CodecMode.
          SpeechPatternStruct:
             $Param{SPType1}        According to Abisco ActivateSpeech
             $Param{SPTime1}        According to Abisco ActivateSpeech
             $Param{SPType2}        According to Abisco ActivateSpeech
             $Param{SPTime2}        According to Abisco ActivateSpeech
          CodecModePatternStruct:
             $Param{CodecDL1}       According to Abisco ActivateSpeech
             $Param{CodecUL1}       According to Abisco ActivateSpeech
             $Param{CodecTime1}     According to Abisco ActivateSpeech
             $Param{CodecDL2}       According to Abisco ActivateSpeech
             $Param{CodecUL2}       According to Abisco ActivateSpeech
             $Param{CodecTime2}     According to Abisco ActivateSpeech
             $Param{CodecDL3}       According to Abisco ActivateSpeech
             $Param{CodecUL3}       According to Abisco ActivateSpeech
             $Param{CodecTime3}     According to Abisco ActivateSpeech
             $Param{CodecDL4}       According to Abisco ActivateSpeech
             $Param{CodecUL4}       According to Abisco ActivateSpeech
             $Param{CodecTime4}     According to Abisco ActivateSpeech

             $Param{LoopDelay}      According to Abisco ActivateSpeech OPT3
             $Param{SimTypeMSSIM}   "LOOP", "PRBS", "PLAY_CHK" or "PLAY_REC"
             $Param{TxFile}         TxFile for MSSIM, see Prisma GSM base
             $Param{RxFile}         RxFile for MSSIM, see Prisma GSM base
             $Param{RxMax}          Rxmax for MSSIM, see Prisma GSM base
             @{$Param{Codec}}       Used Codecs, MSSIM format example:
                                    ["AFS4_75", "AFS5_15", "AFS5_9",
                                     "AFS6_7"].
             $Param{TimeToRun}      Time to run (in seconds)
             $Param{VAMOS}          Optional, defined = VAMOS
             $Param{MSCapability}   Optional, MS Capability
             $Param{MixingOrder}    Optional, Mixing Order
             $Param{TSCSet}         Optional, TSC Set}
             $Param{TSC}            Optional, TSC
             $Param{BP2}            Optional, BS Power 2
             $Param{VAMOS_SubCh}    Optional, VAMOS SubChannel

OUT : Error 0=OK, 1=error
      Error Reason
      Result hash including:
             @{$Result{Statistic1}}   MSSIM fixed counters
             @{$Result{Statistic2}}   MSSIM variable counters from
                                      Cnt parameter.
             @{$Result{Statistic3}})  TSS counters
        Optional MSSIM variable counters from Cnt parameter,
        for GUI presentation:
             @{$Result{CntRow0}})
             @{$Result{CntRow1}})
             @{$Result{CntRow2}})
             @{$Result{CntRow3}})
             @{$Result{CntRow4}})
             @{$Result{CntRow5}})


=head2 StartLoopMSSIM

 StartLoopMSSIM();

SUBROUTINE  : StartLoopMSSIM
DESCRIPTION : To start the loop function in MSSIM

IN  : Parameter Hash
OUT : 0=OK


=head2 StartPLAY

 StartPLAY();

SUBROUTINE  : StartPLAY
DESCRIPTION : To start the play function in MSSIM

IN  : Parameter Hash
OUT : 0=OK


=head2 StartPRBS

 StartPRBS();

SUBROUTINE  : StartPRBS
DESCRIPTION : To start the PRBS function in MSSIM

IN  : Parameter Hash
OUT : 0=OK


=head2 StopLoopMSSIM

 StopLoopMSSIM();

SUBROUTINE  : StopLoopMSSIM
DESCRIPTION : To stop the loop function in MSSIM and prepare statistics

IN  : Parameter Hash
OUT : Result Hash


=head2 StopPLAY

 StopPLAY();

SUBROUTINE  : StopPLAY
DESCRIPTION : To stop the play function in MSSIM and prepare statistics

IN  : Parameter Hash
OUT : Result hash including statistics


=head2 StopPRBS

 StopPRBS();

SUBROUTINE  : StopPRBS
DESCRIPTION : To stop the PRBS function in MSSIM and prepare statistics

IN  : Parameter Hash
OUT : Result Hash


=head2 UnpackCnt

 UnpackCnt();

SUBROUTINE  : UnpackCnt
DESCRIPTION : To unpack statistics in the Cnt parameter

IN  : RESP (Response hash from MSSIM)
      Result Hash
OUT : Result Hash updated with Cnt parameters


=head2 numerically

 numerically();

SUBROUTINE  : numerically
DESCRIPTION : Numerical sorting

IN  : None
OUT : None



=cut

=head1 NAME

StabFunc


=head1 DESCRIPTION

--------Document number: 36/190 55-CAH 161 1290/1 Uen
MODULE      : StabFunc.pm
DESCRIPTION :
AUTHOR      : ERADIPE

COPYRIGHT (C) 2005 Ericsson AB

Rev      Date       Name      Comment
PA1      20060111   ERADIPE   First revision
PA2      20070301
P1A      20080319   ERABAHG   New rev
P1B      20080401   XRSJALI   Implementing CR 5761.
P1C      20090416   ERABAHG   Merged to main
P1D      20080609   XRSJALI   Updated for CR 5758. Merged to main
P1E_1A   20080902   XMATTEK   Updated for CR 5759
P1F      20080903   ERABAHG   Merge to main
P1F_1A   20080929   XMATTEK   Implementing CR 5904.
P1F_1B   20080929   XRSJALI   Implementing CR 5771.
P1F_1C   20080929   XRSJALI   Implementing CR 5888.
P1G      20081008   XRSJALI   Merge to main
P1G_1A   20081014   XMATTEK   Implemented CR 5764.
P1H      20081020   XRSJALI   Merge to main
P1H_1A   20081111   XRSJALI   Implemented TR 5951.
P1J      20081111   XRSJALI   Merge to main
P1J_1A   20090203   XYNSTAN   Implemented TR5984
P1K      20090203   XYNSTAN   Merge to main
B        20110907   XSOFFRO   Added new document number

Note that on 2011-06-20 the revision style was changed back to A, B and so on.
This is a document, not a product!

=head1 REQUIRES

L<PerlFunc(PrettyPrint,> 

L<Globals()> 

L<Spreadsheet::WriteExcel> 


=head1 METHODS

=head2 ConnectToServer

 ConnectToServer();

FUNCTION : ConnectToServer
COMMENT  :

IN	   :
OUT	   :


=head2 DisconnectFromServer

 DisconnectFromServer();

FUNCTION : DisconnectFromServer
COMMENT  :

IN	   :
OUT	   :


=head2 GenerateMeasurements

 GenerateMeasurements();

FUNCTION : GenerateMeasurements
COMMENT  : A measurement contains following parts:
             [[data log #1], [data log #2], .., [LTS success rates], [[fault report #1], ..], Code]

              data log #nr is data aquired for every monitor e.g. DX, TRU0
              data logs are repeated for every log e.g. IDLE, POOL
              Code is:
                 '<' : nothing
                 'L' : loading has commenced
                 'R' : restart has commenced
                 'F' : FAS has commenced

              Code is marked only when starting the activity. After that it is '<'.
              This routing fills everything except for the Code.

IN	   :
OUT	   :


=head2 GetLogIndicator

 GetLogIndicator();

FUNCTION : GetLogIndicator
COMMENT  :

IN	   :
OUT	   :


=head2 InitAcc

 InitAcc();

FUNCTION : InitAcc
COMMENT  :

IN	   :
OUT	   :


=head2 InitMeas

 InitMeas();

FUNCTION : InitMeas
COMMENT  :

IN	   :
OUT	   :


=head2 PrepareData

 PrepareData();

FUNCTION : PrepareData
COMMENT  :

IN	   :
OUT	   :


=head2 PrintAcc

 PrintAcc();

FUNCTION : PrintAcc
COMMENT  :

IN	   :
OUT	   :


=head2 PrintData

 PrintData();

FUNCTION : PrintData
COMMENT  :

IN	   :
OUT	   :


=head2 ReadMessage

 ReadMessage();

FUNCTION : ReadMessage
COMMENT  :
IN	   :
OUT	   :


=head2 SaveResults

 SaveResults();

FUNCTION : SaveResults
COMMENT  :

IN	   :
OUT	   :


=head2 SearchForErrors

 SearchForErrors();

FUNCTION : SearchForErrors
COMMENT  :

IN	   :
OUT	   :


=head2 SendMessage

 SendMessage();

FUNCTION : SendMessage
COMMENT  :
IN	   :
OUT	   :


=head2 SendToServer

 SendToServer();

FUNCTION : SendToServer
COMMENT  :

IN	   :
OUT	   :


=head2 UpdateAcc

 UpdateAcc();

FUNCTION : UpdateAcc
COMMENT  :

IN	   :
OUT	   :


=head2 UpdateData

 UpdateData();

FUNCTION : UpdateData
COMMENT  :

IN	   :
OUT	   :


=head2 UpdateMeas

 UpdateMeas();

FUNCTION : UpdateMeas
COMMENT  :

IN	   :
OUT	   :



=cut

=head1 NAME

SupportFunc


=head1 DESCRIPTION

Document number: 37/190 55-CAH 161 1290/1 Uen
MODULE      : SupportFunc.pm
DESCRIPTION :

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
PA1 20050419  ERADIPE
    20050906  ERADIPE             Workaround for DVT logs.
                                  Added Cabinet type.
    20060227  ERADIPE             GetTGData updated for UFTE R18B
P1A 20080319  ERABAHG             New rev
B   20110830  XJMJMJM   XLEIMAR   Updated to new script template,
                                   Quality control with PerlCritic
                                   Included Strip from Msg.


=head1 REQUIRES

L<English> 

L<Carp> 

L<PerlFunc> 

L<DVTFunc> 

L<User> 

L<Msg> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 GetSeveral

 GetSeveral();

SUBROUTINE  : GetSeveral
DESCRIPTION : An example call:

             $SignalList =
               GetSeveral(BTSConn => $BTS1,
                          Expect  => [{Message => Accept},
                                      {Message => RFResourceIndication},
                                      PROMPT],
                          Upto    => [1, 3, 1],
                          Timeout => 30,
                          Until   => {Message => Reject});

             {Expect} can contain a list of signal names or hashes
             (for assert). Entry {Upto} must exist if {Expect} exists.
             Timeout defaults to 10 minutes.

             Returned from GetSeveral is a reference to a hash with entry
             names the signal names that were received. Three additional
             entries are given:

               {Status}   : 'Timed out' || 'All signals received' ||
                            'Until signal received'
               {Signals}  : e.g. {Accept => 1, RFResourceIndication => 3,
                            FaultReport => 2} indicating the number of
                            signals of each sort that were received.
               {Sequence} : [[RFResourceIndication, 1],
                             [FaultReport, 1],
                             [Accept, 1],
                             [FaultReport, 2],
                             [RFResourceIndication, 2],
                             [RFResourceIndication, 3]]

             The signals look like this:
               {Accept}{001}
               {FaultReport}{001}
               {FaultReport}{002}
               {RFResourceIndication}{001}
               {RFResourceIndication}{002}
               {RFResourceIndication}{003}

             The first entry is $ReceivedSignal (e.g. Accept, FaultReport,
             ACK). Each entry above is a hash having two entries: Sig and
             Time. Entry Sig is the signal as received with a little
             modification done for Abis signals, PROMPT's etc. This is done
             for simplification, we would like for instance to be able to
             say:

                 Expect => [{Message => ChannelActAck__ABIS_UL},
                            {Message => PROMPT}]

             Messages tagged as RESP, ERR, SPONT and REPORT will set
             $ReceivedSignal to $Resp->{Message}.

             Messages tagged as ABIS_DL and ABIS_UL will set $ReceivedSignal
             to the signal name extracted from $Resp->{Message} and
             concatenated with the tag, e.g. 'NegotiationRequest__ABIS_DL'.
             Under {Sig} there are only three keys: 'TimeStamp(ms)',
             'Data (Hex)' and 'Data (Text)' which are extracted from
             $Resp->{Message}. All other keys are deleted and {Message} is
             set to $ReceivedSignal (to be able to do Assert).

             All other tags, e.g. ACK or ECHO, set $ReceivedSignal to
             $Resp->{Tag}. No relevant data is saved under {Sig}.
             {Message} is set to the tag.

IN  : See example above.
OUT :


=head2 GetTGData

 GetTGData();

SUBROUTINE  : GetTGData
DESCRIPTION : Fills %TG with TG and cell data used throughout this program.
              Data is read from the TG itself, from the DVT and from the OMT

IN  : 1. $TG   -> A reference to %TG
      2. $rP   -> e.g. ['DVT']
                  Any combination of 'DVT', 'OMT' and 'Site'.
OUT :


=head2 GreaterOrEqual

 GreaterOrEqual();

SUBROUTINE  : GreaterOrEqual
DESCRIPTION :

IN  :
OUT :



=cut

=head1 NAME

SwitchBox


=head1 DESCRIPTION

Document number : 38/190 55-CAH 161 1290/1
MODULE          : SwitchBox.pm
DESCRIPTION     : Provides some APIs to control a switchbox.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV   DATE      NAME            REVIEW     COMMENT
A     20110930  XTANGHE         XTOBSEM    Imported from ACM project
B     20120530  XLEAENG                    HP14008: Updated with ACM libraries
                                           Updated to new script template.
                                           Quality control with PerlCritic
C     20130703  Syntronic AB/   XWOOKUN    Removed trailing spaces and hard tabs


=head1 REQUIRES

L<Carp> 

L<English> 

L<PerlFunc> 

L<MIME::Base64> 

L<POSIX> 

L<Socket> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 new

 $self->new();

SUBROUTINE  : new
DESCRIPTION : Create an instance of the SwitchBox object that can be
              used by the TP to control and query the status of the
              switchbox.

IN  : A hash with the following hash-key(s)
      1. Address  -> Hostname or IP address of the switchbox.
      2. Port     -> Port number of the switchbox.
      3. Username -> Name that is used to login when
                     establishing a connection to the
                     switchbox.
      4. Password -> Password that is used to login when
                     establishing a connection to the
                     switchbox.
      5. Timeout (Optional) ->
           Time (in seconds) to wait for a response after
           sending a request to the switchbox before retrying.
      6. Retries (Optional) ->
           Number of times to resend requests after a previous
           request did not respond due to timeout.
OUT : 1. $rObj -> Reference to the newly instantiated SwitchBox
                  object.


=head2 CancelReset

 $self->CancelReset();

SUBROUTINE  : CancelReset
DESCRIPTION : Breaks or cancels an ongoing reset sequence. If the
              switchbox is not currently performing an active reset,
              this function does nothing.

IN  : -
OUT : -


=head2 IsSwitchedOn

 $self->IsSwitchedOn();

SUBROUTINE  : IsSwitchedOn
DESCRIPTION : Checks to determine whether the switchbox is currently
              powered on.

IN  : -
OUT : 1. $Answer -> One of:
           1 - The switchbox is on.
           0 - The switchbox is off.


=head2 Off

 $self->Off();

SUBROUTINE  : Off
DESCRIPTION : Power off the switchbox.

IN  : -
OUT : -


=head2 On

 $self->On();

SUBROUTINE  : On
DESCRIPTION : Power on the switchbox.

IN  : -
OUT : -


=head2 Print

 $self->Print();

SUBROUTINE  : Print
DESCRIPTION : Display the value of one of the SwitchBox object's
              attributes (hash-keys that were set during the object's
              construction) on the screen. For example,

                $SB->Print('Address');

              will print,

                Address is 10.0.100.0

IN  : 1. $Attribute -> A SwitchBox object's attribute name.
                       This could be: 'Address', 'Port',
                       'Username', 'Password', 'Timeout',
                       or 'Retries'.
OUT : -


=head2 Read

 $self->Read();

SUBROUTINE  : Read
DESCRIPTION : Display the current status of the switchbox on the screen.
              The output should look something like this:

                SWITCH  INRESET  -W-    -R-
                   1       0      1      1

              The first column tells whether the switch is on/off.
              The second column tells whether it is doing a reset
              sequence. The -W- and -R- tells whether you have write
              and read permissions respectively.

IN  : -
OUT : -


=head2 Reset

 $self->Reset();

SUBROUTINE  : Reset
DESCRIPTION : Start a reset sequence, whereby the switchbox will power
              off for a preconfigured time. You can find out the current
              reset delay by logging on to
                http://$rX->{Address}/config.htm

IN  : -
OUT : -


=head2 Write

 $self->Write();

SUBROUTINE  : Write
DESCRIPTION : (This function has no use.)

IN  : -
OUT : -



=cut

=head1 NAME

Trig


=head1 DESCRIPTION

Document number: 5/190 55-CAH 161 1290/1 Uen
MODULE      : Trig.pm
DESCRIPTION : Utility functions for working with the 'Trig' routine provided
              by the 'Abisco_Connection' package. Remember that trigs that
              are set later override earlier ones.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 000927    QRAJRHD             Created, trig patterns from user.pm
P1Y 000911    QRAJRHD             Accept local to remote while link lost
P1Z 001108    QRAJRHD             Modified error messages
P2A 001109    QRAJRHD             Do not accept L/R SWI (BTS In Local Mode)
P2B 010411    QRAJRHD             'Trig_Set' example was too complicated
P2C 010521    QRAFRYS             Change of semantics in Trig_Set
P2D 010810    QRAJRHD             Suppress PCU failures
P2E 010903    QRAFRYS             Improved Trig_Set documentation
P2F 010911    QRAFRYS             Added revision information to trig.html
P2G 060601    QMIKHEL             <> changed to () due to Perl upgrade
                                  to 5.8 .
A   070607    XYNHAKS             Approved for UFTE R23A.
B 20110810    ETORWIL   XLEIMAR   Moved code into new template.
                                   Implemeted use strict, warnings and
                                    diagnostics (Quality improvement).
                                   Imported Untrig from Abisco_Connection
                                    since not existing in user.pm.

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Carp> 

L<Msg> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 Error

 Error();

SUBROUTINE  : Error
DESCRIPTION : Set result to 'Error'. Can be used as trig handler for message
              patterns that indicate an error in the test system itself (and
              not in the SUT). The TP support does not really distinguish
              between 'Error' and 'Fail', but Texas does make a distinction
              by applying heuristics on the error message. See also L(Fail).

IN  : $1 - Abisco_Connection instance
      $2 - Matching message
OUT : None (raises an exception)


=head2 Fail

 Fail();

SUBROUTINE  : Fail
DESCRIPTION : Set result to 'Fail'. Can be used as trig handler for message
              patterns that indicate a failure in the system under test
              (SUT). Throws an exception that stops the test immediately.
              See also L(Not_Applicable).

IN  : $1 - Abisco_Connection instance
      $2 - Matching message
OUT : None (raises an exception)


=head2 Not_Applicable

 Not_Applicable();

SUBROUTINE  : Not_Applicable
DESCRIPTION : Set result to 'Not_Applicable'. Can be used as trig handler
              for message patterns that make the test outcome uncertain
              (manual evaluation needed). If the trig occurs after a test it
              will be booked to the next test (if there is one).
              See also L(Pass).

IN  : $1 - Abisco_Connection instance
      $2 - Matching message
OUT : None (stops search for more triggers)


=head2 Pass

 Pass();

SUBROUTINE  : Pass
DESCRIPTION : Trig handler for acceptable message patterns. The routine does
              nothing, but the trig search is stopped (since it matched).
              The handler is normally inserted last in the trig list, so
              that it can shaddow higher severity levels (Not_Applicable,
              Fail, Error). The message is not skipped, so the normal TP
              code can have a second opinion on it.

IN  : $1 - Abisco_Connection instance
      $2 - Matching message
OUT : None (stops search for more triggers)


=head2 Trig_Clear

 Trig_Clear();

SUBROUTINE  : Trig_Clear
DESCRIPTION : @Triggers = Trig_Set;
               Trig_Clear(@Triggers);

              Cancel triggers. Input is a list of trig identities as
              returned from L(Trig_Set) and/or individual Id's returned from
              Abisco_Connection::Trig.

IN  : @1 - See POD
OUT : None


=head2 Trig_Set

 Trig_Set();

SUBROUTINE  : Trig_Set
DESCRIPTION : Set up trig handlers for the four test outcomes. The right
              sides are message patterns, the same as in 'Assert'. An
              'undef' message pattern means no trigger.

              Returns a list of trig Ids which can be used with L(Trig_Clear)

              Examples:
              Specify all parameters explicitly

                Trig_Set( Pass           => $Trig::Pass,
                          Not_Applicable => $Trig::Not_Applicable,
                          Fail           => $Trig::Fail,
                          Error          => $Trig::Error);

              The parameters above are the defaults,
              so this is the same thing:

                Trig_Set;

              If less than all four parameters are specified only the
              specified triggers will be set

                Trig_Set(Pass           => $Trig::Pass,
                         Not_Applicable => $Trig::Not_Applicable);

              Memorize trig Ids (for Trig_Clear):

                @Trig = Trig_Set;

              More examples:

              Do not use any pass trigger. Set TC to fail on
              'ABORT_LINK_ERROR', or if there is a message from BG with
              Class2 FaultMap of [2,0]:

                Trig_Set(Pass => undef,
                         Fail => [{Message => ABORT_LINK_ERROR},
                                  {Server => BG,
                                   ExtConditionMapClass2
                                     => {FaultMap => [ 2, 0 ]}
                                  }]
                        );

              Using 'Pass' subroutine provided by 'Trig.pm' in a low level
              call to 'Abisco_Connection::Trig'. Allow
              'ConnectionFailureIndication' by letting the 'Pass' handler
              intercept the message (register this trig after the default
              trig setup):

                Abisco_Connection::Trig({Message
                                           => ConnectionFailureIndication},
                                        &Trig::TrigPass);

IN  : %1 - See POD
OUT : @1 - List of handles to be used when deleting the triggers



=cut

=head1 NAME

tstm


=head1 DESCRIPTION

Document number: 242/190 55-CAH 161 1607/1 Uen
MODULE      : tstm.pm
DESCRIPTION : Interface routines to the Prisma Test Manager. Routines in this program 
              can be used to control RACH load from MSSIM.
							More information can be found in:
								- Remote Control of Prisma Test Manager, 6/198 17-FCD 201 33 (CDM)

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV 	DATE      NAME      REVIEW    COMMENT
P1A   120820  	ESTEMOH             Created
P1B   121123  	ESTEMOH             Minor bugs corrected
P1C   130909  	ESTEMOH             Updated for TTR and AirMosaic 2.0
P1D   130916    ESTEMOH             Removed the temporary code for POOL_SESSION_CMD
P1E   130924    ESTEMOH             Correction for multiple Test Managers
P1F   131104    ESTEMOH             Avoid division with zero if RACH rate is zer0


=head1 REQUIRES

L<Abisco_Connection> 

L<User> Used for Abisco logging

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 RACHActivate

 RACHActivate();

FUNCTION : RACHActivate
COMMENT  : To activate sending of Channel Request from the Test Manager

							Note! The number of Channel Request per sec and EGPRS Channel Request per sec
              shall be given for one CCCH. MSSIM Test Manager  will automatically
              generate the same load on all configured CCCH in a cell.

							The cell number shall be the cell in the MSSIM configuraion. It is not
							necessarily the same as in the Abisco TG configuration.

IN       : 	$REQ{IP} 								IP addr to the Test Manager
       	 : 	$REQ{Cell} 							Cell number in MSSIM
         :  $REQ{InstanceNo}    Only when TTR is used
       	 : 	$REQ{ChReqPerSec} 			Number of Channel Request/s for one CCH
       	 : 	$REQ{EGPRSChReqPerSec} 	Number of EGPRS Channel Request/s for one CCH
OUT      :  $RESP{Code}							Reslut Code (0=OK)
         :  $RESP{Reason}						Text
         :  $RESP{Response}					Response received from the Test Manager


=head2 RACHActivateTTR

 RACHActivateTTR();


RACHActivate using the TTR



=head2 RACHClose

 RACHClose();

FUNCTION : RACHClose
COMMENT  : To close the socket to the Test Manager

IN       :  $REQ{InstanceNo}    Only when TTR is used
OUT      :  None


=head2 RACHCloseTTR

 RACHCloseTTR();


RACHClose using the TTR



=head2 RACHDeactivate

 RACHDeactivate();

FUNCTION : RACHDeactivate
COMMENT  : To deactivate sending of Channel Request from the Test Manager

IN       : 	$REQ{IP} 						IP addr to the Test Manager
       	 : 	$REQ{Cell} 					Cell number in MSSIM
         :  $REQ{InstanceNo}    Only when TTR is used
OUT      :  $RESP{Code}				  Reslut Code (0=OK)
         :  $RESP{Reason}				Text
         :  $RESP{Response}			Response received from the Test Manager


=head2 RACHDeactivateTTR

 RACHDeactivateTTR();


RACHDeactivate using the TTR



=head2 RACHOpen

 RACHOpen();

FUNCTION : RACHOpen
COMMENT  : To open the Query port and send a QUERY_CMD to the Test Manager

IN       : 	$REQ{IP} 						IP address to the Test Manager
OUT      :  $RESP{Code}					Reslut Code (0=OK)
         :  $RESP{Reason}				Text
         :  $REQ{InstanceNo}    Only when TTR is used


=head2 RACHOpenTTR

 RACHOpenTTR();


RACHOpen using the TTR



=head2 RACHStart

 RACHStart();

FUNCTION : RACHStart
COMMENT  : To activate the Test Manager

IN       : 	$REQ{IP} 						IP address to the Test Manager
         :  $REQ{InstanceNo}    Only when TTR is used
OUT      :  $RESP{Code}					Reslut Code (0=OK)
         :  $RESP{Reason}				Text


=head2 RACHStartTTR

 RACHStartTTR();


RACHStart using the TTR



=head2 numerically

 numerically();

=head2 tstmConfig

 tstmConfig();

FUNCTION : tstmConfig
COMMENT  : To configure the Test Manager

IN       :  Parameter hash, see document 6/198 17-FCD 201 33 (CDM)
OUT      :  Result hash


=head2 tstmGet

 tstmGet();

FUNCTION : tstmGet
COMMENT  : To receive a response from the Test Manager

IN       : 	$REQ{IPServer} 			IP Handel returned from Connect
																(Only if previous put message was "Command")

Out      :	Accept
							IPServer		IP Handel returned from Connect
							Response		If previous message was "Command"
						Reject
							Code				Error Code
							Reason			Error Reason (text)


=head2 tstmPut

 tstmPut();

FUNCTION : tstmPut
COMMENT  : To send a Command to the Test Manager

IN       : 	$REQ{Message} 			Connect, Disconnect or Command
						Connect
							IP					IP address for Test Manager
							Port				Port
							Timeout			Timeout value in seconds
						Disconnect
							IPServer		IP Handel returned from Connect
						Command
							IPServer		IP Handel returned from Connect
							String			Command String

OUT      :  None



=cut

=head1 NAME

ttr


=head1 DESCRIPTION

Document number: 243/190 55-CAH 161 1607/1 Uen
MODULE      : ttr.pm
DESCRIPTION : Connect and Disconnect to the TTR  
              Connect and Disconnect to a Tool.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV 	DATE      NAME      REVIEW    COMMENT
P1A   131212    ESTEMOH             Created


=head1 REQUIRES

L<Cwd> 

L<Win32::TieRegistry> 

L<Win32::Process> 

L<Win32> 

L<Abisco_Connection> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 ConnectTTR

 ConnectTTR();

SUBROUTINE  : ConnectTTR
DESCRIPTION : Routine to connect the Command Handler to the TTR.

IN  : None
OUT : Status => 0=OK, >0=Error
      Reason => Error reason
      Host   => Host Name
      Port   => Port number


=head2 ConnectTool

 ConnectTool();

SUBROUTINE  : ConnectTool
DESCRIPTION : To connect a tool in the TTR.

IN  : Tool => Tool Name
OUT : InstanceNo => Instance number
      Status     => 0=OK, >0=Error
      Reason     => Error reason


=head2 DisconnectTTR

 DisconnectTTR();

SUBROUTINE  : DisconnectTTR
DESCRIPTION : Routine to disconnect the Command Handler from the TTR.

IN  : None
OUT : Status => 0=OK, >0=Error
      Reason => Error reason
      Host   => Host Name
      Port   => Port number


=head2 DisconnectTool

 DisconnectTool();

SUBROUTINE  : DisconnectTool
DESCRIPTION : To disconnect a tool from the TTR.

IN  : Tool => Tool Name
      InstanceNo => Instance number
OUT : InstanceNo => Instance number
      Status     => 0=OK, >0=Error
      Reason     => Error reason


=head2 StartTTR

 StartTTR();

SUBROUTINE  : StartTTR
DESCRIPTION : Routine to start the TTR.

IN  : None
OUT : None



=cut

=head1 NAME

User


=head1 DESCRIPTION

Document number: 6/190 55-CAH 161 1290/1 Uen
MODULE      : user.pm
DESCRIPTION : User (client) interface

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
PA1 980929    QRAJRHD             Development started
PA2 981127    QRAJRHD             Ready for test
PA3 981214    QRAJRHD             Ready for Octopus (R8)
PA4 981216    QRAJRHD             Improved overrides. Pass-thru unknown servers
PA5 981217    QRAJRHD             Lis file to wordpad instead of fti
PA6 980107    QRAJRHD             Minor adaptions to install-script
PA7 980111    QRAJRHD             Lis file renamed ftx, help corrected
 A  990309    QRAJRHD             Several minor improvements (use diff)
PB1 990318    QRAJRHD             Never prompt for spec, pick lowest no.
PB2 990524    QRAJRHD             One ftx per spec, '-echo', '-ftx', more help
P2B 990816    QRAJRHD             'main::' => '::', more PAR handling, 'Check_Keys' gone
P2C 990816    QRAJRHD             Respond with server TP unless Tex
P2D 990827    QRAJRHD             Update default spec frequently
P2E 990829    QRAJRHD             List replaces first_abisco_connection.
P2F 990913    QRAJRHD             FTI and FTX in subdirectories
P2G 990921    QRAJRHD             Tool report
P2H 990922    QRAJRHD             Timeout option
P2J 991010    QRAJRHD             Rudimentary cmd line parameters working
P2K 991011    QRAJRHD             Print_Hash was not exported
P2L 991011    QRAJRHD             Quit needs to cleanup input
P2M 991012    QRAJRHD             Echo and Tagging did not see eye to eye
P2N 991012    QRAJRHD             Keyboard interrupt
P2P 991014    QRAJRHD             Command line parameter consistency check
P2Q 991101    QRAJRHD             Handle spec 0, more log padding needed
P2R 991109    QRAJRHD             Propagate BTS error messages
P2S 991110    QRAJRHD             Biafra needed newlines in FTI strings
P2T 991114    QRAJRHD             -Ignore
P2U 991205    QRAJRHD             FTS->TS, SDS->FTI (backward compatible)
P2V 991210    QRAJRHD             SUBT -> SUBTC in id's, detect missing SUB-TC in Run_Leaf
P2X 000104    QRAJRHD             SPONT when interrupted
P2Y 000113    QRAJRHD             Cancel replaces quit in alerts
P2Z 000121    QRAJRHD             Cleaned up sockets and termination
P2A 000127    QRAJRHD             'In Sub' removed, no good first, now we have line numbers
P2B 000202    QRAJRHD             'Prompt->Alert', exception handler around Quit
P2C 000205    QRAJRHD             'Config option='
P2D 000218    QRAJRHD             Eval around untrig when tool set to manual
P2E 000223    QRAJRHD             Return log fetch declaration with help on=<TC>
P2F 000223    QRAJRHD             Support TC revision number (after the letter)
P2G 000308    QRAJRHD             Product split
P2H 000411    QRAJRHD             Cleaned up user IO handling
P2I 000508    QRAJRHD             Don't do retry in Read
P2J 000505    QRAJRHD             Init to command loop and Init_Globals at 'use'-time
P2K 000515    QRAJRHD             Step modified: config option=step/nostep
P2L 000518    QRAJRHD             Crash on PGM/file name mismatch
P2M 000518    QRAJRHD             Checking cmd line parameters again
P2N 000526    QRAJRHD             Loop parameters
P2O 000616    QRAJRHD             Help On=Program_Description
P2P 000622    QRAJRHD             Step mode C-x, parameter bug, subtc "" set when no subtc
P2Q 000814    QRAJRHD             Handle CR LF in log-routine
P2S 000828    QRATHRA             Added Term i.e. calling for a TP's Term routine at 'quit'
P2T 000911    QRAJRHD             Clean input queue before every user command
P2U 000922    QRAJRHD             Reason with Not_Applicable
P2V 001002    QRAJRHD             Manual instances
P2X 001017    QRAJRHD             Logging proper messages, FTI/FTX removed
P2Y 001101    QRAJRHD             Delete trailing '\n' for Print+String
P2Z 001106    QRAJRHD             Edit P2U lost during merge
P3A 001205    QRAJRHD             Removed registry dependency, added 'Cleanup'
P3B 001220    QRAJRHD             Corrected parameter save, percent of loops
P3C 001221    ERAABAY             Corrected loop exclude counter
P3D 010118    ERAABAY             Alert TR is fixed
P3E 010121    QRAJRHD             Step mode improved
P3F 010124    QRAJRHD             Make sure Reason is cleared after each TC
P3G 010206    ERAABAY             No more support for 'Function', use 'Message'
P3G 010314    ERAABAY             CPY => 0 does not work
P3G 010320    ERAABAY             Prompt routine crashes is fixed
P3H 010329    QRAJRHD             Excluded TC could have $@ set
P3J 010329    QRAJRHD             Clear out sub-action before running cleanup (&Clean)
P3K 011023    QRAFRYS             Introduced check of PAR array in Program_Description
P3L 011112    QRAFRYS             Improved error message in Init_Command Loop
P3M 020129    QRAFRYS             Improved check of PAR array
P3N 070625    ERABAHG             Possible to handle TCid starting with letters
P3P 080529    ERABAHG             Changed print out when calling an invalid TC id
P3Q 090508    XYNSTAN             Removed TS, TXT from @TC_List in sub Get_TC_List
P3R 090520    ERATZIS             Replaced "die" in Call_With_Parameters (fix for TR 6090)
P3S 090820    ERATZIS             Added Option '-gui' in order to run with GUI (if exists). Added CreateGUI.
P3T 110322    ETORWIL             Updated lastResult reporting, now defaulting to 'Not_Applicable' instead of 'Pass'
                                   Implemented Glob_RunResult parameter to keep track of aggregated result since last commandline call
                                   Removed Not_Applicable counter and updated Respond() in Run()
                                   General code cleanup (removed use of TAB, identation cleaned trailing spaces etc)
                                   Converted script to use strict and use warnings (quality improvement)
                                   Implemented GetRunResult() function to return RunResult.
                                   Minor bugfix in Get_Exists()
                                   Fix in Crack_Test() ReqExp returning undef
                                   Fixed bug in Init_Command_Loop with option -debug
                                   Save all Fail-reasons......
C   20110114  ETORWIL             Updated to comply better with Perl Best Practices
                                   Implemented use diagnostics
                                   HO43422
                                   HO29809: Fixed function Restore_Parameters
                                    so it actually restores parameters,
                                    but sets undef to parameters that were
                                    not defined in the %Saved hash.
                                   HO29341: Fixed Set_Effective_Parameters
                                    where $ did not append to variable name
                                    string.
                                   Fixed bugs in Run_Test, while-loop +
                                    Get_TC_List - remove duplicates. Added
                                    run command line switch.
                                   Updated Cracktest
                                   Sorted TC list in Get_TC_List.
                                   Several and numerous updates please use diff
D   20120329  XSOFFRO   XNAVNAS    Fixed bug where script had to have a
                                    defined Init subroutine to run (TR HP64480).
              EDAMELI   XNAVNAS    Updates in Command_Loop due to CR HP65864
Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<PerlFunc> 

L<charnames> 

L<Carp> 

L<IO::Handle> 

L<English> Lib with readable names

L<Trig> 

L<Complex> 

L<Abisco_Connection> 

L<Msg> 

L<Hash::Util> 

L<File::Basename> 

L<Cwd> 

L<IO::Socket> 

L<Getopt::Long> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 Adjust_Case

 Adjust_Case();

SUBROUTINE  : Adjust_Case
DESCRIPTION : Check parameter list against program description. Also modify the
              letter case in parameter names.

IN  : \%1 - Hash where the keys should be corrected (only the top level)
      \%2 - Casing table, keys are all lowercase, values are in correct case

OUT : None


=head2 Alert

 Alert();

SUBROUTINE  : Alert
DESCRIPTION : Give client a set of choices (for GUI alert box).
              The first choice is selected on empty line.
              The array of choices should be packed in strings
              in tag mode too, but the MMI parser can't cope
              (restricts the button text to one word).

IN  : $0 - Optional 1st argument 'No_Log' means do not log (internal use?)
      $1 - Prompt string, default is 'Continue?'
      @2 - List of choices (max 10 according to SRS), default is (OK, Cancel)

OUT : One of @2


=head2 Break_Handler

 Break_Handler();

SUBROUTINE  : Break_Handler
DESCRIPTION : Handle SIGURG (from ABISCO_Connection). Used for client
              interrupts while waiting for an ABISCO response.

IN  : $1 - File handle
OUT : One line of input


=head2 Call_With_Parameters

 Call_With_Parameters();

SUBROUTINE  : Call_With_Parameters
DESCRIPTION : Set standard parameters and parameters from program
              description in the main program, then call the subroutine.

IN  : $1 - Subroutine name
      $2 - SubTC index, i.e. relative position in SUBT array

OUT : None


=head2 Clean

 Clean();

SUBROUTINE  : Clean
DESCRIPTION : Run the cleanup for the most recently executed test, with the
              parameters set for the right loop iteration (which may be hard
              to work out manually).

IN  : $1 - Command hash
OUT : None


=head2 Cleanup_Error_Message

 Cleanup_Error_Message();

SUBROUTINE  : Cleanup_Error_Message
DESCRIPTION : Take away the file handle/chunk info from $@

IN  : $1 - $@ or similarly formatted string (default is $@)
OUT : $1 - A presentable version of $@


=head2 Command_Loop

 Command_Loop();

SUBROUTINE  : Command_Loop
DESCRIPTION : Main loop

IN  : None
OUT : Never returns


=head2 Config

 Config();

SUBROUTINE  : Config
DESCRIPTION : Reconfigure

IN  : %1 - Command hash
OUT : Current/None


=head2 Crack_Test

 Crack_Test();

SUBROUTINE  : Crack_Test
DESCRIPTION : Parse test name and set context globals accordingly.

IN  : $1 - Test name - same format as in ordinary
      commands + spec no. only

OUT : None (dies on bad formats - globals intact)


=head2 CreateGUI

 CreateGUI();

SUBROUTINE  : CreateGUI
DESCRIPTION : If Option -gui will be used, there must be a subroutine called
              CreateGUI in Main ( or in subs_xxx.pm)

IN  : None
OUT : None


=head2 Exception

 Exception();

SUBROUTINE  : Exception
DESCRIPTION : General exception handler. $@ is assumed to be set.

IN  : None
OUT : None


=head2 Exclude

 Exclude();

SUBROUTINE  : Exclude
DESCRIPTION : See help text for corresponding user command.

IN  : $1 - Command hash
OUT : None


=head2 Find_Leaf

 Find_Leaf();

SUBROUTINE  : Find_Leaf
DESCRIPTION : Look for implementation of current test. Try
              wildcards too. Die if no implementation found.

IN  : None
OUT : The name of the routine found


=head2 General_TP_Info

 General_TP_Info();

SUBROUTINE  : General_TP_Info
DESCRIPTION : Set message hash parameters with general TP information

IN  : None
OUT : \%1 - Some message parameters


=head2 GetLastResult

 GetLastResult();

SUBROUTINE  : GetLastResult
DESCRIPTION : Returns LastResult (result returned from section p a or c)

IN  : None
OUT : The value of $Glob_LastResult


=head2 GetRunResult

 GetRunResult();

COMMENT: Returns RunResult (aggregated result since commandline)
IN: None
OUT: The value of $Glob_RunResult


=head2 Get_CPY_SPEC

 Get_CPY_SPEC();

SUBROUTINE  : Get_CPY_SPEC
DESCRIPTION : Access functions for the Program description. Relies
              on the context globals.

IN  : None
OUT : Reference to SPEC sub-hash


=head2 Get_Exists

 Get_Exists();

SUBROUTINE  : Get_Exists
DESCRIPTION : Return given hash item if it exists, so that the caller doesn't
              have to reference the key twice to avoid a warning. Doesn't unpack
              to save time.

IN  : \%1 - Hash
       $2 - Hash key to check/return.
OUT :  $1 - The value of indicated key, or undef if it doesn't exist


=head2 Get_Logs

 Get_Logs();

SUBROUTINE  : Get_Logs
DESCRIPTION : Get log list

IN  : None (using context globals)
OUT : \%1 - log list


=head2 Get_No_Of_SUBA

 Get_No_Of_SUBA();

SUBROUTINE  : Get_No_Of_SUBA
DESCRIPTION : Access functions for the Program description. Relies
              on the context globals.

IN  : None
OUT : No. of subactions for current TC


=head2 Get_PAR

 Get_PAR();

SUBROUTINE  : Get_PAR
DESCRIPTION : Get parameters

IN  : None (using context globals)
OUT : \%1 - Parameter list


=head2 Get_SPEC

 Get_SPEC();

SUBROUTINE  : Get_SPEC
DESCRIPTION : Access functions for the Program description. Relies
              on the context globals.

IN  : None
OUT : Reference to SPEC sub-hash


=head2 Get_SUBTC_Index

 Get_SUBTC_Index();

SUBROUTINE  : Get_SUBTC_Index
DESCRIPTION : Find the current subtest in the SUBTC array and
              return its index.

IN  : None  (to keep it fast)
OUT : The array index


=head2 Get_SUBTC_List

 Get_SUBTC_List();

SUBROUTINE  : Get_SUBTC_List
DESCRIPTION : Return list of subtests

IN  : None (using context globals)
OUT : \@1 - List of subtests


=head2 Get_Search_List

 Get_Search_List();

SUBROUTINE  : Get_Search_List
DESCRIPTION : Generate list of names for a test with increasing
              number of wildcards.
              Needs global context variables to be set

IN  : $1 - Prefix to prepend to each name
OUT : An array of names to try


=head2 Get_Specs

 Get_Specs();

SUBROUTINE  : Get_Specs
DESCRIPTION : Return list of supported specs

IN  : None
OUT : None


=head2 Get_TC

 Get_TC();

SUBROUTINE  : Get_TC
DESCRIPTION : Access functions for the Program description. Relies
              on the context globals.
              If a TC is not found a retry is made with a version of TC with
              initial zeros stripped

IN  : None
OUT : Reference to TC sub-hash


=head2 Get_TC_List

 Get_TC_List();

SUBROUTINE  : Get_TC_List
DESCRIPTION : Generate list of testcases in correct order.

IN  : $1 - Reference to hash of testcases (as pointed
      out by SPEC in %Program_Description).
      $2 - Take out old revisions if set

OUT : \@1 - TC's with revision in execution order


=head2 Get_Test_String

 Get_Test_String();

SUBROUTINE  : Get_Test_String
DESCRIPTION : Pack a test name string using global context variables

IN  : None
OUT : None


=head2 Get_Timeout

 Get_Timeout();

SUBROUTINE  : Get_Timeout
DESCRIPTION : Get timeout

IN  : None (using context globals)
OUT : $1 - Timeout


=head2 Get_Tools

 Get_Tools();

SUBROUTINE  : Get_Tools
DESCRIPTION : Get needed test instruments

IN  : None (using context globals)
OUT : \%1 - log list


=head2 Get_Tries

 Get_Tries();

SUBROUTINE  : Get_Tries
DESCRIPTION : Generate list of values to try for a particular
              context global. If the global is undefined or null
              then a null list is returned.

IN  : $1 - Name of a context global
OUT : List of names to try


=head2 Help

 Help();

SUBROUTINE  : Help
DESCRIPTION : Print requested help info

IN  : %1 - Command hash
OUT : None


=head2 Help_Context

 Help_Context();

SUBROUTINE  : Help_Context
DESCRIPTION : Describe run-time context

IN  : None
OUT : None


=head2 Help_Doc

 Help_Doc();

SUBROUTINE  : Help_Doc
DESCRIPTION : Give general program information (only available
              at run-time)

IN  : None
OUT : None


=head2 Help_Test

 Help_Test();

SUBROUTINE  : Help_Test
DESCRIPTION : Print out info about test on different levels

IN  : $1 - Test name - same format as in ordinary
      commands + spec no. only
OUT : True if correct/supported test name, false otherwise


=head2 Help_Test_Get_PAC

 Help_Test_Get_PAC();

SUBROUTINE  : Help_Test_Get_PAC
DESCRIPTION : Generate PAC list (Auxiliary to Help_Test)
              Needs global context variables to be set

IN  : None
OUT : Array of values representing the PAC and sub-actions


=head2 Init

 Init();

SUBROUTINE  : Init
DESCRIPTION : See help text for corresponding user command.

IN  : $1 - Command hash
OUT : None


=head2 Init_ABISCO

 Init_ABISCO();

SUBROUTINE  : Init_ABISCO
DESCRIPTION : Bend ABISCO into shape for function test

IN  : None
OUT : None


=head2 Init_Client_Socket

 Init_Client_Socket();

SUBROUTINE  : Init_Client_Socket
DESCRIPTION : Make this program a socket server instead
              of using STDIO for the client interface
              The client must be started between the 'new' and
              the accept to avoid a race condition between the
              socket setup and the client startup.

IN  : $1 - IP host name (the name of this computer)
      $2 - IP port number that this program serves

OUT : None


=head2 Init_Command_Loop

 Init_Command_Loop();

SUBROUTINE  : Init_Command_Loop
DESCRIPTION : Set up defaults and call Program Init routine.

IN  : None
OUT : None


=head2 Init_Globals

 Init_Globals();

SUBROUTINE  : Init_Globals
DESCRIPTION : Set up defaults for TP global ((loop) parameters, and some
              locally used globals

IN  : None
OUT : None


=head2 Init_Spec

 Init_Spec();

SUBROUTINE  : Init_Spec
DESCRIPTION : Pick a default SPEC (TS). Use the one with the
              lowest number. The UG says to favour RS2000, but
              that's the same thing.

IN  : None
OUT : None


=head2 Int_Handler

 Int_Handler();

SUBROUTINE  : Int_Handler
DESCRIPTION : Handle SIGINT

IN  : $1 - File handle
OUT : One line of input


=head2 Log

 Log();

SUBROUTINE  : Log
DESCRIPTION : Put string in ABISCO log file. Newlines are re-
              moved and converted since they mean end of comment
              in ABISCO (an improvement would be to make one log
              call per line). 'Do' is used instead of 'Put' to
              get rid of the new CH prompt. A period is added last
              in case it ends with ',', the CH otherwise waits
              for more without issuing a new prompt (the dot felt
              cheaper than substitution, this routine is called a lot).

IN  : $1 - String to log,
      or \%1 - Message hash

OUT : None


=head2 Log_Test

 Log_Test();

SUBROUTINE  : Log_Test
DESCRIPTION : Log test started/stopped

IN  : $1 - A prefix character to use as marker
      $2 - The name of the object to log
      $3 - The action (Start or End)

OUT : None


=head2 Loop_Exclude

 Loop_Exclude();

SUBROUTINE  :Loop_Exclude
DESCRIPTION : Return true if the current iteration should be
              excluded. Currently checks all values, set by TP, PD, predef
              or command line. To only check values set per iteration, use
              the 'Saved' hash.

IN  : None (looks at the current variable settings in main::)
OUT : $1 - True if this iteration should be skipped (i.e. forbidden
      combination or not in random pick)


=head2 Loop_Init

 Loop_Init();

SUBROUTINE  : Loop_Init
DESCRIPTION : Initialize indices for loop parameters. This must be done after
              the TC is selected, since the parameters must be case-corrected
              first.

IN  : None
OUT : None


=head2 Loop_Step

 Loop_Step();

SUBROUTINE  : Loop_Step
DESCRIPTION : Advance loop parameter indices. If one wraps around then goto
              the next one.

IN  : None
OUT : $1 - False on overflow (all came to zero again), true otherwise


=head2 Manual_Prompt

 Manual_Prompt();

SUBROUTINE  : Manual_Prompt
DESCRIPTION : Transform a tool command into a user prompt

IN  : $1 - Intercepting Abisco_Connection instance
      \%2 - Message hash

OUT : None


=head2 Manual_UL

 Manual_UL();

SUBROUTINE  : Manual_UL
DESCRIPTION : Intercepts Get calls that expect input from a manual tool

IN  : $1 - Intercepting Abisco_Connection instance
      \%2 - Expected message

OUT : None


=head2 Opt_Step

 Opt_Step();

SUBROUTINE  : Opt_Step
DESCRIPTION : Switch step mode on or off.

IN  : $1 - 'Step'
      $2 - Perl true/false depending on whether the option is set on or off

OUT : None


=head2 Override

 Override();

SUBROUTINE  : Override
DESCRIPTION : Register a parameter override. This is just a
              simplified interface to Replace. Parameters are
              taken to be literal.

IN  : $1 - Pointer to call hash, tag names as in user command

OUT : If no args return pointer to hash of all
      replacements (old=>new pairs)


=head2 Pad

 Pad();

SUBROUTINE  : Pad
DESCRIPTION : Pad string with blanks upto indicated length.
              Longer strings are left intact.

IN  : $1 - Length to pad to
      $2 - String to pad

OUT : Padded string


=head2 Parse_Parameters

 Parse_Parameters();

SUBROUTINE  : Parse_Parameters
DESCRIPTION : Check parameter list against program description. Also modify the
              letter case in parameter names. Also case correct the exclude lists
              (the casing may be different to the previous TC).

IN  : $1 - Parameter list from the program description
      $2 - The current command (with parameters)

OUT : None


=head2 Print

 Print();

SUBROUTINE  : Print
DESCRIPTION : Write a string to the client. Also put string
              in ABISCO log (unless $3).

IN  : $1 - Tag (see CH for general info)
      $2 - String to output, line-feed must be set by the caller
      or \%2 - Message hash
      $3 - If set then do not log
      $4 - Raw mode, output raw text without (much) editing

OUT : None


=head2 Print_Array

 Print_Array();

SUBROUTINE  : Print_Array
DESCRIPTION : Print array. The tag is set for the whole block.

IN  : $1 - Tag
      $2 - Pointer to an array of text lines
OUT : None


=head2 Print_Hash

 Print_Hash();

SUBROUTINE  : Print_Hash
DESCRIPTION : Print a standard call hash to client

IN  : $1 - Tag (see option -tag in the UG)
      $2 - Pointer to standard ABISCO call hash
           (same as in 'Do')
      $3 - Pretty print if true
      $4 - Log

OUT : None


=head2 Prompt

 Prompt();

SUBROUTINE  : Prompt
DESCRIPTION : Ask client for input. If no args then ask for 'enter'

IN  : $1 - Prompt string
      $2 - Must stop if set (overrides -nonstop)
      $3 - Idle, turn off ABISCO input if set (avoid input
      buffer overflow)
      $4 - Reduced formatting (internal use)
      $5 - No logging if true (internal?), do not log UL if 'UL'

OUT : The client input line


=head2 Purify

 Purify();

SUBROUTINE  : Purify
DESCRIPTION : Normalize test name and remove unnecessary delimiters

IN  : $1 - A test name that may have extraneous delimiters
OUT : A corrected name


=head2 Quit

 Quit();

SUBROUTINE  : Quit
DESCRIPTION : Terminate processing.

IN  : None
OUT : None


=head2 Quit_Handler

 Quit_Handler();

SUBROUTINE  : Quit_Handler
DESCRIPTION : Handle SIGQUIT

IN  : $1 - File handle
OUT : One line of input


=head2 Read

 Read();

SUBROUTINE  : Read
DESCRIPTION : Read from client. Also emulate interrupts. This could have
              been a simple readline if it hadn't been for the interrupt
              handling.

IN  : $1 - File handle to read from
OUT : One line of input, or 0 if EOF, or undef on error


=head2 Replace

 Replace();

SUBROUTINE  : Replace
DESCRIPTION : Register a regular expression replacement request.
              The data is used just before transmission to Abisco

IN  : $1 - Command hash
OUT : If no args print all replacements


=head2 Respond

 Respond();

SUBROUTINE  : Respond
DESCRIPTION : Give the client a message.

IN  : \%1 - Command hash, default tag is "RESP"
      or   %1 - see previous line
      $2 - No_Log if set (to anything)

OUT : None


=head2 Restore_Parameters

 Restore_Parameters();

SUBROUTINE  : Restore_Parameters
DESCRIPTION : Restore the main programs original values, so that command
              line overrides are not remembered, or in case the TP PAR list
              was overriding globals in main.

IN  : \%1 - A hash with variables/values to restore
OUT : None


=head2 Run

 Run();

SUBROUTINE  : Run
DESCRIPTION : See help text for corresponding user command.

IN  : $1 - Command hash
OUT : None


=head2 Run_Leaf

 Run_Leaf();

SUBROUTINE  : Run_Leaf
DESCRIPTION : Log and run leaf, i e PAC

IN  : None
OUT : None


=head2 Run_PAC

 Run_PAC();

SUBROUTINE  : Run_PAC
DESCRIPTION : Run prerequisite, action or cleanup

IN  : None
OUT : None


=head2 Run_SUBA

 Run_SUBA();

SUBROUTINE  : Run_SUBA
DESCRIPTION : Run subactions

IN  : Arg1 - No. of subactions
OUT : None


=head2 Run_SUBTC

 Run_SUBTC();

SUBROUTINE  : Run_SUBTC
DESCRIPTION : Set up parameters and run PACs

IN  : None
OUT : None


=head2 Run_Spec

 Run_Spec();

SUBROUTINE  : Run_Spec
DESCRIPTION : Run all tests for one spec. If there are more than
              one revision of a testcase then pick the latest.

IN  : None
OUT : None


=head2 Run_TC

 Run_TC();

SUBROUTINE  : Run_TC
DESCRIPTION : Run all subtests of one testcase. Also works if
              subtest level is missing.

IN  : None, context globals must be set
OUT : None


=head2 Run_Test

 Run_Test();

SUBROUTINE  : Run_Test
DESCRIPTION : Run a test - any level except SPEC
              Global context variables must be set first

IN  : $1 - User command
OUT : None


=head2 Save_Par

 Save_Par();

SUBROUTINE  : Save_Par
DESCRIPTION : Save command line parameters for later check and use. Stores
              lowercased, the case can be restored with the TC parameter,
              we might not have a TC yet if it's spec level execution.

IN  : \%1 - Parameter msg sub-hash
OUT : None


=head2 Set_Effective_Parameters

 Set_Effective_Parameters();

SUBROUTINE  : Set_Effective_Parameters
DESCRIPTION : Set globals in main for this SUBTC/Loop, either from the
              program description or the command line.

IN  : \%1 - Parameter list from program declaration
      \%2 - The user command (letter case corrected)
      $3 - Parameter index (relative position) of current SUBTC (0 if none)

OUT : \%1 - Names/Values of all original values


=head2 Set_Options

 Set_Options();

SUBROUTINE  : Set_Options
DESCRIPTION : Parse command line options and set corresponding
              globals in package main (to make other packages
              independent of this package). Must be called before

IN  : @ARGV (or similar)
OUT : None


=head2 Split_TC

 Split_TC();

SUBROUTINE  : Split_TC
DESCRIPTION : Split string of test case number and revision into
              two separate items, eg: "99Z" to (99Z,"").

IN  : String to split
OUT : List of format (No, Rev)


=head2 Step

 Step();

SUBROUTINE  : Step
DESCRIPTION : Trig routine for handling of debug-step mode

IN  : $1 - Intercepting Abisco_Connection instance
      \%2 - Message hash

OUT : $1 - 'Next' not to shaddow other triggers


=head2 Try

 Try();

SUBROUTINE  : Try
DESCRIPTION : See help text for corresponding user command.

IN  : $1 - Command hash
OUT : If no args print all replacements



=cut

=head1 NAME

Util


=head1 DESCRIPTION

Document number: 7/190 55-CAH 161 1290/1 Uen
MODULE      : Util.pm
DESCRIPTION : Miscellaneous auxiliary routines to do with perl
              and the computer system (not with the BTS).

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE      NAME      REVIEW    COMMENT
P1A 991101    QRAJRHD             Created from texas support (complete
                                  needed by util.c).
P1B 000104    QRAJRHD             Canonicalize paths in 'Complete'
P1C 000221    QRAJRHD             use Carp;
P1D 000221    QRAJRHD             Remove "\.\" from paths
P1E 011107    QRAJRHD             Moving in time string routines from Texas
A   20110810  ETORWIL   XLEIMAR   Converted script using strict warnings and
                                   diagnostics, this is a quality improvment.
                                   Moved code into new code template.

Please note from 2011-06-20 this is a document not a product


=head1 REQUIRES

L<Carp> 

L<File::Spec> 

L<File::Basename> 

L<Cwd> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 Complete

 Complete();

SUBROUTINE  : Complete
DESCRIPTION : Complete file name into full path (if needed)

IN  : $1 - Possibly incomplete file name
      $2 - Default type
      @3 - List of directories to search, don't verify presence if not set.
OUT : $1 - Full absolute path or
      @1 - Name, path and suffix


=head2 Date_String

 Date_String();

SUBROUTINE  : Date_String
DESCRIPTION : Compose a date-time string the way VASS likes it.

IN  : $1 - Time as returned from 'time'  (default is current time)
OUT : $1 - YYYY-MM-DD


=head2 Date_Time

 Date_Time();

SUBROUTINE  : Date_Time
DESCRIPTION : Compose date-time string

IN  : $1 - Time as returned from 'time' (default is current time)
OUT : $1 - YYYY-MM-DD HH:MM:SS


=head2 Join

 Join();

SUBROUTINE  : <Template example row, please remove if not applicable>
DESCRIPTION : Compile file name parts (as returned by Complete or
              fileparse) into file name.

IN  : $1 - Name
      $2 - Directory
      $3 - Suffix
OUT : $1 - Full path


=head2 Time_String

 Time_String();

SUBROUTINE  : Time_String
DESCRIPTION : Compose a time of day string.

IN  : $1 - Time as returned from 'time' (default is current time)
OUT : $1 - HH:MM:SS



=cut

=head1 NAME

wireshark


=head1 DESCRIPTION

Document number: 39/190 55-CAH 161 1290/1 Uen
MODULE      : wireshark.pm
DESCRIPTION : LSU monitoring subroutines, such as Tshark logging.

COPYRIGHT ?: ERICSSON AB, S-164 80 STOCKHOLM
Company Registration number: 556056-6258
The program may be used and/or copied only with the written
permission from Ericsson AB, or in accordance with
the terms and conditions stipulated in the agreement/contract
under which the program has been supplied.
All rights reserved.

REV DATE     NAME    REVIEW  COMMENT
P1A 20091013 ERATZIS         Created based on mssim.pm
P1B 20091021 ERATZIS         Added lsuOpenAbisWLog, lsuReadAbisWLog, createMessageLogFromWLog
P1C 20091112 ERATZIS         Added checkIfParameterInLog, createMSSIMMessageLogFromWLog, convLittleEndianToBigEndian
P1D 20100218 UABJAES         Added CodecControlIndex in pgslC-hash.
P1E 20100305 ESTEMOH         Return ProcessObj from lsuStartWlog
P1F 20100531 ESTEMOH         Changed to handle multiple channels
P1G 20100611 ESTEMOH         Changed handling of ProcessObj in lsuWaitWLog
P1H 20100907 ESTEMOH         Added %REQ in lsuWaitWLog
A   20110704 XGUSTPE XLEIMAR Updated to new script template.
                              Added document number.
                              Added lock_keys hash checking on input
                              Removed unused variables MsgLength, Buffer1, Buffer2
                              Removed Abisco_Connection and User unused code.
                              Imported missing Hash::Util
                              Made filehandle $Handle global within this package scope.
                               $Handle is still passed as an argument between functions
                               within this package to avoid issues when functions in
                               this packet are called externally.
                              Added check for undef value in subroutine lsuOpenWLog.
                              Exported variables needed in Subs_PacketData.pm
                              Added support for pe_tshark and backwards
                               compatibility.
B   20111020 XLEIMAR ETORWIL Improved lsuStartWLog.
C   20111222 XNAVNAS EDAMELI HP22348 Edited lsuStartWLog to accept another command,
                              abis_or_um, used for automatically defining filenames.
D   20120615 EDAMELI XANSBEM Corrected bug in lsuReadWLog (HP99452)
E   20120827 ETORWIL EDAMELI Implemented workaround in lsuStartWLog due to threading issue in Perl

Note that on 2011-06-20 the revision style was changed back to A, B and so on.


=head1 REQUIRES

L<Hash::Util> 

L<English> 

L<mssim> 

L<threads> 

L<Carp> 

L<diagnostics> Produce verbose warning diagnostics


=head1 METHODS

=head2 checkIfParameterInLog

 checkIfParameterInLog();

SUBROUTINE  : checkIfParameterInLog
DESCRIPTION : Check if a parameter exists in a Log

IN  : $Input{Parameter}
      $Input{LogFile}               Message file containing Hex dump as string
      $Input{SameAsPreviousFN}      Sametimes the modified FN may be the same as the previous, correct one. For instance if aFN-4.
OUT : $Resp{Result}                 Result => '1' if found or Result => '0' if not found"
      $Resp{ResultText}             ResultText => "Found" or ResultText => "Not Found"
      $Resp{FoundSameAsPreviousFN}  '1' if same FN is the same as previous one


=head2 convLittleEndianToBigEndian

 convLittleEndianToBigEndian();

SUBROUTINE  : convLittleEndianToBigEndian
DESCRIPTION : To convert a string with Hex in LittleEndian to Big Endian
              Example: String 1F F4 CC is converted to CCF41F (also, spaces are removed)

IN  : $Str                String to be converted
      $NbrOfOctets        Number of octets, in the example above: 3
OUT : $ShiftedStr         Converted string


=head2 createLoggingThr

 createLoggingThr();

=head2 createMSSIMMessageLogFromWLog

 createMSSIMMessageLogFromWLog();

SUBROUTINE  : createMSSIMMessageLogFromWLog
DESCRIPTION : Create Message log From Wireshark Log

IN  : $Input{WLogFile}        Wireshark MSSIM Log File
      $Input{PGSLLogFile}     Message file name
OUT : $Config{PGSLLogFile}    Message File containing Frame number and Hex dump as string, one per Wireshark log line


=head2 createMessageLogFromWLog

 createMessageLogFromWLog();

SUBROUTINE  : createMessageLogFromWLog
DESCRIPTION : Create Message log From Wireshark Log

IN  : $Input{WLogFile}        Wireshark Log File
      $Input{PGSLLogFile}     Message file containing Hex dump as string, one per Wireshark log line
OUT : $Config{PGSLLogFile}    Message File containing containing Hex dump as string, one per Wireshark log line


=head2 lsuCloseWLog

 lsuCloseWLog();

SUBROUTINE  : lsuCloseWLog
DESCRIPTION : To close a binary Wireshark log

IN  : $Input{FileHandle}    File Handle
OUT : $Resp{Result}         Result Code (0=OK)
      $Resp{Reason}         Result Text


=head2 lsuOpenAbisWLog

 lsuOpenAbisWLog();

SUBROUTINE  : lsuOpenAbisWLog
DESCRIPTION : To open a binary LSU log and read the Basic Header,
              Counters and Channel Desciptors

IN  : $Input{FileHandle}      File Handle
      $Input{FilePath}        File path including file name
OUT : $Resp{Result}           Result Code (0=OK)
      $Resp{Reason}           Result Text
      $Resp{NoOfChannels}     Number of Channels
      $Resp{NoOfPackets}      Number of Packets (total for all channels)

      For all parameters below, see see LSU Ethereal User's manual edition 1.50 or later,
      chapter "Channel descriptors"

      $Resp{$Channel}{Domain}
      $Resp{$Channel}{Protocol}
      $Resp{$Channel}{PpuNbr}
      $Resp{$Channel}{SccRate}
      $Resp{$Channel}{UplinkChNbr}
      $Resp{$Channel}{DownlinkChNbr}
      $Resp{$Channel}{InterfaceCode}
      $Resp{$Channel}{ProcObjType}
      $Resp{$Channel}{Spare}
      $Resp{$Channel}{FilterMap}
      $Resp{$Channel}{UplinkPcmNbr}
      $Resp{$Channel}{DownLinkPcmNbr}
      $Resp{$Channel}{UplinkTsMask}
      $Resp{$Channel}{DownLinkTsMask})
      $Resp{$Channel}{UserLabelRxUl}
      $Resp{$Channel}{UserLabelTxDl}
      $Resp{$Channel}{ProcObjDescr}
      $Resp{$Channel}{ProtParamLength}
      $Resp{$Channel}{ProtParam}


=head2 lsuOpenWLog

 lsuOpenWLog();

SUBROUTINE  : lsuOpenWLog
DESCRIPTION : To open a binary LSU created by MSSIM
              This subroutine will use lsuOpenAbisWLog

IN  : $Input{FileHandle}      File Handle
      $Input{FilePath}        File path including file name
OUT : See lsuOpenAbisWLog


=head2 lsuReadAbisWLog

 lsuReadAbisWLog();

SUBROUTINE  : lsuReadAbisWLog
DESCRIPTION : To read a ABIS record including Common Trace header and SDR header from a Wireshark log

IN  : $Input{FileHandle}    File Handle
OUT : $Resp{Message}        Messaged unpacked
      $Resp{MsgType}        Message Type, see LSU Ethereal User's manual edition 1.50 or later
      $Resp{Direction}      0 = Uplink, 1= Downlink
      $Resp{MsgLength}      Message Type, see LSU Ethereal User's manual edition 1.50 or later
      $Resp{Result}
      $Resp{Reason}

      For all parameters below, see see LSU Ethereal User's manual edition 1.50 or later,
      chapter "Additional header for GSM SDR radio Messages"

      $Resp{TimestampSec},
      $Resp{TimestampMic},
      $Resp{NoOfSavedOct},
      $Resp{MsgLength},
      $Resp{ChannelId},
      $Resp{MsgType},
      $Resp{ErrorCode},
      $Resp{Spare10},
      $Resp{LostMsg},
      $Resp{MsgDiscr},


=head2 lsuReadWLog

 lsuReadWLog();

SUBROUTINE  : lsuReadWLog
DESCRIPTION : To read a record including Common Trace header and SDR header from a Wireshark log

IN  : $Input{FileHandle}    File Handle
OUT : $Resp{Message}        Messaged unpacked
      $Resp{MsgType}        Message Type, see LSU Ethereal User's manual edition 1.50 or later
      $Resp{Direction}      0 = Uplink, 1= Downlink
      $Resp{MsgLength}      Message Type, see LSU Ethereal User's manual edition 1.50 or later
      $Resp{Result}
      $Resp{Reason}

      For all parameters below, see see LSU Ethereal User's manual edition 1.50 or later,
      chapter "Additional header for GSM SDR radio Messages"

      $Resp{TimestampSec},
      $Resp{TimestampMic},
      $Resp{NoOfSavedOct},
      $Resp{MsgLength},
      $Resp{ChannelId},
      $Resp{MsgType},
      $Resp{ErrorCode},
      $Resp{Spare10},
      $Resp{LostMsg},
      $Resp{MsgDiscr},
      $Resp{FN},
      $Resp{TRX},
      $Resp{Timeslot},
      $Resp{SubTimeslot},
      $Resp{ChannelType},
      $Resp{BurstType},
      $Resp{TimeDelay},
      $Resp{CodingScheme},
      $Resp{CodecType},
      $Resp{Power0},
      $Resp{Power1},
      $Resp{Power2},
      $Resp{Power3},
      $Resp{SNR0},
      $Resp{SNR1},
      $Resp{SNR2},
      $Resp{SNR3},
      $Resp{RfLevel0},
      $Resp{RfLevel1},
      $Resp{RfLevel2},
      $Resp{RfLevel3},
      $Resp{DemodulationMask},
      $Resp{RxStatus},
      $Resp{PagingGroup},
      $Resp{Spare1},
      $Resp{Spare2},
      $Resp{USF},
      $Resp{BitLength}


=head2 lsuStartWLog

 lsuStartWLog();

SUBROUTINE  : lsuStartWLog
DESCRIPTION : To create a log file by use of Tshark
              Note! Either duration or Filesize must be given

IN  : $Input{interface}    Mandatory, name of the cfg file
      $Input{savefile}     Mandatory, path and file save file
      $Input{duration}     Optional, duration in seconds
      $Input{Filesize}     Optional, filesize in KB
      $Input{files}        Optional, Number of Ring files
      $Input{abis_or_um}   Optional, state whether Interface is ABIS or UM
OUT : $Resp{Result}        Result Code (0=OK)
      $Resp{Reason}        Result Text
      $Resp{ProcessObj}    Process Object


=head2 lsuWaitWLog

 lsuWaitWLog();

SUBROUTINE  : lsuWaitWLog
DESCRIPTION : To wait for Tshark to complete

IN  : $Input{ProcessObj}    ProcessObj returned from lsuStartWLog
OUT : $Resp{Result}         Result Code (0=OK)
      $Resp{Reason}         Result Text



=cut